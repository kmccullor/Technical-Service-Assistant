(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6549:function(e,t,s){Promise.resolve().then(s.bind(s,6191))},6191:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return el}});var a=s(7437),r=s(2265),n=s(9376),o=s(1245),i=s(8867),l=s(129),c=s(8736),d=s(9202),u=s(3247),m=s(7689),h=s(1817),p=s(9322),f=s(1671),x=s(2489),g=s(4440),v=s(7416),y=s(6980),j=s(4743),N=s(2869),b=s(4508);let w=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("textarea",{className:(0,b.cn)("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...r})});w.displayName="Textarea";var k=s(6070),S=s(5974),_=s(962);let C=_.fC,T=_.wy,A=_.Fw;async function D(e){if(navigator.clipboard)await navigator.clipboard.writeText(e);else{let t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}}let z=[".txt",".log",".csv",".json",".sql",".pdf",".xml",".conf",".config",".ini",".properties",".out",".err",".trace",".dump",".png",".jpg",".jpeg",".gif",".bmp",".tiff",".webp"];function E(e){let{conversationId:t,onConversationCreated:s,onConversationActivity:n}=e,{accessToken:b}=(0,o.a)(),[_,E]=(0,r.useState)([]),[R,Z]=(0,r.useState)(""),[U,F]=(0,r.useState)(!1),[P,O]=(0,r.useState)(null),[I,L]=(0,r.useState)(!1),[H,q]=(0,r.useState)(null),[B,M]=(0,r.useState)(!1),[V,J]=(0,r.useState)(!1),Y=(0,r.useRef)(null),G=(0,r.useRef)(null),W=(0,r.useRef)(null),K=()=>{var e;null===(e=Y.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,r.useEffect)(()=>{K()},[_]);let[$,Q]=(0,r.useState)(!1),[X,ee]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=!1,s=async t=>{if(!b){ee("Authentication required to load conversation."),E([]);return}try{Q(!0),ee(null);let s=await fetch("/api/conversations/".concat(t),{headers:{Authorization:"Bearer ".concat(b)},cache:"no-store"});if(!s.ok){if(404===s.status){ee("Conversation not found."),E([]);return}let e=await s.text().catch(()=>"");throw Error(e||"Failed to load conversation (status ".concat(s.status,")"))}let a=await s.json();if(e)return;let r=Array.isArray(null==a?void 0:a.messages)?a.messages.map(e=>{var t,s,a,r;return{id:String(e.id),role:"assistant"===e.role?"assistant":"user",content:null!==(t=e.content)&&void 0!==t?t:"",citations:Array.isArray(e.citations)?e.citations:void 0,searchType:null!==(s=e.searchType)&&void 0!==s?s:e.method,timestamp:new Date(null!==(r=null!==(a=e.createdAt)&&void 0!==a?a:e.created_at)&&void 0!==r?r:new Date().toISOString())}}):[];E(r),O(null),q(null)}catch(t){e||(console.error("Failed to load conversation history:",t),ee("Unable to load conversation history."),E([]))}finally{e||Q(!1)}};return void 0===t?(E([]),Z(""),O(null),q(null),ee(null),Q(!1)):s(t),()=>{e=!0}},[t,b]);let et=e=>{if(e.size>10485760)return"File size exceeds ".concat(10,"MB limit");let t=e.name.toLowerCase().substring(e.name.lastIndexOf("."));return z.includes(t)?null:"File type not supported. Allowed: ".concat(z.join(", "))},es=async e=>{let t=et(e);if(t){q(t);return}L(!0),q(null);try{let t=new FormData;t.append("file",e);let s=await fetch("/api/temp-upload",{method:"POST",body:t,headers:b?{Authorization:"Bearer ".concat(b)}:void 0}),a=await s.json();if(!a.success)throw Error(a.error||"Upload failed");let r={sessionId:a.sessionId,fileName:a.fileName,fileSize:a.fileSize,uploadTime:new Date().toISOString()};O(r);let n={id:Date.now().toString(),role:"assistant",content:"✅ **File uploaded successfully:** ".concat(e.name," (").concat(ea(e.size),")\n\nYou can now ask questions about this document. I'll analyze its content to provide specific insights and troubleshooting assistance."),searchType:"temp-doc",uploadedFile:r,timestamp:new Date};E(e=>[...e,n])}catch(e){console.error("Upload error:",e),q(e instanceof Error?e.message:"Upload failed")}finally{L(!1)}},ea=e=>{if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["Bytes","KB","MB"][t]},[er,en]=(0,r.useState)(!1),[eo,ei]=(0,r.useState)("");(0,r.useEffect)(()=>{let e=e=>{var t;(null===(t=e.dataTransfer)||void 0===t?void 0:t.types.includes("Files"))&&M(!0)},t=e=>{0===e.clientX&&0===e.clientY&&M(!1)};return document.addEventListener("dragenter",e),document.addEventListener("dragleave",t),()=>{document.removeEventListener("dragenter",e),document.removeEventListener("dragleave",t)}},[]);let el=async e=>{e.preventDefault();let a=R.trim();if(!a||U)return;if(!b){ei("Please sign in to chat."),en(!0);return}let r=a.match(/^\/(new|update|close)\s+case\s+(.+)$/i),o=a,i=a;if(r){let e=r[1].toLowerCase(),t=r[2].trim();if(!t){ei("Please provide a case number, e.g. /new case 01125052"),en(!0);return}"new"===e?(o="\uD83D\uDCC4 Initiating Salesforce case ".concat(t),i="You are assisting with Salesforce case ".concat(t,". Using the conversation context, define the case for analysis and recommendation by providing:\n- A concise case overview with important facts known so far.\n- Immediate diagnostic or triage steps to perform.\n- Clarifying questions that should be asked of the customer.\n- Recommended next actions for engineering/support teams.\nReturn the response with headings: Case Overview, Immediate Actions, Clarifying Questions, Recommended Next Steps.")):"update"===e?(o="\uD83D\uDEE0️ Updating Salesforce case ".concat(t),i="You are providing an update on Salesforce case ".concat(t,". Review the conversation context and produce:\n- The current status/progress of the case.\n- Outstanding issues or blockers.\n- Recommended next steps for the support engineer.\n- Suggested customer communication points.\nReturn the response with headings: Case Status, Outstanding Items, Recommended Actions, Customer Communication.")):"close"===e&&(o="✅ Closing Salesforce case ".concat(t),i="You are preparing to close Salesforce case ".concat(t,". Based on the conversation context, provide:\n- A brief incident summary.\n- Actions taken and resolutions applied.\n- Verification steps or final checks completed/needed.\n- Final closing comments for the customer.\nReturn the response with headings: Summary, Actions Taken, Verification, Closing Comments."))}let l={id:Date.now().toString(),role:"user",content:o,uploadedFile:P||void 0,timestamp:new Date};E(e=>[...e,l]);let c=i;Z(""),F(!0);try{var d,u;if(P){let e=await fetch("/api/temp-analyze",{method:"POST",headers:{"Content-Type":"application/json",...b?{Authorization:"Bearer ".concat(b)}:{}},body:JSON.stringify({sessionId:P.sessionId,query:c,maxResults:5})});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=await e.json(),s={id:(Date.now()+1).toString(),role:"assistant",content:t.response,citations:null===(u=t.results)||void 0===u?void 0:u.map((e,t)=>({id:"temp-".concat(t),title:"Section ".concat(e.rank),content:e.content,source:P.fileName,score:e.similarity})),searchType:"temp-doc",timestamp:new Date};E(e=>[...e,s]);return}let e=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(b)},body:JSON.stringify({conversationId:t,message:c,displayMessage:l.content})});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let a=null===(d=e.body)||void 0===d?void 0:d.getReader();if(!a)throw Error("No response body");let r={id:(Date.now()+1).toString(),role:"assistant",content:"",timestamp:new Date},o=t;for(E(e=>[...e,r]);;){let{done:e,value:n}=await a.read();if(e)break;for(let e of new TextDecoder().decode(n).split("\n"))if(e.startsWith("data: "))try{let a=JSON.parse(e.slice(6));"token"===a.type?E(e=>e.map(e=>e.id===r.id?{...e,content:e.content+a.token}:e)):"sources"===a.type?E(e=>e.map(e=>e.id===r.id?{...e,citations:a.sources,searchType:a.method}:e)):"conversation_id"===a.type?"number"==typeof a.conversationId&&(o=a.conversationId,void 0===t&&(null==s||s(a.conversationId))):"done"===a.type?console.log("Streaming completed"):"error"===a.type&&console.error("Streaming error:",a.error)}catch(t){console.warn("Failed to parse streaming data:",e)}}void 0!==o&&(null==n||n(o))}catch(t){console.error("Chat error:",t);let e={id:(Date.now()+1).toString(),role:"assistant",content:"Sorry, I encountered an error. Please try again.",timestamp:new Date};E(t=>[...t,e])}finally{F(!1)}},ec=e=>{switch(e){case"documents":return(0,a.jsx)(c.Z,{className:"h-3 w-3"});case"web":return(0,a.jsx)(d.Z,{className:"h-3 w-3"});case"hybrid":default:return(0,a.jsx)(u.Z,{className:"h-3 w-3"});case"temp-doc":return(0,a.jsx)(m.Z,{className:"h-3 w-3"})}},ed=e=>{switch(e){case"documents":return"Document Search";case"web":return"Web Search";case"hybrid":return"Hybrid Search";case"temp-doc":return"Uploaded Document";default:return"Search"}};return(0,a.jsxs)("div",{ref:W,className:"flex flex-col h-full relative",onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),M(!0)},onDragLeave:e=>{var t;e.preventDefault(),e.stopPropagation(),(null===(t=W.current)||void 0===t?void 0:t.contains(e.relatedTarget))||M(!1)},onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:e=>{e.preventDefault(),e.stopPropagation(),M(!1);let t=e.dataTransfer.files;t&&t.length>0&&es(t[0])},children:[B&&(0,a.jsx)("div",{className:"absolute inset-0 z-50 bg-blue-500/10 backdrop-blur-sm flex items-center justify-center border-2 border-dashed border-blue-500",children:(0,a.jsxs)("div",{className:"text-center p-8 bg-white/90 rounded-lg shadow-lg",children:[(0,a.jsx)(m.Z,{className:"h-12 w-12 mx-auto text-blue-500 mb-4"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-blue-900 mb-2",children:"Drop file to analyze"}),(0,a.jsx)("p",{className:"text-blue-700",children:"Supports logs, configs, PDFs, images, and more"}),(0,a.jsx)("p",{className:"text-sm text-blue-600 mt-2",children:"AI will analyze your document with Technical Service Assistant expertise"})]})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[$&&0===_.length?(0,a.jsxs)("div",{className:"text-center text-muted-foreground py-8",children:[(0,a.jsx)(h.Z,{className:"h-10 w-10 mx-auto mb-4 animate-spin"}),(0,a.jsx)("p",{children:"Loading conversation..."})]}):X&&0===_.length?(0,a.jsxs)("div",{className:"text-center text-red-500 py-8",children:[(0,a.jsx)(p.Z,{className:"h-10 w-10 mx-auto mb-4"}),(0,a.jsx)("p",{children:X})]}):0===_.length?(0,a.jsxs)("div",{className:"text-center text-muted-foreground py-8",children:[(0,a.jsx)(u.Z,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,a.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Start a conversation"}),(0,a.jsx)("p",{children:"Ask questions about your documents or any topic."})]}):null,_.map(e=>(0,a.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"max-w-[80%] ".concat("user"===e.role?"bg-primary text-primary-foreground":"bg-muted"," rounded-lg p-4 relative"),children:[(0,a.jsx)("div",{className:"whitespace-pre-wrap break-words",children:e.content}),"assistant"===e.role&&(0,a.jsx)("button",{className:"absolute top-2 right-2 p-1 rounded hover:bg-accent focus:outline-none focus:ring",title:"Copy response","aria-label":"Copy response","data-testid":"copy-btn",onClick:async()=>{try{await D(function(e){let t=e.content;if(e.citations&&e.citations.length>0)for(let s of(t+="\n\nSources:",e.citations))t+="\n- ".concat(s.title," (").concat(s.source,")").concat(s.score?" [".concat((100*s.score).toFixed(0),"% match]"):"");return t+="\n\nTimestamp: ".concat(e.timestamp.toLocaleString())}(e)),ei("Copied to clipboard!"),en(!0)}catch(e){ei("Copy failed"),en(!0)}},children:(0,a.jsx)(i.Z,{className:"h-4 w-4 text-muted-foreground"})}),e.citations&&e.citations.length>0&&(0,a.jsxs)("div",{className:"mt-3 pt-3 border-t border-border/20",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[ec(e.searchType),(0,a.jsx)("span",{className:"text-xs font-medium",children:ed(e.searchType)}),(0,a.jsxs)(S.C,{variant:"secondary",className:"text-xs",children:[e.citations.length," source",1!==e.citations.length?"s":""]})]}),(0,a.jsxs)(C,{children:[(0,a.jsx)(T,{className:"text-xs text-muted-foreground hover:text-foreground transition-colors",children:"Show sources ↓"}),(0,a.jsx)(A,{className:"mt-2 space-y-2",children:e.citations.map((e,t)=>(0,a.jsx)(k.Zb,{className:"text-xs",children:(0,a.jsxs)(k.aY,{className:"p-3",children:[(0,a.jsx)("div",{className:"font-medium mb-1",children:e.title}),(0,a.jsx)("div",{className:"text-muted-foreground mb-2 line-clamp-2",children:e.content}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:e.source}),e.score&&(0,a.jsxs)(S.C,{variant:"outline",children:[(100*e.score).toFixed(0),"% match"]})]})]})},t))})]})]})]})},e.id)),$&&_.length>0&&(0,a.jsx)("div",{className:"text-center text-xs text-muted-foreground",children:"Updating conversation…"}),U&&(0,a.jsx)("div",{className:"flex justify-start",children:(0,a.jsx)("div",{className:"bg-muted rounded-lg p-4",children:(0,a.jsx)(h.Z,{className:"h-4 w-4 animate-spin"})})}),(0,a.jsx)("div",{ref:Y})]}),(0,a.jsxs)("div",{className:"sticky bottom-0 border-t bg-background p-4 z-10",children:[P&&(0,a.jsxs)("div",{className:"mb-3 p-3 bg-green-50 border border-green-200 rounded-lg flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(f.Z,{className:"h-4 w-4 text-green-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium text-green-900",children:P.fileName}),(0,a.jsxs)("span",{className:"text-sm text-green-600 ml-2",children:["(",ea(P.fileSize),")"]})]})]}),(0,a.jsx)(N.z,{variant:"ghost",size:"sm",onClick:()=>{O(null),q(null),G.current&&(G.current.value="")},className:"text-green-700 hover:text-green-800",children:(0,a.jsx)(x.Z,{className:"h-4 w-4"})})]}),H&&(0,a.jsxs)("div",{className:"mb-3 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2",children:[(0,a.jsx)(p.Z,{className:"h-4 w-4 text-red-500 mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-red-900",children:"Upload Error"}),(0,a.jsx)("div",{className:"text-sm text-red-600",children:H})]}),(0,a.jsx)(N.z,{variant:"ghost",size:"sm",onClick:()=>q(null),className:"text-red-700 hover:text-red-800 ml-auto",children:(0,a.jsx)(x.Z,{className:"h-4 w-4"})})]}),(0,a.jsxs)("form",{onSubmit:el,className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[(0,a.jsx)("span",{children:"Press Enter to send, Shift+Enter for a new line."}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)(N.z,{type:"button",variant:"ghost",size:"icon",onClick:()=>J(e=>!e),className:"text-muted-foreground hover:text-foreground",title:V?"Collapse input":"Expand input",children:V?(0,a.jsx)(g.Z,{className:"h-4 w-4"}):(0,a.jsx)(v.Z,{className:"h-4 w-4"})})})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(w,{value:R,onChange:e=>Z(e.target.value),placeholder:P?P.fileName.match(/\.(png|jpg|jpeg|gif|bmp|tiff|webp)$/i)?"Describe what you see in the image or ask questions about it...":"Ask questions about the uploaded document...":"Ask a question about your documents...",className:"w-full pr-12 resize-y ".concat(V?"min-h-[180px]":"min-h-[80px]"," max-h-[320px]"),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),el(e))}}),(0,a.jsxs)("div",{className:"absolute right-3 bottom-3 flex items-center gap-2",children:[(0,a.jsx)("input",{type:"file",ref:G,onChange:e=>{let t=e.target.files;t&&t.length>0&&es(t[0])},accept:z.join(","),className:"hidden"}),(0,a.jsx)(N.z,{type:"button",variant:"ghost",size:"icon",onClick:()=>{var e;return null===(e=G.current)||void 0===e?void 0:e.click()},disabled:I,className:"h-7 w-7",title:"Upload document for analysis",children:I?(0,a.jsx)(h.Z,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(y.Z,{className:"h-4 w-4"})})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:!P&&"\uD83D\uDCA1 Tip: Click the clip icon or drag & drop files to upload logs, configs, images, or other documents."}),(0,a.jsx)(N.z,{type:"submit",disabled:!R.trim()||U,children:U?(0,a.jsx)(h.Z,{className:"h-4 w-4 animate-spin"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.Z,{className:"h-4 w-4 mr-1"})," Send"]})})]})]}),!P&&(0,a.jsx)("div",{className:"mt-2 text-xs text-muted-foreground",children:"Need to describe a longer issue? Expand the input or attach files for deeper analysis."})]}),(0,a.jsxs)(l.zt,{swipeDirection:"right",children:[(0,a.jsx)(l.fC,{open:er,onOpenChange:en,duration:2e3,className:"bg-black text-white px-4 py-2 rounded shadow-lg",children:(0,a.jsx)(l.Dx,{children:eo})}),(0,a.jsx)(l.l_,{className:"fixed bottom-4 right-4 z-50"})]})]})}var R=s(7648),Z=s(8728),U=s(9397),F=s(2718),P=s(8930),O=s(166);let I=(0,O.default)(()=>s.e(110).then(s.bind(s,6110)).then(e=>({default:e.Dialog})),{loadableGenerated:{webpack:()=>[6110]},ssr:!1,loading:()=>null}),L=(0,O.default)(()=>s.e(110).then(s.bind(s,6110)).then(e=>({default:e.DialogContent})),{loadableGenerated:{webpack:()=>[6110]},ssr:!1,loading:()=>null}),H=(0,O.default)(()=>s.e(110).then(s.bind(s,6110)).then(e=>({default:e.DialogHeader})),{loadableGenerated:{webpack:()=>[6110]},ssr:!1,loading:()=>null}),q=(0,O.default)(()=>s.e(110).then(s.bind(s,6110)).then(e=>({default:e.DialogTitle})),{loadableGenerated:{webpack:()=>[6110]},ssr:!1,loading:()=>null}),B=(0,O.default)(()=>s.e(110).then(s.bind(s,6110)).then(e=>({default:e.DialogTrigger})),{loadableGenerated:{webpack:()=>[6110]},ssr:!1,loading:()=>null}),M=(0,O.default)(()=>s.e(110).then(s.bind(s,6110)).then(e=>({default:e.DialogDescription})),{loadableGenerated:{webpack:()=>[6110]},ssr:!1,loading:()=>null});function V(e){let{onNewChat:t,onSelectConversation:s,currentConversationId:n,refreshKey:i=0,onConversationDeleted:l}=e,[d,u]=(0,r.useState)(!1),[m,h]=(0,r.useState)([]),[p,f]=(0,r.useState)(!1),[x,g]=(0,r.useState)({documents:0,chunks:0}),[v,y]=(0,r.useState)(!1),[j,b]=(0,r.useState)(!1),[w,k]=(0,r.useState)([]),[S,_]=(0,r.useState)([]),[C,T]=(0,r.useState)(!1),[A,D]=(0,r.useState)(null),[z,E]=(0,r.useState)(""),[R,O]=(0,r.useState)({type:[],product:[],version:[],privacy:[]}),[V,J]=(0,r.useState)({types:[],products:[],versions:[],privacies:[]}),{accessToken:Y,user:G}=(0,o.a)();(0,r.useEffect)(()=>{u(!0)},[]);let W=(0,r.useCallback)(async()=>{if(!Y){h([]);return}try{f(!0);let e=await fetch("/api/conversations?limit=30",{headers:{Authorization:"Bearer ".concat(Y)},cache:"no-store"});if(!e.ok){if(401===e.status){h([]);return}let t="";try{let s=await e.json();t=(null==s?void 0:s.error)||(null==s?void 0:s.detail)||""}catch(e){}throw Error(t||"Failed to load conversations (status ".concat(e.status,")"))}let t=await e.json();if(!Array.isArray(t)){h([]);return}let s=t.map(e=>{var t,s,a,r,n,o,i;return{id:e.id,title:null!==(t=e.title)&&void 0!==t?t:"Untitled conversation",createdAt:null!==(a=null!==(s=e.createdAt)&&void 0!==s?s:e.created_at)&&void 0!==a?a:null,updatedAt:null!==(n=null!==(r=e.updatedAt)&&void 0!==r?r:e.updated_at)&&void 0!==n?n:null,lastReviewedAt:null!==(i=null!==(o=e.lastReviewedAt)&&void 0!==o?o:e.last_reviewed_at)&&void 0!==i?i:null}});h(s)}catch(e){console.error("[Conversations] fetch error:",e),h([])}finally{f(!1)}},[Y]);(0,r.useEffect)(()=>{g({documents:42,chunks:1234})},[]),(0,r.useEffect)(()=>{W()},[W,i]),(0,r.useEffect)(()=>{if(j){T(!0),D(null);let e=new AbortController;return(async()=>{try{let t=await fetch("/api/documents/list",{method:"POST",headers:{"Content-Type":"application/json",...Y?{Authorization:"Bearer ".concat(Y)}:{}},body:JSON.stringify({limit:50,offset:0}),signal:e.signal});if(!t.ok){let e="";try{let s=await t.json();e=s.detail||JSON.stringify(s)}catch(e){}throw Error("Failed to fetch documents (status ".concat(t.status,") ").concat(e).trim())}let s=(await t.json()).documents||[];k(s),_(s)}catch(e){if("AbortError"===e.name)return;console.error("[Documents] fetch error:",e),D(e.message||"Unknown error")}finally{T(!1)}})(),()=>e.abort()}},[j,Y]),(0,r.useEffect)(()=>{if(!j)return;let e={types:new Set,products:new Set,versions:new Set,privacies:new Set};w.forEach(t=>{t.document_type&&e.types.add(t.document_type),t.product_name&&e.products.add(t.product_name),t.product_version&&e.versions.add(t.product_version),t.privacy_level&&e.privacies.add(t.privacy_level)}),J({types:Array.from(e.types).sort(),products:Array.from(e.products).sort(),versions:Array.from(e.versions).sort(),privacies:Array.from(e.privacies).sort()}),O(t=>({type:t.type.filter(t=>e.types.has(t)),product:t.product.filter(t=>e.products.has(t)),version:t.version.filter(t=>e.versions.has(t)),privacy:t.privacy.filter(t=>e.privacies.has(t))}))},[j,w]),(0,r.useEffect)(()=>{if(!j)return;let e=z.trim().toLowerCase();_(w.filter(t=>{let s=[t.file_name,t.document_type,t.product_name,t.product_version,t.privacy_level].filter(Boolean).map(e=>e.toString().toLowerCase());return!!((!e||s.some(t=>t.includes(e)))&&(!R.type.length||t.document_type&&R.type.includes(t.document_type))&&(!R.product.length||t.product_name&&R.product.includes(t.product_name))&&(!R.version.length||t.product_version&&R.version.includes(t.product_version))&&(!R.privacy.length||t.privacy_level&&R.privacy.includes(t.privacy_level)))}))},[z,w,j,R]),(0,r.useEffect)(()=>{j||(E(""),O({type:[],product:[],version:[],privacy:[]}))},[j]);let K=(e,t)=>{O(s=>{let a=new Set(s[e]);return a.has(t)?a.delete(t):a.add(t),{...s,[e]:Array.from(a)}})};return d?(0,a.jsxs)("div",{className:"w-64 bg-muted/30 border-r flex flex-col",children:[(0,a.jsx)("div",{className:"p-4 border-b",children:(0,a.jsxs)(I,{open:j,onOpenChange:b,children:[(0,a.jsx)(B,{asChild:!0,children:(0,a.jsxs)(N.z,{variant:"ghost",className:"w-full justify-start",children:[(0,a.jsx)(c.Z,{className:"h-4 w-4 mr-2"}),"Documents"]})}),(0,a.jsxs)(L,{className:"sm:max-w-md",children:[(0,a.jsxs)(H,{children:[(0,a.jsx)(q,{children:"Documents"}),(0,a.jsx)(M,{children:"View and manage uploaded documents."})]}),C?(0,a.jsx)("div",{className:"py-2 text-muted-foreground text-sm",children:"Loading documents..."}):A?(0,a.jsxs)("div",{className:"py-2 text-red-500 text-sm",children:["Error: ",A]}):(0,a.jsxs)("div",{className:"py-2 space-y-2",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("input",{type:"text",value:z,onChange:e=>E(e.target.value),placeholder:"Search documents",className:"w-full border rounded px-2 py-1 text-sm"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,a.jsxs)("div",{className:"border rounded px-2 py-2",children:[(0,a.jsx)("p",{className:"text-xs font-semibold text-muted-foreground mb-1",children:"Type"}),(0,a.jsx)("div",{className:"flex flex-col gap-1 max-h-24 overflow-y-auto pr-1",children:0===V.types.length?(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"No types available"}):V.types.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-2 text-xs",children:[(0,a.jsx)("input",{type:"checkbox",checked:R.type.includes(e),onChange:()=>K("type",e),className:"h-3 w-3"}),(0,a.jsx)("span",{children:e})]},e))})]}),(0,a.jsxs)("div",{className:"border rounded px-2 py-2",children:[(0,a.jsx)("p",{className:"text-xs font-semibold text-muted-foreground mb-1",children:"Product"}),(0,a.jsx)("div",{className:"flex flex-col gap-1 max-h-24 overflow-y-auto pr-1",children:0===V.products.length?(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"No products available"}):V.products.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-2 text-xs",children:[(0,a.jsx)("input",{type:"checkbox",checked:R.product.includes(e),onChange:()=>K("product",e),className:"h-3 w-3"}),(0,a.jsx)("span",{children:e})]},e))})]}),(0,a.jsxs)("div",{className:"border rounded px-2 py-2",children:[(0,a.jsx)("p",{className:"text-xs font-semibold text-muted-foreground mb-1",children:"Version"}),(0,a.jsx)("div",{className:"flex flex-col gap-1 max-h-24 overflow-y-auto pr-1",children:0===V.versions.length?(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"No versions available"}):V.versions.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-2 text-xs",children:[(0,a.jsx)("input",{type:"checkbox",checked:R.version.includes(e),onChange:()=>K("version",e),className:"h-3 w-3"}),(0,a.jsx)("span",{children:e})]},e))})]}),(0,a.jsxs)("div",{className:"border rounded px-2 py-2",children:[(0,a.jsx)("p",{className:"text-xs font-semibold text-muted-foreground mb-1",children:"Privacy"}),(0,a.jsx)("div",{className:"flex flex-col gap-1 max-h-24 overflow-y-auto pr-1",children:0===V.privacies.length?(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"No privacy levels available"}):V.privacies.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-2 text-xs",children:[(0,a.jsx)("input",{type:"checkbox",checked:R.privacy.includes(e),onChange:()=>K("privacy",e),className:"h-3 w-3"}),(0,a.jsx)("span",{children:e})]},e))})]})]})]}),(0,a.jsx)("div",{className:"max-h-64 overflow-y-auto pr-2",children:0===w.length?(0,a.jsx)("div",{className:"py-2 text-muted-foreground text-sm",children:"No documents found."}):0===S.length?(0,a.jsx)("div",{className:"py-2 text-muted-foreground text-sm",children:"No documents match the selected filters."}):(0,a.jsx)("ul",{className:"space-y-2",children:S.map(e=>(0,a.jsxs)("li",{className:"border-b pb-2",children:[(0,a.jsx)("div",{className:"font-medium",children:e.file_name}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:[e.document_type&&(0,a.jsxs)("span",{children:["Type: ",e.document_type," | "]}),e.product_name&&(0,a.jsxs)("span",{children:["Product: ",e.product_name," | "]}),e.product_version&&(0,a.jsxs)("span",{children:["Version: ",e.product_version," | "]}),e.privacy_level&&(0,a.jsxs)("span",{children:["Privacy: ",e.privacy_level," | "]}),e.processed_at&&(0,a.jsxs)("span",{children:["Processed: ",new Date(e.processed_at).toLocaleDateString()," "]})]})]},e.id))})})]})]})]})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto",children:[(0,a.jsxs)("div",{className:"px-4 pb-2 flex items-center justify-between gap-2",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-muted-foreground",children:"Recent Conversations"}),(0,a.jsxs)(N.z,{size:"sm",variant:"outline",onClick:t,className:"flex items-center gap-1",children:[(0,a.jsx)(U.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-xs",children:"New"})]})]}),(0,a.jsx)("div",{className:"px-2 space-y-1",children:p?(0,a.jsx)("div",{className:"px-1 py-2 text-sm text-muted-foreground",children:"Loading conversations..."}):0===m.length?(0,a.jsx)("div",{className:"px-1 py-2 text-sm text-muted-foreground",children:"No conversations yet. Start a new chat to begin."}):m.map(e=>{var t;let r=null!==(t=e.updatedAt)&&void 0!==t?t:e.createdAt,o=r?new Date(r).toLocaleString():"";return(0,a.jsx)(N.z,{variant:n===e.id?"secondary":"ghost",className:"w-full justify-start text-left h-auto p-3",onClick:()=>s(e.id),children:(0,a.jsxs)("div",{className:"flex items-start gap-2 w-full",children:[(0,a.jsx)(F.Z,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"truncate text-sm",children:e.title}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:o})]}),(0,a.jsxs)("button",{type:"button",className:"ml-2 text-muted-foreground hover:text-destructive transition-colors",onClick:async t=>{if(t.stopPropagation(),window.confirm("Delete this conversation? This action cannot be undone."))try{if(!Y)throw Error("Not authenticated");let t=await fetch("/api/conversations/".concat(e.id),{method:"DELETE",headers:{Authorization:"Bearer ".concat(Y)}});if(!t.ok&&204!==t.status){let e="";try{let s=await t.json();e=(null==s?void 0:s.error)||(null==s?void 0:s.detail)||""}catch(e){}throw Error(e||"Failed to delete conversation (status ".concat(t.status,")"))}null==l||l(e.id),W()}catch(e){console.error("Failed to delete conversation:",e),alert("Failed to delete conversation. Please try again.")}},children:[(0,a.jsx)(P.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Delete conversation"})]})]})},e.id)})})]}),(0,a.jsx)("div",{className:"p-4 border-t",children:(0,a.jsxs)(I,{open:v,onOpenChange:y,children:[(0,a.jsx)(B,{asChild:!0,children:(0,a.jsxs)(N.z,{variant:"ghost",className:"w-full justify-start",children:[(0,a.jsx)(Z.Z,{className:"h-4 w-4 mr-2"}),"Settings"]})}),(0,a.jsxs)(L,{className:"sm:max-w-md",children:[(0,a.jsx)(H,{children:(0,a.jsx)(q,{children:"Settings"})}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"text-sm font-medium",children:"System Information"}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground space-y-1",children:[(0,a.jsxs)("div",{children:["Documents: ",x.documents]}),(0,a.jsxs)("div",{children:["Chunks: ",x.chunks]}),(0,a.jsx)("div",{children:"RAG System: Production Ready ✅"}),(0,a.jsx)("div",{children:"Load Balancing: 4 Ollama Instances"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"text-sm font-medium",children:"Version Information"}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground space-y-1",children:[(0,a.jsx)("div",{children:"Version: 1.0.0"}),(0,a.jsx)("div",{children:"Last Updated: September 24, 2025"}),(0,a.jsx)("div",{children:"Status: Docker Validated"})]})]}),(0,a.jsx)("div",{className:"pt-4 border-t",children:(0,a.jsx)(N.z,{variant:"outline",onClick:()=>y(!1),className:"w-full",children:"Close"})})]})]})]})})]}):(0,a.jsxs)("div",{className:"w-64 bg-muted/30 border-r flex flex-col",children:[(0,a.jsx)("div",{className:"p-4 border-b",children:(0,a.jsxs)(N.z,{variant:"ghost",className:"w-full justify-start",disabled:!0,children:[(0,a.jsx)(c.Z,{className:"h-4 w-4 mr-2"}),"Documents"]})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,a.jsx)("div",{className:"px-4 pb-2",children:(0,a.jsx)("h3",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Recent Conversations"})})}),(0,a.jsx)("div",{className:"p-4 border-t",children:(0,a.jsxs)(N.z,{variant:"ghost",className:"w-full justify-start",disabled:!0,children:[(0,a.jsx)(Z.Z,{className:"h-4 w-4 mr-2"}),"Settings"]})})]})}var J=s(7818),Y=s(407),G=s(401),W=s(519);let K=J.fC,$=J.xz;J.ZA,J.Uv,J.Tr,J.Ee,r.forwardRef((e,t)=>{let{className:s,inset:r,children:n,...o}=e;return(0,a.jsxs)(J.fF,{ref:t,className:(0,b.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",r&&"pl-8",s),...o,children:[n,(0,a.jsx)(Y.Z,{className:"ml-auto h-4 w-4"})]})}).displayName=J.fF.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(J.tu,{ref:t,className:(0,b.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...r})}).displayName=J.tu.displayName;let Q=r.forwardRef((e,t)=>{let{className:s,sideOffset:r=4,...n}=e;return(0,a.jsx)(J.Uv,{children:(0,a.jsx)(J.VY,{ref:t,sideOffset:r,className:(0,b.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...n})})});Q.displayName=J.VY.displayName;let X=r.forwardRef((e,t)=>{let{className:s,inset:r,...n}=e;return(0,a.jsx)(J.ck,{ref:t,className:(0,b.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r&&"pl-8",s),...n})});X.displayName=J.ck.displayName,r.forwardRef((e,t)=>{let{className:s,children:r,checked:n,...o}=e;return(0,a.jsxs)(J.oC,{ref:t,className:(0,b.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:n,...o,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(J.wU,{children:(0,a.jsx)(G.Z,{className:"h-4 w-4"})})}),r]})}).displayName=J.oC.displayName,r.forwardRef((e,t)=>{let{className:s,children:r,...n}=e;return(0,a.jsxs)(J.Rk,{ref:t,className:(0,b.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...n,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(J.wU,{children:(0,a.jsx)(W.Z,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=J.Rk.displayName;let ee=r.forwardRef((e,t)=>{let{className:s,inset:r,...n}=e;return(0,a.jsx)(J.__,{ref:t,className:(0,b.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",s),...n})});ee.displayName=J.__.displayName;let et=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(J.Z0,{ref:t,className:(0,b.cn)("-mx-1 my-1 h-px bg-muted",s),...r})});et.displayName=J.Z0.displayName;var es=s(2369),ea=s(875),er=s(8906),en=s(4001),eo=s(7692);function ei(e){let{className:t}=e,{user:s,logout:r}=(0,o.a)();if(!s)return null;let n="string"==typeof s.role_name?s.role_name.toLowerCase():null,i="string"==typeof s.role_id?Number.parseInt(s.role_id,10):s.role_id;return(0,a.jsxs)(K,{children:[(0,a.jsxs)($,{className:"flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors cursor-pointer ".concat(t),children:[(0,a.jsx)(es.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:s.full_name}),(0,a.jsx)("span",{className:"ml-2 px-2 py-0.5 rounded bg-secondary text-xs uppercase",children:s.role_name||"role "+s.role_id}),(0,a.jsx)(ea.Z,{className:"h-4 w-4"})]}),(0,a.jsxs)(Q,{align:"end",className:"w-56",children:[(0,a.jsx)(ee,{className:"font-normal",children:(0,a.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium leading-none",children:s.full_name}),(0,a.jsx)("p",{className:"text-xs leading-none text-muted-foreground",children:s.email})]})}),(0,a.jsx)(et,{}),("admin"===n||1===i)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(X,{asChild:!0,children:(0,a.jsxs)(R.default,{href:"/admin",className:"flex items-center cursor-pointer",children:[(0,a.jsx)(er.Z,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"User / Role Management"})]})}),(0,a.jsx)(et,{})]}),(0,a.jsx)(X,{asChild:!0,children:(0,a.jsxs)(R.default,{href:"/change-password",className:"flex items-center cursor-pointer",children:[(0,a.jsx)(en.Z,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Change Password"})]})}),(0,a.jsx)(et,{}),(0,a.jsxs)(X,{onClick:r,className:"flex items-center cursor-pointer text-red-600",children:[(0,a.jsx)(eo.Z,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Logout"})]})]})]})}function el(){let[e,t]=(0,r.useState)(),[s,i]=(0,r.useState)(0),[l,c]=(0,r.useState)(!1),{user:d,logout:u,loading:m}=(0,o.a)(),h=(0,n.useRouter)(),p=null==d?void 0:d.password_change_required,f=null==d?void 0:d.email;return((0,r.useEffect)(()=>{console.log("[HOME] Password change check:",{userEmail:f,passwordChangeRequired:p,redirecting:l}),p&&!l&&(console.log("[HOME] Redirecting to password change page"),c(!0),h.push("/change-password"))},[p,f,h,l]),m)?(0,a.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center space-y-4",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading..."})]})}):(null==d?void 0:d.password_change_required)||l?(0,a.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center space-y-4",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Redirecting to password change..."})]})}):(0,a.jsxs)("div",{className:"flex h-screen",children:[d&&(0,a.jsx)(V,{onNewChat:()=>{t(void 0)},onSelectConversation:e=>{t(e)},currentConversationId:e,refreshKey:s,onConversationDeleted:s=>{e===s&&t(void 0),i(e=>e+1)}}),(0,a.jsxs)("main",{className:"flex-1 flex flex-col",children:[(0,a.jsxs)("div",{className:"border-b p-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold",children:"Technical Services Assistant"}),(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:d?"Ask questions about your documents":"Sign in to access the assistant"})]}),(0,a.jsx)("div",{className:"flex items-center gap-4",children:d?(0,a.jsx)(ei,{}):(0,a.jsxs)("div",{className:"flex gap-3 text-sm",children:[(0,a.jsx)(R.default,{href:"/login",className:"underline",children:"Login"}),(0,a.jsx)(R.default,{href:"/register",className:"underline",children:"Register"})]})})]}),d?(0,a.jsx)(E,{conversationId:e,onConversationCreated:e=>{t(e),i(e=>e+1)},onConversationActivity:()=>{i(e=>e+1)}}):(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center space-y-4",children:[(0,a.jsx)("h2",{className:"text-xl font-medium",children:"Welcome to Technical Service Assistant"}),(0,a.jsx)("p",{className:"text-muted-foreground max-w-md",children:"Authenticate to start secure, role-based retrieval augmented conversations. Your role will control access to private versus public knowledge."}),(0,a.jsxs)("div",{className:"flex gap-4 justify-center",children:[(0,a.jsx)(R.default,{href:"/login",className:"underline",children:"Login"}),(0,a.jsx)(R.default,{href:"/register",className:"underline",children:"Register"})]})]})})]})]})}},5974:function(e,t,s){"use strict";s.d(t,{C:function(){return i}});var a=s(7437);s(2265);var r=s(535),n=s(4508);let o=(0,r.j)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:s,...r}=e;return(0,a.jsx)("div",{className:(0,n.cn)(o({variant:s}),t),...r})}},2869:function(e,t,s){"use strict";s.d(t,{z:function(){return c}});var a=s(7437),r=s(2265),n=s(7495),o=s(535),i=s(4508);let l=(0,o.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=r.forwardRef((e,t)=>{let{className:s,variant:r,size:o,asChild:c=!1,...d}=e,u=c?n.g7:"button";return(0,a.jsx)(u,{className:(0,i.cn)(l({variant:r,size:o,className:s})),ref:t,...d})});c.displayName="Button"},6070:function(e,t,s){"use strict";s.d(t,{Ol:function(){return i},SZ:function(){return c},Zb:function(){return o},aY:function(){return d},ll:function(){return l}});var a=s(7437),r=s(2265),n=s(4508);let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("rounded-xl border bg-card text-card-foreground shadow",s),...r})});o.displayName="Card";let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",s),...r})});i.displayName="CardHeader";let l=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("font-semibold leading-none tracking-tight",s),...r})});l.displayName="CardTitle";let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",s),...r})});c.displayName="CardDescription";let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",s),...r})});d.displayName="CardContent",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",s),...r})}).displayName="CardFooter"},4508:function(e,t,s){"use strict";s.d(t,{G:function(){return o},cn:function(){return n}});var a=s(1994),r=s(3335);function n(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.m6)((0,a.W)(t))}function o(e){return e}},1245:function(e,t,s){"use strict";s.d(t,{AuthProvider:function(){return l},a:function(){return c}});var a=s(7437),r=s(2265);let n=(0,r.createContext)(void 0),o="tsa_auth_v1";function i(e){try{localStorage.setItem(o,JSON.stringify(e))}catch(e){}}let l=e=>{let{children:t}=e,[s,l]=(0,r.useState)({user:null,accessToken:null,refreshToken:null,expiresAt:null,loading:!0,error:null}),c=e=>l(t=>({...t,...e})),d=e=>e;(0,r.useEffect)(()=>{let e=!1;return(async()=>{console.log("[AUTH] Initializing auth context");let t=function(){try{let e=localStorage.getItem(o);if(!e)return null;return JSON.parse(e)}catch(e){return null}}();if(console.log("[AUTH] Persisted state:",t?"Found tokens":"No tokens"),!(null==t?void 0:t.accessToken)){console.log("[AUTH] No access token found, setting loading false"),e||c({loading:!1});return}console.log("[AUTH] Found access token, loading user profile"),c({...t,loading:!0});try{let t=await fetch(d("/api/auth/health")).catch(()=>null);if(!t||!t.ok&&404!==t.status){e||c({loading:!1,error:"Auth service unavailable"});return}}catch(t){e||c({loading:!1,error:"Auth service unavailable"});return}try{console.log("[AUTH] Fetching user profile from /api/auth/me");let s=await fetch(d("/api/auth/me"),{headers:{Authorization:"Bearer ".concat(t.accessToken)}});if(console.log("[AUTH] Profile fetch response status:",s.status),s.ok){let t=await s.json();console.log("[AUTH] Profile loaded:",{id:t.id,email:t.email,password_change_required:t.password_change_required}),e||c({user:t,loading:!1})}else e||(c({loading:!1,accessToken:null,refreshToken:null,user:null}),i({}))}catch(t){e||c({loading:!1})}})(),()=>{e=!0}},[]);let u=(0,r.useCallback)(async(e,t)=>{console.log("[AUTH] Login attempt for:",e),c({loading:!0,error:null});try{var s;console.log("[AUTH] Sending login request to:",d("/api/auth/login"));let a=await fetch(d("/api/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(console.log("[AUTH] Login response status:",a.status),!a.ok){let e="Login failed";try{let t=await a.json();t&&"string"==typeof t.detail&&(e=t.detail)}catch(e){}return c({loading:!1,error:e}),!1}let r=null;try{r=await a.json()}catch(e){return c({loading:!1,error:"Malformed server response"}),!1}if(console.log("[AUTH] Login response data:",{hasAccessToken:!!r.access_token,hasRefreshToken:!!r.refresh_token,hasUser:!!r.user,userPasswordChangeRequired:null===(s=r.user)||void 0===s?void 0:s.password_change_required}),!r||"object"!=typeof r||!r.access_token||!r.refresh_token||"number"!=typeof r.expires_in||!r.user)return console.log("[AUTH] Invalid login response data"),c({loading:!1,error:"Unexpected auth response"}),!1;let n=Number.isFinite(r.expires_in)?r.expires_in:0,o=Date.now()+Math.max(0,1e3*n-5e3),l={accessToken:r.access_token,refreshToken:r.refresh_token,expiresAt:o,user:r.user};return console.log("[AUTH] Login successful, setting user state:",{email:r.user.email,password_change_required:r.user.password_change_required}),c({...l,loading:!1}),i(l),!0}catch(e){return c({loading:!1,error:"Network error"}),!1}},[]),m=(0,r.useCallback)(async e=>{c({loading:!0,error:null});try{let t=await fetch(d("/api/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,role_id:e.role_id||2})});if(!t.ok){let e=(await t.json().catch(()=>({}))).detail||"Registration failed";return c({loading:!1,error:e}),!1}return c({loading:!1}),!0}catch(e){return c({loading:!1,error:"Network error"}),!1}},[]),h=(0,r.useCallback)(()=>{if(c({user:null,accessToken:null,refreshToken:null,expiresAt:null}),i({}),!window.location.pathname.startsWith("/login"))try{window.location.href="/login"}catch(e){}},[]);(0,r.useEffect)(()=>{if(globalThis._tsaFetchWrapped)return;let e=fetch;globalThis._tsaFetchWrapped=!0,globalThis.fetch=async function(){for(var t=arguments.length,s=Array(t),a=0;a<t;a++)s[a]=arguments[a];let r=await e(...s);if(401===r.status){let e="string"==typeof s[0]?s[0]:s[0].url;if(!e.includes("/api/auth/login")&&!e.includes("/api/auth/register")&&(h(),!window.location.pathname.startsWith("/login")))try{window.location.pathname="/login"}catch(e){}}return r}},[h]);let p=(0,r.useCallback)(async()=>{if(console.log("[AUTH] Refresh called"),!s.refreshToken){console.log("[AUTH] No refresh token available");return}if(p._inFlight){console.log("[AUTH] Refresh already in flight");return}console.log("[AUTH] Starting token refresh"),p._inFlight=!0;try{var e,t;let a=await fetch(d("/api/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:s.refreshToken})});if(console.log("[AUTH] Refresh response status:",a.status),!a.ok)return console.log("[AUTH] Refresh failed, logging out"),h();let r=await a.json();console.log("[AUTH] Refresh successful, updated user:",{email:null===(e=r.user)||void 0===e?void 0:e.email,password_change_required:null===(t=r.user)||void 0===t?void 0:t.password_change_required});let n=1e3*r.expires_in,o=Date.now()+n-Math.min(5e3,Math.max(1e3,.08*n)),l={accessToken:r.access_token,expiresAt:o,user:r.user};c(l),i({...l,refreshToken:s.refreshToken})}catch(e){h()}finally{p._inFlight=!1}},[s.refreshToken,h]);(0,r.useEffect)(()=>{if(!s.expiresAt)return;let e=s.expiresAt-Date.now();if(e<=0){p();return}let t=e-.12*e;t<1500&&(t=Math.min(Math.max(e-500,0),1500));let a=setTimeout(()=>p(),t);return()=>clearTimeout(a)},[s.expiresAt,p]);let f={...s,login:u,register:m,logout:h,refresh:p};return(0,a.jsx)(n.Provider,{value:f,children:t})};function c(){let e=(0,r.useContext)(n);if(!e)throw Error("useAuth must be used within AuthProvider");return e}}},function(e){e.O(0,[137,648,369,971,117,744],function(){return e(e.s=6549)}),_N_E=e.O()}]);