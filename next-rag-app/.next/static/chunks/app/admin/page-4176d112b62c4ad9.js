(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{5007:function(e,s,t){Promise.resolve().then(t.bind(t,359))},359:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return o}});var a=t(7437),l=t(2265),r=t(1245),d=t(2672),n=t(7648),i=t(8906);let c=(0,t(9205).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);function o(){let{user:e,accessToken:s,loading:t}=(0,r.a)(),[o,m]=(0,l.useState)([]),[x,u]=(0,l.useState)([]),[h,p]=(0,l.useState)([]),[j,f]=(0,l.useState)(!0),[N,b]=(0,l.useState)(null),[y,g]=(0,l.useState)(""),[v,w]=(0,l.useState)(""),[_,k]=(0,l.useState)(null),[C,D]=(0,l.useState)(null),[S,A]=(0,l.useState)(!1),[L,R]=(0,l.useState)({email:"",password:"",first_name:"",last_name:"",role_id:2}),[E,U]=(0,l.useState)(!1),[F,q]=(0,l.useState)(null),[P,Z]=(0,l.useState)(null);(0,l.useEffect)(()=>{s&&e&&"admin"===e.role_name&&z()},[s,null==e?void 0:e.role_name]),(0,l.useEffect)(()=>{s&&e&&"admin"===e.role_name&&(async()=>{try{let e=await (0,d.ju)({accessToken:s,search_term:v,limit:50});p(Array.isArray(null==e?void 0:e.documents)?e.documents:[])}catch(e){console.error("Failed to refresh documents:",e)}})()},[v,s,e]);let z=async()=>{try{f(!0);let[e,t,a]=await Promise.all([(0,d.yw)({accessToken:s,search:y}),(0,d.xv)(s),(0,d.ju)({accessToken:s,search_term:v,limit:50})]);m(Array.isArray(null==e?void 0:e.users)?e.users:[]),u(Array.isArray(t)?t:[]),p(Array.isArray(null==a?void 0:a.documents)?a.documents:[]),b(null)}catch(e){b(e.message||"Failed to load admin data")}finally{f(!1)}},M=async(e,t)=>{try{k(e);let a=await (0,d.Nq)(s,e,{role_id:t});m(s=>s.map(s=>s.id===e?a:s))}catch(e){alert(e.message)}finally{k(null)}},O=async(e,t)=>{try{k(e);let a=await (0,d.Nq)(s,e,{status:t});m(s=>s.map(s=>s.id===e?a:s))}catch(e){alert(e.message)}finally{k(null)}},T=async(e,t)=>{try{D(e);let a=await (0,d.ul)(s,e,{description:t});u(s=>s.map(s=>s.id===e?a:s))}catch(e){alert(e.message)}finally{D(null)}},B=async e=>{let t=o.find(s=>s.id===e);if(t&&confirm("Delete user ".concat(t.email,"? This action cannot be undone.")))try{q(e),await (0,d.h8)(s,e),m(s=>s.filter(s=>s.id!==e))}catch(e){alert(e.message||"Failed to delete user")}finally{q(null)}},H=async e=>{let t=h.find(s=>s.id===e);if(t&&confirm('Delete document "'.concat(t.file_name,'"? This will remove all associated chunks and cannot be undone.')))try{Z(e),await (0,d.iH)(s,e),p(s=>s.filter(s=>s.id!==e))}catch(e){alert(e.message||"Failed to delete document")}finally{Z(null)}},I=async e=>{let t=h.find(s=>s.id===e);if(t)try{let a=await (0,d.AG)(s,e),l=window.URL.createObjectURL(a),r=document.createElement("a");r.href=l,r.download=t.file_name,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(l)}catch(e){alert(e.message||"Failed to download document")}},V=async e=>{if(e.preventDefault(),!L.email||!L.password){alert("Email and password are required");return}try{U(!0);let e=await (0,d.r4)(s,L);m(s=>[e,...s]),R({email:"",password:"",first_name:"",last_name:"",role_id:2}),A(!1),alert("User created successfully!")}catch(e){alert(e.message||"Failed to create user")}finally{U(!1)}};if(t||j)return(0,a.jsx)("div",{className:"flex items-center justify-center h-screen text-muted-foreground",children:"Loading..."});if(!e)return(0,a.jsxs)("div",{className:"p-8 text-center space-y-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold",children:"Authentication Required"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"You must be logged in to view this page."}),(0,a.jsx)(n.default,{href:"/login",className:"underline",children:"Go to Login"})]});if("admin"!==e.role_name)return(0,a.jsxs)("div",{className:"p-8 text-center space-y-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold",children:"Access Denied"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"You do not have permission to view administrative controls."}),(0,a.jsx)(n.default,{href:"/",className:"underline",children:"Return Home"})]});let G=Array.isArray(x)?x:[],W=Array.isArray(o)?o:[];return(0,a.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,a.jsxs)("div",{className:"border-b p-4 flex items-center justify-between bg-muted/30",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(n.default,{href:"/",className:"text-muted-foreground hover:text-foreground mr-2",children:"← Back"}),(0,a.jsx)(i.Z,{className:"h-5 w-5"}),(0,a.jsx)("h1",{className:"text-xl font-semibold",children:"Admin Dashboard"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("input",{className:"border rounded px-2 py-1 text-sm",placeholder:"Search users",value:y,onChange:e=>g(e.target.value)}),(0,a.jsx)("input",{className:"border rounded px-2 py-1 text-sm",placeholder:"Search documents",value:v,onChange:e=>w(e.target.value)}),(0,a.jsxs)("button",{onClick:z,className:"inline-flex items-center gap-1 border rounded px-3 py-1 text-sm hover:bg-muted",children:[(0,a.jsx)(c,{className:"h-4 w-4"})," Refresh"]})]})]}),N&&(0,a.jsx)("div",{className:"p-4 text-sm text-red-600",children:N}),j?(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center text-muted-foreground",children:"Loading..."}):(0,a.jsxs)("div",{className:"flex-1 overflow-auto p-6 space-y-10",children:[(0,a.jsxs)("section",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,a.jsx)("h2",{className:"text-lg font-medium",children:"Users"}),(0,a.jsx)("button",{onClick:()=>A(!S),className:"px-3 py-1 bg-primary text-primary-foreground rounded text-sm hover:bg-primary/90",children:S?"Cancel":"Add User"})]}),S&&(0,a.jsxs)("div",{className:"mb-4 p-4 border rounded bg-muted/20",children:[(0,a.jsx)("h3",{className:"text-md font-medium mb-3",children:"Create New User"}),(0,a.jsxs)("form",{onSubmit:V,className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Email *"}),(0,a.jsx)("input",{type:"email",required:!0,value:L.email,onChange:e=>R(s=>({...s,email:e.target.value})),className:"w-full border rounded px-2 py-1 text-sm"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Password *"}),(0,a.jsx)("input",{type:"password",required:!0,value:L.password,onChange:e=>R(s=>({...s,password:e.target.value})),className:"w-full border rounded px-2 py-1 text-sm"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"First Name"}),(0,a.jsx)("input",{type:"text",value:L.first_name,onChange:e=>R(s=>({...s,first_name:e.target.value})),className:"w-full border rounded px-2 py-1 text-sm"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Last Name"}),(0,a.jsx)("input",{type:"text",value:L.last_name,onChange:e=>R(s=>({...s,last_name:e.target.value})),className:"w-full border rounded px-2 py-1 text-sm"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Role"}),(0,a.jsx)("select",{value:L.role_id,onChange:e=>R(s=>({...s,role_id:Number(e.target.value)})),className:"w-full border rounded px-2 py-1 text-sm",children:G.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))})]}),(0,a.jsx)("div",{className:"flex items-end",children:(0,a.jsx)("button",{type:"submit",disabled:E,className:"px-4 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700 disabled:opacity-50",children:E?"Creating...":"Create User"})})]})]}),(0,a.jsx)("div",{className:"overflow-x-auto border rounded",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-muted/50",children:(0,a.jsxs)("tr",{className:"text-left",children:[(0,a.jsx)("th",{className:"p-2",children:"ID"}),(0,a.jsx)("th",{className:"p-2",children:"Email"}),(0,a.jsx)("th",{className:"p-2",children:"Name"}),(0,a.jsx)("th",{className:"p-2",children:"Role"}),(0,a.jsx)("th",{className:"p-2",children:"Status"}),(0,a.jsx)("th",{className:"p-2",children:"Verified"}),(0,a.jsx)("th",{className:"p-2",children:"Updated"}),(0,a.jsx)("th",{className:"p-2",children:"Actions"})]})}),(0,a.jsxs)("tbody",{children:[W.map(s=>{var t;return(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{className:"p-2 font-mono text-xs",children:s.id}),(0,a.jsx)("td",{className:"p-2",children:s.email}),(0,a.jsx)("td",{className:"p-2",children:s.full_name}),(0,a.jsx)("td",{className:"p-2",children:(0,a.jsx)("select",{className:"border rounded px-1 py-0.5 text-xs",value:s.role_id,disabled:_===s.id,onChange:e=>M(s.id,Number(e.target.value)),children:G.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))})}),(0,a.jsx)("td",{className:"p-2",children:(0,a.jsxs)("select",{className:"border rounded px-1 py-0.5 text-xs",value:s.status,disabled:_===s.id,onChange:e=>O(s.id,e.target.value),children:[(0,a.jsx)("option",{value:"active",children:"active"}),(0,a.jsx)("option",{value:"disabled",children:"disabled"}),(0,a.jsx)("option",{value:"pending",children:"pending"})]})}),(0,a.jsx)("td",{className:"p-2 text-center",children:s.verified?"✅":"❌"}),(0,a.jsx)("td",{className:"p-2 text-xs text-muted-foreground",children:null===(t=s.updated_at)||void 0===t?void 0:t.replace("T"," ").substring(0,16)}),(0,a.jsx)("td",{className:"p-2",children:(0,a.jsx)("button",{onClick:()=>B(s.id),disabled:F===s.id||s.id===e.id,className:"text-xs px-2 py-0.5 rounded border border-red-600 text-red-600 hover:bg-red-600 hover:text-white disabled:opacity-40",title:s.id===e.id?"Cannot delete current logged in user":"Delete user",children:F===s.id?"Deleting...":"Delete"})})]},s.id)}),0===o.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:8,className:"p-4 text-center text-muted-foreground",children:"No users found."})})]})]})})]}),(0,a.jsxs)("section",{children:[(0,a.jsx)("h2",{className:"text-lg font-medium mb-3",children:"Roles"}),(0,a.jsx)("div",{className:"overflow-x-auto border rounded",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-muted/50",children:(0,a.jsxs)("tr",{className:"text-left",children:[(0,a.jsx)("th",{className:"p-2",children:"ID"}),(0,a.jsx)("th",{className:"p-2",children:"Name"}),(0,a.jsx)("th",{className:"p-2",children:"Description"}),(0,a.jsx)("th",{className:"p-2",children:"System"}),(0,a.jsx)("th",{className:"p-2",children:"Permissions"})]})}),(0,a.jsx)("tbody",{children:G.map(e=>(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{className:"p-2 font-mono text-xs",children:e.id}),(0,a.jsx)("td",{className:"p-2 font-medium",children:e.name}),(0,a.jsx)("td",{className:"p-2",children:e.system?(0,a.jsx)("span",{className:"text-muted-foreground text-xs",children:e.description||"—"}):(0,a.jsx)("input",{className:"border rounded px-1 py-0.5 text-xs w-56",defaultValue:e.description||"",disabled:C===e.id,onBlur:s=>{s.target.value!==e.description&&T(e.id,s.target.value)}})}),(0,a.jsx)("td",{className:"p-2 text-center",children:e.system?"\uD83D\uDD12":""}),(0,a.jsx)("td",{className:"p-2 text-xs",children:(0,a.jsxs)("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(e.permissions||[]).map(e=>(0,a.jsx)("span",{className:"px-1.5 py-0.5 rounded bg-secondary text-[10px] tracking-wide uppercase",children:e},e)),(!e.permissions||0===e.permissions.length)&&(0,a.jsx)("span",{className:"text-muted-foreground",children:"—"})]})})]},e.id))})]})})]}),(0,a.jsxs)("section",{children:[(0,a.jsx)("h2",{className:"text-lg font-medium mb-3",children:"Documents"}),(0,a.jsx)("div",{className:"overflow-x-auto border rounded",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-muted/50",children:(0,a.jsxs)("tr",{className:"text-left",children:[(0,a.jsx)("th",{className:"p-2",children:"ID"}),(0,a.jsx)("th",{className:"p-2",children:"File Name"}),(0,a.jsx)("th",{className:"p-2",children:"Title"}),(0,a.jsx)("th",{className:"p-2",children:"Type"}),(0,a.jsx)("th",{className:"p-2",children:"Product"}),(0,a.jsx)("th",{className:"p-2",children:"Privacy"}),(0,a.jsx)("th",{className:"p-2",children:"Chunks"}),(0,a.jsx)("th",{className:"p-2",children:"Size"}),(0,a.jsx)("th",{className:"p-2",children:"Created"}),(0,a.jsx)("th",{className:"p-2",children:"Actions"})]})}),(0,a.jsxs)("tbody",{children:[h.map(e=>(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{className:"p-2 font-mono text-xs",children:e.id}),(0,a.jsx)("td",{className:"p-2 max-w-xs truncate",title:e.file_name,children:e.file_name}),(0,a.jsx)("td",{className:"p-2 max-w-xs truncate",title:e.title||"",children:e.title||"—"}),(0,a.jsx)("td",{className:"p-2",children:e.document_type||"—"}),(0,a.jsx)("td",{className:"p-2",children:e.product_name||"—"}),(0,a.jsx)("td",{className:"p-2",children:(0,a.jsx)("span",{className:"px-1.5 py-0.5 rounded text-xs ".concat("public"===e.privacy_level?"bg-green-100 text-green-800":"internal"===e.privacy_level?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:e.privacy_level})}),(0,a.jsx)("td",{className:"p-2 text-center",children:e.chunk_count}),(0,a.jsx)("td",{className:"p-2 text-xs text-muted-foreground",children:e.file_size?"".concat((e.file_size/1024).toFixed(1)," KB"):"—"}),(0,a.jsx)("td",{className:"p-2 text-xs text-muted-foreground",children:new Date(e.created_at).toLocaleDateString()}),(0,a.jsx)("td",{className:"p-2",children:(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)("button",{onClick:()=>I(e.id),className:"text-xs px-2 py-0.5 rounded border border-blue-600 text-blue-600 hover:bg-blue-600 hover:text-white",title:"Download document",children:"Download"}),(0,a.jsx)("button",{onClick:()=>H(e.id),disabled:P===e.id,className:"text-xs px-2 py-0.5 rounded border border-red-600 text-red-600 hover:bg-red-600 hover:text-white disabled:opacity-40",title:"Delete document",children:P===e.id?"Deleting...":"Delete"})]})})]},e.id)),0===h.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:10,className:"p-4 text-center text-muted-foreground",children:"No documents found."})})]})]})})]})]})]})}},9205:function(e,s,t){"use strict";t.d(s,{Z:function(){return i}});var a=t(2265);let l=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),r=function(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return s.filter((e,s,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===s).join(" ").trim()};var d={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,a.forwardRef)((e,s)=>{let{color:t="currentColor",size:l=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:c="",children:o,iconNode:m,...x}=e;return(0,a.createElement)("svg",{ref:s,...d,width:l,height:l,stroke:t,strokeWidth:i?24*Number(n)/Number(l):n,className:r("lucide",c),...x},[...m.map(e=>{let[s,t]=e;return(0,a.createElement)(s,t)}),...Array.isArray(o)?o:[o]])}),i=(e,s)=>{let t=(0,a.forwardRef)((t,d)=>{let{className:i,...c}=t;return(0,a.createElement)(n,{ref:d,iconNode:s,className:r("lucide-".concat(l(e)),i),...c})});return t.displayName="".concat(e),t}},8906:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(9205).Z)("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]])}},function(e){e.O(0,[137,648,60,971,117,744],function(){return e(e.s=5007)}),_N_E=e.O()}]);