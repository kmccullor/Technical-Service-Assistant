(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[817],{4068:function(e,s,t){Promise.resolve().then(t.bind(t,4740))},4740:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return m}});var r=t(7437),a=t(2265),l=t(1817),n=t(7689),i=t(1671),o=t(2489);let c=(0,t(9205).Z)("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);var d=t(9322),u=t(1245);let h=[".txt",".log",".csv",".json",".sql",".pdf",".xml",".conf",".config",".ini",".properties",".out",".err",".trace",".dump"];function f(e){let{onFileUploaded:s,onAnalysisResult:t}=e,[f,m]=(0,a.useState)(!1),[x,g]=(0,a.useState)(null),[p,y]=(0,a.useState)(!1),[j,b]=(0,a.useState)(!1),[v,k]=(0,a.useState)(null),[N,w]=(0,a.useState)(""),[T,A]=(0,a.useState)(null),_=(0,a.useRef)(null),{accessToken:C}=(0,u.a)(),S=(0,a.useCallback)(e=>{if(e.size>10485760)return"File size exceeds ".concat(10,"MB limit");let s=e.name.toLowerCase().substring(e.name.lastIndexOf("."));return h.includes(s)?null:"File type not supported. Allowed: ".concat(h.join(", "))},[]),U=(0,a.useCallback)(async e=>{let t=S(e);if(t){k(t);return}y(!0),k(null);try{let t=new FormData;t.append("file",e);let r=await fetch("/api/temp-upload",{method:"POST",headers:C?{Authorization:"Bearer ".concat(C)}:void 0,body:t}),a=await r.json();if(!a.success)throw Error(a.error||"Upload failed");let l={sessionId:a.sessionId,fileName:a.fileName,fileSize:a.fileSize,uploadTime:new Date().toISOString()};g(l),null==s||s(l)}catch(e){console.error("Upload error:",e),k(e instanceof Error?e.message:"Upload failed")}finally{y(!1)}},[C,s,S]),H=(0,a.useCallback)(e=>{e&&0!==e.length&&U(e[0])},[U]),F=(0,a.useCallback)(e=>{e.preventDefault(),m(!0)},[]),M=(0,a.useCallback)(e=>{e.preventDefault(),m(!1)},[]),Z=(0,a.useCallback)(e=>{e.preventDefault(),m(!1),H(e.dataTransfer.files)},[H]),q=async()=>{if(x&&N.trim()){b(!0),k(null);try{let e=await fetch("/api/temp-analyze",{method:"POST",headers:{"Content-Type":"application/json",...C?{Authorization:"Bearer ".concat(C)}:{}},body:JSON.stringify({sessionId:x.sessionId,query:N.trim(),maxResults:5})}),s=await e.json();if(e.ok)A(s),null==t||t(s);else throw Error(s.error||"Analysis failed")}catch(e){console.error("Analysis error:",e),k(e instanceof Error?e.message:"Analysis failed")}finally{b(!1)}}};return(0,r.jsxs)("div",{className:"w-full max-w-2xl mx-auto p-6 space-y-6",children:[!x&&(0,r.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-8 text-center transition-colors ".concat(f?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"),onDragOver:F,onDragLeave:M,onDrop:Z,children:[(0,r.jsx)("input",{ref:_,type:"file",className:"hidden",accept:h.join(","),onChange:e=>H(e.target.files)}),p?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(l.Z,{className:"h-12 w-12 mx-auto text-blue-500 animate-spin"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Uploading file..."})]}):(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(n.Z,{className:"h-12 w-12 mx-auto text-gray-400"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-lg font-medium text-gray-900",children:"Upload Document for Analysis"}),(0,r.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Drag and drop a file here, or"," ",(0,r.jsx)("button",{onClick:()=>{var e;return null===(e=_.current)||void 0===e?void 0:e.click()},className:"text-blue-500 hover:text-blue-600 font-medium",children:"browse to upload"})]})]}),(0,r.jsxs)("div",{className:"text-xs text-gray-400 space-y-1",children:[(0,r.jsxs)("p",{children:["Supported: ",h.slice(0,6).join(", "),"..."]}),(0,r.jsx)("p",{children:"Max size: 10MB"})]})]})]}),x&&(0,r.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)(i.Z,{className:"h-5 w-5 text-green-500"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-green-900",children:x.fileName}),(0,r.jsxs)("p",{className:"text-sm text-green-600",children:[(e=>{if(0===e)return"0 Bytes";let s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(1))+" "+["Bytes","KB","MB"][s]})(x.fileSize)," • Uploaded successfully"]})]})]}),(0,r.jsx)("button",{onClick:()=>{g(null),w(""),A(null),k(null),_.current&&(_.current.value="")},className:"text-gray-400 hover:text-gray-600",children:(0,r.jsx)(o.Z,{className:"h-5 w-5"})})]})}),x&&(0,r.jsx)("div",{className:"space-y-4",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ask a question about the document:"}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("input",{type:"text",value:N,onChange:e=>w(e.target.value),placeholder:"e.g., What errors are reported in this log?",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",onKeyDown:e=>"Enter"===e.key&&q()}),(0,r.jsxs)("button",{onClick:q,disabled:!N.trim()||j,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[j?(0,r.jsx)(l.Z,{className:"h-4 w-4 animate-spin"}):(0,r.jsx)(c,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:j?"Analyzing...":"Analyze"})]})]})]})}),v&&(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start space-x-3",children:[(0,r.jsx)(d.Z,{className:"h-5 w-5 text-red-500 flex-shrink-0 mt-0.5"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-red-900",children:"Error"}),(0,r.jsx)("p",{className:"text-sm text-red-600",children:v})]})]}),T&&(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6 space-y-4",children:[(0,r.jsxs)("div",{className:"border-b pb-3",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Analysis Results"}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["Confidence: ",(100*T.confidence).toFixed(1),"%"]})]}),(0,r.jsx)("div",{className:"prose prose-sm max-w-none",children:(0,r.jsxs)("div",{className:"bg-gray-50 rounded p-4",children:[(0,r.jsx)("p",{className:"font-medium text-gray-700 mb-2",children:"Technical Analysis:"}),(0,r.jsx)("div",{className:"whitespace-pre-wrap text-gray-800",children:T.response})]})}),T.results&&T.results.length>0&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-700",children:"Relevant Sections:"}),T.results.map((e,s)=>(0,r.jsxs)("div",{className:"bg-gray-50 rounded p-3 text-sm",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-1",children:[(0,r.jsxs)("span",{className:"font-medium text-gray-600",children:["Section ",e.rank]}),(0,r.jsxs)("span",{className:"text-xs text-gray-500",children:[(100*e.similarity).toFixed(1),"% match"]})]}),(0,r.jsx)("p",{className:"text-gray-700",children:e.content})]},s))]})]})]})}function m(){return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-12",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,r.jsxs)("div",{className:"text-center mb-12",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Document Analysis Tool"}),(0,r.jsx)("p",{className:"mt-4 text-lg text-gray-600",children:"Upload logs, configuration files, query results, or technical documents for immediate AI-powered analysis"})]}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-lg p-8",children:(0,r.jsx)(f,{onFileUploaded:e=>{console.log("File uploaded:",e)},onAnalysisResult:e=>{console.log("Analysis result:",e)}})}),(0,r.jsxs)("div",{className:"mt-8 bg-blue-50 rounded-lg p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-blue-900 mb-3",children:"Perfect for Troubleshooting"}),(0,r.jsxs)("div",{className:"grid md:grid-cols-2 gap-4 text-sm text-blue-800",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium mb-2",children:"Supported File Types:"}),(0,r.jsxs)("ul",{className:"space-y-1",children:[(0,r.jsx)("li",{children:"• Log files (.log, .out, .err, .trace)"}),(0,r.jsx)("li",{children:"• Configuration files (.conf, .config, .ini)"}),(0,r.jsx)("li",{children:"• Query results (.csv, .json, .sql)"}),(0,r.jsx)("li",{children:"• Technical documents (.pdf, .txt)"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium mb-2",children:"Use Cases:"}),(0,r.jsxs)("ul",{className:"space-y-1",children:[(0,r.jsx)("li",{children:"• Analyze error logs for root causes"}),(0,r.jsx)("li",{children:"• Review configuration settings"}),(0,r.jsx)("li",{children:"• Examine database query results"}),(0,r.jsx)("li",{children:"• Extract insights from technical docs"})]})]})]}),(0,r.jsxs)("div",{className:"mt-4 p-3 bg-blue-100 rounded text-sm text-blue-800",children:[(0,r.jsx)("strong",{children:"Privacy Note:"})," Files are processed temporarily and automatically deleted after 2 hours. No data is permanently stored."]})]})]})})}},9205:function(e,s,t){"use strict";t.d(s,{Z:function(){return o}});var r=t(2265);let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=function(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return s.filter((e,s,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===s).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,r.forwardRef)((e,s)=>{let{color:t="currentColor",size:a=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:c="",children:d,iconNode:u,...h}=e;return(0,r.createElement)("svg",{ref:s,...n,width:a,height:a,stroke:t,strokeWidth:o?24*Number(i)/Number(a):i,className:l("lucide",c),...h},[...u.map(e=>{let[s,t]=e;return(0,r.createElement)(s,t)}),...Array.isArray(d)?d:[d]])}),o=(e,s)=>{let t=(0,r.forwardRef)((t,n)=>{let{className:o,...c}=t;return(0,r.createElement)(i,{ref:n,iconNode:s,className:l("lucide-".concat(a(e)),o),...c})});return t.displayName="".concat(e),t}},9322:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9205).Z)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},1671:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9205).Z)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},1817:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9205).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},7689:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9205).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},2489:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9205).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},1245:function(e,s,t){"use strict";t.d(s,{AuthProvider:function(){return o},a:function(){return c}});var r=t(7437),a=t(2265);let l=(0,a.createContext)(void 0),n="tsa_auth_v1";function i(e){try{localStorage.setItem(n,JSON.stringify(e))}catch(e){}}let o=e=>{let{children:s}=e,[t,o]=(0,a.useState)({user:null,accessToken:null,refreshToken:null,expiresAt:null,loading:!0,error:null}),c=e=>o(s=>({...s,...e})),d=e=>e;(0,a.useEffect)(()=>{let e=!1;return(async()=>{console.log("[AUTH] Initializing auth context");let s=function(){try{let e=localStorage.getItem(n);if(!e)return null;return JSON.parse(e)}catch(e){return null}}();if(console.log("[AUTH] Persisted state:",s?"Found tokens":"No tokens"),!(null==s?void 0:s.accessToken)){console.log("[AUTH] No access token found, setting loading false"),e||c({loading:!1});return}console.log("[AUTH] Found access token, loading user profile"),c({...s,loading:!0});try{let s=await fetch(d("/api/auth/health")).catch(()=>null);if(!s||!s.ok&&404!==s.status){e||c({loading:!1,error:"Auth service unavailable"});return}}catch(s){e||c({loading:!1,error:"Auth service unavailable"});return}try{console.log("[AUTH] Fetching user profile from /api/auth/me");let t=await fetch(d("/api/auth/me"),{headers:{Authorization:"Bearer ".concat(s.accessToken)}});if(console.log("[AUTH] Profile fetch response status:",t.status),t.ok){let s=await t.json();console.log("[AUTH] Profile loaded:",{id:s.id,email:s.email,password_change_required:s.password_change_required}),e||c({user:s,loading:!1})}else e||(c({loading:!1,accessToken:null,refreshToken:null,user:null}),i({}))}catch(s){e||c({loading:!1})}})(),()=>{e=!0}},[]);let u=(0,a.useCallback)(async(e,s)=>{console.log("[AUTH] Login attempt for:",e),c({loading:!0,error:null});try{var t;console.log("[AUTH] Sending login request to:",d("/api/auth/login"));let r=await fetch(d("/api/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:s})});if(console.log("[AUTH] Login response status:",r.status),!r.ok){let e="Login failed";try{let s=await r.json();s&&"string"==typeof s.detail&&(e=s.detail)}catch(e){}return c({loading:!1,error:e}),!1}let a=null;try{a=await r.json()}catch(e){return c({loading:!1,error:"Malformed server response"}),!1}if(console.log("[AUTH] Login response data:",{hasAccessToken:!!a.access_token,hasRefreshToken:!!a.refresh_token,hasUser:!!a.user,userPasswordChangeRequired:null===(t=a.user)||void 0===t?void 0:t.password_change_required}),!a||"object"!=typeof a||!a.access_token||!a.refresh_token||"number"!=typeof a.expires_in||!a.user)return console.log("[AUTH] Invalid login response data"),c({loading:!1,error:"Unexpected auth response"}),!1;let l=Number.isFinite(a.expires_in)?a.expires_in:0,n=Date.now()+Math.max(0,1e3*l-5e3),o={accessToken:a.access_token,refreshToken:a.refresh_token,expiresAt:n,user:a.user};return console.log("[AUTH] Login successful, setting user state:",{email:a.user.email,password_change_required:a.user.password_change_required}),c({...o,loading:!1}),i(o),!0}catch(e){return c({loading:!1,error:"Network error"}),!1}},[]),h=(0,a.useCallback)(async e=>{c({loading:!0,error:null});try{let s=await fetch(d("/api/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,role_id:e.role_id||2})});if(!s.ok){let e=(await s.json().catch(()=>({}))).detail||"Registration failed";return c({loading:!1,error:e}),!1}return c({loading:!1}),!0}catch(e){return c({loading:!1,error:"Network error"}),!1}},[]),f=(0,a.useCallback)(()=>{c({user:null,accessToken:null,refreshToken:null,expiresAt:null}),i({})},[]);(0,a.useEffect)(()=>{if(globalThis._tsaFetchWrapped)return;let e=fetch;globalThis._tsaFetchWrapped=!0,globalThis.fetch=async function(){for(var s=arguments.length,t=Array(s),r=0;r<s;r++)t[r]=arguments[r];let a=await e(...t);if(401===a.status){let e="string"==typeof t[0]?t[0]:t[0].url;if(!e.includes("/api/auth/login")&&!e.includes("/api/auth/register")&&(f(),!window.location.pathname.startsWith("/login")))try{window.location.pathname="/login"}catch(e){}}return a}},[f]);let m=(0,a.useCallback)(async()=>{if(console.log("[AUTH] Refresh called"),!t.refreshToken){console.log("[AUTH] No refresh token available");return}if(m._inFlight){console.log("[AUTH] Refresh already in flight");return}console.log("[AUTH] Starting token refresh"),m._inFlight=!0;try{var e,s;let r=await fetch(d("/api/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:t.refreshToken})});if(console.log("[AUTH] Refresh response status:",r.status),!r.ok)return console.log("[AUTH] Refresh failed, logging out"),f();let a=await r.json();console.log("[AUTH] Refresh successful, updated user:",{email:null===(e=a.user)||void 0===e?void 0:e.email,password_change_required:null===(s=a.user)||void 0===s?void 0:s.password_change_required});let l=1e3*a.expires_in,n=Date.now()+l-Math.min(5e3,Math.max(1e3,.08*l)),o={accessToken:a.access_token,expiresAt:n,user:a.user};c(o),i({...o,refreshToken:t.refreshToken})}catch(e){f()}finally{m._inFlight=!1}},[t.refreshToken,f]);(0,a.useEffect)(()=>{if(!t.expiresAt)return;let e=t.expiresAt-Date.now();if(e<=0){m();return}let s=e-.12*e;s<1500&&(s=Math.min(Math.max(e-500,0),1500));let r=setTimeout(()=>m(),s);return()=>clearTimeout(r)},[t.expiresAt,m]);let x={...t,login:u,register:h,logout:f,refresh:m};return(0,r.jsx)(l.Provider,{value:x,children:s})};function c(){let e=(0,a.useContext)(l);if(!e)throw Error("useAuth must be used within AuthProvider");return e}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=4068)}),_N_E=e.O()}]);