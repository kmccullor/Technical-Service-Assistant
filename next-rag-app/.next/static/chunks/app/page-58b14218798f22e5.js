(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6549:function(e,t,s){Promise.resolve().then(s.bind(s,9665))},9665:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return eh}});var a=s(7437),n=s(2265),r=s(9376),o=s(1245),l=s(8867),i=s(129),c=s(7416),d=s(401),u=s(2869),m=s(6110);function x(e){let{code:t,language:s,className:r=""}=e,[o,i]=(0,n.useState)(!1),x=async()=>{try{await navigator.clipboard.writeText(t),i(!0),setTimeout(()=>i(!1),2e3)}catch(e){console.error("Failed to copy code:",e)}};return(0,a.jsxs)("div",{className:"relative group ".concat(r),children:[(0,a.jsx)("pre",{className:"bg-muted p-4 rounded-lg overflow-x-auto text-sm font-mono",children:(0,a.jsx)("code",{className:s?"language-".concat(s):"",children:t})}),(0,a.jsxs)("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,a.jsxs)(m.Dialog,{children:[(0,a.jsx)(m.DialogTrigger,{asChild:!0,children:(0,a.jsx)(u.z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",title:"Expand code",children:(0,a.jsx)(c.Z,{className:"h-4 w-4"})})}),(0,a.jsxs)(m.DialogContent,{className:"max-w-4xl max-h-[80vh]",children:[(0,a.jsx)(m.DialogHeader,{children:(0,a.jsxs)(m.DialogTitle,{children:["Code Block ",s&&"(".concat(s,")")]})}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("pre",{className:"bg-muted p-4 rounded-lg overflow-x-auto text-sm font-mono max-h-[60vh] overflow-y-auto",children:(0,a.jsx)("code",{className:s?"language-".concat(s):"",children:t})}),(0,a.jsx)(u.z,{variant:"ghost",size:"sm",className:"absolute top-2 right-2 h-8 w-8 p-0",onClick:x,title:"Copy code",children:o?(0,a.jsx)(d.Z,{className:"h-4 w-4 text-green-600"}):(0,a.jsx)(l.Z,{className:"h-4 w-4"})})]})]})]}),(0,a.jsx)(u.z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:x,title:"Copy code",children:o?(0,a.jsx)(d.Z,{className:"h-4 w-4 text-green-600"}):(0,a.jsx)(l.Z,{className:"h-4 w-4"})})]})]})}function h(e){let{content:t,className:s=""}=e,n=(e=>{let t;let s=[],a=/```(\w+)?\n?([\s\S]*?)```/g,n=0;for(;null!==(t=a.exec(e));){if(t.index>n){let a=e.slice(n,t.index);a.trim()&&s.push({type:"text",content:a})}let a=t[1],r=t[2].trim();s.push({type:"code",content:r,language:a}),n=t.index+t[0].length}if(n<e.length){let t=e.slice(n);t.trim()&&s.push({type:"text",content:t})}return 0===s.length&&s.push({type:"text",content:e}),s})(t);return(0,a.jsx)("div",{className:"whitespace-pre-wrap break-words ".concat(s),children:n.map((e,t)=>"code"===e.type?(0,a.jsx)(x,{code:e.content,language:e.language,className:"my-2"},t):(0,a.jsx)("span",{children:e.content},t))})}var p=s(8736),f=s(9202),v=s(3247),g=s(7689),j=s(1817),y=s(9322),N=s(1671),b=s(2489),w=s(4440),S=s(6980),C=s(4743),k=s(4508);let D=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("textarea",{className:(0,k.cn)("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...n})});D.displayName="Textarea";var z=s(6070),_=s(5974),E=s(962);let A=E.fC,R=E.wy,Z=E.Fw;async function T(e){if(navigator.clipboard)await navigator.clipboard.writeText(e);else{let t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}}let P=[".txt",".log",".csv",".json",".sql",".pdf",".xml",".conf",".config",".ini",".properties",".out",".err",".trace",".dump",".png",".jpg",".jpeg",".gif",".bmp",".tiff",".webp"];function L(e){let{conversationId:t,onConversationCreated:s,onConversationActivity:r}=e,{accessToken:d}=(0,o.a)(),[m,x]=(0,n.useState)([]),[k,E]=(0,n.useState)(""),[L,F]=(0,n.useState)(!1),[I,O]=(0,n.useState)(null),[U,B]=(0,n.useState)(!1),[M,V]=(0,n.useState)(null),[q,H]=(0,n.useState)(!1),[Y,G]=(0,n.useState)(!1),K=(0,n.useRef)(null),J=(0,n.useRef)(null),W=(0,n.useRef)(null),$=()=>{var e;null===(e=K.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,n.useEffect)(()=>{$()},[m]);let[Q,X]=(0,n.useState)(!1),[ee,et]=(0,n.useState)(null);(0,n.useEffect)(()=>{let e=!1,s=async t=>{if(!d){et("Authentication required to load conversation."),x([]);return}try{X(!0),et(null);let s=await fetch("/api/conversations/".concat(t),{headers:{Authorization:"Bearer ".concat(d)},cache:"no-store"});if(!s.ok){if(404===s.status){et("Conversation not found."),x([]);return}let e=await s.text().catch(()=>"");throw Error(e||"Failed to load conversation (status ".concat(s.status,")"))}let a=await s.json();if(e)return;let n=Array.isArray(null==a?void 0:a.messages)?a.messages.map(e=>{var t,s,a,n;return{id:String(e.id),role:"assistant"===e.role?"assistant":"user",content:null!==(t=e.content)&&void 0!==t?t:"",citations:Array.isArray(e.citations)?e.citations:void 0,searchType:null!==(s=e.searchType)&&void 0!==s?s:e.method,timestamp:new Date(null!==(n=null!==(a=e.createdAt)&&void 0!==a?a:e.created_at)&&void 0!==n?n:new Date().toISOString())}}):[];x(n),O(null),V(null)}catch(t){e||(console.error("Failed to load conversation history:",t),et("Unable to load conversation history."),x([]))}finally{e||X(!1)}};return void 0===t?(x([]),E(""),O(null),V(null),et(null),X(!1)):s(t),()=>{e=!0}},[t,d]);let es=e=>{if(e.size>10485760)return"File size exceeds ".concat(10,"MB limit");let t=e.name.toLowerCase().substring(e.name.lastIndexOf("."));return P.includes(t)?null:"File type not supported. Allowed: ".concat(P.join(", "))},ea=async e=>{let t=es(e);if(t){V(t);return}B(!0),V(null);try{let t=new FormData;t.append("file",e);let s=await fetch("/api/temp-upload",{method:"POST",body:t,headers:d?{Authorization:"Bearer ".concat(d)}:void 0}),a=await s.json();if(!a.success)throw Error(a.error||"Upload failed");let n={sessionId:a.sessionId,fileName:a.fileName,fileSize:a.fileSize,uploadTime:new Date().toISOString()};O(n);let r={id:Date.now().toString(),role:"assistant",content:"✅ **File uploaded successfully:** ".concat(e.name," (").concat(en(e.size),")\n\nYou can now ask questions about this document. I'll analyze its content to provide specific insights and troubleshooting assistance."),searchType:"temp-doc",uploadedFile:n,timestamp:new Date};x(e=>[...e,r])}catch(e){console.error("Upload error:",e),V(e instanceof Error?e.message:"Upload failed")}finally{B(!1)}},en=e=>{if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["Bytes","KB","MB"][t]},[er,eo]=(0,n.useState)(!1),[el,ei]=(0,n.useState)("");(0,n.useEffect)(()=>{let e=e=>{var t;(null===(t=e.dataTransfer)||void 0===t?void 0:t.types.includes("Files"))&&H(!0)},t=e=>{0===e.clientX&&0===e.clientY&&H(!1)};return document.addEventListener("dragenter",e),document.addEventListener("dragleave",t),()=>{document.removeEventListener("dragenter",e),document.removeEventListener("dragleave",t)}},[]);let ec=async e=>{e.preventDefault();let a=k.trim();if(!a||L)return;if(!d){ei("Please sign in to chat."),eo(!0);return}let n=a.match(/^\/(new|update|close)\s+case\s+(.+)$/i),o=a,l=a;if(n){let e=n[1].toLowerCase(),t=n[2].trim();if(!t){ei("Please provide a case number, e.g. /new case 01125052"),eo(!0);return}"new"===e?(o="\uD83D\uDCC4 Initiating Salesforce case ".concat(t),l="You are assisting with Salesforce case ".concat(t,". Using the conversation context, define the case for analysis and recommendation by providing:\n- A concise case overview with important facts known so far.\n- Immediate diagnostic or triage steps to perform.\n- Clarifying questions that should be asked of the customer.\n- Recommended next actions for engineering/support teams.\nReturn the response with headings: Case Overview, Immediate Actions, Clarifying Questions, Recommended Next Steps.")):"update"===e?(o="\uD83D\uDEE0️ Updating Salesforce case ".concat(t),l="You are providing an update on Salesforce case ".concat(t,". Review the conversation context and produce:\n- The current status/progress of the case.\n- Outstanding issues or blockers.\n- Recommended next steps for the support engineer.\n- Suggested customer communication points.\nReturn the response with headings: Case Status, Outstanding Items, Recommended Actions, Customer Communication.")):"close"===e&&(o="✅ Closing Salesforce case ".concat(t),l="You are preparing to close Salesforce case ".concat(t,". Based on the conversation context, provide:\n- A brief incident summary.\n- Actions taken and resolutions applied.\n- Verification steps or final checks completed/needed.\n- Final closing comments for the customer.\nReturn the response with headings: Summary, Actions Taken, Verification, Closing Comments."))}let i={id:Date.now().toString(),role:"user",content:o,uploadedFile:I||void 0,timestamp:new Date};x(e=>[...e,i]);let c=l;E(""),F(!0);try{var u,m;if(I){let e=await fetch("/api/temp-analyze",{method:"POST",headers:{"Content-Type":"application/json",...d?{Authorization:"Bearer ".concat(d)}:{}},body:JSON.stringify({sessionId:I.sessionId,query:c,maxResults:5})});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=await e.json(),s={id:(Date.now()+1).toString(),role:"assistant",content:t.response,citations:null===(m=t.results)||void 0===m?void 0:m.map((e,t)=>({id:"temp-".concat(t),title:"Section ".concat(e.rank),content:e.content,source:I.fileName,score:e.similarity})),searchType:"temp-doc",timestamp:new Date};x(e=>[...e,s]);return}let e=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(d)},body:JSON.stringify({conversationId:t,message:c,displayMessage:i.content})});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let a=null===(u=e.body)||void 0===u?void 0:u.getReader();if(!a)throw Error("No response body");let n={id:(Date.now()+1).toString(),role:"assistant",content:"",timestamp:new Date},o=t;for(x(e=>[...e,n]);;){let{done:e,value:r}=await a.read();if(e)break;for(let e of new TextDecoder().decode(r).split("\n"))if(e.startsWith("data: "))try{let a=JSON.parse(e.slice(6));"token"===a.type?x(e=>e.map(e=>e.id===n.id?{...e,content:e.content+a.token}:e)):"sources"===a.type?x(e=>e.map(e=>e.id===n.id?{...e,citations:a.sources,searchType:a.method}:e)):"conversation_id"===a.type?"number"==typeof a.conversationId&&(o=a.conversationId,void 0===t&&(null==s||s(a.conversationId))):"done"===a.type?console.log("Streaming completed"):"error"===a.type&&console.error("Streaming error:",a.error)}catch(t){console.warn("Failed to parse streaming data:",e)}}void 0!==o&&(null==r||r(o))}catch(t){console.error("Chat error:",t);let e={id:(Date.now()+1).toString(),role:"assistant",content:"Sorry, I encountered an error. Please try again.",timestamp:new Date};x(t=>[...t,e])}finally{F(!1)}},ed=e=>{switch(e){case"documents":return(0,a.jsx)(p.Z,{className:"h-3 w-3"});case"web":return(0,a.jsx)(f.Z,{className:"h-3 w-3"});case"hybrid":default:return(0,a.jsx)(v.Z,{className:"h-3 w-3"});case"temp-doc":return(0,a.jsx)(g.Z,{className:"h-3 w-3"})}},eu=e=>{switch(e){case"documents":return"Document Search";case"web":return"Web Search";case"hybrid":return"Hybrid Search";case"temp-doc":return"Uploaded Document";default:return"Search"}};return(0,a.jsxs)("div",{ref:W,className:"flex flex-col h-full relative",onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),H(!0)},onDragLeave:e=>{var t;e.preventDefault(),e.stopPropagation(),(null===(t=W.current)||void 0===t?void 0:t.contains(e.relatedTarget))||H(!1)},onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:e=>{e.preventDefault(),e.stopPropagation(),H(!1);let t=e.dataTransfer.files;t&&t.length>0&&ea(t[0])},children:[q&&(0,a.jsx)("div",{className:"absolute inset-0 z-50 bg-blue-500/10 backdrop-blur-sm flex items-center justify-center border-2 border-dashed border-blue-500",children:(0,a.jsxs)("div",{className:"text-center p-8 bg-white/90 rounded-lg shadow-lg",children:[(0,a.jsx)(g.Z,{className:"h-12 w-12 mx-auto text-blue-500 mb-4"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-blue-900 mb-2",children:"Drop file to analyze"}),(0,a.jsx)("p",{className:"text-blue-700",children:"Supports logs, configs, PDFs, images, and more"}),(0,a.jsx)("p",{className:"text-sm text-blue-600 mt-2",children:"AI will analyze your document with Technical Service Assistant expertise"})]})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[Q&&0===m.length?(0,a.jsxs)("div",{className:"text-center text-muted-foreground py-8",children:[(0,a.jsx)(j.Z,{className:"h-10 w-10 mx-auto mb-4 animate-spin"}),(0,a.jsx)("p",{children:"Loading conversation..."})]}):ee&&0===m.length?(0,a.jsxs)("div",{className:"text-center text-red-500 py-8",children:[(0,a.jsx)(y.Z,{className:"h-10 w-10 mx-auto mb-4"}),(0,a.jsx)("p",{children:ee})]}):0===m.length?(0,a.jsxs)("div",{className:"text-center text-muted-foreground py-8",children:[(0,a.jsx)(v.Z,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,a.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Start a conversation"}),(0,a.jsx)("p",{children:"Ask questions about your documents or any topic."})]}):null,m.map(e=>(0,a.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"max-w-[80%] ".concat("user"===e.role?"bg-primary text-primary-foreground":"bg-muted"," rounded-lg p-4 relative"),children:[(0,a.jsx)(h,{content:e.content}),"assistant"===e.role&&(0,a.jsx)("button",{className:"absolute top-2 right-2 p-1 rounded hover:bg-accent focus:outline-none focus:ring",title:"Copy response","aria-label":"Copy response","data-testid":"copy-btn",onClick:async()=>{try{await T(function(e){let t=e.content;if(e.citations&&e.citations.length>0)for(let s of(t+="\n\nSources:",e.citations))t+="\n- ".concat(s.title," (").concat(s.source,")").concat(s.score?" [".concat((100*s.score).toFixed(0),"% match]"):"");return t+="\n\nTimestamp: ".concat(e.timestamp.toLocaleString())}(e)),ei("Copied to clipboard!"),eo(!0)}catch(e){ei("Copy failed"),eo(!0)}},children:(0,a.jsx)(l.Z,{className:"h-4 w-4 text-muted-foreground"})}),e.citations&&e.citations.length>0&&(0,a.jsxs)("div",{className:"mt-3 pt-3 border-t border-border/20",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[ed(e.searchType),(0,a.jsx)("span",{className:"text-xs font-medium",children:eu(e.searchType)}),(0,a.jsxs)(_.C,{variant:"secondary",className:"text-xs",children:[e.citations.length," source",1!==e.citations.length?"s":""]})]}),(0,a.jsxs)(A,{children:[(0,a.jsx)(R,{className:"text-xs text-muted-foreground hover:text-foreground transition-colors",children:"Show sources ↓"}),(0,a.jsx)(Z,{className:"mt-2 space-y-2",children:e.citations.map((e,t)=>(0,a.jsx)(z.Zb,{className:"text-xs",children:(0,a.jsxs)(z.aY,{className:"p-3",children:[(0,a.jsx)("div",{className:"font-medium mb-1",children:e.title}),(0,a.jsx)("div",{className:"text-muted-foreground mb-2 line-clamp-2",children:e.content}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:e.source}),e.score&&(0,a.jsxs)(_.C,{variant:"outline",children:[(100*e.score).toFixed(0),"% match"]})]})]})},t))})]})]})]})},e.id)),Q&&m.length>0&&(0,a.jsx)("div",{className:"text-center text-xs text-muted-foreground",children:"Updating conversation…"}),L&&(0,a.jsx)("div",{className:"flex justify-start",children:(0,a.jsx)("div",{className:"bg-muted rounded-lg p-4",children:(0,a.jsx)(j.Z,{className:"h-4 w-4 animate-spin"})})}),(0,a.jsx)("div",{ref:K})]}),(0,a.jsxs)("div",{className:"sticky bottom-0 border-t bg-background p-4 z-10",children:[I&&(0,a.jsxs)("div",{className:"mb-3 p-3 bg-green-50 border border-green-200 rounded-lg flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(N.Z,{className:"h-4 w-4 text-green-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium text-green-900",children:I.fileName}),(0,a.jsxs)("span",{className:"text-sm text-green-600 ml-2",children:["(",en(I.fileSize),")"]})]})]}),(0,a.jsx)(u.z,{variant:"ghost",size:"sm",onClick:()=>{O(null),V(null),J.current&&(J.current.value="")},className:"text-green-700 hover:text-green-800",children:(0,a.jsx)(b.Z,{className:"h-4 w-4"})})]}),M&&(0,a.jsxs)("div",{className:"mb-3 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2",children:[(0,a.jsx)(y.Z,{className:"h-4 w-4 text-red-500 mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-red-900",children:"Upload Error"}),(0,a.jsx)("div",{className:"text-sm text-red-600",children:M})]}),(0,a.jsx)(u.z,{variant:"ghost",size:"sm",onClick:()=>V(null),className:"text-red-700 hover:text-red-800 ml-auto",children:(0,a.jsx)(b.Z,{className:"h-4 w-4"})})]}),(0,a.jsxs)("form",{onSubmit:ec,className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[(0,a.jsx)("span",{children:"Press Enter to send, Shift+Enter for a new line."}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)(u.z,{type:"button",variant:"ghost",size:"icon",onClick:()=>G(e=>!e),className:"text-muted-foreground hover:text-foreground",title:Y?"Collapse input":"Expand input",children:Y?(0,a.jsx)(w.Z,{className:"h-4 w-4"}):(0,a.jsx)(c.Z,{className:"h-4 w-4"})})})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(D,{value:k,onChange:e=>E(e.target.value),placeholder:I?I.fileName.match(/\.(png|jpg|jpeg|gif|bmp|tiff|webp)$/i)?"Describe what you see in the image or ask questions about it...":"Ask questions about the uploaded document...":"Ask a question about your documents...",className:"w-full pr-12 resize-y ".concat(Y?"min-h-[180px]":"min-h-[80px]"," max-h-[320px]"),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),ec(e))}}),(0,a.jsxs)("div",{className:"absolute right-3 bottom-3 flex items-center gap-2",children:[(0,a.jsx)("input",{type:"file",ref:J,onChange:e=>{let t=e.target.files;t&&t.length>0&&ea(t[0])},accept:P.join(","),className:"hidden"}),(0,a.jsx)(u.z,{type:"button",variant:"ghost",size:"icon",onClick:()=>{var e;return null===(e=J.current)||void 0===e?void 0:e.click()},disabled:U,className:"h-7 w-7",title:"Upload document for analysis",children:U?(0,a.jsx)(j.Z,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(S.Z,{className:"h-4 w-4"})})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:!I&&"\uD83D\uDCA1 Tip: Click the clip icon or drag & drop files to upload logs, configs, images, or other documents."}),(0,a.jsx)(u.z,{type:"submit",disabled:!k.trim()||L,children:L?(0,a.jsx)(j.Z,{className:"h-4 w-4 animate-spin"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(C.Z,{className:"h-4 w-4 mr-1"})," Send"]})})]})]}),!I&&(0,a.jsx)("div",{className:"mt-2 text-xs text-muted-foreground",children:"Need to describe a longer issue? Expand the input or attach files for deeper analysis."})]}),(0,a.jsxs)(i.zt,{swipeDirection:"right",children:[(0,a.jsx)(i.fC,{open:er,onOpenChange:eo,duration:2e3,className:"bg-black text-white px-4 py-2 rounded shadow-lg",children:(0,a.jsx)(i.Dx,{children:el})}),(0,a.jsx)(i.l_,{className:"fixed bottom-4 right-4 z-50"})]})]})}var F=s(7648),I=s(8728),O=s(9397),U=s(2718),B=s(8930),M=s(166);let V=(0,M.default)(()=>Promise.resolve().then(s.bind(s,6110)).then(e=>({default:e.Dialog})),{loadableGenerated:{webpack:()=>[6110]},ssr:!1,loading:()=>null}),q=(0,M.default)(()=>Promise.resolve().then(s.bind(s,6110)).then(e=>({default:e.DialogContent})),{loadableGenerated:{webpack:()=>[6110]},ssr:!1,loading:()=>null}),H=(0,M.default)(()=>Promise.resolve().then(s.bind(s,6110)).then(e=>({default:e.DialogHeader})),{loadableGenerated:{webpack:()=>[6110]},ssr:!1,loading:()=>null}),Y=(0,M.default)(()=>Promise.resolve().then(s.bind(s,6110)).then(e=>({default:e.DialogTitle})),{loadableGenerated:{webpack:()=>[6110]},ssr:!1,loading:()=>null}),G=(0,M.default)(()=>Promise.resolve().then(s.bind(s,6110)).then(e=>({default:e.DialogTrigger})),{loadableGenerated:{webpack:()=>[6110]},ssr:!1,loading:()=>null}),K=(0,M.default)(()=>Promise.resolve().then(s.bind(s,6110)).then(e=>({default:e.DialogDescription})),{loadableGenerated:{webpack:()=>[6110]},ssr:!1,loading:()=>null});var J=s(2672);function W(e){let{onNewChat:t,onSelectConversation:s,currentConversationId:r,refreshKey:l=0,onConversationDeleted:i}=e,[c,d]=(0,n.useState)(!1),[m,x]=(0,n.useState)([]),[h,f]=(0,n.useState)(!1),[v,g]=(0,n.useState)({documents:0,chunks:0}),[j,y]=(0,n.useState)(!1),[N,b]=(0,n.useState)(!1),[w,S]=(0,n.useState)([]),[C,k]=(0,n.useState)([]),[D,z]=(0,n.useState)(!1),[_,E]=(0,n.useState)(null),[A,R]=(0,n.useState)(null),[Z,T]=(0,n.useState)(""),[P,L]=(0,n.useState)(new Set),[F,M]=(0,n.useState)(!1),[W,$]=(0,n.useState)(!1),[Q,X]=(0,n.useState)({type:[],product:[],version:[],privacy:[]}),[ee,et]=(0,n.useState)({types:[],products:[],versions:[],privacies:[]}),{accessToken:es,user:ea}=(0,o.a)(),en="admin"===((null==ea?void 0:ea.role_name)||"").toLowerCase();(0,n.useEffect)(()=>{d(!0)},[]);let er=(0,n.useCallback)(async()=>{if(!es){x([]);return}try{f(!0);let e=await fetch("/api/conversations?limit=30",{headers:{Authorization:"Bearer ".concat(es)},cache:"no-store"});if(!e.ok){if(401===e.status){x([]);return}let t="";try{let s=await e.json();t=(null==s?void 0:s.error)||(null==s?void 0:s.detail)||""}catch(e){}throw Error(t||"Failed to load conversations (status ".concat(e.status,")"))}let t=await e.json();if(!t||!Array.isArray(t.conversations)){x([]);return}let s=t.conversations.map(e=>{var t,s,a,n,r,o,l;return{id:e.id,title:null!==(t=e.title)&&void 0!==t?t:"Untitled conversation",createdAt:null!==(a=null!==(s=e.createdAt)&&void 0!==s?s:e.created_at)&&void 0!==a?a:null,updatedAt:null!==(r=null!==(n=e.updatedAt)&&void 0!==n?n:e.updated_at)&&void 0!==r?r:null,lastReviewedAt:null!==(l=null!==(o=e.lastReviewedAt)&&void 0!==o?o:e.last_reviewed_at)&&void 0!==l?l:null}});x(s)}catch(e){console.error("[Conversations] fetch error:",e),x([])}finally{f(!1)}},[es]);(0,n.useEffect)(()=>{g({documents:42,chunks:1234})},[]),(0,n.useEffect)(()=>{er()},[er,l]),(0,n.useEffect)(()=>{if(!N)return;if(!es){S([]),k([]),E("Not authenticated");return}let e=!1;return z(!0),E(null),R(null),(async()=>{try{let t=await (0,J.ju)({accessToken:es,limit:50,offset:0});if(e)return;let s=Array.isArray(null==t?void 0:t.documents)?t.documents:[];S(s)}catch(t){if(e)return;console.error("[Documents] fetch error:",t),S([]),k([]),E((null==t?void 0:t.message)||"Failed to load documents")}finally{e||z(!1)}})(),()=>{e=!0}},[N,es]),(0,n.useEffect)(()=>{if(!N)return;let e={types:new Set,products:new Set,versions:new Set,privacies:new Set};w.forEach(t=>{t.document_type&&e.types.add(t.document_type),t.product_name&&e.products.add(t.product_name),t.product_version&&e.versions.add(t.product_version),t.privacy_level&&e.privacies.add(t.privacy_level)}),et({types:Array.from(e.types).sort(),products:Array.from(e.products).sort(),versions:Array.from(e.versions).sort(),privacies:Array.from(e.privacies).sort()}),X(t=>({type:t.type.filter(t=>e.types.has(t)),product:t.product.filter(t=>e.products.has(t)),version:t.version.filter(t=>e.versions.has(t)),privacy:t.privacy.filter(t=>e.privacies.has(t))}))},[N,w]),(0,n.useEffect)(()=>{if(!N)return;let e=Z.trim().toLowerCase();k(w.filter(t=>{let s=[t.file_name,t.document_type,t.product_name,t.product_version,t.privacy_level].filter(e=>"string"==typeof e&&e.length>0).map(e=>e.toLowerCase());return!!((!e||s.some(t=>t.includes(e)))&&(!Q.type.length||t.document_type&&Q.type.includes(t.document_type))&&(!Q.product.length||t.product_name&&Q.product.includes(t.product_name))&&(!Q.version.length||t.product_version&&Q.version.includes(t.product_version))&&(!Q.privacy.length||t.privacy_level&&Q.privacy.includes(t.privacy_level)))}))},[Z,w,N,Q]),(0,n.useEffect)(()=>{N||(T(""),X({type:[],product:[],version:[],privacy:[]}),L(new Set),R(null))},[N]),(0,n.useEffect)(()=>{L(e=>{if(0===e.size)return e;let t=new Set(w.map(e=>e.id)),s=!1,a=new Set;return e.forEach(e=>{t.has(e)?a.add(e):s=!0}),s?a:e})},[w]);let eo=(e,t)=>{X(s=>{let a=new Set(s[e]);return a.has(t)?a.delete(t):a.add(t),{...s,[e]:Array.from(a)}})},el=e=>{L(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},ei=async()=>{if(es&&0!==P.size){M(!0),R(null);try{for(let e of Array.from(P)){let t=w.find(t=>t.id===e);if(!t)continue;let s=await (0,J.AG)(es,e),a=window.URL.createObjectURL(s),n=document.createElement("a");n.href=a,n.download=t.file_name||"document-".concat(e),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(a)}}catch(e){console.error("[Documents] bulk download error:",e),R((null==e?void 0:e.message)||"Failed to download selected documents")}finally{M(!1)}}},ec=async()=>{if(!en||!es||0===P.size)return;let e=Array.from(P);if(window.confirm("Delete ".concat(e.length," document").concat(e.length>1?"s":"","? This action cannot be undone."))){$(!0),R(null);try{for(let t of e)await (0,J.iH)(es,t);let t=new Set(e);S(e=>e.filter(e=>!t.has(e.id))),L(new Set)}catch(e){console.error("[Documents] bulk delete error:",e),R((null==e?void 0:e.message)||"Failed to delete selected documents")}finally{$(!1)}}},ed=P.size,eu=(0,n.useMemo)(()=>0!==C.length&&C.every(e=>P.has(e.id)),[C,P]);return c?(0,a.jsxs)("div",{className:"w-64 bg-muted/30 border-r flex flex-col",children:[(0,a.jsx)("div",{className:"p-4 border-b",children:(0,a.jsxs)(V,{open:N,onOpenChange:b,children:[(0,a.jsx)(G,{asChild:!0,children:(0,a.jsxs)(u.z,{variant:"ghost",className:"w-full justify-start",children:[(0,a.jsx)(p.Z,{className:"h-4 w-4 mr-2"}),"Documents"]})}),(0,a.jsxs)(q,{className:"sm:max-w-md",children:[(0,a.jsxs)(H,{children:[(0,a.jsx)(Y,{children:"Documents"}),(0,a.jsx)(K,{children:"View and manage uploaded documents."})]}),D?(0,a.jsx)("div",{className:"py-2 text-muted-foreground text-sm",children:"Loading documents..."}):_?(0,a.jsxs)("div",{className:"py-2 text-red-500 text-sm",children:["Error: ",_]}):(0,a.jsxs)("div",{className:"py-2 space-y-2",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("input",{type:"text",value:Z,onChange:e=>T(e.target.value),placeholder:"Search documents",className:"w-full border rounded px-2 py-1 text-sm"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,a.jsxs)("div",{className:"border rounded px-2 py-2",children:[(0,a.jsx)("p",{className:"text-xs font-semibold text-muted-foreground mb-1",children:"Type"}),(0,a.jsx)("div",{className:"flex flex-col gap-1 max-h-24 overflow-y-auto pr-1",children:0===ee.types.length?(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"No types available"}):ee.types.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-2 text-xs",children:[(0,a.jsx)("input",{type:"checkbox",checked:Q.type.includes(e),onChange:()=>eo("type",e),className:"h-3 w-3"}),(0,a.jsx)("span",{children:e})]},e))})]}),(0,a.jsxs)("div",{className:"border rounded px-2 py-2",children:[(0,a.jsx)("p",{className:"text-xs font-semibold text-muted-foreground mb-1",children:"Product"}),(0,a.jsx)("div",{className:"flex flex-col gap-1 max-h-24 overflow-y-auto pr-1",children:0===ee.products.length?(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"No products available"}):ee.products.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-2 text-xs",children:[(0,a.jsx)("input",{type:"checkbox",checked:Q.product.includes(e),onChange:()=>eo("product",e),className:"h-3 w-3"}),(0,a.jsx)("span",{children:e})]},e))})]}),(0,a.jsxs)("div",{className:"border rounded px-2 py-2",children:[(0,a.jsx)("p",{className:"text-xs font-semibold text-muted-foreground mb-1",children:"Version"}),(0,a.jsx)("div",{className:"flex flex-col gap-1 max-h-24 overflow-y-auto pr-1",children:0===ee.versions.length?(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"No versions available"}):ee.versions.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-2 text-xs",children:[(0,a.jsx)("input",{type:"checkbox",checked:Q.version.includes(e),onChange:()=>eo("version",e),className:"h-3 w-3"}),(0,a.jsx)("span",{children:e})]},e))})]}),(0,a.jsxs)("div",{className:"border rounded px-2 py-2",children:[(0,a.jsx)("p",{className:"text-xs font-semibold text-muted-foreground mb-1",children:"Privacy"}),(0,a.jsx)("div",{className:"flex flex-col gap-1 max-h-24 overflow-y-auto pr-1",children:0===ee.privacies.length?(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"No privacy levels available"}):ee.privacies.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-2 text-xs",children:[(0,a.jsx)("input",{type:"checkbox",checked:Q.privacy.includes(e),onChange:()=>eo("privacy",e),className:"h-3 w-3"}),(0,a.jsx)("span",{children:e})]},e))})]})]})]}),A&&(0,a.jsx)("div",{className:"text-xs text-red-500 px-1",children:A}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-muted-foreground px-1",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",className:"h-3 w-3",checked:eu,onChange:()=>{L(e=>{let t=new Set(e);return C.length>0&&C.every(e=>t.has(e.id))?C.forEach(e=>t.delete(e.id)):C.forEach(e=>t.add(e.id)),t})},disabled:0===C.length}),(0,a.jsx)("span",{children:"Select all"})]}),(0,a.jsxs)("span",{children:[ed," selected"]})]}),(0,a.jsxs)("div",{className:"flex gap-2 px-1",children:[(0,a.jsx)(u.z,{size:"sm",variant:"outline",className:"flex-1",onClick:ei,disabled:0===ed||F,children:F?"Downloading...":"Download Selected"}),en&&(0,a.jsx)(u.z,{size:"sm",variant:"destructive",className:"flex-1",onClick:ec,disabled:0===ed||W,children:W?"Deleting...":"Delete Selected"})]}),(0,a.jsx)("div",{className:"max-h-64 overflow-y-auto pr-2",children:0===w.length?(0,a.jsx)("div",{className:"py-2 text-muted-foreground text-sm",children:"No documents found."}):0===C.length?(0,a.jsx)("div",{className:"py-2 text-muted-foreground text-sm",children:"No documents match the selected filters."}):(0,a.jsx)("ul",{className:"space-y-2",children:C.map(e=>(0,a.jsx)("li",{className:"border-b pb-2",children:(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)("input",{type:"checkbox",className:"h-4 w-4 mt-1",checked:P.has(e.id),onChange:()=>el(e.id)}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"font-medium truncate",children:e.file_name}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:[e.document_type&&(0,a.jsxs)("span",{children:["Type: ",e.document_type," | "]}),e.product_name&&(0,a.jsxs)("span",{children:["Product: ",e.product_name," | "]}),e.product_version&&(0,a.jsxs)("span",{children:["Version: ",e.product_version," | "]}),e.privacy_level&&(0,a.jsxs)("span",{children:["Privacy: ",e.privacy_level," | "]}),e.processed_at&&(0,a.jsxs)("span",{children:["Processed: ",new Date(e.processed_at).toLocaleDateString()," "]})]})]})]})},e.id))})})]})]})]})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto",children:[(0,a.jsxs)("div",{className:"px-4 pb-2 flex items-center justify-between gap-2",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-muted-foreground",children:"Recent Conversations"}),(0,a.jsxs)(u.z,{size:"sm",variant:"outline",onClick:t,className:"flex items-center gap-1",children:[(0,a.jsx)(O.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-xs",children:"New"})]})]}),(0,a.jsx)("div",{className:"px-2 space-y-1",children:h?(0,a.jsx)("div",{className:"px-1 py-2 text-sm text-muted-foreground",children:"Loading conversations..."}):0===m.length?(0,a.jsx)("div",{className:"px-1 py-2 text-sm text-muted-foreground",children:"No conversations yet. Start a new chat to begin."}):m.map(e=>{var t;let n=null!==(t=e.updatedAt)&&void 0!==t?t:e.createdAt,o=n?new Date(n).toLocaleString():"";return(0,a.jsx)(u.z,{variant:r===e.id?"secondary":"ghost",className:"w-full justify-start text-left h-auto p-3",onClick:()=>s(e.id),children:(0,a.jsxs)("div",{className:"flex items-start gap-2 w-full",children:[(0,a.jsx)(U.Z,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"truncate text-sm",children:e.title}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:o})]}),(0,a.jsxs)("button",{type:"button",className:"ml-2 text-muted-foreground hover:text-destructive transition-colors",onClick:async t=>{if(t.stopPropagation(),window.confirm("Delete this conversation? This action cannot be undone."))try{if(!es)throw Error("Not authenticated");let t=await fetch("/api/conversations/".concat(e.id),{method:"DELETE",headers:{Authorization:"Bearer ".concat(es)}});if(!t.ok&&204!==t.status){let e="";try{let s=await t.json();e=(null==s?void 0:s.error)||(null==s?void 0:s.detail)||""}catch(e){}throw Error(e||"Failed to delete conversation (status ".concat(t.status,")"))}null==i||i(e.id),er()}catch(e){console.error("Failed to delete conversation:",e),alert("Failed to delete conversation. Please try again.")}},children:[(0,a.jsx)(B.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Delete conversation"})]})]})},e.id)})})]}),(0,a.jsx)("div",{className:"p-4 border-t",children:(0,a.jsxs)(V,{open:j,onOpenChange:y,children:[(0,a.jsx)(G,{asChild:!0,children:(0,a.jsxs)(u.z,{variant:"ghost",className:"w-full justify-start",children:[(0,a.jsx)(I.Z,{className:"h-4 w-4 mr-2"}),"Settings"]})}),(0,a.jsxs)(q,{className:"sm:max-w-md",children:[(0,a.jsx)(H,{children:(0,a.jsx)(Y,{children:"Settings"})}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"text-sm font-medium",children:"System Information"}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground space-y-1",children:[(0,a.jsxs)("div",{children:["Documents: ",v.documents]}),(0,a.jsxs)("div",{children:["Chunks: ",v.chunks]}),(0,a.jsx)("div",{children:"RAG System: Production Ready ✅"}),(0,a.jsx)("div",{children:"Load Balancing: 4 Ollama Instances"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"text-sm font-medium",children:"Version Information"}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground space-y-1",children:[(0,a.jsx)("div",{children:"Version: 1.0.0"}),(0,a.jsx)("div",{children:"Last Updated: September 24, 2025"}),(0,a.jsx)("div",{children:"Status: Docker Validated"})]})]}),(0,a.jsx)("div",{className:"pt-4 border-t",children:(0,a.jsx)(u.z,{variant:"outline",onClick:()=>y(!1),className:"w-full",children:"Close"})})]})]})]})})]}):(0,a.jsxs)("div",{className:"w-64 bg-muted/30 border-r flex flex-col",children:[(0,a.jsx)("div",{className:"p-4 border-b",children:(0,a.jsxs)(u.z,{variant:"ghost",className:"w-full justify-start",disabled:!0,children:[(0,a.jsx)(p.Z,{className:"h-4 w-4 mr-2"}),"Documents"]})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,a.jsx)("div",{className:"px-4 pb-2",children:(0,a.jsx)("h3",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Recent Conversations"})})}),(0,a.jsx)("div",{className:"p-4 border-t",children:(0,a.jsxs)(u.z,{variant:"ghost",className:"w-full justify-start",disabled:!0,children:[(0,a.jsx)(I.Z,{className:"h-4 w-4 mr-2"}),"Settings"]})})]})}var $=s(7818),Q=s(407),X=s(519);let ee=$.fC,et=$.xz;$.ZA,$.Uv,$.Tr,$.Ee,n.forwardRef((e,t)=>{let{className:s,inset:n,children:r,...o}=e;return(0,a.jsxs)($.fF,{ref:t,className:(0,k.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",n&&"pl-8",s),...o,children:[r,(0,a.jsx)(Q.Z,{className:"ml-auto h-4 w-4"})]})}).displayName=$.fF.displayName,n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)($.tu,{ref:t,className:(0,k.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...n})}).displayName=$.tu.displayName;let es=n.forwardRef((e,t)=>{let{className:s,sideOffset:n=4,...r}=e;return(0,a.jsx)($.Uv,{children:(0,a.jsx)($.VY,{ref:t,sideOffset:n,className:(0,k.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...r})})});es.displayName=$.VY.displayName;let ea=n.forwardRef((e,t)=>{let{className:s,inset:n,...r}=e;return(0,a.jsx)($.ck,{ref:t,className:(0,k.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n&&"pl-8",s),...r})});ea.displayName=$.ck.displayName,n.forwardRef((e,t)=>{let{className:s,children:n,checked:r,...o}=e;return(0,a.jsxs)($.oC,{ref:t,className:(0,k.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:r,...o,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)($.wU,{children:(0,a.jsx)(d.Z,{className:"h-4 w-4"})})}),n]})}).displayName=$.oC.displayName,n.forwardRef((e,t)=>{let{className:s,children:n,...r}=e;return(0,a.jsxs)($.Rk,{ref:t,className:(0,k.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...r,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)($.wU,{children:(0,a.jsx)(X.Z,{className:"h-2 w-2 fill-current"})})}),n]})}).displayName=$.Rk.displayName;let en=n.forwardRef((e,t)=>{let{className:s,inset:n,...r}=e;return(0,a.jsx)($.__,{ref:t,className:(0,k.cn)("px-2 py-1.5 text-sm font-semibold",n&&"pl-8",s),...r})});en.displayName=$.__.displayName;let er=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)($.Z0,{ref:t,className:(0,k.cn)("-mx-1 my-1 h-px bg-muted",s),...n})});er.displayName=$.Z0.displayName;var eo=s(2369),el=s(875),ei=s(8906),ec=s(6215),ed=s(4401),eu=s(4001),em=s(7692);function ex(e){let{className:t}=e,{user:s,logout:n}=(0,o.a)();if(!s)return null;let r="string"==typeof s.role_name?s.role_name.toLowerCase():null,l="string"==typeof s.role_id?Number.parseInt(s.role_id,10):s.role_id;return(0,a.jsxs)(ee,{children:[(0,a.jsxs)(et,{className:"flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors cursor-pointer ".concat(t),children:[(0,a.jsx)(eo.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:s.full_name}),(0,a.jsx)("span",{className:"ml-2 px-2 py-0.5 rounded bg-secondary text-xs uppercase",children:s.role_name||"role "+s.role_id}),(0,a.jsx)(el.Z,{className:"h-4 w-4"})]}),(0,a.jsxs)(es,{align:"end",className:"w-56",children:[(0,a.jsx)(en,{className:"font-normal",children:(0,a.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium leading-none",children:s.full_name}),(0,a.jsx)("p",{className:"text-xs leading-none text-muted-foreground",children:s.email})]})}),(0,a.jsx)(er,{}),("admin"===r||1===l)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ea,{asChild:!0,children:(0,a.jsxs)(F.default,{href:"/admin",className:"flex items-center cursor-pointer",children:[(0,a.jsx)(ei.Z,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"User / Role Management"})]})}),(0,a.jsx)(ea,{asChild:!0,children:(0,a.jsxs)("a",{href:"http://RNI-LLM-01.lab.sensus.net:3001",target:"_blank",rel:"noopener noreferrer",className:"flex items-center cursor-pointer",children:[(0,a.jsx)(ec.Z,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Grafana Dashboard"})]})}),(0,a.jsx)(ea,{asChild:!0,children:(0,a.jsxs)("a",{href:"http://RNI-LLM-01.lab.sensus.net:9091",target:"_blank",rel:"noopener noreferrer",className:"flex items-center cursor-pointer",children:[(0,a.jsx)(ed.Z,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Prometheus Server"})]})}),(0,a.jsx)(er,{})]}),(0,a.jsx)(ea,{asChild:!0,children:(0,a.jsxs)(F.default,{href:"/change-password",className:"flex items-center cursor-pointer",children:[(0,a.jsx)(eu.Z,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Change Password"})]})}),(0,a.jsx)(er,{}),(0,a.jsxs)(ea,{onClick:n,className:"flex items-center cursor-pointer text-red-600",children:[(0,a.jsx)(em.Z,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Logout"})]})]})]})}function eh(){let[e,t]=(0,n.useState)(),[s,l]=(0,n.useState)(0),[i,c]=(0,n.useState)(!1),{user:d,logout:u,loading:m}=(0,o.a)(),x=(0,r.useRouter)(),h=null==d?void 0:d.password_change_required,p=null==d?void 0:d.email;return((0,n.useEffect)(()=>{console.log("[HOME] Password change check:",{userEmail:p,passwordChangeRequired:h,redirecting:i}),h&&!i&&(console.log("[HOME] Redirecting to password change page"),c(!0),x.push("/change-password"))},[h,p,x,i]),m)?(0,a.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center space-y-4",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading..."})]})}):(null==d?void 0:d.password_change_required)||i?(0,a.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center space-y-4",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Redirecting to password change..."})]})}):(0,a.jsxs)("div",{className:"flex h-screen",children:[d&&(0,a.jsx)(W,{onNewChat:()=>{t(void 0)},onSelectConversation:e=>{t(e)},currentConversationId:e,refreshKey:s,onConversationDeleted:s=>{e===s&&t(void 0),l(e=>e+1)}}),(0,a.jsxs)("main",{className:"flex-1 flex flex-col",children:[(0,a.jsxs)("div",{className:"border-b p-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold",children:"Technical Services Assistant"}),(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:d?"Ask questions about your documents":"Sign in to access the assistant"})]}),(0,a.jsx)("div",{className:"flex items-center gap-4",children:d?(0,a.jsx)(ex,{}):(0,a.jsxs)("div",{className:"flex gap-3 text-sm",children:[(0,a.jsx)(F.default,{href:"/login",className:"underline",children:"Login"}),(0,a.jsx)(F.default,{href:"/register",className:"underline",children:"Register"})]})})]}),d?(0,a.jsx)(L,{conversationId:e,onConversationCreated:e=>{t(e),l(e=>e+1)},onConversationActivity:()=>{l(e=>e+1)}}):(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center space-y-4",children:[(0,a.jsx)("h2",{className:"text-xl font-medium",children:"Welcome to Technical Service Assistant"}),(0,a.jsx)("p",{className:"text-muted-foreground max-w-md",children:"Authenticate to start secure, role-based retrieval augmented conversations. Your role will control access to private versus public knowledge."}),(0,a.jsxs)("div",{className:"flex gap-4 justify-center",children:[(0,a.jsx)(F.default,{href:"/login",className:"underline",children:"Login"}),(0,a.jsx)(F.default,{href:"/register",className:"underline",children:"Register"})]})]})})]})]})}},5974:function(e,t,s){"use strict";s.d(t,{C:function(){return l}});var a=s(7437);s(2265);var n=s(535),r=s(4508);let o=(0,n.j)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:s,...n}=e;return(0,a.jsx)("div",{className:(0,r.cn)(o({variant:s}),t),...n})}},2869:function(e,t,s){"use strict";s.d(t,{z:function(){return c}});var a=s(7437),n=s(2265),r=s(7495),o=s(535),l=s(4508);let i=(0,o.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=n.forwardRef((e,t)=>{let{className:s,variant:n,size:o,asChild:c=!1,...d}=e,u=c?r.g7:"button";return(0,a.jsx)(u,{className:(0,l.cn)(i({variant:n,size:o,className:s})),ref:t,...d})});c.displayName="Button"},6070:function(e,t,s){"use strict";s.d(t,{Ol:function(){return l},SZ:function(){return c},Zb:function(){return o},aY:function(){return d},ll:function(){return i}});var a=s(7437),n=s(2265),r=s(4508);let o=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,r.cn)("rounded-xl border bg-card text-card-foreground shadow",s),...n})});o.displayName="Card";let l=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",s),...n})});l.displayName="CardHeader";let i=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,r.cn)("font-semibold leading-none tracking-tight",s),...n})});i.displayName="CardTitle";let c=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,r.cn)("text-sm text-muted-foreground",s),...n})});c.displayName="CardDescription";let d=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,r.cn)("p-6 pt-0",s),...n})});d.displayName="CardContent",n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,r.cn)("flex items-center p-6 pt-0",s),...n})}).displayName="CardFooter"},6110:function(e,t,s){"use strict";s.r(t),s.d(t,{Dialog:function(){return l},DialogContent:function(){return m},DialogDescription:function(){return p},DialogHeader:function(){return x},DialogTitle:function(){return h},DialogTrigger:function(){return u}});var a=s(7437),n=s(2265),r=s(2489),o=s(2869);let l=e=>{let{open:t,onOpenChange:s,children:r}=e,[o,l]=n.useState(t||!1);return n.useEffect(()=>{void 0!==t&&l(t)},[t]),(0,a.jsx)(c,{value:{open:o,onOpenChange:e=>{l(e),null==s||s(e)}},children:r})},i=n.createContext(null),c=i.Provider,d=()=>{let e=n.useContext(i);if(!e)throw Error("useDialog must be used within Dialog");return e},u=e=>{let{asChild:t,children:s}=e,{open:r,onOpenChange:l}=d(),i=()=>{l(!r)};return t?n.cloneElement(s,{onClick:i}):(0,a.jsx)(o.z,{onClick:i,children:s})},m=e=>{let{className:t="",children:s}=e,{open:n,onOpenChange:l}=d();return n?(0,a.jsxs)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black/60",style:{zIndex:9998},onClick:()=>l(!1)}),(0,a.jsxs)("div",{className:"relative bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 w-full max-w-xl mx-4",style:{zIndex:9999},children:[(0,a.jsx)(o.z,{variant:"ghost",size:"sm",className:"absolute right-2 top-2 p-1 h-6 w-6",onClick:()=>l(!1),children:(0,a.jsx)(r.Z,{className:"h-4 w-4"})}),s]})]}):null},x=e=>{let{children:t}=e;return(0,a.jsx)("div",{className:"mb-4",children:t})},h=e=>{let{children:t}=e;return(0,a.jsx)("h2",{className:"text-lg font-semibold",children:t})},p=e=>{let{children:t}=e;return(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:t})}}},function(e){e.O(0,[137,648,944,60,971,117,744],function(){return e(e.s=6549)}),_N_E=e.O()}]);