(()=>{var e={};e.id=6973,e.ids=[6973],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5424:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>o.a,__next_app__:()=>h,originalPathname:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c}),r(9408),r(9458),r(996);var a=r(170),s=r(5002),n=r(3876),o=r.n(n),i=r(6299),l={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>i[e]);r.d(t,l);let c=["",{children:["change-password",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,9408)),"/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/change-password/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,9458)),"/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,996,23)),"next/dist/client/components/not-found-error"]}],d=["/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/change-password/page.tsx"],u="/change-password/page",h={require:r,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/change-password/page",pathname:"/change-password",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},5504:(e,t,r)=>{Promise.resolve().then(r.bind(r,7560))},3649:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,3642,23)),Promise.resolve().then(r.t.bind(r,7586,23)),Promise.resolve().then(r.t.bind(r,7838,23)),Promise.resolve().then(r.t.bind(r,8057,23)),Promise.resolve().then(r.t.bind(r,7741,23)),Promise.resolve().then(r.t.bind(r,3118,23))},7730:(e,t,r)=>{Promise.resolve().then(r.bind(r,9410))},7560:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var a=r(7247),s=r(8964),n=r(9410),o=r(8053),i=r(7757);function l(){let{user:e,logout:t}=(0,n.a)(),[r,l]=(0,s.useState)(""),[c,d]=(0,s.useState)(""),[u,h]=(0,s.useState)(""),[p,m]=(0,s.useState)(!1),[g,f]=(0,s.useState)(null),[x,w]=(0,s.useState)(null),[v,b]=(0,s.useState)(!1),y=e=>e.length<8?"Password must be at least 8 characters long":/[A-Z]/.test(e)?/[a-z]/.test(e)?/\d/.test(e)?/[!@#$%^&*(),.?":{}|<>]/.test(e)?null:"Password must contain at least one special character":"Password must contain at least one digit":"Password must contain at least one lowercase letter":"Password must contain at least one uppercase letter",j=async e=>{e.preventDefault(),f(null),w(null);let t=y(c);if(t){f(t);return}if(c!==u){f("New password and confirmation do not match");return}if(!v&&!r){f("Current password is required");return}m(!0);try{let e=v?"/api/auth/force-change-password":"/api/auth/change-password",t=v?{new_password:c,confirm_password:u}:{current_password:r,new_password:c,confirm_password:u},a=await fetch(`http://localhost:8008${e}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")}`},body:JSON.stringify(t)}),s=await a.json();a.ok?(w("Password changed successfully!"),setTimeout(()=>{v||(l(""),d(""),h(""))},2e3)):f(s.detail||"Failed to change password")}catch(e){f("Network error. Please try again.")}finally{m(!1)}};return e?a.jsx("div",{className:"flex items-center justify-center min-h-screen p-4",children:(0,a.jsxs)(i.Zb,{className:"p-8 w-full max-w-md space-y-6",children:[(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-2xl font-semibold mb-2",children:v?"Change Your Password":"Change Password"}),v?a.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"You must change your password before continuing. Please choose a strong password."}):a.jsx("p",{className:"text-sm text-muted-foreground",children:"Update your account password"})]}),g&&a.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:g}),x&&a.jsx("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded",children:x}),(0,a.jsxs)("form",{onSubmit:j,className:"space-y-4",children:[!v&&(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium",htmlFor:"current-password",children:"Current Password"}),a.jsx("input",{id:"current-password",type:"password",value:r,onChange:e=>l(e.target.value),className:"w-full border rounded px-3 py-2 text-sm bg-background",placeholder:"Enter current password",required:!v})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium",htmlFor:"new-password",children:"New Password"}),a.jsx("input",{id:"new-password",type:"password",value:c,onChange:e=>d(e.target.value),className:"w-full border rounded px-3 py-2 text-sm bg-background",placeholder:"Enter new password",required:!0}),a.jsx("div",{className:"text-xs text-muted-foreground",children:"Password must contain at least 8 characters, including uppercase, lowercase, digit, and special character"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium",htmlFor:"confirm-password",children:"Confirm New Password"}),a.jsx("input",{id:"confirm-password",type:"password",value:u,onChange:e=>h(e.target.value),className:"w-full border rounded px-3 py-2 text-sm bg-background",placeholder:"Confirm new password",required:!0})]}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[a.jsx(o.z,{type:"submit",disabled:p,className:"flex-1",children:p?"Changing...":"Change Password"}),!v&&a.jsx(o.z,{type:"button",variant:"outline",onClick:()=>{},disabled:p,children:"Cancel"})]})]}),v&&a.jsx("div",{className:"pt-4 border-t",children:a.jsx(o.z,{variant:"outline",onClick:()=>{t()},className:"w-full",children:"Logout Instead"})})]})}):null}},8053:(e,t,r)=>{"use strict";r.d(t,{z:()=>c});var a=r(7247),s=r(8964),n=r(9008),o=r(7972),i=r(5008);let l=(0,o.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef(({className:e,variant:t,size:r,asChild:s=!1,...o},c)=>{let d=s?n.g7:"button";return a.jsx(d,{className:(0,i.cn)(l({variant:t,size:r,className:e})),ref:c,...o})});c.displayName="Button"},7757:(e,t,r)=>{"use strict";r.d(t,{Ol:()=>i,SZ:()=>c,Zb:()=>o,aY:()=>d,ll:()=>l});var a=r(7247),s=r(8964),n=r(5008);let o=s.forwardRef(({className:e,...t},r)=>a.jsx("div",{ref:r,className:(0,n.cn)("rounded-xl border bg-card text-card-foreground shadow",e),...t}));o.displayName="Card";let i=s.forwardRef(({className:e,...t},r)=>a.jsx("div",{ref:r,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",e),...t}));i.displayName="CardHeader";let l=s.forwardRef(({className:e,...t},r)=>a.jsx("div",{ref:r,className:(0,n.cn)("font-semibold leading-none tracking-tight",e),...t}));l.displayName="CardTitle";let c=s.forwardRef(({className:e,...t},r)=>a.jsx("div",{ref:r,className:(0,n.cn)("text-sm text-muted-foreground",e),...t}));c.displayName="CardDescription";let d=s.forwardRef(({className:e,...t},r)=>a.jsx("div",{ref:r,className:(0,n.cn)("p-6 pt-0",e),...t}));d.displayName="CardContent",s.forwardRef(({className:e,...t},r)=>a.jsx("div",{ref:r,className:(0,n.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter"},5008:(e,t,r)=>{"use strict";r.d(t,{cn:()=>n});var a=r(1929),s=r(5770);function n(...e){return(0,s.m6)((0,a.W)(e))}},9410:(e,t,r)=>{"use strict";r.d(t,{AuthProvider:()=>l,a:()=>c});var a=r(7247),s=r(8964);let n=(0,s.createContext)(void 0),o="tsa_auth_v1";function i(e){try{localStorage.setItem(o,JSON.stringify(e))}catch(e){}}let l=({children:e})=>{let[t,r]=(0,s.useState)({user:null,accessToken:null,refreshToken:null,expiresAt:null,loading:!0,error:null}),l=e=>r(t=>({...t,...e})),c=e=>e;(0,s.useEffect)(()=>{let e=!1;return(async()=>{let t=function(){try{let e=localStorage.getItem(o);if(!e)return null;return JSON.parse(e)}catch(e){return null}}();if(!t?.accessToken){e||l({loading:!1});return}l({...t,loading:!0});try{let t=await fetch(c("/api/auth/health")).catch(()=>null);if(!t||!t.ok&&404!==t.status){e||l({loading:!1,error:"Auth service unavailable"});return}}catch(t){e||l({loading:!1,error:"Auth service unavailable"});return}try{let r=await fetch(c("/api/auth/me"),{headers:{Authorization:`Bearer ${t.accessToken}`}});if(r.ok){let t=await r.json();e||l({user:t,loading:!1})}else e||(l({loading:!1,accessToken:null,refreshToken:null,user:null}),i({}))}catch(t){e||l({loading:!1})}})(),()=>{e=!0}},[]);let d=(0,s.useCallback)(async(e,t)=>{l({loading:!0,error:null});try{let r=await fetch(c("/api/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!r.ok){let e="Login failed";try{let t=await r.json();t&&"string"==typeof t.detail&&(e=t.detail)}catch(e){}return l({loading:!1,error:e}),!1}let a=null;try{a=await r.json()}catch(e){return l({loading:!1,error:"Malformed server response"}),!1}if(!a||"object"!=typeof a||!a.access_token||!a.refresh_token||"number"!=typeof a.expires_in||!a.user)return l({loading:!1,error:"Unexpected auth response"}),!1;let s=Number.isFinite(a.expires_in)?a.expires_in:0,n=Date.now()+Math.max(0,1e3*s-5e3),o={accessToken:a.access_token,refreshToken:a.refresh_token,expiresAt:n,user:a.user};return l({...o,loading:!1}),i(o),!0}catch(e){return l({loading:!1,error:"Network error"}),!1}},[]),u=(0,s.useCallback)(async e=>{l({loading:!0,error:null});try{let t=await fetch(c("/api/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,role_id:e.role_id||2})});if(!t.ok){let e=(await t.json().catch(()=>({}))).detail||"Registration failed";return l({loading:!1,error:e}),!1}return l({loading:!1}),!0}catch(e){return l({loading:!1,error:"Network error"}),!1}},[]),h=(0,s.useCallback)(()=>{l({user:null,accessToken:null,refreshToken:null,expiresAt:null}),i({})},[]);(0,s.useEffect)(()=>{if(globalThis._tsaFetchWrapped)return;let e=fetch;globalThis._tsaFetchWrapped=!0,globalThis.fetch=async(...t)=>{let r=await e(...t);if(401===r.status){let e="string"==typeof t[0]?t[0]:t[0].url;e.includes("/api/auth/login")||e.includes("/api/auth/register")||h()}return r}},[h]);let p=(0,s.useCallback)(async()=>{if(t.refreshToken&&!p._inFlight){p._inFlight=!0;try{let e=await fetch(c("/api/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:t.refreshToken})});if(!e.ok)return h();let r=await e.json(),a=1e3*r.expires_in,s=Date.now()+a-Math.min(5e3,Math.max(1e3,.08*a)),n={accessToken:r.access_token,expiresAt:s,user:r.user};l(n),i({...n,refreshToken:t.refreshToken})}catch(e){h()}finally{p._inFlight=!1}}},[t.refreshToken,h]);(0,s.useEffect)(()=>{if(!t.expiresAt)return;let e=t.expiresAt-Date.now();if(e<=0){p();return}let r=e-.12*e;r<1500&&(r=Math.min(Math.max(e-500,0),1500));let a=setTimeout(()=>p(),r);return()=>clearTimeout(a)},[t.expiresAt,p]);let m={...t,login:d,register:u,logout:h,refresh:p};return a.jsx(n.Provider,{value:m,children:e})};function c(){let e=(0,s.useContext)(n);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},9408:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});let a=(0,r(5347).createProxy)(String.raw`/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/change-password/page.tsx#default`)},9458:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c,metadata:()=>l});var a=r(2051),s=r(1312),n=r.n(s);r(7272);var o=r(5347);let i=(0,o.createProxy)(String.raw`/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/src/context/AuthContext.tsx#AuthProvider`);(0,o.createProxy)(String.raw`/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/src/context/AuthContext.tsx#useAuth`);let l={title:"Technical Services Assistant",description:"Intelligent document search and chat with RAG capabilities"};function c({children:e}){return a.jsx("html",{lang:"en",children:a.jsx("body",{className:n().className,children:a.jsx(i,{children:a.jsx("div",{className:"min-h-screen bg-background",children:e})})})})}},7272:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[9379,2704,3997],()=>r(5424));module.exports=a})();