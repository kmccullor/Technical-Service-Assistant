"use strict";(()=>{var e={};e.id=3,e.ids=[3],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8678:e=>{e.exports=import("pg")},3029:(e,t,o)=>{o.a(e,async(e,n)=>{try{o.r(t),o.d(t,{originalPathname:()=>f,patchFetch:()=>d,requestAsyncStorage:()=>u,routeModule:()=>l,serverHooks:()=>p,staticGenerationAsyncStorage:()=>m});var a=o(3278),r=o(5002),s=o(4877),i=o(1321),c=e([i]);i=(c.then?(await c)():c)[0];let l=new a.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/conversations/route",pathname:"/api/conversations",filename:"route",bundlePath:"app/api/conversations/route"},resolvedPagePath:"/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/api/conversations/route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:u,staticGenerationAsyncStorage:m,serverHooks:p}=l,f="/api/conversations/route";function d(){return(0,s.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:m})}n()}catch(e){n(e)}})},1321:(e,t,o)=>{o.a(e,async(e,n)=>{try{o.r(t),o.d(t,{GET:()=>d});var a=o(1309),r=o(8420),s=o(7382),i=o(5013),c=e([r]);async function d(){try{let e=await r.db.select().from(s.conversations).orderBy((0,i.C)(s.conversations.createdAt)).limit(20);return a.NextResponse.json(e)}catch(e){return console.error("Error fetching conversations:",e),a.NextResponse.json({error:"Failed to fetch conversations"},{status:500})}}r=(c.then?(await c)():c)[0],n()}catch(e){n(e)}})},8420:(e,t,o)=>{o.a(e,async(e,n)=>{try{o.d(t,{db:()=>m});var a=o(2163),r=o(8678),s=o(7382),i=e([r,a]);[r,a]=i.then?(await i)():i;let c="postgresql://postgres:postgres@pgvector:5432/vector_db";if(console.log("Database configuration:",{DATABASE_URL:c?"set":"not set",DATABASE_URL_value:c,NODE_ENV:"production"}),!c)throw Error("DATABASE_URL environment variable is required");let d=new URL(c),l={host:d.hostname,port:parseInt(d.port)||5432,database:d.pathname.slice(1),user:d.username,password:d.password,ssl:!1,max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:2e3};console.log("Raw URL parts:",{href:d.href,hostname:d.hostname,port:d.port,pathname:d.pathname,username:d.username}),console.log("Parsed connection config:",{host:l.host,port:l.port,database:l.database,user:l.user});let u=new r.Pool(l);u.on("error",e=>{console.error("PostgreSQL pool error:",e)});let m=(0,a.tS)(u,{schema:s});n()}catch(e){n(e)}})},7382:(e,t,o)=>{o.r(t),o.d(t,{conversations:()=>v,conversationsRelations:()=>y,documentChunks:()=>h,documentChunksRelations:()=>L,documents:()=>f,documentsRelations:()=>g,messages:()=>_,messagesRelations:()=>A});var n=o(6620),a=o(9894),r=o(9411),s=o(7681),i=o(4717),c=o(4006),d=o(5671),l=o(380),u=o(3204),m=o(4211),p=o(4497);let f=(0,n.af)("documents",{id:(0,a.c0)("id",{mode:"number"}).primaryKey(),fileName:(0,r.fL)("file_name").notNull(),originalPath:(0,r.fL)("original_path"),fileHash:(0,r.fL)("file_hash").notNull().unique(),fileSize:(0,s.Kv)("file_size",{mode:"number"}),mimeType:(0,r.fL)("mime_type"),title:(0,r.fL)("title"),version:(0,r.fL)("version"),docNumber:(0,r.fL)("doc_number"),gaDate:(0,i.hT)("ga_date"),publisher:(0,r.fL)("publisher"),copyrightYear:(0,c._L)("copyright_year"),productFamily:(0,r.fL)("product_family").array(),productName:(0,r.fL)("product_name"),productVersion:(0,r.fL)("product_version"),documentType:(0,r.fL)("document_type"),documentCategory:(0,r.fL)("document_category"),serviceLines:(0,r.fL)("service_lines").array(),audiences:(0,r.fL)("audiences").array(),privacyLevel:(0,r.fL)("privacy_level").default("public"),securityClassification:(0,r.fL)("security_classification"),classificationConfidence:(0,d.kw)("classification_confidence"),classificationMethod:(0,r.fL)("classification_method"),processingStatus:(0,r.fL)("processing_status").default("pending"),processedAt:(0,l.AB)("processed_at",{withTimezone:!0}),metadata:(0,u.JB)("metadata").default("{}"),createdAt:(0,l.AB)("created_at",{withTimezone:!0}).defaultNow(),updatedAt:(0,l.AB)("updated_at",{withTimezone:!0}).defaultNow()}),h=(0,n.af)("document_chunks",{id:(0,a.c0)("id",{mode:"number"}).primaryKey(),documentId:(0,s.Kv)("document_id",{mode:"number"}).references(()=>f.id,{onDelete:"cascade"}).notNull(),chunkIndex:(0,c._L)("chunk_index").notNull(),pageNumber:(0,c._L)("page_number"),sectionTitle:(0,r.fL)("section_title"),chunkType:(0,r.fL)("chunk_type").default("text"),content:(0,r.fL)("content").notNull(),contentHash:(0,r.fL)("content_hash").notNull(),contentLength:(0,c._L)("content_length"),embedding:(0,m.xr)("embedding",{dimensions:768}),language:(0,r.fL)("language").default("en"),tokens:(0,c._L)("tokens"),metadata:(0,u.JB)("metadata").default("{}"),contentTsvector:(0,r.fL)("content_tsvector"),createdAt:(0,l.AB)("created_at",{withTimezone:!0}).defaultNow()}),v=(0,n.af)("conversations",{id:(0,a.c0)("id",{mode:"number"}).primaryKey(),title:(0,r.fL)("title").notNull(),createdAt:(0,l.AB)("created_at",{withTimezone:!0}).defaultNow()}),_=(0,n.af)("messages",{id:(0,a.c0)("id",{mode:"number"}).primaryKey(),conversationId:(0,s.Kv)("conversation_id",{mode:"number"}).references(()=>v.id,{onDelete:"cascade"}).notNull(),role:(0,r.fL)("role",{enum:["user","assistant","system"]}).notNull(),content:(0,r.fL)("content").notNull(),citations:(0,u.JB)("citations"),createdAt:(0,l.AB)("created_at",{withTimezone:!0}).defaultNow()}),g=(0,p.lE)(f,({many:e})=>({chunks:e(h)})),L=(0,p.lE)(h,({one:e})=>({document:e(f,{fields:[h.documentId],references:[f.id]})})),y=(0,p.lE)(v,({many:e})=>({messages:e(_)})),A=(0,p.lE)(_,({one:e})=>({conversation:e(v,{fields:[_.conversationId],references:[v.id]})}))}};var t=require("../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),n=t.X(0,[379,833,163],()=>o(3029));module.exports=n})();