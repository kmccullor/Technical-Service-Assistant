"use strict";(()=>{var e={};e.id=4003,e.ids=[4003],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8678:e=>{e.exports=import("pg")},3029:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>c,requestAsyncStorage:()=>u,routeModule:()=>d,serverHooks:()=>h,staticGenerationAsyncStorage:()=>p});var a=r(9303),o=r(8716),i=r(670),s=r(4898),l=e([s]);s=(l.then?(await l)():l)[0];let d=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/conversations/route",pathname:"/api/conversations",filename:"route",bundlePath:"app/api/conversations/route"},resolvedPagePath:"/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/api/conversations/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:u,staticGenerationAsyncStorage:p,serverHooks:h}=d,f="/api/conversations/route";function c(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:p})}n()}catch(e){n(e)}})},4898:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{GET:()=>u});var a=r(7070),o=r(7395),i=r(306),s=r(7745),l=r(1445),c=r(2405),d=e([o]);async function u(e){try{let t=e.headers.get("authorization"),r=await (0,c.k)(t);if(!r)return a.NextResponse.json({error:"Unauthorized"},{status:401});let n=Number.parseInt(e.nextUrl.searchParams.get("limit")??"",10),d=Number.isFinite(n)?Math.min(Math.max(n,1),30):30,u=new Date(Date.now()-2592e6),p=await o.db.select({id:i.p5.id,title:i.p5.title,createdAt:i.p5.createdAt,updatedAt:i.p5.updatedAt,lastReviewedAt:i.p5.lastReviewedAt}).from(i.p5).where((0,s.xD)((0,s.eq)(i.p5.userId,r.id),(0,s.eg)(i.p5.createdAt,u))).orderBy((0,l.C)(i.p5.updatedAt),(0,l.C)(i.p5.createdAt)).limit(d);return a.NextResponse.json(p)}catch(e){return console.error("Error fetching conversations:",e),a.NextResponse.json({error:"Failed to fetch conversations"},{status:500})}}o=(d.then?(await d)():d)[0],n()}catch(e){n(e)}})},7395:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{db:()=>c});var a=r(8029),o=r(8678),i=e([o,a]);[o,a]=i.then?(await i)():i;let s=process.env.DATABASE_SSL?.toLowerCase()==="true"||process.env.DATABASE_SSL?.toLowerCase()==="require",l=globalThis.__tsaDbPool||new o.Pool({connectionString:"postgresql://postgres:postgres@localhost:5432/vector_db",ssl:s?{rejectUnauthorized:!1}:void 0}),c=(0,a.tS)(l);n()}catch(e){n(e)}})},306:(e,t,r)=>{r.d(t,{De:()=>u,p5:()=>c,sY:()=>d,yD:()=>p});var n=r(7561),a=r(5961),o=r(2140),i=r(2941),s=r(1575),l=r(8680);let c=(0,n.af)("conversations",{id:(0,a.eP)("id").primaryKey(),title:(0,o.fL)("title").notNull(),userId:(0,i._L)("user_id"),createdAt:(0,s.AB)("created_at",{withTimezone:!0}).defaultNow().notNull(),updatedAt:(0,s.AB)("updated_at",{withTimezone:!0}).defaultNow(),lastReviewedAt:(0,s.AB)("last_reviewed_at",{withTimezone:!0})}),d=(0,n.af)("messages",{id:(0,a.eP)("id").primaryKey(),conversationId:(0,i._L)("conversation_id").notNull().references(()=>c.id,{onDelete:"cascade"}),role:(0,o.fL)("role").notNull(),content:(0,o.fL)("content").notNull(),citations:(0,l.JB)("citations").$type(),createdAt:(0,s.AB)("created_at",{withTimezone:!0}).defaultNow().notNull()}),u=(0,n.af)("documents",{id:(0,a.eP)("id").primaryKey(),fileName:(0,o.fL)("file_name").notNull(),title:(0,o.fL)("title").notNull(),description:(0,o.fL)("description"),fileHash:(0,o.fL)("file_hash"),fileSize:(0,i._L)("file_size"),mimeType:(0,o.fL)("mime_type"),documentType:(0,o.fL)("document_type"),productName:(0,o.fL)("product_name"),productVersion:(0,o.fL)("product_version"),privacyLevel:(0,o.fL)("privacy_level"),processedAt:(0,s.AB)("processed_at",{withTimezone:!0}),createdAt:(0,s.AB)("created_at",{withTimezone:!0}).defaultNow().notNull(),updatedAt:(0,s.AB)("updated_at",{withTimezone:!0}).defaultNow().notNull()}),p=(0,n.af)("document_chunks",{id:(0,a.eP)("id").primaryKey(),documentId:(0,i._L)("document_id").notNull().references(()=>u.id,{onDelete:"cascade"}),chunkIndex:(0,i._L)("chunk_index"),pageNumber:(0,i._L)("page_number"),chunkType:(0,o.fL)("chunk_type"),content:(0,o.fL)("content").notNull(),contentHash:(0,o.fL)("content_hash"),contentLength:(0,i._L)("content_length").default(0).notNull(),metadata:(0,l.JB)("metadata").$type().default({}),embedding:(0,l.JB)("embedding").$type(),createdAt:(0,s.AB)("created_at",{withTimezone:!0}).defaultNow().notNull(),updatedAt:(0,s.AB)("updated_at",{withTimezone:!0}).defaultNow()})},553:(e,t,r)=>{r.d(t,{c:()=>n});function n(e){let t=function(){for(let e of[process.env.RERANKER_BASE_URL,process.env.RERANKER_INTERNAL_URL,process.env.RERANKER_URL,""]){let t=e?function(e){if(!e)return null;let t=e.trim();if(!t)return null;try{let e=new URL(t);if("3000"===e.port)return null;return t.replace(/\/$/,"")}catch{return null}}(e):null;if(t)return t}return"http://localhost:8008"}(),r=e.startsWith("/")?e:`/${e}`;return`${t}${r}`}},2405:(e,t,r)=>{r.d(t,{k:()=>a});var n=r(553);async function a(e){if(!e)return null;try{let t=await fetch((0,n.c)("/api/auth/me"),{method:"GET",headers:{Authorization:e},cache:"no-store"});if(!t.ok)return null;let r=await t.json();if(!r||"number"!=typeof r.id)return null;return r}catch(e){return console.error("Failed to fetch current user:",e),null}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8948,5972,8029],()=>r(3029));module.exports=n})();