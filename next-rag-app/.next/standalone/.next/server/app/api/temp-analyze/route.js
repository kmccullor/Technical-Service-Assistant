"use strict";(()=>{var e={};e.id=140,e.ids=[140],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},629:e=>{e.exports=require("fs/promises")},5315:e=>{e.exports=require("path")},604:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>x,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{GET:()=>u,POST:()=>l});var o=r(3278),n=r(5002),a=r(4877),i=r(1309),p=r(5315);async function l(e){try{let{sessionId:t,query:s,maxResults:o=5}=await e.json();if(!t||!s)return i.NextResponse.json({error:"Session ID and query are required"},{status:400});let n=(0,p.join)(process.cwd(),"temp-uploads",t),a=(0,p.join)(n,"metadata.json");try{let{readFile:e}=await Promise.resolve().then(r.t.bind(r,629,23)),l=JSON.parse(await e(a,"utf-8")),u=(0,p.join)(n,l.safeFileName),c=process.env.RERANKER_BASE_URL||"http://reranker:8008",d=await fetch(`${c}/api/temp-process`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:t,file_path:u,file_name:l.originalName})});if(!d.ok){let e=await d.text();return console.error("Processing failed:",e),i.NextResponse.json({error:"Failed to process document"},{status:500})}let m=await fetch(`${c}/api/temp-analyze`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:t,query:s,max_results:o})});if(!m.ok){let e=await m.text();return console.error("Analysis failed:",e),i.NextResponse.json({error:"Failed to analyze document"},{status:500})}let f=await m.json();return console.log(`Analysis complete for session ${t}: ${s}`),i.NextResponse.json(f)}catch(e){return console.error("File access error:",e),i.NextResponse.json({error:"Session not found or file no longer available"},{status:404})}}catch(e){return console.error("Analysis error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function u(e){try{let{searchParams:t}=new URL(e.url),r=t.get("sessionId");if(!r)return i.NextResponse.json({error:"Session ID required"},{status:400});let s=process.env.RERANKER_BASE_URL||"http://reranker:8008",o=await fetch(`${s}/api/temp-session/${r}`);if(!o.ok)return i.NextResponse.json({error:"Session not found"},{status:404});let n=await o.json();return i.NextResponse.json(n)}catch(e){return console.error("Session info error:",e),i.NextResponse.json({error:"Failed to get session info"},{status:500})}}let c=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/temp-analyze/route",pathname:"/api/temp-analyze",filename:"route",bundlePath:"app/api/temp-analyze/route"},resolvedPagePath:"/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/api/temp-analyze/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:f}=c,h="/api/temp-analyze/route";function x(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:m})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[379,833],()=>r(604));module.exports=s})();