"use strict";(()=>{var e={};e.id=9810,e.ids=[9810],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2048:e=>{e.exports=require("fs")},629:e=>{e.exports=require("fs/promises")},5315:e=>{e.exports=require("path")},3933:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>S,requestAsyncStorage:()=>h,routeModule:()=>f,serverHooks:()=>w,staticGenerationAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{GET:()=>m,POST:()=>d});var o=r(3278),n=r(5002),a=r(4877),i=r(1309),l=r(5315),p=r(629),c=r(2048);async function u(e){let t=0;try{for(let r of(await (0,p.readdir)(e,{withFileTypes:!0}))){let s=(0,l.join)(e,r.name);if(r.isDirectory())t+=await u(s);else{let e=await (0,p.stat)(s);t+=e.size}}}catch(e){}return t}async function d(e){try{let e=(0,l.join)(process.cwd(),"temp-uploads"),t={sessionsDeleted:0,filesDeleted:0,totalSizeFreed:0};if(!(0,c.existsSync)(e))return i.NextResponse.json(t);try{for(let r of(await (0,p.readdir)(e))){let s=(0,l.join)(e,r);try{let e=await (0,p.stat)(s);if(Date.now()-e.mtime.getTime()>72e5){let e=await u(s),o=await (0,p.readdir)(s);await (0,p.rmdir)(s,{recursive:!0}),t.sessionsDeleted++,t.filesDeleted+=o.length,t.totalSizeFreed+=e,console.log(`Cleaned up expired session: ${r} (${o.length} files, ${e} bytes)`)}}catch(e){console.error(`Error processing session ${r}:`,e)}}try{let e=process.env.RERANKER_BASE_URL||"http://reranker:8008";await fetch(`${e}/api/temp-cleanup`,{method:"POST",headers:{"Content-Type":"application/json"}})}catch(e){console.warn("Could not notify reranker for cleanup:",e)}return console.log(`Cleanup completed: ${t.sessionsDeleted} sessions, ${t.filesDeleted} files, ${(t.totalSizeFreed/1024/1024).toFixed(2)}MB freed`),i.NextResponse.json(t)}catch(e){return console.error("Directory cleanup error:",e),i.NextResponse.json(t)}}catch(e){return console.error("Cleanup error:",e),i.NextResponse.json({sessionsDeleted:0,filesDeleted:0,totalSizeFreed:0},{status:500})}}async function m(){try{let e=(0,l.join)(process.cwd(),"temp-uploads");if(!(0,c.existsSync)(e))return i.NextResponse.json({sessions:0,totalSize:0,oldestSession:null});let t=await (0,p.readdir)(e),r=0,s=Date.now();for(let o of t){let t=(0,l.join)(e,o);try{let e=await u(t),o=await (0,p.stat)(t);r+=e,o.mtime.getTime()<s&&(s=o.mtime.getTime())}catch(e){}}return i.NextResponse.json({sessions:t.length,totalSize:r,totalSizeMB:(r/1024/1024).toFixed(2),oldestSession:t.length>0?new Date(s).toISOString():null})}catch(e){return console.error("Status check error:",e),i.NextResponse.json({error:"Status check failed"},{status:500})}}let f=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/temp-cleanup/route",pathname:"/api/temp-cleanup",filename:"route",bundlePath:"app/api/temp-cleanup/route"},resolvedPagePath:"/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/api/temp-cleanup/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:x,serverHooks:w}=f,y="/api/temp-cleanup/route";function S(){return(0,a.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:x})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9379,4833],()=>r(3933));module.exports=s})();