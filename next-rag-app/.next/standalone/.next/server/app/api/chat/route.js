"use strict";(()=>{var e={};e.id=744,e.ids=[744],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8678:e=>{e.exports=import("pg")},539:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>u,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p});var n=r(3278),s=r(5002),i=r(4877),o=r(1725),l=e([o]);o=(l.then?(await l)():l)[0];let c=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:"app/api/chat/route"},resolvedPagePath:"/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/api/chat/route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:m}=c,h="/api/chat/route";function u(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:p})}a()}catch(e){a(e)}})},1725:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{POST:()=>l});var n=r(3823),s=r(8420),i=r(7382),o=e([n,s]);async function l(e){try{let t=await e.json();console.log("Chat API received body:",JSON.stringify(t,null,2));let{conversationId:r,messages:a,useWebFallback:o=!0,temperature:l=.7,maxTokens:u=1024}=t;if(!a||0===a.length)return console.log("Error: Messages are required"),new Response("Messages are required",{status:400});let c=a[a.length-1];if("user"!==c.role)return console.log("Error: Last message must be from user, got:",c.role),new Response("Last message must be from user",{status:400});console.log("Processing user message:",c.content);let d="true"===process.env.USE_LOCAL_MODELS,p=process.env.OPENAI_API_KEY;if(console.log("Model configuration:",{useLocalModels:d,hasOpenaiKey:!!p}),!d&&(!p||"sk-your-openai-api-key-here"===p)){console.log("Neither local models nor OpenAI API key configured, returning test response");let e=new TextEncoder,t=new ReadableStream({start(t){t.enqueue(e.encode(`data: ${JSON.stringify({type:"content",content:"Hello! I'm your RAG assistant. To enable full functionality, please configure your OpenAI API key in the .env.local file or set USE_LOCAL_MODELS=true. "})}

`)),t.enqueue(e.encode(`data: ${JSON.stringify({type:"content",content:"I can see you have documents loaded in the database, but I need either local models or an OpenAI API key to search and answer questions about them."})}

`)),t.enqueue(e.encode(`data: ${JSON.stringify({type:"citations",citations:[],searchType:"fallback"})}

`)),t.close()}});return new Response(t,{headers:{"Content-Type":"text/plain; charset=utf-8","Cache-Control":"no-cache",Connection:"keep-alive"}})}let m=await (0,n.$Q)(c.content,{useWebFallback:o,temperature:l,maxTokens:u,confidenceThreshold:.3}),h=r||0;if(!r){let[e]=await s.db.insert(i.conversations).values({title:c.content.slice(0,50)+(c.content.length>50?"...":"")}).returning();h=e.id}await s.db.insert(i.messages).values({conversationId:h,role:"user",content:c.content});let f=new TextEncoder,g="",y=new ReadableStream({async start(e){try{for await(let t of(e.enqueue(f.encode(`data: ${JSON.stringify({type:"conversation_id",conversationId:h})}

`)),e.enqueue(f.encode(`data: ${JSON.stringify({type:"sources",sources:m.sources,confidence:m.confidence,method:m.method})}

`)),m.textStream))g+=t,e.enqueue(f.encode(`data: ${JSON.stringify({type:"token",token:t})}

`));await s.db.insert(i.messages).values({conversationId:h,role:"assistant",content:g,citations:m.sources.map(e=>({title:e.document.title,source:e.document.source,content:e.content?.slice(0,200)+"..."}))}),e.enqueue(f.encode(`data: ${JSON.stringify({type:"done",messageId:"temp-id"})}

`)),e.close()}catch(t){console.error("Streaming error:",t),e.enqueue(f.encode(`data: ${JSON.stringify({type:"error",error:"An error occurred while processing your request"})}

`)),e.close()}}});return new Response(y,{headers:{"Content-Type":"text/plain; charset=utf-8","Cache-Control":"no-cache",Connection:"keep-alive"}})}catch(e){return console.error("Chat API error:",e),new Response("Internal server error",{status:500})}}[n,s]=o.then?(await o)():o,a()}catch(e){a(e)}})},8420:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{db:()=>p});var n=r(2163),s=r(8678),i=r(7382),o=e([s,n]);[s,n]=o.then?(await o)():o;let l="postgresql://postgres:postgres@pgvector:5432/vector_db";if(console.log("Database configuration:",{DATABASE_URL:l?"set":"not set",DATABASE_URL_value:l,NODE_ENV:"production"}),!l)throw Error("DATABASE_URL environment variable is required");let u=new URL(l),c={host:u.hostname,port:parseInt(u.port)||5432,database:u.pathname.slice(1),user:u.username,password:u.password,ssl:!1,max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:2e3};console.log("Raw URL parts:",{href:u.href,hostname:u.hostname,port:u.port,pathname:u.pathname,username:u.username}),console.log("Parsed connection config:",{host:c.host,port:c.port,database:c.database,user:c.user});let d=new s.Pool(c);d.on("error",e=>{console.error("PostgreSQL pool error:",e)});let p=(0,n.tS)(d,{schema:i});a()}catch(e){a(e)}})},7382:(e,t,r)=>{r.r(t),r.d(t,{conversations:()=>g,conversationsRelations:()=>b,documentChunks:()=>f,documentChunksRelations:()=>_,documents:()=>h,documentsRelations:()=>v,messages:()=>y,messagesRelations:()=>x});var a=r(6620),n=r(9894),s=r(9411),i=r(7681),o=r(4717),l=r(4006),u=r(5671),c=r(380),d=r(3204),p=r(4211),m=r(4497);let h=(0,a.af)("documents",{id:(0,n.c0)("id",{mode:"number"}).primaryKey(),fileName:(0,s.fL)("file_name").notNull(),originalPath:(0,s.fL)("original_path"),fileHash:(0,s.fL)("file_hash").notNull().unique(),fileSize:(0,i.Kv)("file_size",{mode:"number"}),mimeType:(0,s.fL)("mime_type"),title:(0,s.fL)("title"),version:(0,s.fL)("version"),docNumber:(0,s.fL)("doc_number"),gaDate:(0,o.hT)("ga_date"),publisher:(0,s.fL)("publisher"),copyrightYear:(0,l._L)("copyright_year"),productFamily:(0,s.fL)("product_family").array(),productName:(0,s.fL)("product_name"),productVersion:(0,s.fL)("product_version"),documentType:(0,s.fL)("document_type"),documentCategory:(0,s.fL)("document_category"),serviceLines:(0,s.fL)("service_lines").array(),audiences:(0,s.fL)("audiences").array(),privacyLevel:(0,s.fL)("privacy_level").default("public"),securityClassification:(0,s.fL)("security_classification"),classificationConfidence:(0,u.kw)("classification_confidence"),classificationMethod:(0,s.fL)("classification_method"),processingStatus:(0,s.fL)("processing_status").default("pending"),processedAt:(0,c.AB)("processed_at",{withTimezone:!0}),metadata:(0,d.JB)("metadata").default("{}"),createdAt:(0,c.AB)("created_at",{withTimezone:!0}).defaultNow(),updatedAt:(0,c.AB)("updated_at",{withTimezone:!0}).defaultNow()}),f=(0,a.af)("document_chunks",{id:(0,n.c0)("id",{mode:"number"}).primaryKey(),documentId:(0,i.Kv)("document_id",{mode:"number"}).references(()=>h.id,{onDelete:"cascade"}).notNull(),chunkIndex:(0,l._L)("chunk_index").notNull(),pageNumber:(0,l._L)("page_number"),sectionTitle:(0,s.fL)("section_title"),chunkType:(0,s.fL)("chunk_type").default("text"),content:(0,s.fL)("content").notNull(),contentHash:(0,s.fL)("content_hash").notNull(),contentLength:(0,l._L)("content_length"),embedding:(0,p.xr)("embedding",{dimensions:768}),language:(0,s.fL)("language").default("en"),tokens:(0,l._L)("tokens"),metadata:(0,d.JB)("metadata").default("{}"),contentTsvector:(0,s.fL)("content_tsvector"),createdAt:(0,c.AB)("created_at",{withTimezone:!0}).defaultNow()}),g=(0,a.af)("conversations",{id:(0,n.c0)("id",{mode:"number"}).primaryKey(),title:(0,s.fL)("title").notNull(),createdAt:(0,c.AB)("created_at",{withTimezone:!0}).defaultNow()}),y=(0,a.af)("messages",{id:(0,n.c0)("id",{mode:"number"}).primaryKey(),conversationId:(0,i.Kv)("conversation_id",{mode:"number"}).references(()=>g.id,{onDelete:"cascade"}).notNull(),role:(0,s.fL)("role",{enum:["user","assistant","system"]}).notNull(),content:(0,s.fL)("content").notNull(),citations:(0,d.JB)("citations"),createdAt:(0,c.AB)("created_at",{withTimezone:!0}).defaultNow()}),v=(0,m.lE)(h,({many:e})=>({chunks:e(f)})),_=(0,m.lE)(f,({one:e})=>({document:e(h,{fields:[f.documentId],references:[h.id]})})),b=(0,m.lE)(g,({many:e})=>({messages:e(y)})),x=(0,m.lE)(y,({one:e})=>({conversation:e(g,{fields:[y.conversationId],references:[g.id]})}))},2812:(e,t,r)=>{r.d(t,{C6:()=>o});var a=r(4329),n=r(4974),s=r(9567);let i={model:process.env.EMBEDDING_MODEL||"text-embedding-3-large",batchSize:100};async function o(e,t={}){let r={...i,...t};if("true"===process.env.USE_LOCAL_MODELS)return console.log("Using local Ollama for embeddings:",r.model),await s.R.generateEmbedding(e,r.model);let{embedding:o}=await (0,n.$Z)({model:a.fr.embedding(r.model),value:e});return o}},3823:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{$Q:()=>u});var n=r(8086),s=r(4329),i=r(4974),o=r(9567);r(6657);var l=e([n]);n=(l.then?(await l)():l)[0];let c={maxContextLength:2e3,confidenceThreshold:parseFloat(process.env.CONFIDENCE_THRESHOLD||"0.3"),temperature:parseFloat(process.env.TEMPERATURE||"0.3"),maxTokens:parseInt(process.env.MAX_TOKENS||"1024"),model:process.env.CHAT_MODEL||"llama3.2:1b",useWebFallback:!1},d=`You are a Technical Service Assistant, designed to answer questions about Sensus AMI Technology and Equipment and assist with troubleshooting issues.

You can write Microsoft SQL Server queries for the Sensus FlexNet database, referring to the data dictionary for the specific RNI version in question.

You can write PostgreSQL queries for the Sensus PostgreSQL AMDS, Router, FWDL databases, referring to a database dictionary for the specific database and RNI version in question.

Focus on:
- Sensus AMI (Advanced Metering Infrastructure) technology
- Equipment troubleshooting and technical support
- Database queries for FlexNet, AMDS, Router, and FWDL systems
- RNI (Radio Network Interface) version-specific guidance
- Technical documentation and procedures

Provide accurate, technical responses based on the available documentation and context.`;async function u(e,t={}){var r,a;let l={...c,...t},u=await (0,n.cD)(e,{limit:5,threshold:.1}),p=u.confidence>=l.confidenceThreshold,m="";p&&u.results.length>0&&(m=function(e,t){let r="",a=0;for(let n of e){let e=`[Source: ${n.document.title}]
Page ${n.pageNumber||"N/A"} | Score: ${n.score?.toFixed(3)||"N/A"}
${n.content}

---

`,s=e.length/4;if(a+s>t)break;r+=e,a+=s}return r.trim()}(u.results,l.maxContextLength));let h=(r=p,a=u.results.length,r?`${d}

You have access to ${a||"multiple"} Sensus technical documents in your knowledge base.

Use the provided context from documents to answer the user's question accurately and comprehensively.

Guidelines:
- Base your answer primarily on the provided context from the technical documents
- Provide detailed, step-by-step instructions when appropriate
- Cite sources using [Document Title] format when referencing specific information
- Include relevant technical details, version numbers, system requirements, and configuration steps
- If the context contains multiple related documents, synthesize information from all relevant sources
- If the context doesn't contain enough information to fully answer the question, clearly state what information is missing
- For installation or configuration questions, provide complete procedures with prerequisites
- Include warnings, notes, or important considerations mentioned in the documentation
- Focus on Sensus AMI technology, RNI systems, and database operations
- Be thorough and technical - users expect detailed technical guidance`:`${d}

You have access to ${a||53} Sensus technical documents in your knowledge base.

The user has asked a question, but no highly relevant context was found in the current search. However, you should still acknowledge your knowledge base capabilities.

Guidelines:
- Acknowledge that you have access to technical documentation about Sensus AMI and RNI systems
- Explain that while no specific documents matched this query, you have comprehensive documentation available
- Suggest rephrasing the question or asking about specific topics like installation, configuration, troubleshooting, database queries, etc.
- Mention the types of documents available (installation guides, user manuals, configuration guides, database schemas, etc.)
- Encourage the user to ask more specific technical questions about Sensus AMI technology or RNI systems`),f=p?`Context:
${m}

Question: ${e}`:e;return"true"!==process.env.USE_LOCAL_MODELS?{textStream:(await (0,i.kP)({model:(0,s.fr)(l.model),system:h,prompt:f,temperature:l.temperature,maxTokens:l.maxTokens})).textStream,sources:u.results,confidence:u.confidence,method:p?"rag":"fallback"}:(console.log("Using local Ollama for streaming generation:",l.model),{textStream:o.R.generateStreamingChatResponse([{role:"system",content:h},{role:"user",content:f}],l.model,{temperature:l.temperature,max_tokens:l.maxTokens}),sources:u.results,confidence:u.confidence,method:p?"rag":"fallback"})}a()}catch(e){a(e)}})},8086:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{cD:()=>p});var n=r(8420),s=r(7382),i=r(2812),o=r(4214),l=r(9785),u=e([n]);n=(u.then?(await u)():u)[0];let m={vectorWeight:.7,lexicalWeight:.3,limit:10,threshold:.1};async function c(e,t={}){let{limit:r=10,threshold:a=.1}=t;console.log(`🔍 Vector search for: "${e}" (limit: ${r}, threshold: ${a})`);let u=await (0,i.C6)(e);console.log(`📊 Generated embedding of length: ${u.length}`);let c=await n.db.select({chunk:s.documentChunks,document:{title:s.documents.fileName,source:s.documents.fileName},score:(0,o.i6)`1 - (${s.documentChunks.embedding} <=> ${JSON.stringify(u)}::vector)`}).from(s.documentChunks).innerJoin(s.documents,(0,l.eq)(s.documentChunks.documentId,s.documents.id)).where((0,o.i6)`${s.documentChunks.embedding} IS NOT NULL`).orderBy((0,o.i6)`${s.documentChunks.embedding} <=> ${JSON.stringify(u)}::vector`).limit(r);console.log(`📝 Vector search found ${c.length} results`);let d=c.filter(e=>e.score>=a).map(e=>({...e.chunk,document:e.document,score:e.score}));return console.log(`✅ After threshold filter (>=${a}): ${d.length} results`),d.length>0&&console.log(`🏆 Top result score: ${d[0].score.toFixed(3)}`),d}async function d(e,t={}){let r={...m,...t};return console.log("\uD83D\uDD0D Using pure vector search for better confidence scores"),await c(e,{limit:r.limit,threshold:r.threshold})}async function p(e,t={}){console.log(`🔍 Starting search with confidence for: "${e}"`);let r=await d(e,t);if(console.log(`📊 Hybrid search returned ${r.length} results`),0===r.length)return console.log(`❌ No results found`),{results:[],confidence:0,metadata:{vectorCount:0,lexicalCount:0,avgScore:0,maxScore:0}};let a=r.map(e=>e.score),n=a.reduce((e,t)=>e+t,0)/a.length,s=Math.max(...a),i=0;return i=s>=.7?Math.min(.95,.6+.4*s+.05*r.length):s>=.5?Math.min(.8,.3+.6*s+.05*r.length):s>=.3?Math.min(.6,1.5*s+.03*r.length):s>=.1?Math.min(.4,2*s+.02*r.length):Math.min(.2,3*s),console.log(`📈 Search confidence: ${i.toFixed(3)} (avgScore: ${n.toFixed(3)}, maxScore: ${s.toFixed(3)})`),{results:r,confidence:i,metadata:{vectorCount:r.length,lexicalCount:r.length,avgScore:n,maxScore:s}}}a()}catch(e){a(e)}})},6657:(e,t,r)=>{var a=r(9567);class n{constructor(){this.cache=new Map,this.SIMILARITY_THRESHOLD=.85,this.CACHE_TTL=36e5,this.MAX_CACHE_SIZE=1e3,this.CLEANUP_INTERVAL=3e5,setInterval(()=>this.cleanupCache(),this.CLEANUP_INTERVAL),console.log("\uD83E\uDDE0 Semantic Cache Service initialized")}cosineSimilarity(e,t){if(e.length!==t.length)return 0;let r=0,a=0,n=0;for(let s=0;s<e.length;s++)r+=e[s]*t[s],a+=e[s]*e[s],n+=t[s]*t[s];return 0===a||0===n?0:r/(Math.sqrt(a)*Math.sqrt(n))}generateCacheKey(e){return Buffer.from(e.toLowerCase().trim()).toString("base64").slice(0,32)}async findSimilarQueries(e,t){let r=Date.now(),n=t;if(!n)try{n=await a.R.generateEmbedding(e)}catch(e){return console.error("Failed to generate embedding for semantic cache:",e),[]}let s=[];for(let[e,t]of this.cache.entries()){let e=this.cosineSimilarity(n,t.embedding);e>=this.SIMILARITY_THRESHOLD&&s.push({entry:t,similarity:e})}s.sort((e,t)=>t.similarity-e.similarity);let i=Date.now()-r;return console.log(`🔍 Semantic search completed in ${i}ms, found ${s.length} similar queries`),s}async getCachedResponse(e){try{let t=this.generateCacheKey(e),r=this.cache.get(t);if(r&&this.isEntryValid(r))return r.hitCount++,console.log("\uD83C\uDFAF Exact cache hit for query"),{response:r.response,sources:r.sources,confidence:r.confidence,cacheHit:!0,similarity:1,originalQuery:r.query};let a=await this.findSimilarQueries(e);if(a.length>0){let e=a[0];if(this.isEntryValid(e.entry))return e.entry.hitCount++,console.log(`🧠 Semantic cache hit: ${e.similarity.toFixed(3)} similarity with "${e.entry.query}"`),{response:e.entry.response,sources:e.entry.sources,confidence:e.entry.confidence,cacheHit:!0,similarity:e.similarity,originalQuery:e.entry.query}}return null}catch(e){return console.error("Semantic cache lookup failed:",e),null}}async cacheResponse(e,t,r,n,s){try{let i=s;i||(i=await a.R.generateEmbedding(e));let o=this.generateCacheKey(e),l={query:e.trim(),embedding:i,response:t,sources:r,confidence:n,timestamp:Date.now(),hitCount:0};this.cache.size>=this.MAX_CACHE_SIZE&&this.evictLeastUsed(),this.cache.set(o,l),console.log(`💾 Cached response for query: "${e.slice(0,50)}..."`)}catch(e){console.error("Failed to cache response:",e)}}isEntryValid(e){return Date.now()-e.timestamp<this.CACHE_TTL}evictLeastUsed(){let e=null,t=1/0;for(let[r,a]of this.cache.entries()){let n=(Date.now()-a.timestamp)/Math.max(1,a.hitCount);n<t&&(t=n,e=[r,a])}e&&(this.cache.delete(e[0]),console.log(`🗑️ Evicted cache entry: "${e[1].query.slice(0,30)}..."`))}cleanupCache(){let e=this.cache.size;for(let[e,t]of(Date.now(),this.cache.entries()))this.isEntryValid(t)||this.cache.delete(e);let t=this.cache.size,r=e-t;r>0&&console.log(`🧹 Cleaned up ${r} expired cache entries (${t} remaining)`)}getCacheStats(){let e=Array.from(this.cache.values()),t=e.reduce((e,t)=>e+t.hitCount,0),r=e.filter(e=>e.hitCount>0),a=r.length>0?r.reduce((e,t)=>e+t.hitCount,0)/r.length:0,n=e.filter(e=>e.hitCount>0).sort((e,t)=>t.hitCount-e.hitCount).slice(0,5).map(e=>({query:e.query.slice(0,50)+"...",hits:e.hitCount}));return{size:this.cache.size,maxSize:this.MAX_CACHE_SIZE,hitRate:t/Math.max(1,e.length),avgSimilarity:a,topQueries:n}}clearCache(){this.cache.clear(),console.log("\uD83D\uDDD1️ Semantic cache cleared")}async preWarmCache(e){for(let t of(console.log(`🔥 Pre-warming semantic cache with ${e.length} common queries...`),e))await this.cacheResponse(t.query,t.response,t.sources,t.confidence);console.log("✅ Cache pre-warming completed")}}new n},3278:(e,t,r)=>{e.exports=r(517)},9145:e=>{let t="undefined"!=typeof Buffer,r=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,a=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function n(e,n,i){null==i&&null!==n&&"object"==typeof n&&(i=n,n=void 0),t&&Buffer.isBuffer(e)&&(e=e.toString()),e&&65279===e.charCodeAt(0)&&(e=e.slice(1));let o=JSON.parse(e,n);if(null===o||"object"!=typeof o)return o;let l=i&&i.protoAction||"error",u=i&&i.constructorAction||"error";if("ignore"===l&&"ignore"===u)return o;if("ignore"!==l&&"ignore"!==u){if(!1===r.test(e)&&!1===a.test(e))return o}else if("ignore"!==l&&"ignore"===u){if(!1===r.test(e))return o}else if(!1===a.test(e))return o;return s(o,{protoAction:l,constructorAction:u,safe:i&&i.safe})}function s(e,{protoAction:t="error",constructorAction:r="error",safe:a}={}){let n=[e];for(;n.length;){let e=n;for(let s of(n=[],e)){if("ignore"!==t&&Object.prototype.hasOwnProperty.call(s,"__proto__")){if(!0===a)return null;if("error"===t)throw SyntaxError("Object contains forbidden prototype property");delete s.__proto__}if("ignore"!==r&&Object.prototype.hasOwnProperty.call(s,"constructor")&&Object.prototype.hasOwnProperty.call(s.constructor,"prototype")){if(!0===a)return null;if("error"===r)throw SyntaxError("Object contains forbidden prototype property");delete s.constructor}for(let e in s){let t=s[e];t&&"object"==typeof t&&n.push(t)}}}return e}function i(e,t,r){let a=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return n(e,t,r)}finally{Error.stackTraceLimit=a}}e.exports=i,e.exports.default=i,e.exports.parse=i,e.exports.safeParse=function(e,t){let r=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return n(e,t,{safe:!0})}catch(e){return null}finally{Error.stackTraceLimit=r}},e.exports.scan=s},4329:(e,t,r)=>{r.d(t,{fr:()=>eM});var a,n,s,i,o,l,u,c,d,p,m="vercel.ai.error",h=Symbol.for(m),f=class e extends Error{constructor({name:e,message:t,cause:r}){super(t),this[a]=!0,this.name=e,this.cause=r}static isInstance(t){return e.hasMarker(t,m)}static hasMarker(e,t){let r=Symbol.for(t);return null!=e&&"object"==typeof e&&r in e&&"boolean"==typeof e[r]&&!0===e[r]}toJSON(){return{name:this.name,message:this.message}}};a=h;var g=f,y="AI_APICallError",v=`vercel.ai.error.${y}`,_=Symbol.for(v),b=class extends g{constructor({message:e,url:t,requestBodyValues:r,statusCode:a,responseHeaders:s,responseBody:i,cause:o,isRetryable:l=null!=a&&(408===a||409===a||429===a||a>=500),data:u}){super({name:y,message:e,cause:o}),this[n]=!0,this.url=t,this.requestBodyValues=r,this.statusCode=a,this.responseHeaders=s,this.responseBody=i,this.isRetryable=l,this.data=u}static isInstance(e){return g.hasMarker(e,v)}static isAPICallError(e){return e instanceof Error&&e.name===y&&"string"==typeof e.url&&"object"==typeof e.requestBodyValues&&(null==e.statusCode||"number"==typeof e.statusCode)&&(null==e.responseHeaders||"object"==typeof e.responseHeaders)&&(null==e.responseBody||"string"==typeof e.responseBody)&&(null==e.cause||"object"==typeof e.cause)&&"boolean"==typeof e.isRetryable&&(null==e.data||"object"==typeof e.data)}toJSON(){return{name:this.name,message:this.message,url:this.url,requestBodyValues:this.requestBodyValues,statusCode:this.statusCode,responseHeaders:this.responseHeaders,responseBody:this.responseBody,cause:this.cause,isRetryable:this.isRetryable,data:this.data}}};n=_;var x="AI_EmptyResponseBodyError",w=`vercel.ai.error.${x}`,k=Symbol.for(w),T=class extends g{constructor({message:e="Empty response body"}={}){super({name:x,message:e}),this[s]=!0}static isInstance(e){return g.hasMarker(e,w)}static isEmptyResponseBodyError(e){return e instanceof Error&&e.name===x}};function S(e){return null==e?"unknown error":"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}s=k;var I="AI_InvalidPromptError",A=`vercel.ai.error.${I}`,E=Symbol.for(A),C=class extends g{constructor({prompt:e,message:t,cause:r}){super({name:I,message:`Invalid prompt: ${t}`,cause:r}),this[i]=!0,this.prompt=e}static isInstance(e){return g.hasMarker(e,A)}static isInvalidPromptError(e){return e instanceof Error&&e.name===I&&null!=prompt}toJSON(){return{name:this.name,message:this.message,stack:this.stack,prompt:this.prompt}}};i=E;var N="AI_InvalidResponseDataError",R=`vercel.ai.error.${N}`,O=Symbol.for(R),$=class extends g{constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:N,message:t}),this[o]=!0,this.data=e}static isInstance(e){return g.hasMarker(e,R)}static isInvalidResponseDataError(e){return e instanceof Error&&e.name===N&&null!=e.data}toJSON(){return{name:this.name,message:this.message,stack:this.stack,data:this.data}}};o=O;var P="AI_JSONParseError",Z=`vercel.ai.error.${P}`,j=Symbol.for(Z),M=class extends g{constructor({text:e,cause:t}){super({name:P,message:`JSON parsing failed: Text: ${e}.
Error message: ${S(t)}`,cause:t}),this[l]=!0,this.text=e}static isInstance(e){return g.hasMarker(e,Z)}static isJSONParseError(e){return e instanceof Error&&e.name===P&&"text"in e&&"string"==typeof e.text}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,valueText:this.text}}};l=j;var L="AI_LoadAPIKeyError",q=`vercel.ai.error.${L}`,D=Symbol.for(q),F=class extends g{constructor({message:e}){super({name:L,message:e}),this[u]=!0}static isInstance(e){return g.hasMarker(e,q)}static isLoadAPIKeyError(e){return e instanceof Error&&e.name===L}};u=D,Symbol.for("vercel.ai.error.AI_LoadSettingError"),Symbol.for("vercel.ai.error.AI_NoContentGeneratedError"),Symbol.for("vercel.ai.error.AI_NoSuchModelError");var U="AI_TooManyEmbeddingValuesForCallError",z=`vercel.ai.error.${U}`,B=Symbol.for(z),J=class extends g{constructor(e){super({name:U,message:`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`}),this[c]=!0,this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values}static isInstance(e){return g.hasMarker(e,z)}static isTooManyEmbeddingValuesForCallError(e){return e instanceof Error&&e.name===U&&"provider"in e&&"string"==typeof e.provider&&"modelId"in e&&"string"==typeof e.modelId&&"maxEmbeddingsPerCall"in e&&"number"==typeof e.maxEmbeddingsPerCall&&"values"in e&&Array.isArray(e.values)}toJSON(){return{name:this.name,message:this.message,stack:this.stack,provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:this.values}}};c=B;var V="AI_TypeValidationError",K=`vercel.ai.error.${V}`,H=Symbol.for(K),W=class e extends g{constructor({value:e,cause:t}){super({name:V,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${S(t)}`,cause:t}),this[d]=!0,this.value=e}static isInstance(e){return g.hasMarker(e,K)}static wrap({value:t,cause:r}){return e.isInstance(r)&&r.value===t?r:new e({value:t,cause:r})}static isTypeValidationError(e){return e instanceof Error&&e.name===V}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,value:this.value}}};d=H;var G="AI_UnsupportedFunctionalityError",X=`vercel.ai.error.${G}`,Y=Symbol.for(X),Q=class extends g{constructor({functionality:e}){super({name:G,message:`'${e}' functionality not supported.`}),this[p]=!0,this.functionality=e}static isInstance(e){return g.hasMarker(e,X)}static isUnsupportedFunctionalityError(e){return e instanceof Error&&e.name===G&&"string"==typeof e.functionality}toJSON(){return{name:this.name,message:this.message,stack:this.stack,functionality:this.functionality}}};function ee(e){return null===e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e||(Array.isArray(e)?e.every(ee):"object"==typeof e&&Object.entries(e).every(([e,t])=>"string"==typeof e&&ee(t)))}p=Y;let et=(e,t=21)=>(r=t)=>{let a="",n=r;for(;n--;)a+=e[Math.random()*e.length|0];return a};var er=r(9145);let ea=[239,187,191];class en extends TransformStream{constructor(){let e;super({start(t){e=function(e){let t,r,a,n,s,i,o;return l(),{feed:function(l){var u;r=r?r+l:l,t&&(u=r,ea.every((e,t)=>u.charCodeAt(t)===e))&&(r=r.slice(ea.length)),t=!1;let c=r.length,d=0,p=!1;for(;d<c;){let t;p&&("\n"===r[d]&&++d,p=!1);let l=-1,u=n;for(let e=a;l<0&&e<c;++e)":"===(t=r[e])&&u<0?u=e-d:"\r"===t?(p=!0,l=e-d):"\n"===t&&(l=e-d);if(l<0){a=c-d,n=u;break}a=0,n=-1,function(t,r,a,n){if(0===n){o.length>0&&(e({type:"event",id:s,event:i||void 0,data:o.slice(0,-1)}),o="",s=void 0),i=void 0;return}let l=a<0,u=t.slice(r,r+(l?n:a)),c=0;c=l?n:" "===t[r+a+1]?a+2:a+1;let d=r+c,p=n-c,m=t.slice(d,d+p).toString();if("data"===u)o+=m?"".concat(m,"\n"):"\n";else if("event"===u)i=m;else if("id"!==u||m.includes("\0")){if("retry"===u){let t=parseInt(m,10);Number.isNaN(t)||e({type:"reconnect-interval",value:t})}}else s=m}(r,d,u,l),d+=l+1}d===c?r="":d>0&&(r=r.slice(d))},reset:l};function l(){t=!0,r="",a=0,n=-1,s=void 0,i=void 0,o=""}}(e=>{"event"===e.type&&t.enqueue(e)})},transform(t){e.feed(t)}})}}function es(...e){return e.reduce((e,t)=>({...e,...null!=t?t:{}}),{})}function ei(e){let t={};return e.headers.forEach((e,r)=>{t[r]=e}),t}var eo=(({prefix:e="",size:t=7,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"}={})=>{let a=et(r,t);return t=>`${e}${a(t)}`})();function el(e){return e instanceof Error&&("AbortError"===e.name||"TimeoutError"===e.name)}var eu=Symbol.for("vercel.ai.validator");function ec({value:e,schema:t}){let r="object"==typeof t&&null!==t&&eu in t&&!0===t[eu]&&"validate"in t?t:{[eu]:!0,validate:e=>{let r=t.safeParse(e);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}};try{if(null==r.validate)return{success:!0,value:e};let t=r.validate(e);if(t.success)return t;return{success:!1,error:W.wrap({value:e,cause:t.error})}}catch(t){return{success:!1,error:W.wrap({value:e,cause:t})}}}function ed({text:e,schema:t}){try{let r=er.parse(e);if(null==t)return{success:!0,value:r};return ec({value:r,schema:t})}catch(t){return{success:!1,error:M.isJSONParseError(t)?t:new M({text:e,cause:t})}}}function ep(e){try{return er.parse(e),!0}catch(e){return!1}}var em=()=>globalThis.fetch,eh=async({url:e,headers:t,body:r,failedResponseHandler:a,successfulResponseHandler:n,abortSignal:s,fetch:i})=>ef({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(r),values:r},failedResponseHandler:a,successfulResponseHandler:n,abortSignal:s,fetch:i}),ef=async({url:e,headers:t={},body:r,successfulResponseHandler:a,failedResponseHandler:n,abortSignal:s,fetch:i=em()})=>{try{let o=await i(e,{method:"POST",headers:Object.fromEntries(Object.entries(t).filter(([e,t])=>null!=t)),body:r.content,signal:s}),l=ei(o);if(!o.ok){let t;try{t=await n({response:o,url:e,requestBodyValues:r.values})}catch(t){if(el(t)||b.isAPICallError(t))throw t;throw new b({message:"Failed to process error response",cause:t,statusCode:o.status,url:e,responseHeaders:l,requestBodyValues:r.values})}throw t.value}try{return await a({response:o,url:e,requestBodyValues:r.values})}catch(t){if(t instanceof Error&&(el(t)||b.isAPICallError(t)))throw t;throw new b({message:"Failed to process successful response",cause:t,statusCode:o.status,url:e,responseHeaders:l,requestBodyValues:r.values})}}catch(t){if(el(t))throw t;if(t instanceof TypeError&&"fetch failed"===t.message){let a=t.cause;if(null!=a)throw new b({message:`Cannot connect to API: ${a.message}`,cause:a,url:e,requestBodyValues:r.values,isRetryable:!0})}throw t}},eg=e=>async({response:t})=>{let r=ei(t);if(null==t.body)throw new T({});return{responseHeaders:r,value:t.body.pipeThrough(new TextDecoderStream).pipeThrough(new en).pipeThrough(new TransformStream({transform({data:t},r){"[DONE]"!==t&&r.enqueue(ed({text:t,schema:e}))}}))}},ey=e=>async({response:t,url:r,requestBodyValues:a})=>{let n=await t.text(),s=ed({text:n,schema:e}),i=ei(t);if(!s.success)throw new b({message:"Invalid JSON response",cause:s.error,statusCode:t.status,responseHeaders:i,responseBody:n,url:r,requestBodyValues:a});return{responseHeaders:i,value:s.value}},{btoa:ev,atob:e_}=globalThis,eb=r(3389);function ex(e){var t,r;return null!=(r=null==(t=null==e?void 0:e.content)?void 0:t.map(({token:e,logprob:t,top_logprobs:r})=>({token:e,logprob:t,topLogprobs:r?r.map(({token:e,logprob:t})=>({token:e,logprob:t})):[]})))?r:void 0}function ew(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var ek=eb.Ry({error:eb.Ry({message:eb.Z_(),type:eb.Z_().nullish(),param:eb.Yj().nullish(),code:eb.G0([eb.Z_(),eb.Rx()]).nullish()})}),eT=(({errorSchema:e,errorToMessage:t,isRetryable:r})=>async({response:a,url:n,requestBodyValues:s})=>{let i=await a.text(),o=ei(a);if(""===i.trim())return{responseHeaders:o,value:new b({message:a.statusText,url:n,requestBodyValues:s,statusCode:a.status,responseHeaders:o,responseBody:i,isRetryable:null==r?void 0:r(a)})};try{let l=function({text:e,schema:t}){try{let r=er.parse(e);if(null==t)return r;return function({value:e,schema:t}){let r=ec({value:e,schema:t});if(!r.success)throw W.wrap({value:e,cause:r.error});return r.value}({value:r,schema:t})}catch(t){if(M.isJSONParseError(t)||W.isTypeValidationError(t))throw t;throw new M({text:e,cause:t})}}({text:i,schema:e});return{responseHeaders:o,value:new b({message:t(l),url:n,requestBodyValues:s,statusCode:a.status,responseHeaders:o,responseBody:i,data:l,isRetryable:null==r?void 0:r(a,l)})}}catch(e){return{responseHeaders:o,value:new b({message:a.statusText,url:n,requestBodyValues:s,statusCode:a.status,responseHeaders:o,responseBody:i,isRetryable:null==r?void 0:r(a)})}}})({errorSchema:ek,errorToMessage:e=>e.error.message});function eS({id:e,model:t,created:r}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:null!=r?new Date(1e3*r):void 0}}var eI=class{constructor(e,t,r){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=r}get supportsStructuredOutputs(){return!0===this.settings.structuredOutputs}get defaultObjectGenerationMode(){return this.supportsStructuredOutputs?"json":"tool"}get provider(){return this.config.provider}get supportsImageUrls(){return!this.settings.downloadImages}getArgs({mode:e,prompt:t,maxTokens:r,temperature:a,topP:n,topK:s,frequencyPenalty:i,presencePenalty:o,stopSequences:l,responseFormat:u,seed:c,providerMetadata:d}){var p,m,h,f,g,y,v;let _=e.type,b=[];null!=s&&b.push({type:"unsupported-setting",setting:"topK"}),null!=u&&"json"===u.type&&null!=u.schema&&b.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is not supported"});let x=this.settings.useLegacyFunctionCalling;if(x&&!0===this.settings.parallelToolCalls)throw new Q({functionality:"useLegacyFunctionCalling with parallelToolCalls"});if(x&&!0===this.settings.structuredOutputs)throw new Q({functionality:"structuredOutputs with useLegacyFunctionCalling"});let w={model:this.modelId,logit_bias:this.settings.logitBias,logprobs:!0===this.settings.logprobs||"number"==typeof this.settings.logprobs||void 0,top_logprobs:"number"==typeof this.settings.logprobs?this.settings.logprobs:"boolean"==typeof this.settings.logprobs&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:r,temperature:a,top_p:n,frequency_penalty:i,presence_penalty:o,stop:l,seed:c,max_completion_tokens:null!=(m=null==(p=null==d?void 0:d.openai)?void 0:p.maxCompletionTokens)?m:void 0,store:null!=(f=null==(h=null==d?void 0:d.openai)?void 0:h.store)?f:void 0,metadata:null!=(y=null==(g=null==d?void 0:d.openai)?void 0:g.metadata)?y:void 0,response_format:(null==u?void 0:u.type)==="json"?{type:"json_object"}:void 0,messages:function({prompt:e,useLegacyFunctionCalling:t=!1}){let r=[];for(let{role:a,content:n}of e)switch(a){case"system":r.push({role:"system",content:n});break;case"user":if(1===n.length&&"text"===n[0].type){r.push({role:"user",content:n[0].text});break}r.push({role:"user",content:n.map(e=>{var t,r,a;switch(e.type){case"text":return{type:"text",text:e.text};case"image":return{type:"image_url",image_url:{url:e.image instanceof URL?e.image.toString():`data:${null!=(t=e.mimeType)?t:"image/jpeg"};base64,${function(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCodePoint(e[r]);return ev(t)}(e.image)}`,detail:null==(a=null==(r=e.providerMetadata)?void 0:r.openai)?void 0:a.imageDetail}};case"file":throw new Q({functionality:"File content parts in user messages"})}})});break;case"assistant":{let e="",a=[];for(let t of n)switch(t.type){case"text":e+=t.text;break;case"tool-call":a.push({id:t.toolCallId,type:"function",function:{name:t.toolName,arguments:JSON.stringify(t.args)}});break;default:throw Error(`Unsupported part: ${t}`)}if(t){if(a.length>1)throw new Q({functionality:"useLegacyFunctionCalling with multiple tool calls in one message"});r.push({role:"assistant",content:e,function_call:a.length>0?a[0].function:void 0})}else r.push({role:"assistant",content:e,tool_calls:a.length>0?a:void 0});break}case"tool":for(let e of n)t?r.push({role:"function",name:e.toolName,content:JSON.stringify(e.result)}):r.push({role:"tool",tool_call_id:e.toolCallId,content:JSON.stringify(e.result)});break;default:throw Error(`Unsupported role: ${a}`)}return r}({prompt:t,useLegacyFunctionCalling:x})};switch(eN(this.modelId)&&(w.temperature=void 0,w.top_p=void 0,w.frequency_penalty=void 0,w.presence_penalty=void 0),_){case"regular":return{args:{...w,...function({mode:e,useLegacyFunctionCalling:t=!1,structuredOutputs:r=!1}){var a;let n=(null==(a=e.tools)?void 0:a.length)?e.tools:void 0;if(null==n)return{tools:void 0,tool_choice:void 0};let s=e.toolChoice;if(t){let e=n.map(e=>({name:e.name,description:e.description,parameters:e.parameters}));if(null==s)return{functions:e,function_call:void 0};switch(s.type){case"auto":case"none":case void 0:return{functions:e,function_call:void 0};case"required":throw new Q({functionality:"useLegacyFunctionCalling and toolChoice: required"});default:return{functions:e,function_call:{name:s.toolName}}}}let i=n.map(e=>({type:"function",function:{name:e.name,description:e.description,parameters:e.parameters,strict:!0===r||void 0}}));if(null==s)return{tools:i,tool_choice:void 0};let o=s.type;switch(o){case"auto":case"none":case"required":return{tools:i,tool_choice:o};case"tool":return{tools:i,tool_choice:{type:"function",function:{name:s.toolName}}};default:throw Error(`Unsupported tool choice type: ${o}`)}}({mode:e,useLegacyFunctionCalling:x,structuredOutputs:this.settings.structuredOutputs})},warnings:b};case"object-json":return{args:{...w,response_format:!0===this.settings.structuredOutputs?{type:"json_schema",json_schema:{schema:e.schema,strict:!0,name:null!=(v=e.name)?v:"response",description:e.description}}:{type:"json_object"}},warnings:b};case"object-tool":return{args:x?{...w,function_call:{name:e.tool.name},functions:[{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters}]}:{...w,tool_choice:{type:"function",function:{name:e.tool.name}},tools:[{type:"function",function:{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters,strict:!0===this.settings.structuredOutputs||void 0}}]},warnings:b};default:throw Error(`Unsupported type: ${_}`)}}async doGenerate(e){var t,r,a,n,s,i,o,l,u,c,d,p,m,h,f,g,y,v;let _;let{args:b,warnings:x}=this.getArgs(e),{responseHeaders:w,value:k}=await eh({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:es(this.config.headers(),e.headers),body:b,failedResponseHandler:eT,successfulResponseHandler:ey(eE),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:T,...S}=b,I=k.choices[0];return((null==(r=null==(t=k.usage)?void 0:t.completion_tokens_details)?void 0:r.reasoning_tokens)!=null||(null==(n=null==(a=k.usage)?void 0:a.prompt_tokens_details)?void 0:n.cached_tokens)!=null)&&(_={openai:{}},(null==(i=null==(s=k.usage)?void 0:s.completion_tokens_details)?void 0:i.reasoning_tokens)!=null&&(_.openai.reasoningTokens=null==(l=null==(o=k.usage)?void 0:o.completion_tokens_details)?void 0:l.reasoning_tokens),(null==(c=null==(u=k.usage)?void 0:u.prompt_tokens_details)?void 0:c.cached_tokens)!=null&&(_.openai.cachedPromptTokens=null==(p=null==(d=k.usage)?void 0:d.prompt_tokens_details)?void 0:p.cached_tokens)),{text:null!=(m=I.message.content)?m:void 0,toolCalls:this.settings.useLegacyFunctionCalling&&I.message.function_call?[{toolCallType:"function",toolCallId:eo(),toolName:I.message.function_call.name,args:I.message.function_call.arguments}]:null==(h=I.message.tool_calls)?void 0:h.map(e=>{var t;return{toolCallType:"function",toolCallId:null!=(t=e.id)?t:eo(),toolName:e.function.name,args:e.function.arguments}}),finishReason:ew(I.finish_reason),usage:{promptTokens:null!=(g=null==(f=k.usage)?void 0:f.prompt_tokens)?g:NaN,completionTokens:null!=(v=null==(y=k.usage)?void 0:y.completion_tokens)?v:NaN},rawCall:{rawPrompt:T,rawSettings:S},rawResponse:{headers:w},response:eS(k),warnings:x,logprobs:ex(I.logprobs),providerMetadata:_}}async doStream(e){let t,r;if(eN(this.modelId)){let t=await this.doGenerate(e);return{stream:new ReadableStream({start(e){if(e.enqueue({type:"response-metadata",...t.response}),t.text&&e.enqueue({type:"text-delta",textDelta:t.text}),t.toolCalls)for(let r of t.toolCalls)e.enqueue({type:"tool-call",...r});e.enqueue({type:"finish",finishReason:t.finishReason,usage:t.usage,logprobs:t.logprobs,providerMetadata:t.providerMetadata}),e.close()}}),rawCall:t.rawCall,rawResponse:t.rawResponse,warnings:t.warnings}}let{args:a,warnings:n}=this.getArgs(e),{responseHeaders:s,value:i}=await eh({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:es(this.config.headers(),e.headers),body:{...a,stream:!0,stream_options:"strict"===this.config.compatibility?{include_usage:!0}:void 0},failedResponseHandler:eT,successfulResponseHandler:eg(eC),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:o,...l}=a,u=[],c="unknown",d={promptTokens:void 0,completionTokens:void 0},p=!0,{useLegacyFunctionCalling:m}=this.settings;return{stream:i.pipeThrough(new TransformStream({transform(e,a){var n,s,i,o,l,h,f,g,y,v,_,b,x,w,k,T;if(!e.success){c="error",a.enqueue({type:"error",error:e.error});return}let S=e.value;if("error"in S){c="error",a.enqueue({type:"error",error:S.error});return}p&&(p=!1,a.enqueue({type:"response-metadata",...eS(S)})),null!=S.usage&&(d={promptTokens:null!=(n=S.usage.prompt_tokens)?n:void 0,completionTokens:null!=(s=S.usage.completion_tokens)?s:void 0},(null==(i=S.usage.prompt_tokens_details)?void 0:i.cached_tokens)!=null&&(r={openai:{cachedPromptTokens:null==(o=S.usage.prompt_tokens_details)?void 0:o.cached_tokens}}));let I=S.choices[0];if((null==I?void 0:I.finish_reason)!=null&&(c=ew(I.finish_reason)),(null==I?void 0:I.delta)==null)return;let A=I.delta;null!=A.content&&a.enqueue({type:"text-delta",textDelta:A.content});let E=ex(null==I?void 0:I.logprobs);(null==E?void 0:E.length)&&(void 0===t&&(t=[]),t.push(...E));let C=m&&null!=A.function_call?[{type:"function",id:eo(),function:A.function_call,index:0}]:A.tool_calls;if(null!=C)for(let e of C){let t=e.index;if(null==u[t]){if("function"!==e.type)throw new $({data:e,message:"Expected 'function' type."});if(null==e.id)throw new $({data:e,message:"Expected 'id' to be a string."});if((null==(l=e.function)?void 0:l.name)==null)throw new $({data:e,message:"Expected 'function.name' to be a string."});u[t]={id:e.id,type:"function",function:{name:e.function.name,arguments:null!=(h=e.function.arguments)?h:""}};let r=u[t];(null==(f=r.function)?void 0:f.name)!=null&&(null==(g=r.function)?void 0:g.arguments)!=null&&(r.function.arguments.length>0&&a.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:r.id,toolName:r.function.name,argsTextDelta:r.function.arguments}),ep(r.function.arguments)&&a.enqueue({type:"tool-call",toolCallType:"function",toolCallId:null!=(y=r.id)?y:eo(),toolName:r.function.name,args:r.function.arguments}));continue}let r=u[t];(null==(v=e.function)?void 0:v.arguments)!=null&&(r.function.arguments+=null!=(b=null==(_=e.function)?void 0:_.arguments)?b:""),a.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:r.id,toolName:r.function.name,argsTextDelta:null!=(x=e.function.arguments)?x:""}),(null==(w=r.function)?void 0:w.name)!=null&&(null==(k=r.function)?void 0:k.arguments)!=null&&ep(r.function.arguments)&&a.enqueue({type:"tool-call",toolCallType:"function",toolCallId:null!=(T=r.id)?T:eo(),toolName:r.function.name,args:r.function.arguments})}},flush(e){var a,n;e.enqueue({type:"finish",finishReason:c,logprobs:t,usage:{promptTokens:null!=(a=d.promptTokens)?a:NaN,completionTokens:null!=(n=d.completionTokens)?n:NaN},...null!=r?{providerMetadata:r}:{}})}})),rawCall:{rawPrompt:o,rawSettings:l},rawResponse:{headers:s},warnings:n}}},eA=eb.Ry({prompt_tokens:eb.Rx().nullish(),completion_tokens:eb.Rx().nullish(),prompt_tokens_details:eb.Ry({cached_tokens:eb.Rx().nullish()}).nullish(),completion_tokens_details:eb.Ry({reasoning_tokens:eb.Rx().nullish()}).nullish()}).nullish(),eE=eb.Ry({id:eb.Z_().nullish(),created:eb.Rx().nullish(),model:eb.Z_().nullish(),choices:eb.IX(eb.Ry({message:eb.Ry({role:eb.i0("assistant").nullish(),content:eb.Z_().nullish(),function_call:eb.Ry({arguments:eb.Z_(),name:eb.Z_()}).nullish(),tool_calls:eb.IX(eb.Ry({id:eb.Z_().nullish(),type:eb.i0("function"),function:eb.Ry({name:eb.Z_(),arguments:eb.Z_()})})).nullish()}),index:eb.Rx(),logprobs:eb.Ry({content:eb.IX(eb.Ry({token:eb.Z_(),logprob:eb.Rx(),top_logprobs:eb.IX(eb.Ry({token:eb.Z_(),logprob:eb.Rx()}))})).nullable()}).nullish(),finish_reason:eb.Z_().nullish()})),usage:eA}),eC=eb.G0([eb.Ry({id:eb.Z_().nullish(),created:eb.Rx().nullish(),model:eb.Z_().nullish(),choices:eb.IX(eb.Ry({delta:eb.Ry({role:eb.Km(["assistant"]).nullish(),content:eb.Z_().nullish(),function_call:eb.Ry({name:eb.Z_().optional(),arguments:eb.Z_().optional()}).nullish(),tool_calls:eb.IX(eb.Ry({index:eb.Rx(),id:eb.Z_().nullish(),type:eb.i0("function").optional(),function:eb.Ry({name:eb.Z_().nullish(),arguments:eb.Z_().nullish()})})).nullish()}).nullish(),logprobs:eb.Ry({content:eb.IX(eb.Ry({token:eb.Z_(),logprob:eb.Rx(),top_logprobs:eb.IX(eb.Ry({token:eb.Z_(),logprob:eb.Rx()}))})).nullable()}).nullish(),finish_reason:eb.Z_().nullable().optional(),index:eb.Rx()})),usage:eA}),ek]);function eN(e){return e.startsWith("o1-")}function eR(e){return null==e?void 0:e.tokens.map((t,r)=>({token:t,logprob:e.token_logprobs[r],topLogprobs:e.top_logprobs?Object.entries(e.top_logprobs[r]).map(([e,t])=>({token:e,logprob:t})):[]}))}var eO=class{constructor(e,t,r){this.specificationVersion="v1",this.defaultObjectGenerationMode=void 0,this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}getArgs({mode:e,inputFormat:t,prompt:r,maxTokens:a,temperature:n,topP:s,topK:i,frequencyPenalty:o,presencePenalty:l,stopSequences:u,responseFormat:c,seed:d}){var p;let m=e.type,h=[];null!=i&&h.push({type:"unsupported-setting",setting:"topK"}),null!=c&&"text"!==c.type&&h.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});let{prompt:f,stopSequences:g}=function({prompt:e,inputFormat:t,user:r="user",assistant:a="assistant"}){if("prompt"===t&&1===e.length&&"user"===e[0].role&&1===e[0].content.length&&"text"===e[0].content[0].type)return{prompt:e[0].content[0].text};let n="";for(let{role:t,content:s}of("system"===e[0].role&&(n+=`${e[0].content}

`,e=e.slice(1)),e))switch(t){case"system":throw new C({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":{let e=s.map(e=>{switch(e.type){case"text":return e.text;case"image":throw new Q({functionality:"images"})}}).join("");n+=`${r}:
${e}

`;break}case"assistant":{let e=s.map(e=>{switch(e.type){case"text":return e.text;case"tool-call":throw new Q({functionality:"tool-call messages"})}}).join("");n+=`${a}:
${e}

`;break}case"tool":throw new Q({functionality:"tool messages"});default:throw Error(`Unsupported role: ${t}`)}return{prompt:n+=`${a}:
`,stopSequences:[`
${r}:`]}}({prompt:r,inputFormat:t}),y=[...null!=g?g:[],...null!=u?u:[]],v={model:this.modelId,echo:this.settings.echo,logit_bias:this.settings.logitBias,logprobs:"number"==typeof this.settings.logprobs?this.settings.logprobs:"boolean"==typeof this.settings.logprobs&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:a,temperature:n,top_p:s,frequency_penalty:o,presence_penalty:l,seed:d,prompt:f,stop:y.length>0?y:void 0};switch(m){case"regular":if(null==(p=e.tools)?void 0:p.length)throw new Q({functionality:"tools"});if(e.toolChoice)throw new Q({functionality:"toolChoice"});return{args:v,warnings:h};case"object-json":throw new Q({functionality:"object-json mode"});case"object-tool":throw new Q({functionality:"object-tool mode"});default:throw Error(`Unsupported type: ${m}`)}}async doGenerate(e){let{args:t,warnings:r}=this.getArgs(e),{responseHeaders:a,value:n}=await eh({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:es(this.config.headers(),e.headers),body:t,failedResponseHandler:eT,successfulResponseHandler:ey(e$),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:s,...i}=t,o=n.choices[0];return{text:o.text,usage:{promptTokens:n.usage.prompt_tokens,completionTokens:n.usage.completion_tokens},finishReason:ew(o.finish_reason),logprobs:eR(o.logprobs),rawCall:{rawPrompt:s,rawSettings:i},rawResponse:{headers:a},response:eS(n),warnings:r}}async doStream(e){let t;let{args:r,warnings:a}=this.getArgs(e),{responseHeaders:n,value:s}=await eh({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:es(this.config.headers(),e.headers),body:{...r,stream:!0,stream_options:"strict"===this.config.compatibility?{include_usage:!0}:void 0},failedResponseHandler:eT,successfulResponseHandler:eg(eP),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:i,...o}=r,l="unknown",u={promptTokens:Number.NaN,completionTokens:Number.NaN},c=!0;return{stream:s.pipeThrough(new TransformStream({transform(e,r){if(!e.success){l="error",r.enqueue({type:"error",error:e.error});return}let a=e.value;if("error"in a){l="error",r.enqueue({type:"error",error:a.error});return}c&&(c=!1,r.enqueue({type:"response-metadata",...eS(a)})),null!=a.usage&&(u={promptTokens:a.usage.prompt_tokens,completionTokens:a.usage.completion_tokens});let n=a.choices[0];(null==n?void 0:n.finish_reason)!=null&&(l=ew(n.finish_reason)),(null==n?void 0:n.text)!=null&&r.enqueue({type:"text-delta",textDelta:n.text});let s=eR(null==n?void 0:n.logprobs);(null==s?void 0:s.length)&&(void 0===t&&(t=[]),t.push(...s))},flush(e){e.enqueue({type:"finish",finishReason:l,logprobs:t,usage:u})}})),rawCall:{rawPrompt:i,rawSettings:o},rawResponse:{headers:n},warnings:a}}},e$=eb.Ry({id:eb.Z_().nullish(),created:eb.Rx().nullish(),model:eb.Z_().nullish(),choices:eb.IX(eb.Ry({text:eb.Z_(),finish_reason:eb.Z_(),logprobs:eb.Ry({tokens:eb.IX(eb.Z_()),token_logprobs:eb.IX(eb.Rx()),top_logprobs:eb.IX(eb.IM(eb.Z_(),eb.Rx())).nullable()}).nullish()})),usage:eb.Ry({prompt_tokens:eb.Rx(),completion_tokens:eb.Rx()})}),eP=eb.G0([eb.Ry({id:eb.Z_().nullish(),created:eb.Rx().nullish(),model:eb.Z_().nullish(),choices:eb.IX(eb.Ry({text:eb.Z_(),finish_reason:eb.Z_().nullish(),index:eb.Rx(),logprobs:eb.Ry({tokens:eb.IX(eb.Z_()),token_logprobs:eb.IX(eb.Rx()),top_logprobs:eb.IX(eb.IM(eb.Z_(),eb.Rx())).nullable()}).nullish()})),usage:eb.Ry({prompt_tokens:eb.Rx(),completion_tokens:eb.Rx()}).nullish()}),ek]),eZ=class{constructor(e,t,r){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var e;return null!=(e=this.settings.maxEmbeddingsPerCall)?e:2048}get supportsParallelCalls(){var e;return null==(e=this.settings.supportsParallelCalls)||e}async doEmbed({values:e,headers:t,abortSignal:r}){if(e.length>this.maxEmbeddingsPerCall)throw new J({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let{responseHeaders:a,value:n}=await eh({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:es(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:"float",dimensions:this.settings.dimensions,user:this.settings.user},failedResponseHandler:eT,successfulResponseHandler:ey(ej),abortSignal:r,fetch:this.config.fetch});return{embeddings:n.data.map(e=>e.embedding),usage:n.usage?{tokens:n.usage.prompt_tokens}:void 0,rawResponse:{headers:a}}}},ej=eb.Ry({data:eb.IX(eb.Ry({embedding:eb.IX(eb.Rx())})),usage:eb.Ry({prompt_tokens:eb.Rx()}).nullish()}),eM=function(e={}){var t,r,a,n;let s=null!=(r=null==(n=null!=(t=e.baseURL)?t:e.baseUrl)?void 0:n.replace(/\/$/,""))?r:"https://api.openai.com/v1",i=null!=(a=e.compatibility)?a:"compatible",o=()=>({Authorization:`Bearer ${function({apiKey:e,environmentVariableName:t,apiKeyParameterName:r="apiKey",description:a}){if("string"==typeof e)return e;if(null!=e)throw new F({message:`${a} API key must be a string.`});if("undefined"==typeof process)throw new F({message:`${a} API key is missing. Pass it using the '${r}' parameter. Environment variables is not supported in this environment.`});if(null==(e=process.env[t]))throw new F({message:`${a} API key is missing. Pass it using the '${r}' parameter or the ${t} environment variable.`});if("string"!=typeof e)throw new F({message:`${a} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}({apiKey:e.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":e.organization,"OpenAI-Project":e.project,...e.headers}),l=(t,r={})=>new eI(t,r,{provider:"openai.chat",url:({path:e})=>`${s}${e}`,headers:o,compatibility:i,fetch:e.fetch}),u=(t,r={})=>new eO(t,r,{provider:"openai.completion",url:({path:e})=>`${s}${e}`,headers:o,compatibility:i,fetch:e.fetch}),c=(t,r={})=>new eZ(t,r,{provider:"openai.embedding",url:({path:e})=>`${s}${e}`,headers:o,fetch:e.fetch}),d=(e,t)=>{if(new.target)throw Error("The OpenAI model function cannot be called with the new keyword.");return"gpt-3.5-turbo-instruct"===e?u(e,t):l(e,t)},p=function(e,t){return d(e,t)};return p.languageModel=d,p.chat=l,p.completion=u,p.embedding=c,p.textEmbedding=c,p.textEmbeddingModel=c,p}({compatibility:"strict"})},4974:(e,t,r)=>{let a;r.d(t,{$Z:()=>tP,kP:()=>r$});var n,s,i,o,l,u,c,d,p,m,h,f,g,y,v,_,b,x,w,k,T=r(9145),S="vercel.ai.error",I=Symbol.for(S),A=class e extends Error{constructor({name:e,message:t,cause:r}){super(t),this[n]=!0,this.name=e,this.cause=r}static isInstance(t){return e.hasMarker(t,S)}static hasMarker(e,t){let r=Symbol.for(t);return null!=e&&"object"==typeof e&&r in e&&"boolean"==typeof e[r]&&!0===e[r]}toJSON(){return{name:this.name,message:this.message}}};n=I;var E=A,C=(Symbol.for("vercel.ai.error.AI_APICallError"),Symbol.for("vercel.ai.error.AI_EmptyResponseBodyError"),"AI_InvalidArgumentError"),N=`vercel.ai.error.${C}`,R=Symbol.for(N),O=class extends E{constructor({message:e,cause:t,argument:r}){super({name:C,message:e,cause:t}),this[s]=!0,this.argument=r}static isInstance(e){return E.hasMarker(e,N)}};function $(e){return null===e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e||(Array.isArray(e)?e.every($):"object"==typeof e&&Object.entries(e).every(([e,t])=>"string"==typeof e&&$(t)))}s=R,Symbol.for("vercel.ai.error.AI_InvalidPromptError"),Symbol.for("vercel.ai.error.AI_InvalidResponseDataError"),Symbol.for("vercel.ai.error.AI_JSONParseError"),Symbol.for("vercel.ai.error.AI_LoadAPIKeyError"),Symbol.for("vercel.ai.error.AI_LoadSettingError"),Symbol.for("vercel.ai.error.AI_NoContentGeneratedError"),Symbol.for("vercel.ai.error.AI_NoSuchModelError"),Symbol.for("vercel.ai.error.AI_TooManyEmbeddingValuesForCallError"),Symbol.for("vercel.ai.error.AI_TypeValidationError"),Symbol.for("vercel.ai.error.AI_UnsupportedFunctionalityError");let P=(e,t=21)=>(r=t)=>{let a="",n=0|r;for(;n--;)a+=e[Math.random()*e.length|0];return a};var Z=(({prefix:e,size:t=7,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:a="-"}={})=>{let n=P(r,t);if(null==e)return n;if(r.includes(a))throw new O({argument:"separator",message:`The separator "${a}" must not be part of the alphabet "${r}".`});return t=>`${e}${a}${n(t)}`})(),j=Symbol.for("vercel.ai.validator"),{btoa:M,atob:L}=globalThis;let q=Symbol("Let zodToJsonSchema decide on which parser to use"),D={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},F=e=>"string"==typeof e?{...D,name:e}:{...D,...e},U=e=>{let t=F(e),r=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,flags:{hasReferencedOpenAiAnyType:!1},currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([e,r])=>[r._def,{def:r._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))}};var z=r(3389);let B=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")};function J(e){if("openAi"!==e.target)return{};let t=[...e.basePath,e.definitionPath,e.openAiAnyTypeName];return e.flags.hasReferencedOpenAiAnyType=!0,{$ref:"relative"===e.$refStrategy?B(t,e.currentPath):t.join("/")}}function V(e,t,r,a){a?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function K(e,t,r,a,n){e[t]=r,V(e,t,a,n)}function H(e,t){return ep(e.type._def,t)}let W=(e,t)=>ep(e.innerType._def,t),G=(e,t)=>{let r={type:"integer",format:"unix-time"};if("openApi3"===t.target)return r;for(let a of e.checks)switch(a.kind){case"min":K(r,"minimum",a.value,a.message,t);break;case"max":K(r,"maximum",a.value,a.message,t)}return r},X=e=>(!("type"in e)||"string"!==e.type)&&"allOf"in e,Y={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(void 0===a&&(a=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),a),ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Q(e,t){let r={type:"string"};if(e.checks)for(let a of e.checks)switch(a.kind){case"min":K(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,a.value):a.value,a.message,t);break;case"max":K(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"email":switch(t.emailStrategy){case"format:email":er(r,"email",a.message,t);break;case"format:idn-email":er(r,"idn-email",a.message,t);break;case"pattern:zod":ea(r,Y.email,a.message,t)}break;case"url":er(r,"uri",a.message,t);break;case"uuid":er(r,"uuid",a.message,t);break;case"regex":ea(r,a.regex,a.message,t);break;case"cuid":ea(r,Y.cuid,a.message,t);break;case"cuid2":ea(r,Y.cuid2,a.message,t);break;case"startsWith":ea(r,RegExp(`^${ee(a.value,t)}`),a.message,t);break;case"endsWith":ea(r,RegExp(`${ee(a.value,t)}$`),a.message,t);break;case"datetime":er(r,"date-time",a.message,t);break;case"date":er(r,"date",a.message,t);break;case"time":er(r,"time",a.message,t);break;case"duration":er(r,"duration",a.message,t);break;case"length":K(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,a.value):a.value,a.message,t),K(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"includes":ea(r,RegExp(ee(a.value,t)),a.message,t);break;case"ip":"v6"!==a.version&&er(r,"ipv4",a.message,t),"v4"!==a.version&&er(r,"ipv6",a.message,t);break;case"base64url":ea(r,Y.base64url,a.message,t);break;case"jwt":ea(r,Y.jwt,a.message,t);break;case"cidr":"v6"!==a.version&&ea(r,Y.ipv4Cidr,a.message,t),"v4"!==a.version&&ea(r,Y.ipv6Cidr,a.message,t);break;case"emoji":ea(r,Y.emoji(),a.message,t);break;case"ulid":ea(r,Y.ulid,a.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":er(r,"binary",a.message,t);break;case"contentEncoding:base64":K(r,"contentEncoding","base64",a.message,t);break;case"pattern:zod":ea(r,Y.base64,a.message,t)}break;case"nanoid":ea(r,Y.nanoid,a.message,t)}return r}function ee(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let r=0;r<e.length;r++)et.has(e[r])||(t+="\\"),t+=e[r];return t}(e):e}let et=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function er(e,t,r,a){e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&a.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&a.errorMessages&&{errorMessage:{format:r}}})):K(e,"format",t,r,a)}function ea(e,t,r,a){e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&a.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:en(t,a),...r&&a.errorMessages&&{errorMessage:{pattern:r}}})):K(e,"pattern",en(t,a),r,a)}function en(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;let r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},a=r.i?e.source.toLowerCase():e.source,n="",s=!1,i=!1,o=!1;for(let e=0;e<a.length;e++){if(s){n+=a[e],s=!1;continue}if(r.i){if(i){if(a[e].match(/[a-z]/)){o?(n+=a[e]+`${a[e-2]}-${a[e]}`.toUpperCase(),o=!1):"-"===a[e+1]&&a[e+2]?.match(/[a-z]/)?(n+=a[e],o=!0):n+=`${a[e]}${a[e].toUpperCase()}`;continue}}else if(a[e].match(/[a-z]/)){n+=`[${a[e]}${a[e].toUpperCase()}]`;continue}}if(r.m){if("^"===a[e]){n+=`(^|(?<=[\r
]))`;continue}if("$"===a[e]){n+=`($|(?=[\r
]))`;continue}}if(r.s&&"."===a[e]){n+=i?`${a[e]}\r
`:`[${a[e]}\r
]`;continue}n+=a[e],"\\"===a[e]?s=!0:i&&"]"===a[e]?i=!1:i||"["!==a[e]||(i=!0)}try{new RegExp(n)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return n}function es(e,t){if("openAi"===t.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===t.target&&e.keyType?._def.typeName===z.pA.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((r,a)=>({...r,[a]:ep(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",a]})??J(t)}),{}),additionalProperties:t.rejectedAdditionalProperties};let r={type:"object",additionalProperties:ep(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if("openApi3"===t.target)return r;if(e.keyType?._def.typeName===z.pA.ZodString&&e.keyType._def.checks?.length){let{type:a,...n}=Q(e.keyType._def,t);return{...r,propertyNames:n}}if(e.keyType?._def.typeName===z.pA.ZodEnum)return{...r,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===z.pA.ZodBranded&&e.keyType._def.type._def.typeName===z.pA.ZodString&&e.keyType._def.type._def.checks?.length){let{type:a,...n}=H(e.keyType._def,t);return{...r,propertyNames:n}}return r}let ei={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},eo=(e,t)=>{let r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,r)=>ep(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return r.length?{anyOf:r}:void 0},el=(e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return ep(e.innerType._def,t);let r=ep(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:J(t)},r]}:J(t)},eu=(e,t)=>{if("input"===t.pipeStrategy)return ep(e.in._def,t);if("output"===t.pipeStrategy)return ep(e.out._def,t);let r=ep(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),a=ep(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,a].filter(e=>void 0!==e)}},ec=(e,t)=>ep(e.innerType._def,t),ed=(e,t,r)=>{switch(t){case z.pA.ZodString:return Q(e,r);case z.pA.ZodNumber:return function(e,t){let r={type:"number"};if(!e.checks)return r;for(let a of e.checks)switch(a.kind){case"int":r.type="integer",V(r,"type",a.message,t);break;case"min":"jsonSchema7"===t.target?a.inclusive?K(r,"minimum",a.value,a.message,t):K(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),K(r,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?K(r,"maximum",a.value,a.message,t):K(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),K(r,"maximum",a.value,a.message,t));break;case"multipleOf":K(r,"multipleOf",a.value,a.message,t)}return r}(e,r);case z.pA.ZodObject:return function(e,t){let r="openAi"===t.target,a={type:"object",properties:{}},n=[],s=e.shape();for(let e in s){let i=s[e];if(void 0===i||void 0===i._def)continue;let o=function(e){try{return e.isOptional()}catch{return!0}}(i);o&&r&&("ZodOptional"===i._def.typeName&&(i=i._def.innerType),i.isNullable()||(i=i.nullable()),o=!1);let l=ep(i._def,{...t,currentPath:[...t.currentPath,"properties",e],propertyPath:[...t.currentPath,"properties",e]});void 0!==l&&(a.properties[e]=l,o||n.push(e))}n.length&&(a.required=n);let i=function(e,t){if("ZodNever"!==e.catchall._def.typeName)return ep(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return"strict"===t.removeAdditionalStrategy?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}(e,t);return void 0!==i&&(a.additionalProperties=i),a}(e,r);case z.pA.ZodBigInt:return function(e,t){let r={type:"integer",format:"int64"};if(!e.checks)return r;for(let a of e.checks)switch(a.kind){case"min":"jsonSchema7"===t.target?a.inclusive?K(r,"minimum",a.value,a.message,t):K(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),K(r,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?K(r,"maximum",a.value,a.message,t):K(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),K(r,"maximum",a.value,a.message,t));break;case"multipleOf":K(r,"multipleOf",a.value,a.message,t)}return r}(e,r);case z.pA.ZodBoolean:return{type:"boolean"};case z.pA.ZodDate:return function e(t,r,a){let n=a??r.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((a,n)=>e(t,r,a))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return G(t,r)}}(e,r);case z.pA.ZodUndefined:return{not:J(r)};case z.pA.ZodNull:return"openApi3"===r.target?{enum:["null"],nullable:!0}:{type:"null"};case z.pA.ZodArray:return function(e,t){let r={type:"array"};return e.type?._def&&e.type?._def?.typeName!==z.pA.ZodAny&&(r.items=ep(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&K(r,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&K(r,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(K(r,"minItems",e.exactLength.value,e.exactLength.message,t),K(r,"maxItems",e.exactLength.value,e.exactLength.message,t)),r}(e,r);case z.pA.ZodUnion:case z.pA.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return eo(e,t);let r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every(e=>e._def.typeName in ei&&(!e._def.checks||!e._def.checks.length))){let e=r.reduce((e,t)=>{let r=ei[t._def.typeName];return r&&!e.includes(r)?[...e,r]:e},[]);return{type:e.length>1?e:e[0]}}if(r.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=r.reduce((e,t)=>{let r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===r.length){let t=e.filter((e,t,r)=>r.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:r.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(r.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:r.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return eo(e,t)}(e,r);case z.pA.ZodIntersection:return function(e,t){let r=[ep(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),ep(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(e=>!!e),a="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0,n=[];return r.forEach(e=>{if(X(e))n.push(...e.allOf),void 0===e.unevaluatedProperties&&(a=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:r,...a}=e;t=a}else a=void 0;n.push(t)}}),n.length?{allOf:n,...a}:void 0}(e,r);case z.pA.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,r)=>ep(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:ep(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,r)=>ep(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])}}(e,r);case z.pA.ZodRecord:return es(e,r);case z.pA.ZodLiteral:return function(e,t){let r=typeof e.value;return"bigint"!==r&&"number"!==r&&"boolean"!==r&&"string"!==r?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===r?"integer":r,enum:[e.value]}:{type:"bigint"===r?"integer":r,const:e.value}}(e,r);case z.pA.ZodEnum:return{type:"string",enum:Array.from(e.values)};case z.pA.ZodNativeEnum:return function(e){let t=e.values,r=Object.keys(e.values).filter(e=>"number"!=typeof t[t[e]]).map(e=>t[e]),a=Array.from(new Set(r.map(e=>typeof e)));return{type:1===a.length?"string"===a[0]?"string":"number":["string","number"],enum:r}}(e);case z.pA.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:ei[e.innerType._def.typeName],nullable:!0}:{type:[ei[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){let r=ep(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}let r=ep(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}(e,r);case z.pA.ZodOptional:return el(e,r);case z.pA.ZodMap:return function(e,t){return"record"===t.mapStrategy?es(e,t):{type:"array",maxItems:125,items:{type:"array",items:[ep(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||J(t),ep(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||J(t)],minItems:2,maxItems:2}}}(e,r);case z.pA.ZodSet:return function(e,t){let r={type:"array",uniqueItems:!0,items:ep(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&K(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&K(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}(e,r);case z.pA.ZodLazy:return()=>e.getter()._def;case z.pA.ZodPromise:return ep(e.type._def,r);case z.pA.ZodNaN:case z.pA.ZodNever:return function(e){return"openAi"===e.target?void 0:{not:J({...e,currentPath:[...e.currentPath,"not"]})}}(r);case z.pA.ZodEffects:return function(e,t){return"input"===t.effectStrategy?ep(e.schema._def,t):J(t)}(e,r);case z.pA.ZodAny:case z.pA.ZodUnknown:return J(r);case z.pA.ZodDefault:return function(e,t){return{...ep(e.innerType._def,t),default:e.defaultValue()}}(e,r);case z.pA.ZodBranded:return H(e,r);case z.pA.ZodReadonly:return ec(e,r);case z.pA.ZodCatch:return W(e,r);case z.pA.ZodPipeline:return eu(e,r);case z.pA.ZodFunction:case z.pA.ZodVoid:case z.pA.ZodSymbol:default:return}};function ep(e,t,r=!1){let a=t.seen.get(e);if(t.override){let n=t.override?.(e,t,a,r);if(n!==q)return n}if(a&&!r){let e=em(a,t);if(void 0!==e)return e}let n={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,n);let s=ed(e,e.typeName,t),i="function"==typeof s?ep(s(),t):s;if(i&&eh(e,t,i),t.postProcess){let r=t.postProcess(i,e,t);return n.jsonSchema=i,r}return n.jsonSchema=i,i}let em=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:B(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),J(t);return"seen"===t.$refStrategy?J(t):void 0}},eh=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r),ef=(e,t)=>{let r=U(t),a="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,a])=>({...e,[t]:ep(a._def,{...r,currentPath:[...r.basePath,r.definitionPath,t]},!0)??J(r)}),{}):void 0,n="string"==typeof t?t:t?.nameStrategy==="title"?void 0:t?.name,s=ep(e._def,void 0===n?r:{...r,currentPath:[...r.basePath,r.definitionPath,n]},!1)??J(r),i="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==i&&(s.title=i),r.flags.hasReferencedOpenAiAnyType&&(a||(a={}),a[r.openAiAnyTypeName]||(a[r.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:"relative"===r.$refStrategy?"1":[...r.basePath,r.definitionPath,r.openAiAnyTypeName].join("/")}}));let o=void 0===n?a?{...s,[r.definitionPath]:a}:s:{$ref:[..."relative"===r.$refStrategy?[]:r.basePath,r.definitionPath,n].join("/"),[r.definitionPath]:{...a,[n]:s}};return"jsonSchema7"===r.target?o.$schema="http://json-schema.org/draft-07/schema#":("jsonSchema2019-09"===r.target||"openAi"===r.target)&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===r.target&&("anyOf"in o||"oneOf"in o||"allOf"in o||"type"in o&&Array.isArray(o.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),o};var eg={code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},ey={code:"1",name:"function_call",parse:e=>{if(null==e||"object"!=typeof e||!("function_call"in e)||"object"!=typeof e.function_call||null==e.function_call||!("name"in e.function_call)||!("arguments"in e.function_call)||"string"!=typeof e.function_call.name||"string"!=typeof e.function_call.arguments)throw Error('"function_call" parts expect an object with a "function_call" property.');return{type:"function_call",value:e}}},ev={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw Error('"data" parts expect an array value.');return{type:"data",value:e}}},e_={code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},eb={code:"4",name:"assistant_message",parse:e=>{if(null==e||"object"!=typeof e||!("id"in e)||!("role"in e)||!("content"in e)||"string"!=typeof e.id||"string"!=typeof e.role||"assistant"!==e.role||!Array.isArray(e.content)||!e.content.every(e=>null!=e&&"object"==typeof e&&"type"in e&&"text"===e.type&&"text"in e&&null!=e.text&&"object"==typeof e.text&&"value"in e.text&&"string"==typeof e.text.value))throw Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},ex={code:"5",name:"assistant_control_data",parse:e=>{if(null==e||"object"!=typeof e||!("threadId"in e)||!("messageId"in e)||"string"!=typeof e.threadId||"string"!=typeof e.messageId)throw Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},ew={code:"6",name:"data_message",parse:e=>{if(null==e||"object"!=typeof e||!("role"in e)||!("data"in e)||"string"!=typeof e.role||"data"!==e.role)throw Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},ek={code:"7",name:"tool_calls",parse:e=>{if(null==e||"object"!=typeof e||!("tool_calls"in e)||"object"!=typeof e.tool_calls||null==e.tool_calls||!Array.isArray(e.tool_calls)||e.tool_calls.some(e=>null==e||"object"!=typeof e||!("id"in e)||"string"!=typeof e.id||!("type"in e)||"string"!=typeof e.type||!("function"in e)||null==e.function||"object"!=typeof e.function||!("arguments"in e.function)||"string"!=typeof e.function.name||"string"!=typeof e.function.arguments))throw Error('"tool_calls" parts expect an object with a ToolCallPayload.');return{type:"tool_calls",value:e}}},eT={code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},eS={code:"9",name:"tool_call",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName||!("args"in e)||"object"!=typeof e.args)throw Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},eI={code:"a",name:"tool_result",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("result"in e))throw Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},eA={code:"b",name:"tool_call_streaming_start",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName)throw Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},eE={code:"c",name:"tool_call_delta",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("argsTextDelta"in e)||"string"!=typeof e.argsTextDelta)throw Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},eC={code:"d",name:"finish_message",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw Error('"finish_message" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},eN={code:"e",name:"finish_step",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw Error('"finish_step" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&"boolean"==typeof e.isContinued&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},eR=[eg,ey,ev,e_,eb,ex,ew,ek,eT,eS,eI,eA,eE,eC,eN],eO={[eg.code]:eg,[ey.code]:ey,[ev.code]:ev,[e_.code]:e_,[eb.code]:eb,[ex.code]:ex,[ew.code]:ew,[ek.code]:ek,[eT.code]:eT,[eS.code]:eS,[eI.code]:eI,[eA.code]:eA,[eE.code]:eE,[eC.code]:eC,[eN.code]:eN};eg.name,eg.code,ey.name,ey.code,ev.name,ev.code,e_.name,e_.code,eb.name,eb.code,ex.name,ex.code,ew.name,ew.code,ek.name,ek.code,eT.name,eT.code,eS.name,eS.code,eI.name,eI.code,eA.name,eA.code,eE.name,eE.code,eC.name,eC.code,eN.name,eN.code;var e$=eR.map(e=>e.code),eP=e=>{let t=e.indexOf(":");if(-1===t)throw Error("Failed to parse stream string. No separator found.");let r=e.slice(0,t);if(!e$.includes(r))throw Error(`Failed to parse stream string. Invalid code ${r}.`);let a=JSON.parse(e.slice(t+1));return eO[r].parse(a)};function eZ(e,t){let r=eR.find(t=>t.name===e);if(!r)throw Error(`Invalid stream part type: ${e}`);return`${r.code}:${JSON.stringify(t)}
`}var ej=Symbol.for("vercel.ai.schema");function eM(e){return"object"==typeof e&&null!==e&&ej in e&&!0===e[ej]&&"jsonSchema"in e&&"validate"in e?e:function(e,{validate:t}={}){return{[ej]:!0,_type:void 0,[j]:!0,jsonSchema:e,validate:t}}(ef(e),{validate:t=>{let r=e.safeParse(t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}})}var eL="vercel.ai.error",eq=Symbol.for(eL),eD=class e extends Error{constructor({name:e,message:t,cause:r}){super(t),this[i]=!0,this.name=e,this.cause=r}static isInstance(t){return e.hasMarker(t,eL)}static hasMarker(e,t){let r=Symbol.for(t);return null!=e&&"object"==typeof e&&r in e&&"boolean"==typeof e[r]&&!0===e[r]}toJSON(){return{name:this.name,message:this.message}}};i=eq;var eF=eD,eU="AI_APICallError",ez=`vercel.ai.error.${eU}`,eB=Symbol.for(ez),eJ=class extends eF{constructor({message:e,url:t,requestBodyValues:r,statusCode:a,responseHeaders:n,responseBody:s,cause:i,isRetryable:l=null!=a&&(408===a||409===a||429===a||a>=500),data:u}){super({name:eU,message:e,cause:i}),this[o]=!0,this.url=t,this.requestBodyValues=r,this.statusCode=a,this.responseHeaders=n,this.responseBody=s,this.isRetryable=l,this.data=u}static isInstance(e){return eF.hasMarker(e,ez)}static isAPICallError(e){return e instanceof Error&&e.name===eU&&"string"==typeof e.url&&"object"==typeof e.requestBodyValues&&(null==e.statusCode||"number"==typeof e.statusCode)&&(null==e.responseHeaders||"object"==typeof e.responseHeaders)&&(null==e.responseBody||"string"==typeof e.responseBody)&&(null==e.cause||"object"==typeof e.cause)&&"boolean"==typeof e.isRetryable&&(null==e.data||"object"==typeof e.data)}toJSON(){return{name:this.name,message:this.message,url:this.url,requestBodyValues:this.requestBodyValues,statusCode:this.statusCode,responseHeaders:this.responseHeaders,responseBody:this.responseBody,cause:this.cause,isRetryable:this.isRetryable,data:this.data}}};function eV(e){return null==e?"unknown error":"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}o=eB,Symbol.for("vercel.ai.error.AI_EmptyResponseBodyError");var eK="AI_InvalidArgumentError",eH=`vercel.ai.error.${eK}`,eW=Symbol.for(eH),eG=class extends eF{constructor({message:e,cause:t,argument:r}){super({name:eK,message:e,cause:t}),this[l]=!0,this.argument=r}static isInstance(e){return eF.hasMarker(e,eH)}};l=eW;var eX="AI_InvalidPromptError",eY=`vercel.ai.error.${eX}`,eQ=Symbol.for(eY),e0=class extends eF{constructor({prompt:e,message:t,cause:r}){super({name:eX,message:`Invalid prompt: ${t}`,cause:r}),this[u]=!0,this.prompt=e}static isInstance(e){return eF.hasMarker(e,eY)}static isInvalidPromptError(e){return e instanceof Error&&e.name===eX&&null!=prompt}toJSON(){return{name:this.name,message:this.message,stack:this.stack,prompt:this.prompt}}};u=eQ,Symbol.for("vercel.ai.error.AI_InvalidResponseDataError");var e1="AI_JSONParseError",e9=`vercel.ai.error.${e1}`,e4=Symbol.for(e9),e2=class extends eF{constructor({text:e,cause:t}){super({name:e1,message:`JSON parsing failed: Text: ${e}.
Error message: ${eV(t)}`,cause:t}),this[c]=!0,this.text=e}static isInstance(e){return eF.hasMarker(e,e9)}static isJSONParseError(e){return e instanceof Error&&e.name===e1&&"text"in e&&"string"==typeof e.text}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,valueText:this.text}}};c=e4,Symbol.for("vercel.ai.error.AI_LoadAPIKeyError"),Symbol.for("vercel.ai.error.AI_LoadSettingError"),Symbol.for("vercel.ai.error.AI_NoContentGeneratedError");var e3="AI_NoSuchModelError",e5=`vercel.ai.error.${e3}`,e6=Symbol.for(e5),e7=class extends eF{constructor({errorName:e=e3,modelId:t,modelType:r,message:a=`No such ${r}: ${t}`}){super({name:e,message:a}),this[d]=!0,this.modelId=t,this.modelType=r}static isInstance(e){return eF.hasMarker(e,e5)}static isNoSuchModelError(e){return e instanceof Error&&e.name===e3&&"string"==typeof e.modelId&&"string"==typeof e.modelType}toJSON(){return{name:this.name,message:this.message,stack:this.stack,modelId:this.modelId,modelType:this.modelType}}};d=e6,Symbol.for("vercel.ai.error.AI_TooManyEmbeddingValuesForCallError");var e8="AI_TypeValidationError",te=`vercel.ai.error.${e8}`,tt=Symbol.for(te),tr=class e extends eF{constructor({value:e,cause:t}){super({name:e8,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${eV(t)}`,cause:t}),this[p]=!0,this.value=e}static isInstance(e){return eF.hasMarker(e,te)}static wrap({value:t,cause:r}){return e.isInstance(r)&&r.value===t?r:new e({value:t,cause:r})}static isTypeValidationError(e){return e instanceof Error&&e.name===e8}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,value:this.value}}};p=tt;var ta="AI_UnsupportedFunctionalityError",tn=`vercel.ai.error.${ta}`,ts=Symbol.for(tn),ti=class extends eF{constructor({functionality:e}){super({name:ta,message:`'${e}' functionality not supported.`}),this[m]=!0,this.functionality=e}static isInstance(e){return eF.hasMarker(e,tn)}static isUnsupportedFunctionalityError(e){return e instanceof Error&&e.name===ta&&"string"==typeof e.functionality}toJSON(){return{name:this.name,message:this.message,stack:this.stack,functionality:this.functionality}}};function to(e){return null===e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e||(Array.isArray(e)?e.every(to):"object"==typeof e&&Object.entries(e).every(([e,t])=>"string"==typeof e&&to(t)))}m=ts;let tl=(e,t=21)=>(r=t)=>{let a="",n=0|r;for(;n--;)a+=e[Math.random()*e.length|0];return a};var tu=({prefix:e,size:t=7,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:a="-"}={})=>{let n=tl(r,t);if(null==e)return n;if(r.includes(a))throw new eG({argument:"separator",message:`The separator "${a}" must not be part of the alphabet "${r}".`});return t=>`${e}${a}${n(t)}`};tu();var tc=Symbol.for("vercel.ai.validator");function td({value:e,schema:t}){let r="object"==typeof t&&null!==t&&tc in t&&!0===t[tc]&&"validate"in t?t:{[tc]:!0,validate:e=>{let r=t.safeParse(e);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}};try{if(null==r.validate)return{success:!0,value:e};let t=r.validate(e);if(t.success)return t;return{success:!1,error:tr.wrap({value:e,cause:t.error})}}catch(t){return{success:!1,error:tr.wrap({value:e,cause:t})}}}var{btoa:tp,atob:tm}=globalThis;function th(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCodePoint(e[r]);return tp(t)}var tf=r(6500),tg=r(7028),ty=Object.defineProperty,tv=(e,t)=>{for(var r in t)ty(e,r,{get:t[r],enumerable:!0})};async function t_(e){return void 0===e?Promise.resolve():new Promise(t=>setTimeout(t,e))}var tb="AI_RetryError",tx=`vercel.ai.error.${tb}`,tw=Symbol.for(tx),tk=class extends eF{constructor({message:e,reason:t,errors:r}){super({name:tb,message:e}),this[h]=!0,this.reason=t,this.errors=r,this.lastError=r[r.length-1]}static isInstance(e){return eF.hasMarker(e,tx)}static isRetryError(e){return e instanceof Error&&e.name===tb&&"string"==typeof e.reason&&Array.isArray(e.errors)}toJSON(){return{name:this.name,message:this.message,reason:this.reason,lastError:this.lastError,errors:this.errors}}};h=tw;var tT=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:r=2}={})=>async a=>tS(a,{maxRetries:e,delayInMs:t,backoffFactor:r});async function tS(e,{maxRetries:t,delayInMs:r,backoffFactor:a},n=[]){try{return await e()}catch(u){var s;if((s=u)instanceof Error&&("AbortError"===s.name||"TimeoutError"===s.name)||0===t)throw u;let i=null==u?"unknown error":"string"==typeof u?u:u instanceof Error?u.message:JSON.stringify(u),o=[...n,u],l=o.length;if(l>t)throw new tk({message:`Failed after ${l} attempts. Last error: ${i}`,reason:"maxRetriesExceeded",errors:o});if(u instanceof Error&&eJ.isAPICallError(u)&&!0===u.isRetryable&&l<=t)return await t_(r),tS(e,{maxRetries:t,delayInMs:a*r,backoffFactor:a},o);if(1===l)throw u;throw new tk({message:`Failed after ${l} attempts with non-retryable error: '${i}'`,reason:"errorNotRetryable",errors:o})}}function tI({operationId:e,telemetry:t}){return{"operation.name":`${e}${(null==t?void 0:t.functionId)!=null?` ${t.functionId}`:""}`,"resource.name":null==t?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":null==t?void 0:t.functionId}}function tA({model:e,settings:t,telemetry:r,headers:a}){var n;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((e,[t,r])=>(e[`ai.settings.${t}`]=r,e),{}),...Object.entries(null!=(n=null==r?void 0:r.metadata)?n:{}).reduce((e,[t,r])=>(e[`ai.telemetry.metadata.${t}`]=r,e),{}),...Object.entries(null!=a?a:{}).reduce((e,[t,r])=>(void 0!==r&&(e[`ai.request.headers.${t}`]=r),e),{})}}var tE={startSpan:()=>tC,startActiveSpan:(e,t,r,a)=>"function"==typeof t?t(tC):"function"==typeof r?r(tC):"function"==typeof a?a(tC):void 0},tC={spanContext:()=>tN,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},tN={traceId:"",spanId:"",traceFlags:0};function tR({isEnabled:e=!1,tracer:t}={}){return e?t||tf.g.getTracer("ai"):tE}function tO({name:e,tracer:t,attributes:r,fn:a,endWhenDone:n=!0}){return t.startActiveSpan(e,{attributes:r},async e=>{try{let t=await a(e);return n&&e.end(),t}catch(t){try{t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:tg.Q.ERROR,message:t.message})):e.setStatus({code:tg.Q.ERROR})}finally{e.end()}throw t}})}function t$({telemetry:e,attributes:t}){return(null==e?void 0:e.isEnabled)!==!0?{}:Object.entries(t).reduce((t,[r,a])=>{if(void 0===a)return t;if("object"==typeof a&&"input"in a&&"function"==typeof a.input){if((null==e?void 0:e.recordInputs)===!1)return t;let n=a.input();return void 0===n?t:{...t,[r]:n}}if("object"==typeof a&&"output"in a&&"function"==typeof a.output){if((null==e?void 0:e.recordOutputs)===!1)return t;let n=a.output();return void 0===n?t:{...t,[r]:n}}return{...t,[r]:a}},{})}async function tP({model:e,value:t,maxRetries:r,abortSignal:a,headers:n,experimental_telemetry:s}){let i=tA({model:e,telemetry:s,headers:n,settings:{maxRetries:r}}),o=tR(s);return tO({name:"ai.embed",attributes:t$({telemetry:s,attributes:{...tI({operationId:"ai.embed",telemetry:s}),...i,"ai.value":{input:()=>JSON.stringify(t)}}}),tracer:o,fn:async l=>{let u=tT({maxRetries:r}),{embedding:c,usage:d,rawResponse:p}=await u(()=>tO({name:"ai.embed.doEmbed",attributes:t$({telemetry:s,attributes:{...tI({operationId:"ai.embed.doEmbed",telemetry:s}),...i,"ai.values":{input:()=>[JSON.stringify(t)]}}}),tracer:o,fn:async r=>{var i;let o=await e.doEmbed({values:[t],abortSignal:a,headers:n}),l=o.embeddings[0],u=null!=(i=o.usage)?i:{tokens:NaN};return r.setAttributes(t$({telemetry:s,attributes:{"ai.embeddings":{output:()=>o.embeddings.map(e=>JSON.stringify(e))},"ai.usage.tokens":u.tokens}})),{embedding:l,usage:u,rawResponse:o.rawResponse}}}));return l.setAttributes(t$({telemetry:s,attributes:{"ai.embedding":{output:()=>JSON.stringify(c)},"ai.usage.tokens":d.tokens}})),new tZ({value:t,embedding:c,usage:d,rawResponse:p})}})}var tZ=class{constructor(e){this.value=e.value,this.embedding=e.embedding,this.usage=e.usage,this.rawResponse=e.rawResponse}},tj="AI_DownloadError",tM=`vercel.ai.error.${tj}`,tL=Symbol.for(tM),tq=class extends eF{constructor({url:e,statusCode:t,statusText:r,cause:a,message:n=null==a?`Failed to download ${e}: ${t} ${r}`:`Failed to download ${e}: ${a}`}){super({name:tj,message:n,cause:a}),this[f]=!0,this.url=e,this.statusCode=t,this.statusText=r}static isInstance(e){return eF.hasMarker(e,tM)}static isDownloadError(e){return e instanceof Error&&e.name===tj&&"string"==typeof e.url&&(null==e.statusCode||"number"==typeof e.statusCode)&&(null==e.statusText||"string"==typeof e.statusText)}toJSON(){return{name:this.name,message:this.message,url:this.url,statusCode:this.statusCode,statusText:this.statusText,cause:this.cause}}};async function tD({url:e,fetchImplementation:t=fetch}){var r;let a=e.toString();try{let e=await t(a);if(!e.ok)throw new tq({url:a,statusCode:e.status,statusText:e.statusText});return{data:new Uint8Array(await e.arrayBuffer()),mimeType:null!=(r=e.headers.get("content-type"))?r:void 0}}catch(e){if(tq.isInstance(e))throw e;throw new tq({url:a,cause:e})}}f=tL;var tF=[{mimeType:"image/gif",bytes:[71,73,70]},{mimeType:"image/png",bytes:[137,80,78,71]},{mimeType:"image/jpeg",bytes:[255,216]},{mimeType:"image/webp",bytes:[82,73,70,70]}],tU="AI_InvalidDataContentError",tz=`vercel.ai.error.${tU}`,tB=Symbol.for(tz),tJ=class extends eF{constructor({content:e,cause:t,message:r=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:tU,message:r,cause:t}),this[g]=!0,this.content=e}static isInstance(e){return eF.hasMarker(e,tz)}static isInvalidDataContentError(e){return e instanceof Error&&e.name===tU&&null!=e.content}toJSON(){return{name:this.name,message:this.message,stack:this.stack,cause:this.cause,content:this.content}}};g=tB;var tV=z.G0([z.Z_(),z.Pp(Uint8Array),z.Pp(ArrayBuffer),z.PG(e=>{var t,r;return null!=(r=null==(t=globalThis.Buffer)?void 0:t.isBuffer(e))&&r},{message:"Must be a Buffer"})]);function tK(e){if(e instanceof Uint8Array)return e;if("string"==typeof e)try{return function(e){let t=tm(e.replace(/-/g,"+").replace(/_/g,"/"));return Uint8Array.from(t,e=>e.codePointAt(0))}(e)}catch(t){throw new tJ({message:"Invalid data content. Content string is not a base64-encoded media.",content:e,cause:t})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new tJ({content:e})}var tH="AI_InvalidMessageRoleError",tW=`vercel.ai.error.${tH}`,tG=Symbol.for(tW),tX=class extends eF{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:tH,message:t}),this[y]=!0,this.role=e}static isInstance(e){return eF.hasMarker(e,tW)}static isInvalidMessageRoleError(e){return e instanceof Error&&e.name===tH&&"string"==typeof e.role}toJSON(){return{name:this.name,message:this.message,stack:this.stack,role:this.role}}};async function tY({prompt:e,modelSupportsImageUrls:t=!0,modelSupportsUrl:r=()=>!1,downloadImplementation:a=tD}){let n=await tQ(e.messages,a,t,r);return[...null!=e.system?[{role:"system",content:e.system}]:[],...e.messages.map(e=>(function(e,t){let r=e.role;switch(r){case"system":return{role:"system",content:e.content,providerMetadata:e.experimental_providerMetadata};case"user":if("string"==typeof e.content)return{role:"user",content:[{type:"text",text:e.content}],providerMetadata:e.experimental_providerMetadata};return{role:"user",content:e.content.map(e=>(function(e,t){let r,a,n;if("text"===e.type)return{type:"text",text:e.text,providerMetadata:e.experimental_providerMetadata};let s=e.mimeType,i=e.type;switch(i){case"image":r=e.image;break;case"file":r=e.data;break;default:throw Error(`Unsupported part type: ${i}`)}try{a="string"==typeof r?new URL(r):r}catch(e){a=r}if(a instanceof URL){if("data:"===a.protocol){let{mimeType:e,base64Content:t}=function(e){try{let[t,r]=e.split(",");return{mimeType:t.split(";")[0].split(":")[1],base64Content:r}}catch(e){return{mimeType:void 0,base64Content:void 0}}}(a.toString());if(null==e||null==t)throw Error(`Invalid data URL format in part ${i}`);s=e,n=tK(t)}else{let e=t[a.toString()];e?(n=e.data,null!=s||(s=e.mimeType)):n=a}}else n=tK(a);switch(i){case"image":return null==s&&n instanceof Uint8Array&&(s=function(e){for(let{bytes:t,mimeType:r}of tF)if(e.length>=t.length&&t.every((t,r)=>e[r]===t))return r}(n)),{type:"image",image:n,mimeType:s,providerMetadata:e.experimental_providerMetadata};case"file":var o;if(null==s)throw Error("Mime type is missing for file part");return{type:"file",data:n instanceof Uint8Array?"string"==typeof(o=n)?o:o instanceof ArrayBuffer?th(new Uint8Array(o)):th(o):n,mimeType:s,providerMetadata:e.experimental_providerMetadata}}})(e,t)).filter(e=>"text"!==e.type||""!==e.text),providerMetadata:e.experimental_providerMetadata};case"assistant":if("string"==typeof e.content)return{role:"assistant",content:[{type:"text",text:e.content}],providerMetadata:e.experimental_providerMetadata};return{role:"assistant",content:e.content.filter(e=>"text"!==e.type||""!==e.text).map(e=>{let{experimental_providerMetadata:t,...r}=e;return{...r,providerMetadata:t}}),providerMetadata:e.experimental_providerMetadata};case"tool":return{role:"tool",content:e.content.map(e=>({type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:e.result,content:e.experimental_content,isError:e.isError,providerMetadata:e.experimental_providerMetadata})),providerMetadata:e.experimental_providerMetadata};default:throw new tX({role:r})}})(e,n))]}async function tQ(e,t,r,a){let n=e.filter(e=>"user"===e.role).map(e=>e.content).filter(e=>Array.isArray(e)).flat().filter(e=>"image"===e.type||"file"===e.type).filter(e=>!("image"===e.type&&!0===r)).map(e=>"image"===e.type?e.image:e.data).map(e=>"string"==typeof e&&(e.startsWith("http:")||e.startsWith("https:"))?new URL(e):e).filter(e=>e instanceof URL).filter(e=>!a(e));return Object.fromEntries((await Promise.all(n.map(async e=>({url:e,data:await t({url:e})})))).map(({url:e,data:t})=>[e.toString(),t]))}y=tG;var t0="AI_InvalidArgumentError",t1=`vercel.ai.error.${t0}`,t9=Symbol.for(t1),t4=class extends eF{constructor({parameter:e,value:t,message:r}){super({name:t0,message:`Invalid argument for parameter ${e}: ${r}`}),this[v]=!0,this.parameter=e,this.value=t}static isInstance(e){return eF.hasMarker(e,t1)}static isInvalidArgumentError(e){return e instanceof Error&&e.name===t0&&"string"==typeof e.parameter&&"string"==typeof e.value}toJSON(){return{name:this.name,message:this.message,stack:this.stack,parameter:this.parameter,value:this.value}}};v=t9;var t2=z.Vo(()=>z.G0([z.lB(),z.Z_(),z.Rx(),z.O7(),z.IM(z.Z_(),t2),z.IX(t2)])),t3=z.IM(z.Z_(),z.IM(z.Z_(),t2)),t5=z.IX(z.G0([z.Ry({type:z.i0("text"),text:z.Z_()}),z.Ry({type:z.i0("image"),data:z.Z_(),mimeType:z.Z_().optional()})])),t6=z.Ry({type:z.i0("text"),text:z.Z_(),experimental_providerMetadata:t3.optional()}),t7=z.Ry({type:z.i0("image"),image:z.G0([tV,z.Pp(URL)]),mimeType:z.Z_().optional(),experimental_providerMetadata:t3.optional()}),t8=z.Ry({type:z.i0("file"),data:z.G0([tV,z.Pp(URL)]),mimeType:z.Z_(),experimental_providerMetadata:t3.optional()}),re=z.Ry({type:z.i0("tool-call"),toolCallId:z.Z_(),toolName:z.Z_(),args:z._4()}),rt=z.Ry({type:z.i0("tool-result"),toolCallId:z.Z_(),toolName:z.Z_(),result:z._4(),content:t5.optional(),isError:z.O7().optional(),experimental_providerMetadata:t3.optional()}),rr=z.Ry({role:z.i0("system"),content:z.Z_(),experimental_providerMetadata:t3.optional()}),ra=z.Ry({role:z.i0("user"),content:z.G0([z.Z_(),z.IX(z.G0([t6,t7,t8]))]),experimental_providerMetadata:t3.optional()}),rn=z.Ry({role:z.i0("assistant"),content:z.G0([z.Z_(),z.IX(z.G0([t6,re]))]),experimental_providerMetadata:t3.optional()}),rs=z.Ry({role:z.i0("tool"),content:z.IX(rt),experimental_providerMetadata:t3.optional()}),ri=z.G0([rr,ra,rn,rs]);function ro(e){return"object"==typeof e&&null!==e&&("function"===e.role||"data"===e.role||"toolInvocations"in e||"experimental_attachments"in e)?"has-ui-specific-parts":"object"==typeof e&&null!==e&&"content"in e&&(Array.isArray(e.content)||"experimental_providerMetadata"in e)?"has-core-specific-parts":"object"==typeof e&&null!==e&&"role"in e&&"content"in e&&"string"==typeof e.content&&["system","user","assistant","tool"].includes(e.role)?"message":"other"}var rl="AI_MessageConversionError",ru=`vercel.ai.error.${rl}`,rc=Symbol.for(ru),rd=class extends eF{constructor({originalMessage:e,message:t}){super({name:rl,message:t}),this[_]=!0,this.originalMessage=e}static isInstance(e){return eF.hasMarker(e,ru)}};_=rc;function rp(e,{contentType:t,dataStreamVersion:r}){var a;let n=new Headers(null!=(a=null==e?void 0:e.headers)?a:{});return n.has("Content-Type")||n.set("Content-Type",t),void 0!==r&&n.set("X-Vercel-AI-Data-Stream",r),n}var rm="AI_NoObjectGeneratedError",rh=`vercel.ai.error.${rm}`,rf=Symbol.for(rh),rg=class extends eF{constructor({message:e="No object generated."}={}){super({name:rm,message:e}),this[b]=!0}static isInstance(e){return eF.hasMarker(e,rh)}static isNoObjectGeneratedError(e){return e instanceof Error&&e.name===rm}toJSON(){return{name:this.name,cause:this.cause,message:this.message,stack:this.stack}}};function ry(e,t){let r=e.pipeThrough(new TransformStream(t));return r[Symbol.asyncIterator]=()=>{let e=r.getReader();return{async next(){let{done:t,value:r}=await e.read();return t?{done:!0,value:void 0}:{done:!1,value:r}}}},r}b=rf;function rv(){let e,t;return{promise:new Promise((r,a)=>{e=r,t=a}),resolve:e,reject:t}}tu({prefix:"aiobj",size:24});function r_(){var e,t;return null!=(t=null==(e=null==globalThis?void 0:globalThis.performance)?void 0:e.now())?t:Date.now()}function rb(e,{contentType:t,dataStreamVersion:r}){let a={};if((null==e?void 0:e.headers)!=null)for(let[t,r]of Object.entries(e.headers))a[t]=r;return null==a["Content-Type"]&&(a["Content-Type"]=t),void 0!==r&&(a["X-Vercel-AI-Data-Stream"]=r),a}function rx({response:e,status:t,statusText:r,headers:a,stream:n}){e.writeHead(null!=t?t:200,r,a);let s=n.getReader();(async()=>{try{for(;;){let{done:t,value:r}=await s.read();if(t)break;e.write(r)}}catch(e){throw e}finally{e.end()}})()}tu({prefix:"aiobj",size:24});var rw="AI_InvalidToolArgumentsError",rk=`vercel.ai.error.${rw}`,rT=Symbol.for(rk),rS=class extends eF{constructor({toolArgs:e,toolName:t,cause:r,message:a=`Invalid arguments for tool ${t}: ${eV(r)}`}){super({name:rw,message:a,cause:r}),this[x]=!0,this.toolArgs=e,this.toolName=t}static isInstance(e){return eF.hasMarker(e,rk)}static isInvalidToolArgumentsError(e){return e instanceof Error&&e.name===rw&&"string"==typeof e.toolName&&"string"==typeof e.toolArgs}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,toolName:this.toolName,toolArgs:this.toolArgs}}};x=rT;var rI="AI_NoSuchToolError",rA=`vercel.ai.error.${rI}`,rE=Symbol.for(rA),rC=class extends eF{constructor({toolName:e,availableTools:t,message:r=`Model tried to call unavailable tool '${e}'. ${void 0===t?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:rI,message:r}),this[w]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return eF.hasMarker(e,rA)}static isNoSuchToolError(e){return e instanceof Error&&e.name===rI&&"toolName"in e&&void 0!=e.toolName&&"string"==typeof e.name}toJSON(){return{name:this.name,message:this.message,stack:this.stack,toolName:this.toolName,availableTools:this.availableTools}}};w=rE;var rN=/^([\s\S]*?)(\s+)(\S*)$/;function rR(e,t){let r,a;let n=e.getReader(),s=t.getReader(),i=!1,o=!1;async function l(e){try{null==r&&(r=n.read());let t=await r;r=void 0,t.done?e.close():e.enqueue(t.value)}catch(t){e.error(t)}}async function u(e){try{null==a&&(a=s.read());let t=await a;a=void 0,t.done?e.close():e.enqueue(t.value)}catch(t){e.error(t)}}return new ReadableStream({async pull(e){try{if(i){await u(e);return}if(o){await l(e);return}null==r&&(r=n.read()),null==a&&(a=s.read());let{result:t,reader:c}=await Promise.race([r.then(e=>({result:e,reader:n})),a.then(e=>({result:e,reader:s}))]);t.done||e.enqueue(t.value),c===n?(r=void 0,t.done&&(await u(e),i=!0)):(a=void 0,t.done&&(o=!0,await l(e)))}catch(t){e.error(t)}},cancel(){n.cancel(),s.cancel()}})}tu({prefix:"aitxt",size:24});var rO=tu({prefix:"aitxt",size:24});async function r$({model:e,tools:t,toolChoice:r,system:a,prompt:n,messages:s,maxRetries:i,abortSignal:o,headers:l,maxToolRoundtrips:u=0,maxSteps:c=null!=u?u+1:1,experimental_continueSteps:d=!1,experimental_telemetry:p,experimental_providerMetadata:m,experimental_toolCallStreaming:h=!1,experimental_activeTools:f,onChunk:g,onFinish:y,onStepFinish:v,_internal:{now:_=r_,generateId:b=rO,currentDate:x=()=>new Date}={},...w}){if(c<1)throw new t4({parameter:"maxSteps",value:c,message:"maxSteps must be at least 1"});let k=tA({model:e,telemetry:p,headers:l,settings:{...w,maxRetries:i}}),S=tR(p),I=function({prompt:e,tools:t}){if(null==e.prompt&&null==e.messages)throw new e0({prompt:e,message:"prompt or messages must be defined"});if(null!=e.prompt&&null!=e.messages)throw new e0({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(null!=e.system&&"string"!=typeof e.system)throw new e0({prompt:e,message:"system must be a string"});if(null!=e.prompt){if("string"!=typeof e.prompt)throw new e0({prompt:e,message:"prompt must be a string"});return{type:"prompt",system:e.system,messages:[{role:"user",content:e.prompt}]}}if(null!=e.messages){let r=function(e){if(!Array.isArray(e))return"other";if(0===e.length)return"messages";let t=e.map(ro);return t.some(e=>"has-ui-specific-parts"===e)?"ui-messages":t.every(e=>"has-core-specific-parts"===e||"message"===e)?"messages":"other"}(e.messages);if("other"===r)throw new e0({prompt:e,message:"messages must be an array of CoreMessage or UIMessage"});let a="ui-messages"===r?function(e,t){var r;let a=null!=(r=null==t?void 0:t.tools)?r:{},n=[];for(let t of e){let{role:e,content:r,toolInvocations:s,experimental_attachments:i}=t;switch(e){case"system":n.push({role:"system",content:r});break;case"user":n.push({role:"user",content:i?[{type:"text",text:r},...function(e){var t,r,a;let n=[];for(let s of e){let e;try{e=new URL(s.url)}catch(e){throw Error(`Invalid URL: ${s.url}`)}switch(e.protocol){case"http:":case"https:":if(null==(t=s.contentType)?void 0:t.startsWith("image/"))n.push({type:"image",image:e});else{if(!s.contentType)throw Error("If the attachment is not an image, it must specify a content type");n.push({type:"file",data:e,mimeType:s.contentType})}break;case"data:":{let e,t,i;try{[e,t]=s.url.split(","),i=e.split(";")[0].split(":")[1]}catch(e){throw Error(`Error processing data URL: ${s.url}`)}if(null==i||null==t)throw Error(`Invalid data URL format: ${s.url}`);if(null==(r=s.contentType)?void 0:r.startsWith("image/"))n.push({type:"image",image:tK(t)});else if(null==(a=s.contentType)?void 0:a.startsWith("text/"))n.push({type:"text",text:function(e){try{return new TextDecoder().decode(e)}catch(e){throw Error("Error decoding Uint8Array to text")}}(tK(t))});else{if(!s.contentType)throw Error("If the attachment is not an image or text, it must specify a content type");n.push({type:"file",data:t,mimeType:s.contentType})}break}default:throw Error(`Unsupported URL protocol: ${e.protocol}`)}}return n}(i)]:r});break;case"assistant":if(null==s){n.push({role:"assistant",content:r});break}n.push({role:"assistant",content:[{type:"text",text:r},...s.map(({toolCallId:e,toolName:t,args:r})=>({type:"tool-call",toolCallId:e,toolName:t,args:r}))]}),n.push({role:"tool",content:s.map(e=>{if(!("result"in e))throw new rd({originalMessage:t,message:"ToolInvocation must have a result: "+JSON.stringify(e)});let{toolCallId:r,toolName:n,result:s}=e,i=a[n];return(null==i?void 0:i.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:r,toolName:n,result:i.experimental_toToolResultContent(s),experimental_content:i.experimental_toToolResultContent(s)}:{type:"tool-result",toolCallId:r,toolName:n,result:s}})});break;case"function":case"data":case"tool":break;default:throw new rd({originalMessage:t,message:`Unsupported role: ${e}`})}}return n}(e.messages,{tools:t}):e.messages,n=td({value:a,schema:z.IX(ri)});if(!n.success)throw new e0({prompt:e,message:"messages must be an array of CoreMessage or UIMessage",cause:n.error});return{type:"messages",messages:a,system:e.system}}throw Error("unreachable")}({prompt:{system:a,prompt:n,messages:s},tools:t});return tO({name:"ai.streamText",attributes:t$({telemetry:p,attributes:{...tI({operationId:"ai.streamText",telemetry:p}),...k,"ai.prompt":{input:()=>JSON.stringify({system:a,prompt:n,messages:s})},"ai.settings.maxSteps":c}}),tracer:S,endWhenDone:!1,fn:async a=>{let n=tT({maxRetries:i}),s=async({responseMessages:a})=>{let s=0===a.length?I.type:"messages",i=await tY({prompt:{type:s,system:I.system,messages:[...I.messages,...a]},modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:e.supportsUrl}),u={type:"regular",...function({tools:e,toolChoice:t,activeTools:r}){return null!=e&&Object.keys(e).length>0?{tools:(null!=r?Object.entries(e).filter(([e])=>r.includes(e)):Object.entries(e)).map(([e,t])=>{let r=t.type;switch(r){case void 0:case"function":return{type:"function",name:e,description:t.description,parameters:eM(t.parameters).jsonSchema};case"provider-defined":return{type:"provider-defined",name:e,id:t.id,args:t.args};default:throw Error(`Unsupported tool type: ${r}`)}}),toolChoice:null==t?{type:"auto"}:"string"==typeof t?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}({tools:t,toolChoice:r,activeTools:f})},{result:{stream:c,warnings:d,rawResponse:g,request:y},doStreamSpan:v,startTimestampMs:b}=await n(()=>tO({name:"ai.streamText.doStream",attributes:t$({telemetry:p,attributes:{...tI({operationId:"ai.streamText.doStream",telemetry:p}),...k,"ai.prompt.format":{input:()=>s},"ai.prompt.messages":{input:()=>JSON.stringify(i)},"ai.prompt.tools":{input:()=>{var e;return null==(e=u.tools)?void 0:e.map(e=>JSON.stringify(e))}},"ai.prompt.toolChoice":{input:()=>null!=u.toolChoice?JSON.stringify(u.toolChoice):void 0},"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":w.frequencyPenalty,"gen_ai.request.max_tokens":w.maxTokens,"gen_ai.request.presence_penalty":w.presencePenalty,"gen_ai.request.stop_sequences":w.stopSequences,"gen_ai.request.temperature":w.temperature,"gen_ai.request.top_k":w.topK,"gen_ai.request.top_p":w.topP}}),tracer:S,endWhenDone:!1,fn:async t=>({startTimestampMs:_(),doStreamSpan:t,result:await e.doStream({mode:u,...function({maxTokens:e,temperature:t,topP:r,topK:a,presencePenalty:n,frequencyPenalty:s,stopSequences:i,seed:o,maxRetries:l}){if(null!=e){if(!Number.isInteger(e))throw new t4({parameter:"maxTokens",value:e,message:"maxTokens must be an integer"});if(e<1)throw new t4({parameter:"maxTokens",value:e,message:"maxTokens must be >= 1"})}if(null!=t&&"number"!=typeof t)throw new t4({parameter:"temperature",value:t,message:"temperature must be a number"});if(null!=r&&"number"!=typeof r)throw new t4({parameter:"topP",value:r,message:"topP must be a number"});if(null!=a&&"number"!=typeof a)throw new t4({parameter:"topK",value:a,message:"topK must be a number"});if(null!=n&&"number"!=typeof n)throw new t4({parameter:"presencePenalty",value:n,message:"presencePenalty must be a number"});if(null!=s&&"number"!=typeof s)throw new t4({parameter:"frequencyPenalty",value:s,message:"frequencyPenalty must be a number"});if(null!=o&&!Number.isInteger(o))throw new t4({parameter:"seed",value:o,message:"seed must be an integer"});if(null!=l){if(!Number.isInteger(l))throw new t4({parameter:"maxRetries",value:l,message:"maxRetries must be an integer"});if(l<0)throw new t4({parameter:"maxRetries",value:l,message:"maxRetries must be >= 0"})}return{maxTokens:e,temperature:null!=t?t:0,topP:r,topK:a,presencePenalty:n,frequencyPenalty:s,stopSequences:null!=i&&i.length>0?i:void 0,seed:o,maxRetries:null!=l?l:2}}(w),inputFormat:s,prompt:i,providerMetadata:m,abortSignal:o,headers:l})})}));return{result:{stream:function({tools:e,generatorStream:t,toolCallStreaming:r,tracer:a,telemetry:n,abortSignal:s}){let i,o=null,l=new ReadableStream({start(e){o=e}}),u={},c=new Set,d=!1;function p(){d&&0===c.size&&(null!=i&&o.enqueue(i),o.close())}let m=new TransformStream({transform(t,l){let d=t.type;switch(d){case"text-delta":case"response-metadata":case"error":l.enqueue(t);break;case"tool-call-delta":r&&(u[t.toolCallId]||(l.enqueue({type:"tool-call-streaming-start",toolCallId:t.toolCallId,toolName:t.toolName}),u[t.toolCallId]=!0),l.enqueue({type:"tool-call-delta",toolCallId:t.toolCallId,toolName:t.toolName,argsTextDelta:t.argsTextDelta}));break;case"tool-call":{let r=t.toolName;if(null==e){o.enqueue({type:"error",error:new rC({toolName:t.toolName})});break}let i=e[r];if(null==i){o.enqueue({type:"error",error:new rC({toolName:t.toolName,availableTools:Object.keys(e)})});break}try{let r=function({toolCall:e,tools:t}){let r=e.toolName;if(null==t)throw new rC({toolName:e.toolName});let a=t[r];if(null==a)throw new rC({toolName:e.toolName,availableTools:Object.keys(t)});let n=eM(a.parameters),s=""===e.args.trim()?td({value:{},schema:n}):function({text:e,schema:t}){try{let r=T.parse(e);if(null==t)return{success:!0,value:r};return td({value:r,schema:t})}catch(t){return{success:!1,error:e2.isJSONParseError(t)?t:new e2({text:e,cause:t})}}}({text:e.args,schema:n});if(!1===s.success)throw new rS({toolName:r,toolArgs:e.args,cause:s.error});return{type:"tool-call",toolCallId:e.toolCallId,toolName:r,args:s.value}}({toolCall:t,tools:e});if(l.enqueue(r),null!=i.execute){let e=Z();c.add(e),tO({name:"ai.toolCall",attributes:t$({telemetry:n,attributes:{...tI({operationId:"ai.toolCall",telemetry:n}),"ai.toolCall.name":r.toolName,"ai.toolCall.id":r.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(r.args)}}}),tracer:a,fn:async t=>i.execute(r.args,{abortSignal:s}).then(a=>{o.enqueue({...r,type:"tool-result",result:a}),c.delete(e),p();try{t.setAttributes(t$({telemetry:n,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(a)}}}))}catch(e){}},t=>{o.enqueue({type:"error",error:t}),c.delete(e),p()})})}}catch(e){o.enqueue({type:"error",error:e})}break}case"finish":var m;i={type:"finish",finishReason:t.finishReason,logprobs:t.logprobs,usage:{promptTokens:(m=t.usage).promptTokens,completionTokens:m.completionTokens,totalTokens:m.promptTokens+m.completionTokens},experimental_providerMetadata:t.providerMetadata};break;default:throw Error(`Unhandled chunk type: ${d}`)}},flush(){d=!0,p()}});return new ReadableStream({start:async e=>Promise.all([t.pipeThrough(m).pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){}})),l.pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){e.close()}}))])})}({tools:t,generatorStream:c,toolCallStreaming:h,tracer:S,telemetry:p,abortSignal:o}),warnings:d,request:null!=y?y:{},rawResponse:g},doStreamSpan:v,startTimestampMs:b}},{result:{stream:u,warnings:A,rawResponse:E,request:C},doStreamSpan:N,startTimestampMs:R}=await s({responseMessages:[]});return new rP({stream:u,warnings:A,rawResponse:E,request:C,onChunk:g,onFinish:y,onStepFinish:v,rootSpan:a,doStreamSpan:N,telemetry:p,startTimestampMs:R,maxSteps:c,continueSteps:d,startStep:s,modelId:e.modelId,now:_,currentDate:x,generateId:b,tools:t})}})}var rP=class{constructor({stream:e,warnings:t,rawResponse:r,request:a,onChunk:n,onFinish:s,onStepFinish:i,rootSpan:o,doStreamSpan:l,telemetry:u,startTimestampMs:c,maxSteps:d,continueSteps:p,startStep:m,modelId:h,now:f,currentDate:g,generateId:y,tools:v}){this.warnings=t,this.rawResponse=r;let{resolve:_,promise:b}=rv();this.usage=b;let{resolve:x,promise:w}=rv();this.finishReason=w;let{resolve:k,promise:T}=rv();this.text=T;let{resolve:S,promise:I}=rv();this.toolCalls=I;let{resolve:A,promise:E}=rv();this.toolResults=E;let{resolve:C,promise:N}=rv();this.steps=N;let{resolve:R,promise:O}=rv();this.experimental_providerMetadata=O;let{resolve:$,promise:P}=rv();this.request=P;let{resolve:Z,promise:j}=rv();this.response=j;let{resolve:M,promise:L}=rv();this.responseMessages=L;let{stream:q,addStream:D,close:F}=function(){let e=[],t=null,r=!1,a=async()=>{if(r&&0===e.length){null==t||t.close();return}if(0!==e.length)try{let{value:n,done:s}=await e[0].read();s?(e.shift(),e.length>0?await a():r&&(null==t||t.close())):null==t||t.enqueue(n)}catch(a){null==t||t.error(a),e.shift(),r&&0===e.length&&(null==t||t.close())}};return{stream:new ReadableStream({start(e){t=e},pull:a,async cancel(){for(let t of e)await t.cancel();e=[],r=!0}}),addStream:t=>{if(r)throw Error("Cannot add inner stream: outer stream is closed");e.push(t.getReader())},close:()=>{r=!0,0===e.length&&(null==t||t.close())}}}();this.originalStream=q;let U=[],z=this;!function e({stream:a,startTimestamp:l,doStreamSpan:c,currentStep:b,responseMessages:w,usage:T={promptTokens:0,completionTokens:0,totalTokens:0},stepType:I,previousStepText:E="",stepRequest:N,hasLeadingWhitespace:O}){let P,j;let L=[],q=[],B="unknown",J={promptTokens:0,completionTokens:0,totalTokens:0},V=!0,K="",H="continue"===I?E:"",W={id:y(),timestamp:g(),modelId:h},G="",X=!1,Y=!0,Q=!1;async function ee({controller:e,chunk:t}){e.enqueue(t),K+=t.textDelta,H+=t.textDelta,X=!0,Q=t.textDelta.trimEnd()!==t.textDelta,await (null==n?void 0:n({chunk:t}))}D(a.pipeThrough(new TransformStream({async transform(e,t){var r,a,s;if(V){let e=f()-l;V=!1,c.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":e,"ai.stream.msToFirstChunk":e}),c.setAttributes({"ai.response.msToFirstChunk":e,"ai.stream.msToFirstChunk":e})}if("text-delta"===e.type&&0===e.textDelta.length)return;let i=e.type;switch(i){case"text-delta":if(p){let r=Y&&O?e.textDelta.trimStart():e.textDelta;if(0===r.length)break;Y=!1;let a=function(e){let t=e.match(rN);return t?{prefix:t[1],whitespace:t[2],suffix:t[3]}:void 0}(G+=r);null!=a&&(G=a.suffix,await ee({controller:t,chunk:{type:"text-delta",textDelta:a.prefix+a.whitespace}}))}else await ee({controller:t,chunk:e});break;case"tool-call":t.enqueue(e),L.push(e),await (null==n?void 0:n({chunk:e}));break;case"tool-result":t.enqueue(e),q.push(e),await (null==n?void 0:n({chunk:e}));break;case"response-metadata":W={id:null!=(r=e.id)?r:W.id,timestamp:null!=(a=e.timestamp)?a:W.timestamp,modelId:null!=(s=e.modelId)?s:W.modelId};break;case"finish":{J=e.usage,B=e.finishReason,P=e.experimental_providerMetadata,j=e.logprobs;let t=f()-l;c.addEvent("ai.stream.finish"),c.setAttributes({"ai.response.msToFinish":t,"ai.response.avgCompletionTokensPerSecond":1e3*J.completionTokens/t});break}case"tool-call-streaming-start":case"tool-call-delta":t.enqueue(e),await (null==n?void 0:n({chunk:e}));break;case"error":t.enqueue(e),B="error";break;default:throw Error(`Unknown chunk type: ${i}`)}},async flush(a){var n;let l=L.length>0?JSON.stringify(L):void 0,h="done";b+1<d&&(p&&"length"===B&&0===L.length?h="continue":L.length>0&&q.length===L.length&&(h="tool-result")),p&&G.length>0&&("continue"!==h||"continue"===I&&!X)&&(await ee({controller:a,chunk:{type:"text-delta",textDelta:G}}),G="");try{c.setAttributes(t$({telemetry:u,attributes:{"ai.response.finishReason":B,"ai.response.text":{output:()=>K},"ai.response.toolCalls":{output:()=>l},"ai.response.id":W.id,"ai.response.model":W.modelId,"ai.response.timestamp":W.timestamp.toISOString(),"ai.usage.promptTokens":J.promptTokens,"ai.usage.completionTokens":J.completionTokens,"ai.finishReason":B,"ai.result.text":{output:()=>K},"ai.result.toolCalls":{output:()=>l},"gen_ai.response.finish_reasons":[B],"gen_ai.response.id":W.id,"gen_ai.response.model":W.modelId,"gen_ai.usage.input_tokens":J.promptTokens,"gen_ai.usage.output_tokens":J.completionTokens}}))}catch(e){}finally{c.end()}if(a.enqueue({type:"step-finish",finishReason:B,usage:J,experimental_providerMetadata:P,logprobs:j,response:{...W},isContinued:"continue"===h}),"continue"===I){let e=w[w.length-1];"string"==typeof e.content?e.content+=K:e.content.push({text:K,type:"text"})}else w.push(...function({text:e="",tools:t,toolCalls:r,toolResults:a}){let n=[];return n.push({role:"assistant",content:[{type:"text",text:e},...r]}),a.length>0&&n.push({role:"tool",content:a.map(e=>{let r=t[e.toolName];return(null==r?void 0:r.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:r.experimental_toToolResultContent(e.result),experimental_content:r.experimental_toToolResultContent(e.result)}:{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:e.result}})}),n}({text:K,tools:null!=v?v:{},toolCalls:L,toolResults:q}));let f={stepType:I,text:K,toolCalls:L,toolResults:q,finishReason:B,usage:J,warnings:z.warnings,logprobs:j,request:N,rawResponse:z.rawResponse,response:{...W,headers:null==(n=z.rawResponse)?void 0:n.headers,messages:JSON.parse(JSON.stringify(w))},experimental_providerMetadata:P,isContinued:"continue"===h};U.push(f),await (null==i?void 0:i(f));let g={promptTokens:T.promptTokens+J.promptTokens,completionTokens:T.completionTokens+J.completionTokens,totalTokens:T.totalTokens+J.totalTokens};if("done"!==h){let{result:t,doStreamSpan:r,startTimestampMs:a}=await m({responseMessages:w});z.warnings=t.warnings,z.rawResponse=t.rawResponse,e({stream:t.stream,startTimestamp:a,doStreamSpan:r,currentStep:b+1,responseMessages:w,usage:g,stepType:h,previousStepText:H,stepRequest:t.request,hasLeadingWhitespace:Q});return}try{a.enqueue({type:"finish",finishReason:B,usage:g,experimental_providerMetadata:P,logprobs:j,response:{...W}}),F(),o.setAttributes(t$({telemetry:u,attributes:{"ai.response.finishReason":B,"ai.response.text":{output:()=>H},"ai.response.toolCalls":{output:()=>l},"ai.usage.promptTokens":g.promptTokens,"ai.usage.completionTokens":g.completionTokens,"ai.finishReason":B,"ai.result.text":{output:()=>H},"ai.result.toolCalls":{output:()=>l}}})),_(g),x(B),k(H),S(L),R(P),A(q),$(N),Z({...W,headers:null==r?void 0:r.headers,messages:w}),C(U),M(w),await (null==s?void 0:s({finishReason:B,logprobs:j,usage:g,text:H,toolCalls:L,toolResults:q,request:N,rawResponse:r,response:{...W,headers:null==r?void 0:r.headers,messages:w},warnings:t,experimental_providerMetadata:P,steps:U,responseMessages:w}))}catch(e){a.error(e)}finally{o.end()}}})))}({stream:e,startTimestamp:c,doStreamSpan:l,currentStep:0,responseMessages:[],usage:void 0,stepType:"initial",stepRequest:a,hasLeadingWhitespace:!1})}teeStream(){let[e,t]=this.originalStream.tee();return this.originalStream=t,e}get textStream(){return ry(this.teeStream(),{transform(e,t){"text-delta"===e.type?t.enqueue(e.textDelta):"error"===e.type&&t.error(e.error)}})}get fullStream(){return ry(this.teeStream(),{transform(e,t){t.enqueue(e)}})}toAIStream(e={}){return this.toDataStreamInternal({callbacks:e})}toDataStreamInternal({callbacks:e={},getErrorMessage:t=()=>"",sendUsage:r=!0}={}){let a="",n=new TransformStream({async start(){e.onStart&&await e.onStart()},async transform(t,r){if(r.enqueue(t),"text-delta"===t.type){let r=t.textDelta;a+=r,e.onToken&&await e.onToken(r),e.onText&&await e.onText(r)}},async flush(){e.onCompletion&&await e.onCompletion(a),e.onFinal&&await e.onFinal(a)}}),s=new TransformStream({transform:async(e,a)=>{let n=e.type;switch(n){case"text-delta":a.enqueue(eZ("text",e.textDelta));break;case"tool-call-streaming-start":a.enqueue(eZ("tool_call_streaming_start",{toolCallId:e.toolCallId,toolName:e.toolName}));break;case"tool-call-delta":a.enqueue(eZ("tool_call_delta",{toolCallId:e.toolCallId,argsTextDelta:e.argsTextDelta}));break;case"tool-call":a.enqueue(eZ("tool_call",{toolCallId:e.toolCallId,toolName:e.toolName,args:e.args}));break;case"tool-result":a.enqueue(eZ("tool_result",{toolCallId:e.toolCallId,result:e.result}));break;case"error":a.enqueue(eZ("error",t(e.error)));break;case"step-finish":a.enqueue(eZ("finish_step",{finishReason:e.finishReason,usage:r?{promptTokens:e.usage.promptTokens,completionTokens:e.usage.completionTokens}:void 0,isContinued:e.isContinued}));break;case"finish":a.enqueue(eZ("finish_message",{finishReason:e.finishReason,usage:r?{promptTokens:e.usage.promptTokens,completionTokens:e.usage.completionTokens}:void 0}));break;default:throw Error(`Unknown chunk type: ${n}`)}}});return this.fullStream.pipeThrough(n).pipeThrough(s).pipeThrough(new TextEncoderStream)}pipeAIStreamToResponse(e,t){return this.pipeDataStreamToResponse(e,t)}pipeDataStreamToResponse(e,t){let r=null==t?void 0:"init"in t?t.init:{headers:"headers"in t?t.headers:void 0,status:"status"in t?t.status:void 0,statusText:"statusText"in t?t.statusText:void 0},a=null==t?void 0:"data"in t?t.data:void 0,n=null==t?void 0:"getErrorMessage"in t?t.getErrorMessage:void 0,s=null==t?void 0:"sendUsage"in t?t.sendUsage:void 0;rx({response:e,status:null==r?void 0:r.status,statusText:null==r?void 0:r.statusText,headers:rb(r,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"}),stream:this.toDataStream({data:a,getErrorMessage:n,sendUsage:s})})}pipeTextStreamToResponse(e,t){rx({response:e,status:null==t?void 0:t.status,statusText:null==t?void 0:t.statusText,headers:rb(t,{contentType:"text/plain; charset=utf-8"}),stream:this.textStream.pipeThrough(new TextEncoderStream)})}toAIStreamResponse(e){return this.toDataStreamResponse(e)}toDataStream(e){let t=this.toDataStreamInternal({getErrorMessage:null==e?void 0:e.getErrorMessage,sendUsage:null==e?void 0:e.sendUsage});return(null==e?void 0:e.data)?rR(null==e?void 0:e.data.stream,t):t}toDataStreamResponse(e){var t;let r=null==e?void 0:"init"in e?e.init:{headers:"headers"in e?e.headers:void 0,status:"status"in e?e.status:void 0,statusText:"statusText"in e?e.statusText:void 0},a=null==e?void 0:"data"in e?e.data:void 0,n=null==e?void 0:"getErrorMessage"in e?e.getErrorMessage:void 0,s=null==e?void 0:"sendUsage"in e?e.sendUsage:void 0;return new Response(this.toDataStream({data:a,getErrorMessage:n,sendUsage:s}),{status:null!=(t=null==r?void 0:r.status)?t:200,statusText:null==r?void 0:r.statusText,headers:rp(r,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}toTextStreamResponse(e){var t;return new Response(this.textStream.pipeThrough(new TextEncoderStream),{status:null!=(t=null==e?void 0:e.status)?t:200,headers:rp(e,{contentType:"text/plain; charset=utf-8"})})}},rZ="AI_NoSuchProviderError",rj=`vercel.ai.error.${rZ}`;function rM(e){let t=new TextEncoder,r="",a=e||{};return new TransformStream({async start(){a.onStart&&await a.onStart()},async transform(e,n){let s="string"==typeof e?e:e.content;n.enqueue(t.encode(s)),r+=s,a.onToken&&await a.onToken(s),a.onText&&"string"==typeof e&&await a.onText(e)},async flush(){a.onCompletion&&await a.onCompletion(r),!a.onFinal||"experimental_onFunctionCall"in a||await a.onFinal(r)}})}k=Symbol.for(rj);function rL(){let e=new TextEncoder,t=new TextDecoder;return new TransformStream({transform:async(r,a)=>{let n=t.decode(r);a.enqueue(e.encode(eZ("text",n)))}})}new TextDecoder("utf-8");function rq(e,t){return rD(e,t)}function rD(e,t){return e.pipeThrough(new TransformStream({transform:async(e,t)=>{var r;if("string"==typeof e){t.enqueue(e);return}if("event"in e){"on_chat_model_stream"===e.event&&rU(null==(r=e.data)?void 0:r.chunk,t);return}rU(e,t)}})).pipeThrough(rM(t)).pipeThrough(rL())}function rF(e,t){var r;let a=rD(e,null==t?void 0:t.callbacks),n=null==t?void 0:t.data,s=null==t?void 0:t.init;return new Response(n?rR(n.stream,a):a,{status:null!=(r=null==s?void 0:s.status)?r:200,statusText:null==s?void 0:s.statusText,headers:rp(s,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function rU(e,t){if("string"==typeof e.content)t.enqueue(e.content);else for(let r of e.content)"text"===r.type&&t.enqueue(r.text)}function rz(e,t){return(function(e){let t;let r=e[Symbol.asyncIterator](),a=(t=!0,e=>(t&&(e=e.trimStart())&&(t=!1),e));return new ReadableStream({async pull(e){var t;let{value:n,done:s}=await r.next();if(s){e.close();return}let i=a(null!=(t=n.delta)?t:"");i&&e.enqueue(i)}})})(e).pipeThrough(rM(t)).pipeThrough(rL())}function rB(e,t={}){var r;let{init:a,data:n,callbacks:s}=t,i=rz(e,s);return new Response(n?rR(n.stream,i):i,{status:null!=(r=null==a?void 0:a.status)?r:200,statusText:null==a?void 0:a.statusText,headers:rp(a,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}tv({},{toAIStream:()=>rq,toDataStream:()=>rD,toDataStreamResponse:()=>rF}),tv({},{toDataStream:()=>rz,toDataStreamResponse:()=>rB});Symbol("internal_openai_fn_messages"),Response},3389:(e,t,r)=>{var a,n,s,i;let o;r.d(t,{pA:()=>i,Yj:()=>eZ,IX:()=>eM,O7:()=>e$,PG:()=>eC,Km:()=>ez,Pp:()=>eN,Vo:()=>eF,i0:()=>eU,lB:()=>eP,Rx:()=>eO,Ry:()=>eL,IM:()=>eD,Z_:()=>eR,G0:()=>eq,_4:()=>ej}),function(e){e.assertEqual=e=>{},e.assertIs=function(e){},e.assertNever=function(e){throw Error()},e.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},e.getValidEnumValues=t=>{let r=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),a={};for(let e of r)a[e]=t[e];return e.objectValues(a)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(let r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(a||(a={})),(n||(n={})).mergeShapes=(e,t)=>({...e,...t});let l=a.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),u=e=>{switch(typeof e){case"undefined":return l.undefined;case"string":return l.string;case"number":return Number.isNaN(e)?l.nan:l.number;case"boolean":return l.boolean;case"function":return l.function;case"bigint":return l.bigint;case"symbol":return l.symbol;case"object":if(Array.isArray(e))return l.array;if(null===e)return l.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return l.promise;if("undefined"!=typeof Map&&e instanceof Map)return l.map;if("undefined"!=typeof Set&&e instanceof Set)return l.set;if("undefined"!=typeof Date&&e instanceof Date)return l.date;return l.object;default:return l.unknown}},c=a.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class d extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},r={_errors:[]},a=e=>{for(let n of e.issues)if("invalid_union"===n.code)n.unionErrors.map(a);else if("invalid_return_type"===n.code)a(n.returnTypeError);else if("invalid_arguments"===n.code)a(n.argumentsError);else if(0===n.path.length)r._errors.push(t(n));else{let e=r,a=0;for(;a<n.path.length;){let r=n.path[a];a===n.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(n))):e[r]=e[r]||{_errors:[]},e=e[r],a++}}};return a(this),r}static assert(e){if(!(e instanceof d))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,a.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let a of this.issues)if(a.path.length>0){let r=a.path[0];t[r]=t[r]||[],t[r].push(e(a))}else r.push(e(a));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}d.create=e=>new d(e);let p=(e,t)=>{let r;switch(e.code){case c.invalid_type:r=e.received===l.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case c.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,a.jsonStringifyReplacer)}`;break;case c.unrecognized_keys:r=`Unrecognized key(s) in object: ${a.joinValues(e.keys,", ")}`;break;case c.invalid_union:r="Invalid input";break;case c.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${a.joinValues(e.options)}`;break;case c.invalid_enum_value:r=`Invalid enum value. Expected ${a.joinValues(e.options)}, received '${e.received}'`;break;case c.invalid_arguments:r="Invalid function arguments";break;case c.invalid_return_type:r="Invalid function return type";break;case c.invalid_date:r="Invalid date";break;case c.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:a.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case c.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"bigint"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case c.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case c.custom:r="Invalid input";break;case c.invalid_intersection_types:r="Intersection results could not be merged";break;case c.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case c.not_finite:r="Number must be finite";break;default:r=t.defaultError,a.assertNever(e)}return{message:r}};!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:e?.message}(s||(s={}));let m=e=>{let{data:t,path:r,errorMaps:a,issueData:n}=e,s=[...r,...n.path||[]],i={...n,path:s};if(void 0!==n.message)return{...n,path:s,message:n.message};let o="";for(let e of a.filter(e=>!!e).slice().reverse())o=e(i,{data:t,defaultError:o}).message;return{...n,path:s,message:o}};function h(e,t){let r=m({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,p,p==p?void 0:p].filter(e=>!!e)});e.common.issues.push(r)}class f{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let a of t){if("aborted"===a.status)return g;"dirty"===a.status&&e.dirty(),r.push(a.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let e of t){let t=await e.key,a=await e.value;r.push({key:t,value:a})}return f.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let a of t){let{key:t,value:n}=a;if("aborted"===t.status||"aborted"===n.status)return g;"dirty"===t.status&&e.dirty(),"dirty"===n.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==n.value||a.alwaysSet)&&(r[t.value]=n.value)}return{status:e.value,value:r}}}let g=Object.freeze({status:"aborted"}),y=e=>({status:"dirty",value:e}),v=e=>({status:"valid",value:e}),_=e=>"aborted"===e.status,b=e=>"dirty"===e.status,x=e=>"valid"===e.status,w=e=>"undefined"!=typeof Promise&&e instanceof Promise;class k{constructor(e,t,r,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let T=(e,t)=>{if(x(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new d(e.common.issues);return this._error=t,this._error}}};function S(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:a,description:n}=e;if(t&&(r||a))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:n}:{errorMap:(t,n)=>{let{message:s}=e;return"invalid_enum_value"===t.code?{message:s??n.defaultError}:void 0===n.data?{message:s??a??n.defaultError}:"invalid_type"!==t.code?{message:n.defaultError}:{message:s??r??n.defaultError}},description:n}}class I{get description(){return this._def.description}_getType(e){return u(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:u(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new f,ctx:{common:e.parent.common,data:e.data,parsedType:u(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(w(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){let r={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:u(e)},a=this._parseSync({data:e,path:r.path,parent:r});return T(r,a)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:u(e)};if(!this["~standard"].async)try{let r=this._parseSync({data:e,path:[],parent:t});return x(r)?{value:r.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>x(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:u(e)},a=this._parse({data:e,path:r.path,parent:r});return T(r,await (w(a)?a:Promise.resolve(a)))}refine(e,t){let r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,a)=>{let n=e(t),s=()=>a.addIssue({code:c.custom,...r(t)});return"undefined"!=typeof Promise&&n instanceof Promise?n.then(e=>!!e||(s(),!1)):!!n||(s(),!1)})}refinement(e,t){return this._refinement((r,a)=>!!e(r)||(a.addIssue("function"==typeof t?t(r,a):t),!1))}_refinement(e){return new e_({schema:this,typeName:i.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return eb.create(this,this._def)}nullable(){return ex.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return er.create(this)}promise(){return ev.create(this,this._def)}or(e){return en.create([this,e],this._def)}and(e){return eo.create(this,e,this._def)}transform(e){return new e_({...S(this._def),schema:this,typeName:i.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new ew({...S(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:i.ZodDefault})}brand(){return new eS({typeName:i.ZodBranded,type:this,...S(this._def)})}catch(e){return new ek({...S(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:i.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return eI.create(this,e)}readonly(){return eA.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let A=/^c[^\s-]{8,}$/i,E=/^[0-9a-z]+$/,C=/^[0-9A-HJKMNP-TV-Z]{26}$/i,N=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,R=/^[a-z0-9_-]{21}$/i,O=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,$=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,P=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Z=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,j=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,M=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,L=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,q=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,D=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,F="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",U=RegExp(`^${F}$`);function z(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);let r=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}class B extends I{_parse(e){var t,r,n,s;let i;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==l.string){let t=this._getOrReturnCtx(e);return h(t,{code:c.invalid_type,expected:l.string,received:t.parsedType}),g}let u=new f;for(let l of this._def.checks)if("min"===l.kind)e.data.length<l.value&&(h(i=this._getOrReturnCtx(e,i),{code:c.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),u.dirty());else if("max"===l.kind)e.data.length>l.value&&(h(i=this._getOrReturnCtx(e,i),{code:c.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),u.dirty());else if("length"===l.kind){let t=e.data.length>l.value,r=e.data.length<l.value;(t||r)&&(i=this._getOrReturnCtx(e,i),t?h(i,{code:c.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}):r&&h(i,{code:c.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}),u.dirty())}else if("email"===l.kind)P.test(e.data)||(h(i=this._getOrReturnCtx(e,i),{validation:"email",code:c.invalid_string,message:l.message}),u.dirty());else if("emoji"===l.kind)o||(o=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),o.test(e.data)||(h(i=this._getOrReturnCtx(e,i),{validation:"emoji",code:c.invalid_string,message:l.message}),u.dirty());else if("uuid"===l.kind)N.test(e.data)||(h(i=this._getOrReturnCtx(e,i),{validation:"uuid",code:c.invalid_string,message:l.message}),u.dirty());else if("nanoid"===l.kind)R.test(e.data)||(h(i=this._getOrReturnCtx(e,i),{validation:"nanoid",code:c.invalid_string,message:l.message}),u.dirty());else if("cuid"===l.kind)A.test(e.data)||(h(i=this._getOrReturnCtx(e,i),{validation:"cuid",code:c.invalid_string,message:l.message}),u.dirty());else if("cuid2"===l.kind)E.test(e.data)||(h(i=this._getOrReturnCtx(e,i),{validation:"cuid2",code:c.invalid_string,message:l.message}),u.dirty());else if("ulid"===l.kind)C.test(e.data)||(h(i=this._getOrReturnCtx(e,i),{validation:"ulid",code:c.invalid_string,message:l.message}),u.dirty());else if("url"===l.kind)try{new URL(e.data)}catch{h(i=this._getOrReturnCtx(e,i),{validation:"url",code:c.invalid_string,message:l.message}),u.dirty()}else"regex"===l.kind?(l.regex.lastIndex=0,l.regex.test(e.data)||(h(i=this._getOrReturnCtx(e,i),{validation:"regex",code:c.invalid_string,message:l.message}),u.dirty())):"trim"===l.kind?e.data=e.data.trim():"includes"===l.kind?e.data.includes(l.value,l.position)||(h(i=this._getOrReturnCtx(e,i),{code:c.invalid_string,validation:{includes:l.value,position:l.position},message:l.message}),u.dirty()):"toLowerCase"===l.kind?e.data=e.data.toLowerCase():"toUpperCase"===l.kind?e.data=e.data.toUpperCase():"startsWith"===l.kind?e.data.startsWith(l.value)||(h(i=this._getOrReturnCtx(e,i),{code:c.invalid_string,validation:{startsWith:l.value},message:l.message}),u.dirty()):"endsWith"===l.kind?e.data.endsWith(l.value)||(h(i=this._getOrReturnCtx(e,i),{code:c.invalid_string,validation:{endsWith:l.value},message:l.message}),u.dirty()):"datetime"===l.kind?(function(e){let t=`${F}T${z(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,RegExp(`^${t}$`)})(l).test(e.data)||(h(i=this._getOrReturnCtx(e,i),{code:c.invalid_string,validation:"datetime",message:l.message}),u.dirty()):"date"===l.kind?U.test(e.data)||(h(i=this._getOrReturnCtx(e,i),{code:c.invalid_string,validation:"date",message:l.message}),u.dirty()):"time"===l.kind?RegExp(`^${z(l)}$`).test(e.data)||(h(i=this._getOrReturnCtx(e,i),{code:c.invalid_string,validation:"time",message:l.message}),u.dirty()):"duration"===l.kind?$.test(e.data)||(h(i=this._getOrReturnCtx(e,i),{validation:"duration",code:c.invalid_string,message:l.message}),u.dirty()):"ip"===l.kind?(t=e.data,("v4"===(r=l.version)||!r)&&Z.test(t)||("v6"===r||!r)&&M.test(t)||(h(i=this._getOrReturnCtx(e,i),{validation:"ip",code:c.invalid_string,message:l.message}),u.dirty())):"jwt"===l.kind?!function(e,t){if(!O.test(e))return!1;try{let[r]=e.split(".");if(!r)return!1;let a=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),n=JSON.parse(atob(a));if("object"!=typeof n||null===n||"typ"in n&&n?.typ!=="JWT"||!n.alg||t&&n.alg!==t)return!1;return!0}catch{return!1}}(e.data,l.alg)&&(h(i=this._getOrReturnCtx(e,i),{validation:"jwt",code:c.invalid_string,message:l.message}),u.dirty()):"cidr"===l.kind?(n=e.data,("v4"===(s=l.version)||!s)&&j.test(n)||("v6"===s||!s)&&L.test(n)||(h(i=this._getOrReturnCtx(e,i),{validation:"cidr",code:c.invalid_string,message:l.message}),u.dirty())):"base64"===l.kind?q.test(e.data)||(h(i=this._getOrReturnCtx(e,i),{validation:"base64",code:c.invalid_string,message:l.message}),u.dirty()):"base64url"===l.kind?D.test(e.data)||(h(i=this._getOrReturnCtx(e,i),{validation:"base64url",code:c.invalid_string,message:l.message}),u.dirty()):a.assertNever(l);return{status:u.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:c.invalid_string,...s.errToObj(r)})}_addCheck(e){return new B({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...s.errToObj(e)})}url(e){return this._addCheck({kind:"url",...s.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...s.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...s.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...s.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...s.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...s.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...s.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...s.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...s.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...s.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...s.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...s.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...s.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...s.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...s.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...s.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...s.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...s.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...s.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...s.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...s.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...s.errToObj(t)})}nonempty(e){return this.min(1,s.errToObj(e))}trim(){return new B({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new B({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new B({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}B.create=e=>new B({checks:[],typeName:i.ZodString,coerce:e?.coerce??!1,...S(e)});class J extends I{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==l.number){let t=this._getOrReturnCtx(e);return h(t,{code:c.invalid_type,expected:l.number,received:t.parsedType}),g}let r=new f;for(let n of this._def.checks)"int"===n.kind?a.isInteger(e.data)||(h(t=this._getOrReturnCtx(e,t),{code:c.invalid_type,expected:"integer",received:"float",message:n.message}),r.dirty()):"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(h(t=this._getOrReturnCtx(e,t),{code:c.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(h(t=this._getOrReturnCtx(e,t),{code:c.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"multipleOf"===n.kind?0!==function(e,t){let r=(e.toString().split(".")[1]||"").length,a=(t.toString().split(".")[1]||"").length,n=r>a?r:a;return Number.parseInt(e.toFixed(n).replace(".",""))%Number.parseInt(t.toFixed(n).replace(".",""))/10**n}(e.data,n.value)&&(h(t=this._getOrReturnCtx(e,t),{code:c.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):"finite"===n.kind?Number.isFinite(e.data)||(h(t=this._getOrReturnCtx(e,t),{code:c.not_finite,message:n.message}),r.dirty()):a.assertNever(n);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,s.toString(t))}gt(e,t){return this.setLimit("min",e,!1,s.toString(t))}lte(e,t){return this.setLimit("max",e,!0,s.toString(t))}lt(e,t){return this.setLimit("max",e,!1,s.toString(t))}setLimit(e,t,r,a){return new J({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:s.toString(a)}]})}_addCheck(e){return new J({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:s.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:s.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:s.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:s.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:s.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:s.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:s.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:s.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:s.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&a.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}J.create=e=>new J({checks:[],typeName:i.ZodNumber,coerce:e?.coerce||!1,...S(e)});class V extends I{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==l.bigint)return this._getInvalidInput(e);let r=new f;for(let n of this._def.checks)"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(h(t=this._getOrReturnCtx(e,t),{code:c.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(h(t=this._getOrReturnCtx(e,t),{code:c.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"multipleOf"===n.kind?e.data%n.value!==BigInt(0)&&(h(t=this._getOrReturnCtx(e,t),{code:c.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):a.assertNever(n);return{status:r.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return h(t,{code:c.invalid_type,expected:l.bigint,received:t.parsedType}),g}gte(e,t){return this.setLimit("min",e,!0,s.toString(t))}gt(e,t){return this.setLimit("min",e,!1,s.toString(t))}lte(e,t){return this.setLimit("max",e,!0,s.toString(t))}lt(e,t){return this.setLimit("max",e,!1,s.toString(t))}setLimit(e,t,r,a){return new V({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:s.toString(a)}]})}_addCheck(e){return new V({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:s.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:s.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:s.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:s.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:s.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}V.create=e=>new V({checks:[],typeName:i.ZodBigInt,coerce:e?.coerce??!1,...S(e)});class K extends I{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==l.boolean){let t=this._getOrReturnCtx(e);return h(t,{code:c.invalid_type,expected:l.boolean,received:t.parsedType}),g}return v(e.data)}}K.create=e=>new K({typeName:i.ZodBoolean,coerce:e?.coerce||!1,...S(e)});class H extends I{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==l.date){let t=this._getOrReturnCtx(e);return h(t,{code:c.invalid_type,expected:l.date,received:t.parsedType}),g}if(Number.isNaN(e.data.getTime()))return h(this._getOrReturnCtx(e),{code:c.invalid_date}),g;let r=new f;for(let n of this._def.checks)"min"===n.kind?e.data.getTime()<n.value&&(h(t=this._getOrReturnCtx(e,t),{code:c.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),r.dirty()):"max"===n.kind?e.data.getTime()>n.value&&(h(t=this._getOrReturnCtx(e,t),{code:c.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),r.dirty()):a.assertNever(n);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new H({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:s.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:s.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}H.create=e=>new H({checks:[],coerce:e?.coerce||!1,typeName:i.ZodDate,...S(e)});class W extends I{_parse(e){if(this._getType(e)!==l.symbol){let t=this._getOrReturnCtx(e);return h(t,{code:c.invalid_type,expected:l.symbol,received:t.parsedType}),g}return v(e.data)}}W.create=e=>new W({typeName:i.ZodSymbol,...S(e)});class G extends I{_parse(e){if(this._getType(e)!==l.undefined){let t=this._getOrReturnCtx(e);return h(t,{code:c.invalid_type,expected:l.undefined,received:t.parsedType}),g}return v(e.data)}}G.create=e=>new G({typeName:i.ZodUndefined,...S(e)});class X extends I{_parse(e){if(this._getType(e)!==l.null){let t=this._getOrReturnCtx(e);return h(t,{code:c.invalid_type,expected:l.null,received:t.parsedType}),g}return v(e.data)}}X.create=e=>new X({typeName:i.ZodNull,...S(e)});class Y extends I{constructor(){super(...arguments),this._any=!0}_parse(e){return v(e.data)}}Y.create=e=>new Y({typeName:i.ZodAny,...S(e)});class Q extends I{constructor(){super(...arguments),this._unknown=!0}_parse(e){return v(e.data)}}Q.create=e=>new Q({typeName:i.ZodUnknown,...S(e)});class ee extends I{_parse(e){let t=this._getOrReturnCtx(e);return h(t,{code:c.invalid_type,expected:l.never,received:t.parsedType}),g}}ee.create=e=>new ee({typeName:i.ZodNever,...S(e)});class et extends I{_parse(e){if(this._getType(e)!==l.undefined){let t=this._getOrReturnCtx(e);return h(t,{code:c.invalid_type,expected:l.void,received:t.parsedType}),g}return v(e.data)}}et.create=e=>new et({typeName:i.ZodVoid,...S(e)});class er extends I{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),a=this._def;if(t.parsedType!==l.array)return h(t,{code:c.invalid_type,expected:l.array,received:t.parsedType}),g;if(null!==a.exactLength){let e=t.data.length>a.exactLength.value,n=t.data.length<a.exactLength.value;(e||n)&&(h(t,{code:e?c.too_big:c.too_small,minimum:n?a.exactLength.value:void 0,maximum:e?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(null!==a.minLength&&t.data.length<a.minLength.value&&(h(t,{code:c.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),null!==a.maxLength&&t.data.length>a.maxLength.value&&(h(t,{code:c.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>a.type._parseAsync(new k(t,e,t.path,r)))).then(e=>f.mergeArray(r,e));let n=[...t.data].map((e,r)=>a.type._parseSync(new k(t,e,t.path,r)));return f.mergeArray(r,n)}get element(){return this._def.type}min(e,t){return new er({...this._def,minLength:{value:e,message:s.toString(t)}})}max(e,t){return new er({...this._def,maxLength:{value:e,message:s.toString(t)}})}length(e,t){return new er({...this._def,exactLength:{value:e,message:s.toString(t)}})}nonempty(e){return this.min(1,e)}}er.create=(e,t)=>new er({type:e,minLength:null,maxLength:null,exactLength:null,typeName:i.ZodArray,...S(t)});class ea extends I{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=a.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==l.object){let t=this._getOrReturnCtx(e);return h(t,{code:c.invalid_type,expected:l.object,received:t.parsedType}),g}let{status:t,ctx:r}=this._processInputParams(e),{shape:a,keys:n}=this._getCached(),s=[];if(!(this._def.catchall instanceof ee&&"strip"===this._def.unknownKeys))for(let e in r.data)n.includes(e)||s.push(e);let i=[];for(let e of n){let t=a[e],n=r.data[e];i.push({key:{status:"valid",value:e},value:t._parse(new k(r,n,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof ee){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of s)i.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)s.length>0&&(h(r,{code:c.unrecognized_keys,keys:s}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of s){let a=r.data[t];i.push({key:{status:"valid",value:t},value:e._parse(new k(r,a,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of i){let r=await t.key,a=await t.value;e.push({key:r,value:a,alwaysSet:t.alwaysSet})}return e}).then(e=>f.mergeObjectSync(t,e)):f.mergeObjectSync(t,i)}get shape(){return this._def.shape()}strict(e){return s.errToObj,new ea({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{let a=this._def.errorMap?.(t,r).message??r.defaultError;return"unrecognized_keys"===t.code?{message:s.errToObj(e).message??a}:{message:a}}}:{}})}strip(){return new ea({...this._def,unknownKeys:"strip"})}passthrough(){return new ea({...this._def,unknownKeys:"passthrough"})}extend(e){return new ea({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ea({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:i.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ea({...this._def,catchall:e})}pick(e){let t={};for(let r of a.objectKeys(e))e[r]&&this.shape[r]&&(t[r]=this.shape[r]);return new ea({...this._def,shape:()=>t})}omit(e){let t={};for(let r of a.objectKeys(this.shape))e[r]||(t[r]=this.shape[r]);return new ea({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof ea){let r={};for(let a in t.shape){let n=t.shape[a];r[a]=eb.create(e(n))}return new ea({...t._def,shape:()=>r})}return t instanceof er?new er({...t._def,type:e(t.element)}):t instanceof eb?eb.create(e(t.unwrap())):t instanceof ex?ex.create(e(t.unwrap())):t instanceof el?el.create(t.items.map(t=>e(t))):t}(this)}partial(e){let t={};for(let r of a.objectKeys(this.shape)){let a=this.shape[r];e&&!e[r]?t[r]=a:t[r]=a.optional()}return new ea({...this._def,shape:()=>t})}required(e){let t={};for(let r of a.objectKeys(this.shape))if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof eb;)e=e._def.innerType;t[r]=e}return new ea({...this._def,shape:()=>t})}keyof(){return ef(a.objectKeys(this.shape))}}ea.create=(e,t)=>new ea({shape:()=>e,unknownKeys:"strip",catchall:ee.create(),typeName:i.ZodObject,...S(t)}),ea.strictCreate=(e,t)=>new ea({shape:()=>e,unknownKeys:"strict",catchall:ee.create(),typeName:i.ZodObject,...S(t)}),ea.lazycreate=(e,t)=>new ea({shape:e,unknownKeys:"strip",catchall:ee.create(),typeName:i.ZodObject,...S(t)});class en extends I{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new d(e.ctx.common.issues));return h(t,{code:c.invalid_union,unionErrors:r}),g});{let e;let a=[];for(let n of r){let r={...t,common:{...t.common,issues:[]},parent:null},s=n._parseSync({data:t.data,path:t.path,parent:r});if("valid"===s.status)return s;"dirty"!==s.status||e||(e={result:s,ctx:r}),r.common.issues.length&&a.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let n=a.map(e=>new d(e));return h(t,{code:c.invalid_union,unionErrors:n}),g}}get options(){return this._def.options}}en.create=(e,t)=>new en({options:e,typeName:i.ZodUnion,...S(t)});let es=e=>{if(e instanceof em)return es(e.schema);if(e instanceof e_)return es(e.innerType());if(e instanceof eh)return[e.value];if(e instanceof eg)return e.options;if(e instanceof ey)return a.objectValues(e.enum);if(e instanceof ew)return es(e._def.innerType);if(e instanceof G)return[void 0];else if(e instanceof X)return[null];else if(e instanceof eb)return[void 0,...es(e.unwrap())];else if(e instanceof ex)return[null,...es(e.unwrap())];else if(e instanceof eS)return es(e.unwrap());else if(e instanceof eA)return es(e.unwrap());else if(e instanceof ek)return es(e._def.innerType);else return[]};class ei extends I{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==l.object)return h(t,{code:c.invalid_type,expected:l.object,received:t.parsedType}),g;let r=this.discriminator,a=t.data[r],n=this.optionsMap.get(a);return n?t.common.async?n._parseAsync({data:t.data,path:t.path,parent:t}):n._parseSync({data:t.data,path:t.path,parent:t}):(h(t,{code:c.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),g)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let a=new Map;for(let r of t){let t=es(r.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let n of t){if(a.has(n))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(n)}`);a.set(n,r)}}return new ei({typeName:i.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a,...S(r)})}}class eo extends I{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),n=(e,n)=>{if(_(e)||_(n))return g;let s=function e(t,r){let n=u(t),s=u(r);if(t===r)return{valid:!0,data:t};if(n===l.object&&s===l.object){let n=a.objectKeys(r),s=a.objectKeys(t).filter(e=>-1!==n.indexOf(e)),i={...t,...r};for(let a of s){let n=e(t[a],r[a]);if(!n.valid)return{valid:!1};i[a]=n.data}return{valid:!0,data:i}}if(n===l.array&&s===l.array){if(t.length!==r.length)return{valid:!1};let a=[];for(let n=0;n<t.length;n++){let s=e(t[n],r[n]);if(!s.valid)return{valid:!1};a.push(s.data)}return{valid:!0,data:a}}return n===l.date&&s===l.date&&+t==+r?{valid:!0,data:t}:{valid:!1}}(e.value,n.value);return s.valid?((b(e)||b(n))&&t.dirty(),{status:t.value,value:s.data}):(h(r,{code:c.invalid_intersection_types}),g)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>n(e,t)):n(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}eo.create=(e,t,r)=>new eo({left:e,right:t,typeName:i.ZodIntersection,...S(r)});class el extends I{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==l.array)return h(r,{code:c.invalid_type,expected:l.array,received:r.parsedType}),g;if(r.data.length<this._def.items.length)return h(r,{code:c.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),g;!this._def.rest&&r.data.length>this._def.items.length&&(h(r,{code:c.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let a=[...r.data].map((e,t)=>{let a=this._def.items[t]||this._def.rest;return a?a._parse(new k(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(a).then(e=>f.mergeArray(t,e)):f.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new el({...this._def,rest:e})}}el.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new el({items:e,typeName:i.ZodTuple,rest:null,...S(t)})};class eu extends I{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==l.object)return h(r,{code:c.invalid_type,expected:l.object,received:r.parsedType}),g;let a=[],n=this._def.keyType,s=this._def.valueType;for(let e in r.data)a.push({key:n._parse(new k(r,e,r.path,e)),value:s._parse(new k(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?f.mergeObjectAsync(t,a):f.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,r){return new eu(t instanceof I?{keyType:e,valueType:t,typeName:i.ZodRecord,...S(r)}:{keyType:B.create(),valueType:e,typeName:i.ZodRecord,...S(t)})}}class ec extends I{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==l.map)return h(r,{code:c.invalid_type,expected:l.map,received:r.parsedType}),g;let a=this._def.keyType,n=this._def.valueType,s=[...r.data.entries()].map(([e,t],s)=>({key:a._parse(new k(r,e,r.path,[s,"key"])),value:n._parse(new k(r,t,r.path,[s,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of s){let a=await r.key,n=await r.value;if("aborted"===a.status||"aborted"===n.status)return g;("dirty"===a.status||"dirty"===n.status)&&t.dirty(),e.set(a.value,n.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of s){let a=r.key,n=r.value;if("aborted"===a.status||"aborted"===n.status)return g;("dirty"===a.status||"dirty"===n.status)&&t.dirty(),e.set(a.value,n.value)}return{status:t.value,value:e}}}}ec.create=(e,t,r)=>new ec({valueType:t,keyType:e,typeName:i.ZodMap,...S(r)});class ed extends I{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==l.set)return h(r,{code:c.invalid_type,expected:l.set,received:r.parsedType}),g;let a=this._def;null!==a.minSize&&r.data.size<a.minSize.value&&(h(r,{code:c.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),null!==a.maxSize&&r.data.size>a.maxSize.value&&(h(r,{code:c.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());let n=this._def.valueType;function s(e){let r=new Set;for(let a of e){if("aborted"===a.status)return g;"dirty"===a.status&&t.dirty(),r.add(a.value)}return{status:t.value,value:r}}let i=[...r.data.values()].map((e,t)=>n._parse(new k(r,e,r.path,t)));return r.common.async?Promise.all(i).then(e=>s(e)):s(i)}min(e,t){return new ed({...this._def,minSize:{value:e,message:s.toString(t)}})}max(e,t){return new ed({...this._def,maxSize:{value:e,message:s.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}ed.create=(e,t)=>new ed({valueType:e,minSize:null,maxSize:null,typeName:i.ZodSet,...S(t)});class ep extends I{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==l.function)return h(t,{code:c.invalid_type,expected:l.function,received:t.parsedType}),g;function r(e,r){return m({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,p,p].filter(e=>!!e),issueData:{code:c.invalid_arguments,argumentsError:r}})}function a(e,r){return m({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,p,p].filter(e=>!!e),issueData:{code:c.invalid_return_type,returnTypeError:r}})}let n={errorMap:t.common.contextualErrorMap},s=t.data;if(this._def.returns instanceof ev){let e=this;return v(async function(...t){let i=new d([]),o=await e._def.args.parseAsync(t,n).catch(e=>{throw i.addIssue(r(t,e)),i}),l=await Reflect.apply(s,this,o);return await e._def.returns._def.type.parseAsync(l,n).catch(e=>{throw i.addIssue(a(l,e)),i})})}{let e=this;return v(function(...t){let i=e._def.args.safeParse(t,n);if(!i.success)throw new d([r(t,i.error)]);let o=Reflect.apply(s,this,i.data),l=e._def.returns.safeParse(o,n);if(!l.success)throw new d([a(o,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new ep({...this._def,args:el.create(e).rest(Q.create())})}returns(e){return new ep({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new ep({args:e||el.create([]).rest(Q.create()),returns:t||Q.create(),typeName:i.ZodFunction,...S(r)})}}class em extends I{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}em.create=(e,t)=>new em({getter:e,typeName:i.ZodLazy,...S(t)});class eh extends I{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return h(t,{received:t.data,code:c.invalid_literal,expected:this._def.value}),g}return{status:"valid",value:e.data}}get value(){return this._def.value}}function ef(e,t){return new eg({values:e,typeName:i.ZodEnum,...S(t)})}eh.create=(e,t)=>new eh({value:e,typeName:i.ZodLiteral,...S(t)});class eg extends I{_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return h(t,{expected:a.joinValues(r),received:t.parsedType,code:c.invalid_type}),g}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return h(t,{received:t.data,code:c.invalid_enum_value,options:r}),g}return v(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return eg.create(e,{...this._def,...t})}exclude(e,t=this._def){return eg.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}eg.create=ef;class ey extends I{_parse(e){let t=a.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==l.string&&r.parsedType!==l.number){let e=a.objectValues(t);return h(r,{expected:a.joinValues(e),received:r.parsedType,code:c.invalid_type}),g}if(this._cache||(this._cache=new Set(a.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let e=a.objectValues(t);return h(r,{received:r.data,code:c.invalid_enum_value,options:e}),g}return v(e.data)}get enum(){return this._def.values}}ey.create=(e,t)=>new ey({values:e,typeName:i.ZodNativeEnum,...S(t)});class ev extends I{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==l.promise&&!1===t.common.async?(h(t,{code:c.invalid_type,expected:l.promise,received:t.parsedType}),g):v((t.parsedType===l.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}ev.create=(e,t)=>new ev({type:e,typeName:i.ZodPromise,...S(t)});class e_ extends I{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===i.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),n=this._def.effect||null,s={addIssue:e=>{h(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(s.addIssue=s.addIssue.bind(s),"preprocess"===n.type){let e=n.transform(r.data,s);if(r.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return g;let a=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===a.status?g:"dirty"===a.status||"dirty"===t.value?y(a.value):a});{if("aborted"===t.value)return g;let a=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===a.status?g:"dirty"===a.status||"dirty"===t.value?y(a.value):a}}if("refinement"===n.type){let e=e=>{let t=n.refinement(e,s);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?g:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{let a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===a.status?g:("dirty"===a.status&&t.dirty(),e(a.value),{status:t.value,value:a.value})}}if("transform"===n.type){if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>x(e)?Promise.resolve(n.transform(e.value,s)).then(e=>({status:t.value,value:e})):g);{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!x(e))return g;let a=n.transform(e.value,s);if(a instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}}a.assertNever(n)}}e_.create=(e,t,r)=>new e_({schema:e,typeName:i.ZodEffects,effect:t,...S(r)}),e_.createWithPreprocess=(e,t,r)=>new e_({schema:t,effect:{type:"preprocess",transform:e},typeName:i.ZodEffects,...S(r)});class eb extends I{_parse(e){return this._getType(e)===l.undefined?v(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}eb.create=(e,t)=>new eb({innerType:e,typeName:i.ZodOptional,...S(t)});class ex extends I{_parse(e){return this._getType(e)===l.null?v(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ex.create=(e,t)=>new ex({innerType:e,typeName:i.ZodNullable,...S(t)});class ew extends I{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===l.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}ew.create=(e,t)=>new ew({innerType:e,typeName:i.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...S(t)});class ek extends I{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return w(a)?a.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new d(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new d(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}ek.create=(e,t)=>new ek({innerType:e,typeName:i.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...S(t)});class eT extends I{_parse(e){if(this._getType(e)!==l.nan){let t=this._getOrReturnCtx(e);return h(t,{code:c.invalid_type,expected:l.nan,received:t.parsedType}),g}return{status:"valid",value:e.data}}}eT.create=e=>new eT({typeName:i.ZodNaN,...S(e)}),Symbol("zod_brand");class eS extends I{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class eI extends I{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?g:"dirty"===e.status?(t.dirty(),y(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?g:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new eI({in:e,out:t,typeName:i.ZodPipeline})}}class eA extends I{_parse(e){let t=this._def.innerType._parse(e),r=e=>(x(e)&&(e.value=Object.freeze(e.value)),e);return w(t)?t.then(e=>r(e)):r(t)}unwrap(){return this._def.innerType}}function eE(e,t){let r="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof r?{message:r}:r}function eC(e,t={},r){return e?Y.create().superRefine((a,n)=>{let s=e(a);if(s instanceof Promise)return s.then(e=>{if(!e){let e=eE(t,a),s=e.fatal??r??!0;n.addIssue({code:"custom",...e,fatal:s})}});if(!s){let e=eE(t,a),s=e.fatal??r??!0;n.addIssue({code:"custom",...e,fatal:s})}}):Y.create()}eA.create=(e,t)=>new eA({innerType:e,typeName:i.ZodReadonly,...S(t)}),ea.lazycreate,function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(i||(i={}));let eN=(e,t={message:`Input not instance of ${e.name}`})=>eC(t=>t instanceof e,t),eR=B.create,eO=J.create;eT.create,V.create;let e$=K.create;H.create,W.create,G.create;let eP=X.create,eZ=Y.create,ej=Q.create;ee.create,et.create;let eM=er.create,eL=ea.create;ea.strictCreate;let eq=en.create;ei.create,eo.create,el.create;let eD=eu.create;ec.create,ed.create,ep.create;let eF=em.create,eU=eh.create,ez=eg.create;ey.create,ev.create,e_.create,eb.create,ex.create,e_.createWithPreprocess,eI.create}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[379,163,567],()=>r(539));module.exports=a})();