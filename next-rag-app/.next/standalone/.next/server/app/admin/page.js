(()=>{var e={};e.id=3,e.ids=[3],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},462:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>h,tree:()=>d}),s(8748),s(356),s(5866);var a=s(3191),r=s(8716),n=s(7922),i=s.n(n),l=s(5231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let d=["",{children:["admin",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,8748)),"/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/admin/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,356)),"/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/admin/page.tsx"],u="/admin/page",m={require:s,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/admin/page",pathname:"/admin",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},8108:(e,t,s)=>{Promise.resolve().then(s.bind(s,9010))},2303:(e,t,s)=>{Promise.resolve().then(s.bind(s,4690))},3649:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},9010:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var a=s(326),r=s(7577),n=s(4690),i=s(9523),l=s(434),o=s(165);let d=(0,s(2881).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);function c(){let{user:e,accessToken:t,loading:s}=(0,n.a)(),[c,u]=(0,r.useState)([]),[m,h]=(0,r.useState)([]),[p,x]=(0,r.useState)([]),[f,g]=(0,r.useState)(!0),[y,j]=(0,r.useState)(null),[b,v]=(0,r.useState)(""),[N,_]=(0,r.useState)(""),[w,k]=(0,r.useState)(null),[A,T]=(0,r.useState)(null),[S,P]=(0,r.useState)(!1),[C,U]=(0,r.useState)({email:"",password:"",first_name:"",last_name:"",role_id:2}),[D,H]=(0,r.useState)(!1),[E,q]=(0,r.useState)(null),[R,L]=(0,r.useState)(null),$=async()=>{try{g(!0);let[e,s,a]=await Promise.all([(0,i.yw)({accessToken:t,search:b}),(0,i.xv)(t),(0,i.ju)({accessToken:t,search_term:N,limit:50})]);u(Array.isArray(e?.users)?e.users:[]),h(Array.isArray(s)?s:[]),x(Array.isArray(a?.documents)?a.documents:[]),j(null)}catch(e){j(e.message||"Failed to load admin data")}finally{g(!1)}},F=async(e,s)=>{try{k(e);let a=await (0,i.Nq)(t,e,{role_id:s});u(t=>t.map(t=>t.id===e?a:t))}catch(e){alert(e.message)}finally{k(null)}},O=async(e,s)=>{try{k(e);let a=await (0,i.Nq)(t,e,{status:s});u(t=>t.map(t=>t.id===e?a:t))}catch(e){alert(e.message)}finally{k(null)}},G=async(e,s)=>{try{T(e);let a=await (0,i.ul)(t,e,{description:s});h(t=>t.map(t=>t.id===e?a:t))}catch(e){alert(e.message)}finally{T(null)}},M=async e=>{let s=c.find(t=>t.id===e);if(s&&confirm(`Delete user ${s.email}? This action cannot be undone.`))try{q(e),await (0,i.h8)(t,e),u(t=>t.filter(t=>t.id!==e))}catch(e){alert(e.message||"Failed to delete user")}finally{q(null)}},z=async e=>{let s=p.find(t=>t.id===e);if(s&&confirm(`Delete document "${s.file_name}"? This will remove all associated chunks and cannot be undone.`))try{L(e),await (0,i.iH)(t,e),x(t=>t.filter(t=>t.id!==e))}catch(e){alert(e.message||"Failed to delete document")}finally{L(null)}},I=async e=>{let s=p.find(t=>t.id===e);if(s)try{let a=await (0,i.AG)(t,e),r=window.URL.createObjectURL(a),n=document.createElement("a");n.href=r,n.download=s.file_name,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(r)}catch(e){alert(e.message||"Failed to download document")}},J=async e=>{if(e.preventDefault(),!C.email||!C.password){alert("Email and password are required");return}try{H(!0);let e=await (0,i.r4)(t,C);u(t=>[e,...t]),U({email:"",password:"",first_name:"",last_name:"",role_id:2}),P(!1),alert("User created successfully!")}catch(e){alert(e.message||"Failed to create user")}finally{H(!1)}};if(s||f)return a.jsx("div",{className:"flex items-center justify-center h-screen text-muted-foreground",children:"Loading..."});if(!e)return(0,a.jsxs)("div",{className:"p-8 text-center space-y-4",children:[a.jsx("h1",{className:"text-2xl font-semibold",children:"Authentication Required"}),a.jsx("p",{className:"text-muted-foreground",children:"You must be logged in to view this page."}),a.jsx(l.default,{href:"/login",className:"underline",children:"Go to Login"})]});if("admin"!==e.role_name)return(0,a.jsxs)("div",{className:"p-8 text-center space-y-4",children:[a.jsx("h1",{className:"text-2xl font-semibold",children:"Access Denied"}),a.jsx("p",{className:"text-muted-foreground",children:"You do not have permission to view administrative controls."}),a.jsx(l.default,{href:"/",className:"underline",children:"Return Home"})]});let B=Array.isArray(m)?m:[],Z=Array.isArray(c)?c:[];return(0,a.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,a.jsxs)("div",{className:"border-b p-4 flex items-center justify-between bg-muted/30",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx(l.default,{href:"/",className:"text-muted-foreground hover:text-foreground mr-2",children:"← Back"}),a.jsx(o.Z,{className:"h-5 w-5"}),a.jsx("h1",{className:"text-xl font-semibold",children:"Admin Dashboard"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx("input",{className:"border rounded px-2 py-1 text-sm",placeholder:"Search users",value:b,onChange:e=>v(e.target.value)}),a.jsx("input",{className:"border rounded px-2 py-1 text-sm",placeholder:"Search documents",value:N,onChange:e=>_(e.target.value)}),(0,a.jsxs)("button",{onClick:$,className:"inline-flex items-center gap-1 border rounded px-3 py-1 text-sm hover:bg-muted",children:[a.jsx(d,{className:"h-4 w-4"})," Refresh"]})]})]}),y&&a.jsx("div",{className:"p-4 text-sm text-red-600",children:y}),f?a.jsx("div",{className:"flex-1 flex items-center justify-center text-muted-foreground",children:"Loading..."}):(0,a.jsxs)("div",{className:"flex-1 overflow-auto p-6 space-y-10",children:[(0,a.jsxs)("section",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[a.jsx("h2",{className:"text-lg font-medium",children:"Users"}),a.jsx("button",{onClick:()=>P(!S),className:"px-3 py-1 bg-primary text-primary-foreground rounded text-sm hover:bg-primary/90",children:S?"Cancel":"Add User"})]}),S&&(0,a.jsxs)("div",{className:"mb-4 p-4 border rounded bg-muted/20",children:[a.jsx("h3",{className:"text-md font-medium mb-3",children:"Create New User"}),(0,a.jsxs)("form",{onSubmit:J,className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Email *"}),a.jsx("input",{type:"email",required:!0,value:C.email,onChange:e=>U(t=>({...t,email:e.target.value})),className:"w-full border rounded px-2 py-1 text-sm"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Password *"}),a.jsx("input",{type:"password",required:!0,value:C.password,onChange:e=>U(t=>({...t,password:e.target.value})),className:"w-full border rounded px-2 py-1 text-sm"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"First Name"}),a.jsx("input",{type:"text",value:C.first_name,onChange:e=>U(t=>({...t,first_name:e.target.value})),className:"w-full border rounded px-2 py-1 text-sm"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Last Name"}),a.jsx("input",{type:"text",value:C.last_name,onChange:e=>U(t=>({...t,last_name:e.target.value})),className:"w-full border rounded px-2 py-1 text-sm"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Role"}),a.jsx("select",{value:C.role_id,onChange:e=>U(t=>({...t,role_id:Number(e.target.value)})),className:"w-full border rounded px-2 py-1 text-sm",children:B.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))})]}),a.jsx("div",{className:"flex items-end",children:a.jsx("button",{type:"submit",disabled:D,className:"px-4 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700 disabled:opacity-50",children:D?"Creating...":"Create User"})})]})]}),a.jsx("div",{className:"overflow-x-auto border rounded",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[a.jsx("thead",{className:"bg-muted/50",children:(0,a.jsxs)("tr",{className:"text-left",children:[a.jsx("th",{className:"p-2",children:"ID"}),a.jsx("th",{className:"p-2",children:"Email"}),a.jsx("th",{className:"p-2",children:"Name"}),a.jsx("th",{className:"p-2",children:"Role"}),a.jsx("th",{className:"p-2",children:"Status"}),a.jsx("th",{className:"p-2",children:"Verified"}),a.jsx("th",{className:"p-2",children:"Updated"}),a.jsx("th",{className:"p-2",children:"Actions"})]})}),(0,a.jsxs)("tbody",{children:[Z.map(t=>(0,a.jsxs)("tr",{className:"border-t",children:[a.jsx("td",{className:"p-2 font-mono text-xs",children:t.id}),a.jsx("td",{className:"p-2",children:t.email}),a.jsx("td",{className:"p-2",children:t.full_name}),a.jsx("td",{className:"p-2",children:a.jsx("select",{className:"border rounded px-1 py-0.5 text-xs",value:t.role_id,disabled:w===t.id,onChange:e=>F(t.id,Number(e.target.value)),children:B.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))})}),a.jsx("td",{className:"p-2",children:(0,a.jsxs)("select",{className:"border rounded px-1 py-0.5 text-xs",value:t.status,disabled:w===t.id,onChange:e=>O(t.id,e.target.value),children:[a.jsx("option",{value:"active",children:"active"}),a.jsx("option",{value:"disabled",children:"disabled"}),a.jsx("option",{value:"pending",children:"pending"})]})}),a.jsx("td",{className:"p-2 text-center",children:t.verified?"✅":"❌"}),a.jsx("td",{className:"p-2 text-xs text-muted-foreground",children:t.updated_at?.replace("T"," ").substring(0,16)}),a.jsx("td",{className:"p-2",children:a.jsx("button",{onClick:()=>M(t.id),disabled:E===t.id||t.id===e.id,className:"text-xs px-2 py-0.5 rounded border border-red-600 text-red-600 hover:bg-red-600 hover:text-white disabled:opacity-40",title:t.id===e.id?"Cannot delete current logged in user":"Delete user",children:E===t.id?"Deleting...":"Delete"})})]},t.id)),0===c.length&&a.jsx("tr",{children:a.jsx("td",{colSpan:8,className:"p-4 text-center text-muted-foreground",children:"No users found."})})]})]})})]}),(0,a.jsxs)("section",{children:[a.jsx("h2",{className:"text-lg font-medium mb-3",children:"Roles"}),a.jsx("div",{className:"overflow-x-auto border rounded",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[a.jsx("thead",{className:"bg-muted/50",children:(0,a.jsxs)("tr",{className:"text-left",children:[a.jsx("th",{className:"p-2",children:"ID"}),a.jsx("th",{className:"p-2",children:"Name"}),a.jsx("th",{className:"p-2",children:"Description"}),a.jsx("th",{className:"p-2",children:"System"}),a.jsx("th",{className:"p-2",children:"Permissions"})]})}),a.jsx("tbody",{children:B.map(e=>(0,a.jsxs)("tr",{className:"border-t",children:[a.jsx("td",{className:"p-2 font-mono text-xs",children:e.id}),a.jsx("td",{className:"p-2 font-medium",children:e.name}),a.jsx("td",{className:"p-2",children:e.system?a.jsx("span",{className:"text-muted-foreground text-xs",children:e.description||"—"}):a.jsx("input",{className:"border rounded px-1 py-0.5 text-xs w-56",defaultValue:e.description||"",disabled:A===e.id,onBlur:t=>{t.target.value!==e.description&&G(e.id,t.target.value)}})}),a.jsx("td",{className:"p-2 text-center",children:e.system?"\uD83D\uDD12":""}),a.jsx("td",{className:"p-2 text-xs",children:(0,a.jsxs)("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(e.permissions||[]).map(e=>a.jsx("span",{className:"px-1.5 py-0.5 rounded bg-secondary text-[10px] tracking-wide uppercase",children:e},e)),(!e.permissions||0===e.permissions.length)&&a.jsx("span",{className:"text-muted-foreground",children:"—"})]})})]},e.id))})]})})]}),(0,a.jsxs)("section",{children:[a.jsx("h2",{className:"text-lg font-medium mb-3",children:"Documents"}),a.jsx("div",{className:"overflow-x-auto border rounded",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[a.jsx("thead",{className:"bg-muted/50",children:(0,a.jsxs)("tr",{className:"text-left",children:[a.jsx("th",{className:"p-2",children:"ID"}),a.jsx("th",{className:"p-2",children:"File Name"}),a.jsx("th",{className:"p-2",children:"Title"}),a.jsx("th",{className:"p-2",children:"Type"}),a.jsx("th",{className:"p-2",children:"Product"}),a.jsx("th",{className:"p-2",children:"Privacy"}),a.jsx("th",{className:"p-2",children:"Chunks"}),a.jsx("th",{className:"p-2",children:"Size"}),a.jsx("th",{className:"p-2",children:"Created"}),a.jsx("th",{className:"p-2",children:"Actions"})]})}),(0,a.jsxs)("tbody",{children:[p.map(e=>(0,a.jsxs)("tr",{className:"border-t",children:[a.jsx("td",{className:"p-2 font-mono text-xs",children:e.id}),a.jsx("td",{className:"p-2 max-w-xs truncate",title:e.file_name,children:e.file_name}),a.jsx("td",{className:"p-2 max-w-xs truncate",title:e.title||"",children:e.title||"—"}),a.jsx("td",{className:"p-2",children:e.document_type||"—"}),a.jsx("td",{className:"p-2",children:e.product_name||"—"}),a.jsx("td",{className:"p-2",children:a.jsx("span",{className:`px-1.5 py-0.5 rounded text-xs ${"public"===e.privacy_level?"bg-green-100 text-green-800":"internal"===e.privacy_level?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:e.privacy_level})}),a.jsx("td",{className:"p-2 text-center",children:e.chunk_count}),a.jsx("td",{className:"p-2 text-xs text-muted-foreground",children:e.file_size?`${(e.file_size/1024).toFixed(1)} KB`:"—"}),a.jsx("td",{className:"p-2 text-xs text-muted-foreground",children:new Date(e.created_at).toLocaleDateString()}),a.jsx("td",{className:"p-2",children:(0,a.jsxs)("div",{className:"flex gap-1",children:[a.jsx("button",{onClick:()=>I(e.id),className:"text-xs px-2 py-0.5 rounded border border-blue-600 text-blue-600 hover:bg-blue-600 hover:text-white",title:"Download document",children:"Download"}),a.jsx("button",{onClick:()=>z(e.id),disabled:R===e.id,className:"text-xs px-2 py-0.5 rounded border border-red-600 text-red-600 hover:bg-red-600 hover:text-white disabled:opacity-40",title:"Delete document",children:R===e.id?"Deleting...":"Delete"})]})})]},e.id)),0===p.length&&a.jsx("tr",{children:a.jsx("td",{colSpan:10,className:"p-4 text-center text-muted-foreground",children:"No documents found."})})]})]})})]})]})]})}},9523:(e,t,s)=>{"use strict";s.d(t,{AG:()=>j,Nq:()=>h,h8:()=>p,iH:()=>y,ju:()=>g,r4:()=>f,ul:()=>x,xv:()=>m,yw:()=>u});var a=s(7863);let r={active:"active",inactive:"disabled",suspended:"disabled",pending_verification:"pending"},n={active:"active",disabled:"inactive",pending:"pending_verification"};function i(e){if(!e)return null;let t=e.trim();return t.length?t:null}function l(e){let t="first_name"in e?e.first_name:null,s="last_name"in e?e.last_name:null,a=t?.trim()??"",n=s?.trim()??"",l=("full_name"in e?e.full_name?.trim()??"":"")||`${a} ${n}`.trim()||e.email,o=("string"==typeof e.status?e.status:void 0)??"active";return{id:e.id,email:e.email,first_name:i(t),last_name:i(s),role_id:function(e){if("number"==typeof e)return e;if("string"==typeof e){let t=Number.parseInt(e,10);if(Number.isFinite(t))return t}return 0}(e.role_id),role_name:e.role_name??"",status:r[o]??"active",full_name:l,verified:!!(!("verified"in e)||e.verified),created_at:e.created_at,updated_at:e.updated_at}}function o(e){return{id:e.id,name:e.name,description:e.description??null,permissions:Array.isArray(e.permissions)?e.permissions:[],system:!!("boolean"==typeof e.is_system?e.is_system:"boolean"==typeof e.system?e.system:e.is_system_role),user_count:"number"==typeof e.user_count?e.user_count:0}}async function d(e){try{let t=await e.clone().json();if("string"==typeof t?.detail)return Error(t.detail);if("string"==typeof t?.message)return Error(t.message)}catch{}return Error(e.statusText||"Request failed")}async function c(e,t,s){let r=new Headers(s?.headers);r.set("Authorization",`Bearer ${t}`),s?.body&&!r.has("Content-Type")&&r.set("Content-Type","application/json");let n=await fetch((0,a.G)(e),{...s,headers:r,cache:"no-store"});if(!n.ok)throw await d(n);if(204!==n.status)return await n.json()}async function u(e){let t=new URLSearchParams;e.limit&&t.set("limit",String(e.limit)),e.offset&&t.set("offset",String(e.offset)),e.search&&t.set("search",e.search.trim());let s=t.toString(),a=await c(`/api/admin/users${s?`?${s}`:""}`,e.accessToken,{method:"GET"}),r=Array.isArray(a?.items)?a.items:Array.isArray(a?.users)?a.users:[],n="number"==typeof a?.limit?a.limit:"number"==typeof a?.page_size?a.page_size:r.length,i="number"==typeof a?.offset?a.offset:"number"==typeof a?.page&&n?Math.max(a.page-1,0)*n:0,o="number"==typeof a?.total?a.total:"number"==typeof a?.count?a.count:r.length;return{users:r.map(l),total:o,limit:n,offset:i}}async function m(e){let t=await c("/api/admin/roles",e,{method:"GET"});return(Array.isArray(t)?t:Array.isArray(t?.items)?t.items:[]).map(o)}async function h(e,t,s){let a={};return"number"==typeof s.role_id&&(a.role_id=s.role_id),s.status&&(a.status=n[s.status]??s.status),l(await c(`/api/admin/users/${t}`,e,{method:"PATCH",body:JSON.stringify(a)}))}async function p(e,t){await c(`/api/admin/users/${t}`,e,{method:"DELETE"})}async function x(e,t,s){return o(await c(`/api/admin/roles/${t}`,e,{method:"PATCH",body:JSON.stringify(s)}))}async function f(e,t){let s=await fetch((0,a.G)("/api/auth/register"),{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(t),cache:"no-store"});if(!s.ok)throw await d(s);let r=await s.json(),n=l({...r,role_name:r.role_name??"",status:r.status??"pending_verification"});return r.full_name&&(n.full_name=r.full_name),n}async function g(e){let t={};return e.limit&&(t.limit=e.limit),e.offset&&(t.offset=e.offset),e.search_term&&(t.search_term=e.search_term),e.document_type&&(t.document_type=e.document_type),e.product_name&&(t.product_name=e.product_name),e.privacy_level&&(t.privacy_level=e.privacy_level),e.sort_by&&(t.sort_by=e.sort_by),e.sort_order&&(t.sort_order=e.sort_order),await c("/api/documents/list",e.accessToken,{method:"POST",body:JSON.stringify(t)})}async function y(e,t){await c(`/api/documents/${t}`,e,{method:"DELETE"})}async function j(e,t){let s=new Headers;s.set("Authorization",`Bearer ${e}`);let r=await fetch((0,a.G)(`/api/documents/${t}/download`),{method:"GET",headers:s});if(!r.ok)throw await d(r);return r.blob()}},7863:(e,t,s)=>{"use strict";s.d(t,{G:()=>i,cn:()=>n});var a=s(1135),r=s(1009);function n(...e){return(0,r.m6)((0,a.W)(e))}function i(e){return e}},2881:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o});var a=s(7577);let r=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=(...e)=>e.filter((e,t,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim();var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,a.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:s=2,absoluteStrokeWidth:r,className:l="",children:o,iconNode:d,...c},u)=>(0,a.createElement)("svg",{ref:u,...i,width:t,height:t,stroke:e,strokeWidth:r?24*Number(s)/Number(t):s,className:n("lucide",l),...c},[...d.map(([e,t])=>(0,a.createElement)(e,t)),...Array.isArray(o)?o:[o]])),o=(e,t)=>{let s=(0,a.forwardRef)(({className:s,...i},o)=>(0,a.createElement)(l,{ref:o,iconNode:t,className:n(`lucide-${r(e)}`,s),...i}));return s.displayName=`${e}`,s}},165:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(2881).Z)("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]])},4690:(e,t,s)=>{"use strict";s.d(t,{AuthProvider:()=>o,a:()=>d});var a=s(326),r=s(7577);let n=(0,r.createContext)(void 0),i="tsa_auth_v1";function l(e){try{localStorage.setItem(i,JSON.stringify(e))}catch(e){}}let o=({children:e})=>{let[t,s]=(0,r.useState)({user:null,accessToken:null,refreshToken:null,expiresAt:null,loading:!0,error:null}),o=e=>s(t=>({...t,...e})),d=e=>e;(0,r.useEffect)(()=>{let e=!1;return(async()=>{console.log("[AUTH] Initializing auth context");let t=function(){try{let e=localStorage.getItem(i);if(!e)return null;return JSON.parse(e)}catch(e){return null}}();if(console.log("[AUTH] Persisted state:",t?"Found tokens":"No tokens"),!t?.accessToken){console.log("[AUTH] No access token found, setting loading false"),e||o({loading:!1});return}console.log("[AUTH] Found access token, loading user profile"),o({...t,loading:!0});try{let t=await fetch(d("/api/auth/health")).catch(()=>null);if(!t||!t.ok&&404!==t.status){e||o({loading:!1,error:"Auth service unavailable"});return}}catch(t){e||o({loading:!1,error:"Auth service unavailable"});return}try{console.log("[AUTH] Fetching user profile from /api/auth/me");let s=await fetch(d("/api/auth/me"),{headers:{Authorization:`Bearer ${t.accessToken}`}});if(console.log("[AUTH] Profile fetch response status:",s.status),s.ok){let t=await s.json();console.log("[AUTH] Profile loaded:",{id:t.id,email:t.email,password_change_required:t.password_change_required}),e||o({user:t,loading:!1})}else e||(o({loading:!1,accessToken:null,refreshToken:null,user:null}),l({}))}catch(t){e||o({loading:!1})}})(),()=>{e=!0}},[]);let c=(0,r.useCallback)(async(e,t)=>{console.log("[AUTH] Login attempt for:",e),o({loading:!0,error:null});try{console.log("[AUTH] Sending login request to:",d("/api/auth/login"));let s=await fetch(d("/api/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(console.log("[AUTH] Login response status:",s.status),!s.ok){let e="Login failed";try{let t=await s.json();t&&"string"==typeof t.detail&&(e=t.detail)}catch(e){}return o({loading:!1,error:e}),!1}let a=null;try{a=await s.json()}catch(e){return o({loading:!1,error:"Malformed server response"}),!1}if(console.log("[AUTH] Login response data:",{hasAccessToken:!!a.access_token,hasRefreshToken:!!a.refresh_token,hasUser:!!a.user,userPasswordChangeRequired:a.user?.password_change_required}),!a||"object"!=typeof a||!a.access_token||!a.refresh_token||"number"!=typeof a.expires_in||!a.user)return console.log("[AUTH] Invalid login response data"),o({loading:!1,error:"Unexpected auth response"}),!1;let r=Number.isFinite(a.expires_in)?a.expires_in:0,n=Date.now()+Math.max(0,1e3*r-5e3),i={accessToken:a.access_token,refreshToken:a.refresh_token,expiresAt:n,user:a.user};return console.log("[AUTH] Login successful, setting user state:",{email:a.user.email,password_change_required:a.user.password_change_required}),o({...i,loading:!1}),l(i),!0}catch(e){return o({loading:!1,error:"Network error"}),!1}},[]),u=(0,r.useCallback)(async e=>{o({loading:!0,error:null});try{let t=await fetch(d("/api/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,role_id:e.role_id||2})});if(!t.ok){let e=(await t.json().catch(()=>({}))).detail||"Registration failed";return o({loading:!1,error:e}),!1}return o({loading:!1}),!0}catch(e){return o({loading:!1,error:"Network error"}),!1}},[]),m=(0,r.useCallback)(()=>{o({user:null,accessToken:null,refreshToken:null,expiresAt:null}),l({})},[]);(0,r.useEffect)(()=>{if(globalThis._tsaFetchWrapped)return;let e=fetch;globalThis._tsaFetchWrapped=!0,globalThis.fetch=async(...t)=>{let s=await e(...t);if(401===s.status){let e="string"==typeof t[0]?t[0]:t[0].url;e.includes("/api/auth/login")||e.includes("/api/auth/register")||m()}return s}},[m]);let h=(0,r.useCallback)(async()=>{if(console.log("[AUTH] Refresh called"),!t.refreshToken){console.log("[AUTH] No refresh token available");return}if(h._inFlight){console.log("[AUTH] Refresh already in flight");return}console.log("[AUTH] Starting token refresh"),h._inFlight=!0;try{let e=await fetch(d("/api/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:t.refreshToken})});if(console.log("[AUTH] Refresh response status:",e.status),!e.ok)return console.log("[AUTH] Refresh failed, logging out"),m();let s=await e.json();console.log("[AUTH] Refresh successful, updated user:",{email:s.user?.email,password_change_required:s.user?.password_change_required});let a=1e3*s.expires_in,r=Date.now()+a-Math.min(5e3,Math.max(1e3,.08*a)),n={accessToken:s.access_token,expiresAt:r,user:s.user};o(n),l({...n,refreshToken:t.refreshToken})}catch(e){m()}finally{h._inFlight=!1}},[t.refreshToken,m]);(0,r.useEffect)(()=>{if(!t.expiresAt)return;let e=t.expiresAt-Date.now();if(e<=0){h();return}let s=e-.12*e;s<1500&&(s=Math.min(Math.max(e-500,0),1500));let a=setTimeout(()=>h(),s);return()=>clearTimeout(a)},[t.expiresAt,h]);let p={...t,login:c,register:u,logout:m,refresh:h};return a.jsx(n.Provider,{value:p,children:e})};function d(){let e=(0,r.useContext)(n);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},8748:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(8570).createProxy)(String.raw`/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/admin/page.tsx#default`)},356:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l,metadata:()=>i});var a=s(9510);s(7272);var r=s(8570);let n=(0,r.createProxy)(String.raw`/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/src/context/AuthContext.tsx#AuthProvider`);(0,r.createProxy)(String.raw`/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/src/context/AuthContext.tsx#useAuth`);let i={title:"Technical Services Assistant",description:"Intelligent document search and chat with RAG capabilities"};function l({children:e}){return a.jsx("html",{lang:"en",children:a.jsx("body",{className:"font-sans antialiased",children:a.jsx(n,{children:a.jsx("div",{className:"min-h-screen bg-background",children:e})})})})}},7272:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[8948,4471,325,434],()=>s(462));module.exports=a})();