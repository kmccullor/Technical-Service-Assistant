exports.id=8169,exports.ids=[8169],exports.modules={3649:(e,r,t)=>{Promise.resolve().then(t.t.bind(t,2994,23)),Promise.resolve().then(t.t.bind(t,6114,23)),Promise.resolve().then(t.t.bind(t,9727,23)),Promise.resolve().then(t.t.bind(t,9671,23)),Promise.resolve().then(t.t.bind(t,1868,23)),Promise.resolve().then(t.t.bind(t,4759,23))},7730:(e,r,t)=>{Promise.resolve().then(t.bind(t,4690))},772:(e,r,t)=>{"use strict";t.d(r,{z:()=>c});var n=t(326),s=t(7577),o=t(4214),l=t(9360),a=t(7863);let i=(0,l.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef(({className:e,variant:r,size:t,asChild:s=!1,...l},c)=>{let u=s?o.g7:"button";return n.jsx(u,{className:(0,a.cn)(i({variant:r,size:t,className:e})),ref:c,...l})});c.displayName="Button"},2643:(e,r,t)=>{"use strict";t.d(r,{Ol:()=>a,SZ:()=>c,Zb:()=>l,aY:()=>u,ll:()=>i});var n=t(326),s=t(7577),o=t(7863);let l=s.forwardRef(({className:e,...r},t)=>n.jsx("div",{ref:t,className:(0,o.cn)("rounded-xl border bg-card text-card-foreground shadow",e),...r}));l.displayName="Card";let a=s.forwardRef(({className:e,...r},t)=>n.jsx("div",{ref:t,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",e),...r}));a.displayName="CardHeader";let i=s.forwardRef(({className:e,...r},t)=>n.jsx("div",{ref:t,className:(0,o.cn)("font-semibold leading-none tracking-tight",e),...r}));i.displayName="CardTitle";let c=s.forwardRef(({className:e,...r},t)=>n.jsx("div",{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",e),...r}));c.displayName="CardDescription";let u=s.forwardRef(({className:e,...r},t)=>n.jsx("div",{ref:t,className:(0,o.cn)("p-6 pt-0",e),...r}));u.displayName="CardContent",s.forwardRef(({className:e,...r},t)=>n.jsx("div",{ref:t,className:(0,o.cn)("flex items-center p-6 pt-0",e),...r})).displayName="CardFooter"},7863:(e,r,t)=>{"use strict";t.d(r,{G:()=>l,cn:()=>o});var n=t(1135),s=t(1009);function o(...e){return(0,s.m6)((0,n.W)(e))}function l(e){return e}},4690:(e,r,t)=>{"use strict";t.d(r,{AuthProvider:()=>i,a:()=>c});var n=t(326),s=t(7577);let o=(0,s.createContext)(void 0),l="tsa_auth_v1";function a(e){try{localStorage.setItem(l,JSON.stringify(e))}catch(e){}}let i=({children:e})=>{let[r,t]=(0,s.useState)({user:null,accessToken:null,refreshToken:null,expiresAt:null,loading:!0,error:null}),i=e=>t(r=>({...r,...e})),c=e=>e;(0,s.useEffect)(()=>{let e=!1;return(async()=>{console.log("[AUTH] Initializing auth context");let r=function(){try{let e=localStorage.getItem(l);if(!e)return null;return JSON.parse(e)}catch(e){return null}}();if(console.log("[AUTH] Persisted state:",r?"Found tokens":"No tokens"),!r?.accessToken){console.log("[AUTH] No access token found, setting loading false"),e||i({loading:!1});return}console.log("[AUTH] Found access token, loading user profile"),i({...r,loading:!0});try{let r=await fetch(c("/api/auth/health")).catch(()=>null);if(!r||!r.ok&&404!==r.status){e||i({loading:!1,error:"Auth service unavailable"});return}}catch(r){e||i({loading:!1,error:"Auth service unavailable"});return}try{console.log("[AUTH] Fetching user profile from /api/auth/me");let t=await fetch(c("/api/auth/me"),{headers:{Authorization:`Bearer ${r.accessToken}`}});if(console.log("[AUTH] Profile fetch response status:",t.status),t.ok){let r=await t.json();console.log("[AUTH] Profile loaded:",{id:r.id,email:r.email,password_change_required:r.password_change_required}),e||i({user:r,loading:!1})}else e||(i({loading:!1,accessToken:null,refreshToken:null,user:null}),a({}))}catch(r){e||i({loading:!1})}})(),()=>{e=!0}},[]);let u=(0,s.useCallback)(async(e,r)=>{console.log("[AUTH] Login attempt for:",e),i({loading:!0,error:null});try{console.log("[AUTH] Sending login request to:",c("/api/auth/login"));let t=await fetch(c("/api/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:r})});if(console.log("[AUTH] Login response status:",t.status),!t.ok){let e="Login failed";try{let r=await t.json();r&&"string"==typeof r.detail&&(e=r.detail)}catch(e){}return i({loading:!1,error:e}),!1}let n=null;try{n=await t.json()}catch(e){return i({loading:!1,error:"Malformed server response"}),!1}if(console.log("[AUTH] Login response data:",{hasAccessToken:!!n.access_token,hasRefreshToken:!!n.refresh_token,hasUser:!!n.user,userPasswordChangeRequired:n.user?.password_change_required}),!n||"object"!=typeof n||!n.access_token||!n.refresh_token||"number"!=typeof n.expires_in||!n.user)return console.log("[AUTH] Invalid login response data"),i({loading:!1,error:"Unexpected auth response"}),!1;let s=Number.isFinite(n.expires_in)?n.expires_in:0,o=Date.now()+Math.max(0,1e3*s-5e3),l={accessToken:n.access_token,refreshToken:n.refresh_token,expiresAt:o,user:n.user};return console.log("[AUTH] Login successful, setting user state:",{email:n.user.email,password_change_required:n.user.password_change_required}),i({...l,loading:!1}),a(l),!0}catch(e){return i({loading:!1,error:"Network error"}),!1}},[]),d=(0,s.useCallback)(async e=>{i({loading:!0,error:null});try{let r=await fetch(c("/api/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,role_id:e.role_id||2})});if(!r.ok){let e=(await r.json().catch(()=>({}))).detail||"Registration failed";return i({loading:!1,error:e}),!1}return i({loading:!1}),!0}catch(e){return i({loading:!1,error:"Network error"}),!1}},[]),f=(0,s.useCallback)(()=>{i({user:null,accessToken:null,refreshToken:null,expiresAt:null}),a({})},[]);(0,s.useEffect)(()=>{if(globalThis._tsaFetchWrapped)return;let e=fetch;globalThis._tsaFetchWrapped=!0,globalThis.fetch=async(...r)=>{let t=await e(...r);if(401===t.status){let e="string"==typeof r[0]?r[0]:r[0].url;e.includes("/api/auth/login")||e.includes("/api/auth/register")||f()}return t}},[f]);let h=(0,s.useCallback)(async()=>{if(console.log("[AUTH] Refresh called"),!r.refreshToken){console.log("[AUTH] No refresh token available");return}if(h._inFlight){console.log("[AUTH] Refresh already in flight");return}console.log("[AUTH] Starting token refresh"),h._inFlight=!0;try{let e=await fetch(c("/api/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:r.refreshToken})});if(console.log("[AUTH] Refresh response status:",e.status),!e.ok)return console.log("[AUTH] Refresh failed, logging out"),f();let t=await e.json();console.log("[AUTH] Refresh successful, updated user:",{email:t.user?.email,password_change_required:t.user?.password_change_required});let n=1e3*t.expires_in,s=Date.now()+n-Math.min(5e3,Math.max(1e3,.08*n)),o={accessToken:t.access_token,expiresAt:s,user:t.user};i(o),a({...o,refreshToken:r.refreshToken})}catch(e){f()}finally{h._inFlight=!1}},[r.refreshToken,f]);(0,s.useEffect)(()=>{if(!r.expiresAt)return;let e=r.expiresAt-Date.now();if(e<=0){h();return}let t=e-.12*e;t<1500&&(t=Math.min(Math.max(e-500,0),1500));let n=setTimeout(()=>h(),t);return()=>clearTimeout(n)},[r.expiresAt,h]);let g={...r,login:u,register:d,logout:f,refresh:h};return n.jsx(o.Provider,{value:g,children:e})};function c(){let e=(0,s.useContext)(o);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},356:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>c,metadata:()=>i});var n=t(9510),s=t(5384),o=t.n(s);t(7272);var l=t(8570);let a=(0,l.createProxy)(String.raw`/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/src/context/AuthContext.tsx#AuthProvider`);(0,l.createProxy)(String.raw`/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/src/context/AuthContext.tsx#useAuth`);let i={title:"Technical Services Assistant",description:"Intelligent document search and chat with RAG capabilities"};function c({children:e}){return n.jsx("html",{lang:"en",children:n.jsx("body",{className:o().className,children:n.jsx(a,{children:n.jsx("div",{className:"min-h-screen bg-background",children:e})})})})}},7272:()=>{},8051:(e,r,t)=>{"use strict";t.d(r,{F:()=>o,e:()=>l});var n=t(7577);function s(e,r){if("function"==typeof e)return e(r);null!=e&&(e.current=r)}function o(...e){return r=>{let t=!1,n=e.map(e=>{let n=s(e,r);return t||"function"!=typeof n||(t=!0),n});if(t)return()=>{for(let r=0;r<n.length;r++){let t=n[r];"function"==typeof t?t():s(e[r],null)}}}}function l(...e){return n.useCallback(o(...e),e)}},4214:(e,r,t)=>{"use strict";t.d(r,{Z8:()=>l,g7:()=>a});var n=t(7577),s=t(8051),o=t(326);function l(e){let r=function(e){let r=n.forwardRef((e,r)=>{let{children:t,...o}=e;if(n.isValidElement(t)){let e,l;let a=(e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?t.props.ref:t.props.ref||t.ref,i=function(e,r){let t={...r};for(let n in r){let s=e[n],o=r[n];/^on[A-Z]/.test(n)?s&&o?t[n]=(...e)=>{let r=o(...e);return s(...e),r}:s&&(t[n]=s):"style"===n?t[n]={...s,...o}:"className"===n&&(t[n]=[s,o].filter(Boolean).join(" "))}return{...e,...t}}(o,t.props);return t.type!==n.Fragment&&(i.ref=r?(0,s.F)(r,a):a),n.cloneElement(t,i)}return n.Children.count(t)>1?n.Children.only(null):null});return r.displayName=`${e}.SlotClone`,r}(e),t=n.forwardRef((e,t)=>{let{children:s,...l}=e,a=n.Children.toArray(s),i=a.find(c);if(i){let e=i.props.children,s=a.map(r=>r!==i?r:n.Children.count(e)>1?n.Children.only(null):n.isValidElement(e)?e.props.children:null);return(0,o.jsx)(r,{...l,ref:t,children:n.isValidElement(e)?n.cloneElement(e,void 0,s):null})}return(0,o.jsx)(r,{...l,ref:t,children:s})});return t.displayName=`${e}.Slot`,t}var a=l("Slot"),i=Symbol("radix.slottable");function c(e){return n.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===i}},9360:(e,r,t)=>{"use strict";t.d(r,{j:()=>l});var n=t(1135);let s=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,o=n.W,l=(e,r)=>t=>{var n;if((null==r?void 0:r.variants)==null)return o(e,null==t?void 0:t.class,null==t?void 0:t.className);let{variants:l,defaultVariants:a}=r,i=Object.keys(l).map(e=>{let r=null==t?void 0:t[e],n=null==a?void 0:a[e];if(null===r)return null;let o=s(r)||s(n);return l[e][o]}),c=t&&Object.entries(t).reduce((e,r)=>{let[t,n]=r;return void 0===n||(e[t]=n),e},{});return o(e,i,null==r?void 0:null===(n=r.compoundVariants)||void 0===n?void 0:n.reduce((e,r)=>{let{class:t,className:n,...s}=r;return Object.entries(s).every(e=>{let[r,t]=e;return Array.isArray(t)?t.includes({...a,...c}[r]):({...a,...c})[r]===t})?[...e,t,n]:e},[]),null==t?void 0:t.class,null==t?void 0:t.className)}}};