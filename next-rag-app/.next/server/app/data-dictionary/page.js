(()=>{var e={};e.id=7649,e.ids=[7649],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5214:(e,a,s)=>{"use strict";s.r(a),s.d(a,{GlobalError:()=>l.a,__next_app__:()=>h,originalPathname:()=>m,pages:()=>o,routeModule:()=>x,tree:()=>d}),s(8889),s(9458),s(996);var t=s(170),n=s(5002),r=s(3876),l=s.n(r),i=s(6299),c={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>i[e]);s.d(a,c);let d=["",{children:["data-dictionary",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,8889)),"/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/data-dictionary/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,9458)),"/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,996,23)),"next/dist/client/components/not-found-error"]}],o=["/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/data-dictionary/page.tsx"],m="/data-dictionary/page",h={require:s,loadChunk:()=>Promise.resolve()},x=new t.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/data-dictionary/page",pathname:"/data-dictionary",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},9697:(e,a,s)=>{Promise.resolve().then(s.bind(s,8059))},8059:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>F});var t=s(7247),n=s(8964),r=s(6323);let l=(0,r.Z)("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);var i=s(9964);let c=(0,r.Z)("GitCompare",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]]),d=(0,r.Z)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),o=(0,r.Z)("Table2",[["path",{d:"M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18",key:"gugj83"}]]),m=(0,r.Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),h=(0,r.Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),x=(0,r.Z)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),u=(0,r.Z)("Columns2",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]]);var p=s(2752);let j=(0,r.Z)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var b=s(7316),v=s(9256);let g=(0,r.Z)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var y=s(8053),f=s(7757),N=s(1365),_=s(5008);let S=n.forwardRef(({className:e,type:a,...s},n)=>t.jsx("input",{type:a,className:(0,_.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:n,...s}));S.displayName="Input";let w=n.createContext(null),C=({value:e,onValueChange:a,children:s})=>{let[r,l]=n.useState(!1),i=n.useRef(null);return n.useEffect(()=>{let e=e=>{i.current&&!i.current.contains(e.target)&&l(!1)};if(r)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[r]),t.jsx(w.Provider,{value:{value:e,onValueChange:a,isOpen:r,setIsOpen:l},children:t.jsx("div",{ref:i,className:"relative",children:s})})},E=n.forwardRef(({className:e,children:a,...s},r)=>{let l=n.useContext(w);if(!l)throw Error("SelectTrigger must be used within Select");return(0,t.jsxs)("button",{type:"button",ref:r,className:(0,_.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),onClick:()=>l.setIsOpen(!l.isOpen),...s,children:[a,t.jsx("svg",{className:(0,_.cn)("h-4 w-4 opacity-50 transition-transform",l.isOpen&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{d:"m6 9 6 6 6-6"})})]})});E.displayName="SelectTrigger";let k=({placeholder:e})=>{let a=n.useContext(w);return t.jsx("span",{children:a?.value||e||"Select..."})},A=({children:e})=>{let a=n.useContext(w);if(!a)throw Error("SelectContent must be used within Select");return a.isOpen?t.jsx("div",{className:"absolute top-full left-0 z-50 w-full min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95",children:e}):null},D=({value:e,children:a})=>{let s=n.useContext(w);if(!s)throw Error("SelectItem must be used within Select");return(0,t.jsxs)("div",{className:"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground cursor-pointer data-[selected=true]:bg-accent",onClick:()=>{s.onValueChange(e),s.setIsOpen(!1)},"data-selected":s.value===e,children:[s.value===e&&t.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:t.jsx("svg",{className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),a]})},L=n.createContext(null),O=({defaultValue:e,value:a,onValueChange:s,children:r,className:l})=>{let[i,c]=n.useState(e||"");return t.jsx(L.Provider,{value:{value:void 0!==a?a:i,onValueChange:s||c},children:t.jsx("div",{className:(0,_.cn)("w-full",l),children:r})})},I=n.forwardRef(({className:e,...a},s)=>t.jsx("div",{ref:s,className:(0,_.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...a}));I.displayName="TabsList";let R=n.forwardRef(({className:e,value:a,...s},r)=>{let l=n.useContext(L);return t.jsx("button",{ref:r,type:"button",className:(0,_.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",l?.value===a?"bg-background text-foreground shadow-sm":"hover:bg-muted hover:text-foreground",e),onClick:()=>l?.onValueChange(a),...s})});R.displayName="TabsTrigger";let T=n.forwardRef(({className:e,value:a,...s},r)=>{let l=n.useContext(L);return l?.value!==a?null:t.jsx("div",{ref:r,className:(0,_.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...s})});T.displayName="TabsContent";var P=s(8969);let M=n.forwardRef(({className:e,...a},s)=>t.jsx("label",{ref:s,className:(0,_.cn)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",e),...a}));function F(){let[e,a]=(0,n.useState)([]),[s,r]=(0,n.useState)(""),[v,g]=(0,n.useState)([]),[_,w]=(0,n.useState)([]),[L,F]=(0,n.useState)([]),[Z,z]=(0,n.useState)(!1),[U,H]=(0,n.useState)(""),[J,Y]=(0,n.useState)(""),[B,$]=(0,n.useState)(""),[W,G]=(0,n.useState)(""),[K,X]=(0,n.useState)(!1),[ee,ea]=(0,n.useState)(null),[es,et]=(0,n.useState)({rni_version_id:0,database_type:"PostgreSQL",database_name:"",created_by:""}),[en,er]=(0,n.useState)(!1),[el,ei]=(0,n.useState)(!1),[ec,ed]=(0,n.useState)(""),[eo,em]=(0,n.useState)(""),[eh,ex]=(0,n.useState)(null),eu=async()=>{z(!0);try{let e=new URLSearchParams;s&&e.append("version_number",s),J&&e.append("database_name",J),B&&e.append("schema_name",B);let a=await fetch(`/api/reranker/data-dictionary/schema-overview?${e}`),t=await a.json();g(t)}catch(e){console.error("Failed to fetch schema overview:",e)}finally{z(!1)}},ep=async()=>{if(s)try{let a=e.find(e=>e.version_number===s);if(!a)return;let t=await fetch(`/api/reranker/data-dictionary/database-instances?rni_version_id=${a.id}`),n=await t.json();F(n)}catch(e){console.error("Failed to fetch database instances:",e)}},ej=async e=>{try{let a=new URLSearchParams;s&&a.append("version_number",s),J&&a.append("database_name",J),B&&a.append("schema_name",B),e&&a.append("table_name",e);let t=await fetch(`/api/reranker/data-dictionary/column-details?${a}`),n=await t.json();w(n),G(e)}catch(e){console.error("Failed to fetch column details:",e)}},eb=e=>{navigator.clipboard.writeText(e).then(()=>alert("Query copied to clipboard!")).catch(e=>console.error("Failed to copy text: ",e))},ev=async()=>{if(ee){z(!0);try{let e=new FormData;e.append("file",ee),e.append("rni_version_id",es.rni_version_id.toString()),e.append("database_type",es.database_type),e.append("database_name",es.database_name),e.append("created_by",es.created_by);let a=await fetch("/api/data-dictionary/upload-schema",{method:"POST",body:e});if(a.ok){let e=await a.json();alert(`Schema upload successful! Imported ${e.statistics?.tables||0} tables and ${e.statistics?.columns||0} columns.`),X(!1),ea(null),eu(),ep()}else{let e=await a.json();alert(`Schema upload failed: ${e.detail||"Unknown error"}`)}}catch(e){console.error("Schema upload error:",e),alert("Schema upload failed. Please try again.")}finally{z(!1)}}},eg=async()=>{if(ec&&eo){z(!0);try{let e=new URLSearchParams({version1:ec,version2:eo});J&&e.append("database_name",J);let a=await fetch(`/api/reranker/data-dictionary/compare-schemas?${e}`),s=await a.json();ex(s)}catch(e){console.error("Failed to compare schemas:",e)}finally{z(!1)}}},ey=v.filter(e=>{if(J&&e.database_name!==J||B&&e.schema_name!==B)return!1;if(U){let a=U.toLowerCase();return e.table_name.toLowerCase().includes(a)||e.schema_name.toLowerCase().includes(a)||e.database_name.toLowerCase().includes(a)||(e.table_description||"").toLowerCase().includes(a)}return!0}),ef=[...new Set(v.map(e=>e.database_name))],eN=[...new Set(v.filter(e=>!J||e.database_name===J).map(e=>e.schema_name))];return(0,t.jsxs)("div",{className:"container mx-auto p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[t.jsx(l,{className:"h-8 w-8"}),"Data Dictionary Manager"]}),t.jsx("p",{className:"text-muted-foreground",children:"Manage database schemas for MSSQL and PostgreSQL databases by RNI version"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(P.Vq,{open:K,onOpenChange:X,children:[t.jsx(P.hg,{asChild:!0,children:(0,t.jsxs)(y.z,{children:[t.jsx(i.Z,{className:"h-4 w-4 mr-2"}),"Upload Schema"]})}),(0,t.jsxs)(P.cZ,{className:"max-w-2xl",children:[(0,t.jsxs)(P.fK,{children:[t.jsx(P.$N,{children:"Upload Database Schema"}),t.jsx(P.Be,{children:"Upload schema data for Sensus AMI databases. You'll need to run the provided SQL query on your database and upload the CSV results."})]}),(0,t.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[t.jsx(M,{htmlFor:"rni_version",children:"RNI Version"}),(0,t.jsxs)(C,{value:es.rni_version_id.toString(),onValueChange:e=>et(a=>({...a,rni_version_id:parseInt(e)})),children:[t.jsx(E,{children:t.jsx(k,{placeholder:"Select RNI Version"})}),t.jsx(A,{children:e.map(e=>(0,t.jsxs)(D,{value:e.id.toString(),children:[e.version_number," - ",e.version_name]},e.id))})]})]}),(0,t.jsxs)("div",{children:[t.jsx(M,{htmlFor:"database_type",children:"Database Type"}),(0,t.jsxs)(C,{value:es.database_type,onValueChange:e=>et(a=>({...a,database_type:e})),children:[t.jsx(E,{children:t.jsx(k,{})}),(0,t.jsxs)(A,{children:[t.jsx(D,{value:"PostgreSQL",children:"PostgreSQL"}),t.jsx(D,{value:"MSSQL",children:"Microsoft SQL Server"})]})]})]})]}),(0,t.jsxs)("div",{children:[t.jsx(M,{htmlFor:"database_name",children:"Database Name"}),t.jsx(S,{id:"database_name",value:es.database_name,onChange:e=>et(a=>({...a,database_name:e.target.value})),placeholder:"e.g., FlexnetDB, AMDS, Router, FWDL"})]}),(0,t.jsxs)("div",{children:[t.jsx(M,{htmlFor:"schema_file",children:"Schema CSV File"}),t.jsx(S,{id:"schema_file",type:"file",accept:".csv",onChange:e=>ea(e.target.files?.[0]||null),className:"cursor-pointer"}),t.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Upload a CSV file generated by running the extraction query on your database. See the query help section below."})]}),(0,t.jsxs)("div",{children:[t.jsx(M,{htmlFor:"created_by",children:"Created By"}),t.jsx(S,{id:"created_by",value:es.created_by,onChange:e=>et(a=>({...a,created_by:e.target.value})),placeholder:"Your name or username"})]}),(0,t.jsxs)("div",{className:"border rounded-lg p-4 bg-amber-50 border-amber-200",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("h4",{className:"font-medium text-amber-800",children:"\uD83D\uDCCB Schema Extraction Query"}),(0,t.jsxs)(y.z,{type:"button",variant:"outline",onClick:()=>er(!en),className:"text-xs",children:[en?"Hide":"Show"," Query"]})]}),en&&(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("p",{className:"text-sm text-amber-700",children:[t.jsx("strong",{children:"⚠️ Important:"})," You must run this query on your ",es.database_type," database to generate the CSV file for upload:"]}),(0,t.jsxs)("div",{className:"relative bg-gray-900 text-gray-100 p-3 rounded text-xs font-mono overflow-x-auto",children:[t.jsx(y.z,{type:"button",variant:"outline",onClick:()=>eb("MSSQL"===es.database_type?V(es.database_name):Q(es.database_name)),className:"absolute top-2 right-2 h-6 px-2 text-xs bg-gray-700 hover:bg-gray-600 border-gray-600",children:"\uD83D\uDCCB Copy"}),t.jsx("pre",{className:"whitespace-pre-wrap pr-16",children:"MSSQL"===es.database_type?V(es.database_name):Q(es.database_name)})]}),(0,t.jsxs)("div",{className:"text-xs text-amber-700 bg-white p-3 rounded border",children:[t.jsx("p",{children:t.jsx("strong",{children:"\uD83D\uDCDD Step-by-step Instructions:"})}),(0,t.jsxs)("ol",{className:"list-decimal list-inside space-y-1 mt-2",children:[t.jsx("li",{children:"Copy the SQL query above"}),(0,t.jsxs)("li",{children:["Connect to your ",es.database_name," database"]}),t.jsx("li",{children:"Execute the query in your SQL client"}),t.jsx("li",{children:"Export the query results as a CSV file"}),t.jsx("li",{children:"Upload the generated CSV file using the file selector above"})]}),(0,t.jsxs)("p",{className:"mt-2 text-amber-600",children:[t.jsx("strong",{children:"Note:"})," This system cannot directly access your database servers. You must generate and upload the schema data manually."]})]})]})]})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[t.jsx(y.z,{variant:"outline",onClick:()=>X(!1),children:"Cancel"}),t.jsx(y.z,{onClick:ev,disabled:Z||!ee,children:Z?"Uploading...":"Upload Schema"})]})]})]}),(0,t.jsxs)(P.Vq,{open:el,onOpenChange:ei,children:[t.jsx(P.hg,{asChild:!0,children:(0,t.jsxs)(y.z,{variant:"outline",children:[t.jsx(c,{className:"h-4 w-4 mr-2"}),"Compare Versions"]})}),(0,t.jsxs)(P.cZ,{children:[(0,t.jsxs)(P.fK,{children:[t.jsx(P.$N,{children:"Compare Schema Versions"}),t.jsx(P.Be,{children:"Compare database schemas between two RNI versions"})]}),(0,t.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[t.jsx(M,{htmlFor:"version1",children:"Version 1"}),(0,t.jsxs)(C,{value:ec,onValueChange:ed,children:[t.jsx(E,{children:t.jsx(k,{placeholder:"Select first version"})}),t.jsx(A,{children:e.map(e=>t.jsx(D,{value:e.version_number,children:e.version_number},e.id))})]})]}),(0,t.jsxs)("div",{children:[t.jsx(M,{htmlFor:"version2",children:"Version 2"}),(0,t.jsxs)(C,{value:eo,onValueChange:em,children:[t.jsx(E,{children:t.jsx(k,{placeholder:"Select second version"})}),t.jsx(A,{children:e.map(e=>t.jsx(D,{value:e.version_number,children:e.version_number},e.id))})]})]})]}),t.jsx(y.z,{onClick:eg,disabled:!ec||!eo||Z,children:Z?"Comparing...":"Compare Schemas"}),eh&&(0,t.jsxs)("div",{className:"mt-4 space-y-2",children:[t.jsx("h4",{className:"font-medium",children:"Comparison Results:"}),t.jsx("div",{className:"max-h-60 overflow-y-auto",children:eh.changes.map((e,a)=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-2 bg-muted rounded",children:[(0,t.jsxs)("span",{className:"text-sm",children:[e.schema_name,".",e.table_name,".",e.column_name]}),t.jsx(N.C,{variant:"ADDED"===e.change_type?"default":"REMOVED"===e.change_type?"destructive":"secondary",children:e.change_type})]},a))})]})]})]})]})]})]}),(0,t.jsxs)(f.Zb,{children:[t.jsx(f.Ol,{children:(0,t.jsxs)(f.ll,{className:"flex items-center gap-2",children:[t.jsx(d,{className:"h-5 w-5"}),"Filters"]})}),t.jsx(f.aY,{children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{children:[t.jsx(M,{children:"RNI Version"}),(0,t.jsxs)(C,{value:s,onValueChange:e=>{r(e),Y(""),$(""),w([]),G("")},children:[t.jsx(E,{children:t.jsx(k,{placeholder:"Select RNI Version"})}),t.jsx(A,{children:e.map(e=>(0,t.jsxs)(D,{value:e.version_number,children:[e.version_number,e.is_active&&t.jsx(N.C,{className:"ml-2",children:"Active"})]},e.id))})]})]}),(0,t.jsxs)("div",{children:[t.jsx(M,{children:"Database"}),(0,t.jsxs)(C,{value:J,onValueChange:e=>{Y(e),$("")},children:[t.jsx(E,{children:t.jsx(k,{placeholder:"All Databases"})}),(0,t.jsxs)(A,{children:[t.jsx(D,{value:"",children:"All Databases"}),ef.map(e=>t.jsx(D,{value:e,children:e},e))]})]})]}),(0,t.jsxs)("div",{children:[t.jsx(M,{children:"Schema"}),(0,t.jsxs)(C,{value:B,onValueChange:$,children:[t.jsx(E,{children:t.jsx(k,{placeholder:"All Schemas"})}),(0,t.jsxs)(A,{children:[t.jsx(D,{value:"",children:"All Schemas"}),eN.map(e=>t.jsx(D,{value:e,children:e},e))]})]})]}),(0,t.jsxs)("div",{children:[t.jsx(M,{children:"Search Tables"}),t.jsx(S,{placeholder:"Search tables...",value:U,onChange:e=>H(e.target.value)})]})]})})]}),(0,t.jsxs)(O,{defaultValue:"overview",className:"space-y-4",children:[(0,t.jsxs)(I,{children:[t.jsx(R,{value:"overview",children:"Schema Overview"}),t.jsx(R,{value:"columns",children:"Column Details"}),t.jsx(R,{value:"instances",children:"Database Instances"}),t.jsx(R,{value:"ami-assistant",children:"Technical Services Assistant"})]}),t.jsx(T,{value:"overview",children:(0,t.jsxs)(f.Zb,{children:[t.jsx(f.Ol,{children:(0,t.jsxs)(f.ll,{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[t.jsx(o,{className:"h-5 w-5"}),"Schema Overview (",ey.length," tables)"]}),(0,t.jsxs)(y.z,{variant:"outline",size:"sm",children:[t.jsx(m,{className:"h-4 w-4 mr-2"}),"Export"]})]})}),t.jsx(f.aY,{children:Z?(0,t.jsxs)("div",{className:"flex items-center justify-center py-8",children:[t.jsx(h,{className:"h-6 w-6 animate-spin mr-2"}),"Loading schema data..."]}):t.jsx("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full border-collapse",children:[t.jsx("thead",{children:(0,t.jsxs)("tr",{className:"border-b",children:[t.jsx("th",{className:"text-left p-2",children:"Database"}),t.jsx("th",{className:"text-left p-2",children:"Schema"}),t.jsx("th",{className:"text-left p-2",children:"Table"}),t.jsx("th",{className:"text-left p-2",children:"Type"}),t.jsx("th",{className:"text-left p-2",children:"Columns"}),t.jsx("th",{className:"text-left p-2",children:"Rows"}),t.jsx("th",{className:"text-left p-2",children:"Actions"})]})}),t.jsx("tbody",{children:ey.map((e,a)=>(0,t.jsxs)("tr",{className:"border-b hover:bg-muted/50",children:[t.jsx("td",{className:"p-2",children:(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[t.jsx(l,{className:"h-4 w-4"}),e.database_name,t.jsx(N.C,{variant:"outline",children:e.database_type})]})}),t.jsx("td",{className:"p-2",children:e.schema_name}),t.jsx("td",{className:"p-2",children:(0,t.jsxs)("div",{children:[t.jsx("div",{className:"font-medium",children:e.table_name}),e.table_description&&t.jsx("div",{className:"text-xs text-muted-foreground",children:e.table_description})]})}),t.jsx("td",{className:"p-2",children:t.jsx(N.C,{variant:"TABLE"===e.table_type?"default":"secondary",children:e.table_type})}),t.jsx("td",{className:"p-2",children:e.column_count}),t.jsx("td",{className:"p-2",children:null!==e.row_count?e.row_count.toLocaleString():"N/A"}),t.jsx("td",{className:"p-2",children:t.jsx(y.z,{variant:"ghost",size:"sm",onClick:()=>ej(e.table_name),children:t.jsx(x,{className:"h-4 w-4"})})})]},a))})]})})})]})}),t.jsx(T,{value:"columns",children:(0,t.jsxs)(f.Zb,{children:[t.jsx(f.Ol,{children:(0,t.jsxs)(f.ll,{className:"flex items-center gap-2",children:[t.jsx(u,{className:"h-5 w-5"}),"Column Details",W&&(0,t.jsxs)("span",{className:"text-muted-foreground",children:["- ",W]})]})}),t.jsx(f.aY,{children:_.length>0?t.jsx("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full border-collapse",children:[t.jsx("thead",{children:(0,t.jsxs)("tr",{className:"border-b",children:[t.jsx("th",{className:"text-left p-2",children:"#"}),t.jsx("th",{className:"text-left p-2",children:"Column Name"}),t.jsx("th",{className:"text-left p-2",children:"Data Type"}),t.jsx("th",{className:"text-left p-2",children:"Nullable"}),t.jsx("th",{className:"text-left p-2",children:"Key"}),t.jsx("th",{className:"text-left p-2",children:"Default"}),t.jsx("th",{className:"text-left p-2",children:"Description"})]})}),t.jsx("tbody",{children:_.map((e,a)=>(0,t.jsxs)("tr",{className:"border-b hover:bg-muted/50",children:[t.jsx("td",{className:"p-2",children:e.ordinal_position}),t.jsx("td",{className:"p-2 font-medium",children:e.column_name}),t.jsx("td",{className:"p-2",children:(0,t.jsxs)("code",{className:"text-sm bg-muted px-1 rounded",children:[e.data_type,e.max_length&&`(${e.max_length})`,e.precision_value&&e.scale_value&&`(${e.precision_value},${e.scale_value})`]})}),t.jsx("td",{className:"p-2",children:e.is_nullable?t.jsx(p.Z,{className:"h-4 w-4 text-green-500"}):t.jsx(j,{className:"h-4 w-4 text-red-500"})}),t.jsx("td",{className:"p-2",children:(0,t.jsxs)("div",{className:"flex gap-1",children:[e.is_primary_key&&t.jsx(N.C,{children:"PK"}),e.is_foreign_key&&t.jsx(N.C,{variant:"outline",children:"FK"}),e.is_identity&&t.jsx(N.C,{variant:"secondary",children:"ID"})]})}),t.jsx("td",{className:"p-2 text-sm text-muted-foreground",children:e.default_value||"-"}),t.jsx("td",{className:"p-2 text-sm text-muted-foreground",children:e.description||"-"})]},a))})]})}):t.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Select a table from the Schema Overview to view column details"})})]})}),t.jsx(T,{value:"instances",children:(0,t.jsxs)(f.Zb,{children:[t.jsx(f.Ol,{children:(0,t.jsxs)(f.ll,{className:"flex items-center gap-2",children:[t.jsx(b.Z,{className:"h-5 w-5"}),"Database Instances"]})}),t.jsx(f.aY,{children:t.jsx("div",{className:"grid gap-4",children:L.map(e=>t.jsx(f.Zb,{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"font-medium flex items-center gap-2",children:[t.jsx(l,{className:"h-4 w-4"}),e.database_name,t.jsx(N.C,{variant:"outline",children:e.database_type}),e.is_active&&t.jsx(N.C,{children:"Active"})]}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e.server_name,":",e.port]}),e.description&&t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.description})]}),t.jsx("div",{className:"flex gap-2",children:t.jsx(y.z,{variant:"outline",size:"sm",children:t.jsx(b.Z,{className:"h-4 w-4"})})})]})},e.id))})})]})}),t.jsx(T,{value:"ami-assistant",children:t.jsx(q,{})})]})]})}function V(e){return`-- Sensus AMI ${e} Schema Extraction Query (MSSQL)
-- Run this query to extract schema information for data dictionary import

SELECT 
    s.name AS schema_name,
    t.name AS table_name,
    c.name AS column_name,
    ty.name AS data_type,
    c.max_length,
    c.precision,
    c.scale,
    c.is_nullable,
    c.is_identity,
    CASE WHEN pk.column_name IS NOT NULL THEN 1 ELSE 0 END AS is_primary_key,
    ISNULL(cc.definition, '') AS default_value,
    ISNULL(ep.value, '') AS column_description
FROM sys.tables t
INNER JOIN sys.schemas s ON t.schema_id = s.schema_id
INNER JOIN sys.columns c ON t.object_id = c.object_id
INNER JOIN sys.types ty ON c.user_type_id = ty.user_type_id
LEFT JOIN (
    SELECT 
        ic.object_id,
        ic.column_id,
        c.name AS column_name
    FROM sys.indexes i
    INNER JOIN sys.index_columns ic ON i.object_id = ic.object_id AND i.index_id = ic.index_id
    INNER JOIN sys.columns c ON ic.object_id = c.object_id AND ic.column_id = c.column_id
    WHERE i.is_primary_key = 1
) pk ON t.object_id = pk.object_id AND c.column_id = pk.column_id
LEFT JOIN sys.default_constraints cc ON c.default_object_id = cc.object_id
LEFT JOIN sys.extended_properties ep ON t.object_id = ep.major_id AND c.column_id = ep.minor_id AND ep.name = 'MS_Description'
WHERE t.type = 'U'  -- User tables only
ORDER BY s.name, t.name, c.column_id;`}function Q(e){return`-- Sensus AMI ${e} Schema Extraction Query (PostgreSQL)
-- Run this query to extract schema information for data dictionary import

SELECT 
    n.nspname AS schema_name,
    c.relname AS table_name,
    a.attname AS column_name,
    t.typname AS data_type,
    CASE WHEN a.attlen > 0 THEN a.attlen ELSE a.atttypmod - 4 END AS max_length,
    0 AS precision,  -- PostgreSQL specific handling would go here
    0 AS scale,      -- PostgreSQL specific handling would go here
    NOT a.attnotnull AS is_nullable,
    CASE WHEN a.attidentity != '' THEN true ELSE false END AS is_identity,
    CASE WHEN pk.attname IS NOT NULL THEN true ELSE false END AS is_primary_key,
    COALESCE(ad.adsrc, '') AS default_value,
    COALESCE(d.description, '') AS column_description
FROM pg_class c
JOIN pg_namespace n ON c.relnamespace = n.oid
JOIN pg_attribute a ON c.oid = a.attrelid
JOIN pg_type t ON a.atttypid = t.oid
LEFT JOIN pg_attrdef ad ON a.attrelid = ad.adrelid AND a.attnum = ad.adnum
LEFT JOIN pg_description d ON c.oid = d.objoid AND a.attnum = d.objsubid
LEFT JOIN (
    SELECT 
        i.indrelid,
        a.attname,
        a.attnum
    FROM pg_index i
    JOIN pg_attribute a ON i.indrelid = a.attrelid AND a.attnum = ANY(i.indkey)
    WHERE i.indisprimary = true
) pk ON c.oid = pk.indrelid AND a.attnum = pk.attnum
WHERE c.relkind = 'r'  -- Regular tables only
  AND n.nspname NOT IN ('information_schema', 'pg_catalog', 'pg_toast')
  AND a.attnum > 0     -- Exclude system columns
  AND NOT a.attisdropped
ORDER BY n.nspname, c.relname, a.attnum;`}function q(){let[e,a]=(0,n.useState)(""),[s,r]=(0,n.useState)(""),[l,i]=(0,n.useState)(null),[c,d]=(0,n.useState)(!1),[o,m]=(0,n.useState)([]),x=async()=>{if(!e||!s){alert("Please select both RNI version and database name");return}d(!0);try{let a=await fetch("/api/data-dictionary/query-assistance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rni_version:e,database_name:s})}),t=await a.json();i(t)}catch(e){console.error("Query assistance failed:",e),i({status:"error",message:"Failed to get query assistance"})}finally{d(!1)}},u=e=>{navigator.clipboard.writeText(e),alert("Copied to clipboard!")};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(f.Zb,{children:[(0,t.jsxs)(f.Ol,{children:[(0,t.jsxs)(f.ll,{className:"flex items-center gap-2",children:[t.jsx(v.Z,{className:"h-5 w-5"}),"Technical Services Assistant"]}),t.jsx(f.SZ,{children:"Get help with database queries for Sensus AMI Infrastructure. Check if schema data is available or get SQL queries to extract schema information for upload."})]}),(0,t.jsxs)(f.aY,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(M,{htmlFor:"rni-version",children:"RNI Version *"}),(0,t.jsxs)(C,{value:e,onValueChange:a,children:[t.jsx(E,{children:t.jsx(k,{placeholder:"Select RNI version"})}),t.jsx(A,{children:o.map(e=>(0,t.jsxs)(D,{value:e.version_number,children:[e.version_number," - ",e.version_name,e.is_active&&t.jsx(N.C,{className:"ml-2",children:"Active"})]},e.id))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(M,{htmlFor:"database-name",children:"Database Name *"}),(0,t.jsxs)(C,{value:s,onValueChange:r,children:[t.jsx(E,{children:t.jsx(k,{placeholder:"Select database"})}),(0,t.jsxs)(A,{children:[t.jsx(D,{value:"FlexnetDB",children:"FlexnetDB (MSSQL)"}),t.jsx(D,{value:"AMDS",children:"AMDS (PostgreSQL)"}),t.jsx(D,{value:"Router",children:"Router (PostgreSQL)"}),t.jsx(D,{value:"FWDL",children:"FWDL (PostgreSQL)"})]})]})]})]}),t.jsx(y.z,{onClick:x,disabled:c||!e||!s,className:"w-full",children:c?(0,t.jsxs)(t.Fragment,{children:[t.jsx(h,{className:"h-4 w-4 mr-2 animate-spin"}),"Checking Data Dictionary..."]}):(0,t.jsxs)(t.Fragment,{children:[t.jsx(v.Z,{className:"h-4 w-4 mr-2"}),"Get Query Assistance"]})})]})]}),l&&(0,t.jsxs)(f.Zb,{children:[t.jsx(f.Ol,{children:(0,t.jsxs)(f.ll,{className:"flex items-center gap-2",children:["data_dictionary_available"===l.status&&t.jsx(p.Z,{className:"h-5 w-5 text-green-500"}),"schema_extraction_needed"===l.status&&t.jsx(g,{className:"h-5 w-5 text-yellow-500"}),"database_not_configured"===l.status&&t.jsx(j,{className:"h-5 w-5 text-red-500"}),"rni_version_not_found"===l.status&&t.jsx(j,{className:"h-5 w-5 text-red-500"}),"Query Assistance Result"]})}),(0,t.jsxs)(f.aY,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,t.jsxs)("p",{className:"font-medium",children:["Status: ",l.status?.replace("_"," ")]}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:l.message})]}),"data_dictionary_available"===l.status&&l.schemas_available&&(0,t.jsxs)("div",{children:[t.jsx("h4",{className:"font-medium mb-2",children:"Available Schemas:"}),t.jsx("div",{className:"space-y-2",children:l.schemas_available.map((e,a)=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-2 bg-green-50 rounded",children:[t.jsx("span",{className:"font-medium",children:e.schema_name}),(0,t.jsxs)(N.C,{variant:"secondary",children:[e.table_count," tables"]})]},a))}),t.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Data dictionary is available. You can proceed with your queries using the schema information."})]}),"schema_extraction_needed"===l.status&&l.extraction_query&&(0,t.jsxs)("div",{children:[t.jsx("h4",{className:"font-medium mb-2",children:"Schema Extraction Required"}),(0,t.jsxs)("p",{className:"text-sm text-gray-600 mb-3",children:["No schema information is available. Run the following query on your ",l.database_type," database to extract the schema:"]}),(0,t.jsxs)("div",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg text-sm font-mono overflow-x-auto",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("span",{className:"text-gray-400",children:["Extraction Query (",l.database_type,")"]}),t.jsx(y.z,{variant:"outline",onClick:()=>u(l.extraction_query),className:"h-6 px-2 text-xs",children:"Copy"})]}),t.jsx("pre",{className:"whitespace-pre-wrap",children:l.extraction_query})]}),(0,t.jsxs)("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded",children:[t.jsx("h5",{className:"font-medium text-blue-800",children:"Next Steps:"}),(0,t.jsxs)("ol",{className:"list-decimal list-inside text-sm text-blue-700 mt-1 space-y-1",children:[t.jsx("li",{children:"Copy the extraction query above"}),(0,t.jsxs)("li",{children:["Connect to your ",s," database server"]}),t.jsx("li",{children:"Execute the query in your SQL client"}),t.jsx("li",{children:"Export the results as a CSV file"}),t.jsx("li",{children:'Upload the CSV file using the "Upload Schema" button'})]}),(0,t.jsxs)("p",{className:"text-xs text-blue-600 mt-2",children:[t.jsx("strong",{children:"Note:"})," The system cannot access your database servers directly. You must run the query and upload the results manually."]})]})]}),"database_not_configured"===l.status&&(0,t.jsxs)("div",{className:"p-3 bg-orange-50 border border-orange-200 rounded",children:[t.jsx("h5",{className:"font-medium text-orange-800",children:"Database Not Configured"}),(0,t.jsxs)("p",{className:"text-sm text-orange-700 mt-1",children:["The database ",s," is not configured for RNI version ",e,'. Please add it using the "Database Instances" tab first.']})]}),"rni_version_not_found"===l.status&&(0,t.jsxs)("div",{className:"p-3 bg-red-50 border border-red-200 rounded",children:[t.jsx("h5",{className:"font-medium text-red-800",children:"RNI Version Not Found"}),(0,t.jsxs)("p",{className:"text-sm text-red-700 mt-1",children:["RNI version ",e," was not found. Please check available versions in the dropdown."]})]})]})]}),(0,t.jsxs)(f.Zb,{children:[t.jsx(f.Ol,{children:t.jsx(f.ll,{className:"text-lg",children:"Sensus AMI Databases"})}),t.jsx(f.aY,{children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"p-4 border rounded-lg",children:[t.jsx("h4",{className:"font-semibold text-blue-600",children:"FlexnetDB (Microsoft SQL Server)"}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Primary Sensus AMI database containing meter data, billing information, and infrastructure management."})]}),(0,t.jsxs)("div",{className:"p-4 border rounded-lg",children:[t.jsx("h4",{className:"font-semibold text-green-600",children:"AMDS (PostgreSQL)"}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Advanced Metering Data System for real-time meter reading and data processing."})]}),(0,t.jsxs)("div",{className:"p-4 border rounded-lg",children:[t.jsx("h4",{className:"font-semibold text-green-600",children:"Router (PostgreSQL)"}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Communication management database for AMI network routing and device connectivity."})]}),(0,t.jsxs)("div",{className:"p-4 border rounded-lg",children:[t.jsx("h4",{className:"font-semibold text-green-600",children:"FWDL (PostgreSQL)"}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Firmware Download management system for device updates and version control."})]})]})})]})]})}M.displayName="Label"},8889:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>t});let t=(0,s(5347).createProxy)(String.raw`/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/data-dictionary/page.tsx#default`)}};var a=require("../../webpack-runtime.js");a.C(e);var s=e=>a(a.s=e),t=a.X(0,[9379,2704,3997,8800],()=>s(5214));module.exports=t})();