"use strict";(()=>{var e={};e.id=4003,e.ids=[4003],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8678:e=>{e.exports=import("pg")},3029:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>c,requestAsyncStorage:()=>l,routeModule:()=>u,serverHooks:()=>h,staticGenerationAsyncStorage:()=>p});var n=r(9303),o=r(8716),i=r(670),s=r(4898),d=e([s]);s=(d.then?(await d)():d)[0];let u=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/conversations/route",pathname:"/api/conversations",filename:"route",bundlePath:"app/api/conversations/route"},resolvedPagePath:"/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/api/conversations/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:p,serverHooks:h}=u,m="/api/conversations/route";function c(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:p})}a()}catch(e){a(e)}})},4898:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{GET:()=>l});var n=r(7070),o=r(7395),i=r(306),s=r(7745),d=r(1445),c=r(2405),u=e([o]);async function l(e){try{let t=e.headers.get("authorization"),r=await (0,c.k)(t);if(!r)return n.NextResponse.json({error:"Unauthorized"},{status:401});let a=Number.parseInt(e.nextUrl.searchParams.get("limit")??"",10),u=Number.isFinite(a)?Math.min(Math.max(a,1),30):30,l=new Date(Date.now()-2592e6),p=await o.db.select({id:i.p5.id,title:i.p5.title,createdAt:i.p5.createdAt,updatedAt:i.p5.updatedAt,lastReviewedAt:i.p5.lastReviewedAt}).from(i.p5).where((0,s.xD)((0,s.eq)(i.p5.userId,r.id),(0,s.eg)(i.p5.createdAt,l))).orderBy((0,d.C)(i.p5.updatedAt),(0,d.C)(i.p5.createdAt)).limit(u);return n.NextResponse.json(p)}catch(e){return console.error("Error fetching conversations:",e),n.NextResponse.json({error:"Failed to fetch conversations"},{status:500})}}o=(u.then?(await u)():u)[0],a()}catch(e){a(e)}})},7395:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{db:()=>u});var n=r(8029),o=r(8678),i=e([o,n]);[o,n]=i.then?(await i)():i;let s=process.env.DATABASE_URL??process.env.POSTGRES_URL??process.env.POSTGRES_CONNECTION_STRING??"postgresql://postgres:postgres@db:5432/vector_db",d=process.env.DATABASE_SSL?.toLowerCase()==="true"||process.env.DATABASE_SSL?.toLowerCase()==="require",c=globalThis.__tsaDbPool||new o.Pool({connectionString:s,ssl:d?{rejectUnauthorized:!1}:void 0}),u=(0,n.tS)(c);a()}catch(e){a(e)}})},306:(e,t,r)=>{r.d(t,{De:()=>l,p5:()=>c,sY:()=>u,yD:()=>p});var a=r(7561),n=r(5961),o=r(2140),i=r(2941),s=r(1575),d=r(8680);let c=(0,a.af)("conversations",{id:(0,n.eP)("id").primaryKey(),title:(0,o.fL)("title").notNull(),userId:(0,i._L)("user_id"),createdAt:(0,s.AB)("created_at",{withTimezone:!0}).defaultNow().notNull(),updatedAt:(0,s.AB)("updated_at",{withTimezone:!0}).defaultNow(),lastReviewedAt:(0,s.AB)("last_reviewed_at",{withTimezone:!0})}),u=(0,a.af)("messages",{id:(0,n.eP)("id").primaryKey(),conversationId:(0,i._L)("conversation_id").notNull().references(()=>c.id,{onDelete:"cascade"}),role:(0,o.fL)("role").notNull(),content:(0,o.fL)("content").notNull(),citations:(0,d.JB)("citations").$type(),createdAt:(0,s.AB)("created_at",{withTimezone:!0}).defaultNow().notNull()}),l=(0,a.af)("documents",{id:(0,n.eP)("id").primaryKey(),fileName:(0,o.fL)("file_name").notNull(),title:(0,o.fL)("title").notNull(),description:(0,o.fL)("description"),fileHash:(0,o.fL)("file_hash"),fileSize:(0,i._L)("file_size"),mimeType:(0,o.fL)("mime_type"),documentType:(0,o.fL)("document_type"),productName:(0,o.fL)("product_name"),productVersion:(0,o.fL)("product_version"),privacyLevel:(0,o.fL)("privacy_level"),processedAt:(0,s.AB)("processed_at",{withTimezone:!0}),createdAt:(0,s.AB)("created_at",{withTimezone:!0}).defaultNow().notNull(),updatedAt:(0,s.AB)("updated_at",{withTimezone:!0}).defaultNow().notNull()}),p=(0,a.af)("document_chunks",{id:(0,n.eP)("id").primaryKey(),documentId:(0,i._L)("document_id").notNull().references(()=>l.id,{onDelete:"cascade"}),chunkIndex:(0,i._L)("chunk_index"),pageNumber:(0,i._L)("page_number"),chunkType:(0,o.fL)("chunk_type"),content:(0,o.fL)("content").notNull(),contentHash:(0,o.fL)("content_hash"),contentLength:(0,i._L)("content_length").default(0).notNull(),metadata:(0,d.JB)("metadata").$type().default({}),embedding:(0,d.JB)("embedding").$type(),createdAt:(0,s.AB)("created_at",{withTimezone:!0}).defaultNow().notNull(),updatedAt:(0,s.AB)("updated_at",{withTimezone:!0}).defaultNow()})},2405:(e,t,r)=>{r.d(t,{k:()=>n});let a=process.env.RERANKER_BASE_URL||"http://reranker:8008";async function n(e){if(!e)return null;try{let t=await fetch(`${a}/api/auth/me`,{method:"GET",headers:{Authorization:e},cache:"no-store"});if(!t.ok)return null;let r=await t.json();if(!r||"number"!=typeof r.id)return null;return r}catch(e){return console.error("Failed to fetch current user:",e),null}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,5972,8029],()=>r(3029));module.exports=a})();