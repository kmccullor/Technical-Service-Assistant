"use strict";(()=>{var e={};e.id=1297,e.ids=[1297],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8678:e=>{e.exports=import("pg")},5108:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>c,requestAsyncStorage:()=>l,routeModule:()=>u,serverHooks:()=>h,staticGenerationAsyncStorage:()=>p});var o=r(9303),a=r(8716),i=r(670),s=r(7838),d=e([s]);s=(d.then?(await d)():d)[0];let u=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/conversations/[id]/route",pathname:"/api/conversations/[id]",filename:"route",bundlePath:"app/api/conversations/[id]/route"},resolvedPagePath:"/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/api/conversations/[id]/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:p,serverHooks:h}=u,f="/api/conversations/[id]/route";function c(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:p})}n()}catch(e){n(e)}})},7838:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{DELETE:()=>p,GET:()=>l});var o=r(7070),a=r(7395),i=r(306),s=r(7745),d=r(1445),c=r(2405),u=e([a]);async function l(e,{params:t}){try{let r=e.headers.get("authorization"),n=await (0,c.k)(r);if(!n)return o.NextResponse.json({error:"Unauthorized"},{status:401});let u=Number.parseInt(t.id,10);if(!Number.isFinite(u))return o.NextResponse.json({error:"Invalid conversation id"},{status:400});let l=await a.db.select({id:i.p5.id,title:i.p5.title,createdAt:i.p5.createdAt,updatedAt:i.p5.updatedAt}).from(i.p5).where((0,s.xD)((0,s.eq)(i.p5.id,u),(0,s.eq)(i.p5.userId,n.id))).limit(1);if(0===l.length)return o.NextResponse.json({error:"Conversation not found"},{status:404});let p=await a.db.select({id:i.sY.id,role:i.sY.role,content:i.sY.content,citations:i.sY.citations,createdAt:i.sY.createdAt}).from(i.sY).where((0,s.eq)(i.sY.conversationId,u)).orderBy((0,d.d)(i.sY.createdAt),(0,d.d)(i.sY.id));return o.NextResponse.json({conversation:l[0],messages:p})}catch(e){return console.error("Error fetching conversation messages:",e),o.NextResponse.json({error:"Failed to fetch conversation messages"},{status:500})}}async function p(e,{params:t}){try{let r=e.headers.get("authorization"),n=await (0,c.k)(r);if(!n)return o.NextResponse.json({error:"Unauthorized"},{status:401});let d=Number.parseInt(t.id,10);if(!Number.isFinite(d))return o.NextResponse.json({error:"Invalid conversation id"},{status:400});let u=await a.db.delete(i.p5).where((0,s.xD)((0,s.eq)(i.p5.id,d),(0,s.eq)(i.p5.userId,n.id))).returning({id:i.p5.id});if(0===u.length)return o.NextResponse.json({error:"Conversation not found"},{status:404});return new o.NextResponse(null,{status:204})}catch(e){return console.error("Error deleting conversation:",e),o.NextResponse.json({error:"Failed to delete conversation"},{status:500})}}a=(u.then?(await u)():u)[0],n()}catch(e){n(e)}})},7395:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{db:()=>u});var o=r(8029),a=r(8678),i=e([a,o]);[a,o]=i.then?(await i)():i;let s=process.env.DATABASE_URL??process.env.POSTGRES_URL??process.env.POSTGRES_CONNECTION_STRING??"postgresql://postgres:postgres@db:5432/vector_db",d=process.env.DATABASE_SSL?.toLowerCase()==="true"||process.env.DATABASE_SSL?.toLowerCase()==="require",c=globalThis.__tsaDbPool||new a.Pool({connectionString:s,ssl:d?{rejectUnauthorized:!1}:void 0}),u=(0,o.tS)(c);n()}catch(e){n(e)}})},306:(e,t,r)=>{r.d(t,{De:()=>l,p5:()=>c,sY:()=>u,yD:()=>p});var n=r(7561),o=r(5961),a=r(2140),i=r(2941),s=r(1575),d=r(8680);let c=(0,n.af)("conversations",{id:(0,o.eP)("id").primaryKey(),title:(0,a.fL)("title").notNull(),userId:(0,i._L)("user_id"),createdAt:(0,s.AB)("created_at",{withTimezone:!0}).defaultNow().notNull(),updatedAt:(0,s.AB)("updated_at",{withTimezone:!0}).defaultNow(),lastReviewedAt:(0,s.AB)("last_reviewed_at",{withTimezone:!0})}),u=(0,n.af)("messages",{id:(0,o.eP)("id").primaryKey(),conversationId:(0,i._L)("conversation_id").notNull().references(()=>c.id,{onDelete:"cascade"}),role:(0,a.fL)("role").notNull(),content:(0,a.fL)("content").notNull(),citations:(0,d.JB)("citations").$type(),createdAt:(0,s.AB)("created_at",{withTimezone:!0}).defaultNow().notNull()}),l=(0,n.af)("documents",{id:(0,o.eP)("id").primaryKey(),fileName:(0,a.fL)("file_name").notNull(),title:(0,a.fL)("title").notNull(),description:(0,a.fL)("description"),fileHash:(0,a.fL)("file_hash"),fileSize:(0,i._L)("file_size"),mimeType:(0,a.fL)("mime_type"),documentType:(0,a.fL)("document_type"),productName:(0,a.fL)("product_name"),productVersion:(0,a.fL)("product_version"),privacyLevel:(0,a.fL)("privacy_level"),processedAt:(0,s.AB)("processed_at",{withTimezone:!0}),createdAt:(0,s.AB)("created_at",{withTimezone:!0}).defaultNow().notNull(),updatedAt:(0,s.AB)("updated_at",{withTimezone:!0}).defaultNow().notNull()}),p=(0,n.af)("document_chunks",{id:(0,o.eP)("id").primaryKey(),documentId:(0,i._L)("document_id").notNull().references(()=>l.id,{onDelete:"cascade"}),chunkIndex:(0,i._L)("chunk_index"),pageNumber:(0,i._L)("page_number"),chunkType:(0,a.fL)("chunk_type"),content:(0,a.fL)("content").notNull(),contentHash:(0,a.fL)("content_hash"),contentLength:(0,i._L)("content_length").default(0).notNull(),metadata:(0,d.JB)("metadata").$type().default({}),embedding:(0,d.JB)("embedding").$type(),createdAt:(0,s.AB)("created_at",{withTimezone:!0}).defaultNow().notNull(),updatedAt:(0,s.AB)("updated_at",{withTimezone:!0}).defaultNow()})},2405:(e,t,r)=>{r.d(t,{k:()=>o});let n=process.env.RERANKER_BASE_URL||"http://reranker:8008";async function o(e){if(!e)return null;try{let t=await fetch(`${n}/api/auth/me`,{method:"GET",headers:{Authorization:e},cache:"no-store"});if(!t.ok)return null;let r=await t.json();if(!r||"number"!=typeof r.id)return null;return r}catch(e){return console.error("Failed to fetch current user:",e),null}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8948,5972,8029],()=>r(5108));module.exports=n})();