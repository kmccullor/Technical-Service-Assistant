"use strict";(()=>{var e={};e.id=235,e.ids=[235],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8678:e=>{e.exports=import("pg")},1281:(e,t,n)=>{n.a(e,async(e,o)=>{try{n.r(t),n.d(t,{originalPathname:()=>h,patchFetch:()=>d,requestAsyncStorage:()=>l,routeModule:()=>u,serverHooks:()=>p,staticGenerationAsyncStorage:()=>m});var a=n(3278),s=n(5002),r=n(4877),i=n(8141),c=e([i]);i=(c.then?(await c)():c)[0];let u=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/knowledge-base/route",pathname:"/api/knowledge-base",filename:"route",bundlePath:"app/api/knowledge-base/route"},resolvedPagePath:"/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/api/knowledge-base/route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:p}=u,h="/api/knowledge-base/route";function d(){return(0,r.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:m})}o()}catch(e){o(e)}})},8141:(e,t,n)=>{n.a(e,async(e,o)=>{try{n.r(t),n.d(t,{GET:()=>c});var a=n(8420),s=n(7382),r=n(4214),i=e([a]);async function c(e){try{let[e]=await a.db.select({documents:(0,r.i6)`COUNT(DISTINCT ${s.documentChunks.documentId})::int`,chunks:(0,r.i6)`COUNT(*)::int`,avgChunkLength:(0,r.i6)`AVG(${s.documentChunks.contentLength})::int`,totalContent:(0,r.i6)`SUM(${s.documentChunks.contentLength})::bigint`}).from(s.documentChunks),t=await a.db.select({documentId:s.documentChunks.documentId,title:(0,r.i6)`MAX(${s.documentChunks.metadata}->>'document')`,chunkCount:(0,r.i6)`COUNT(*)::int`}).from(s.documentChunks).groupBy(s.documentChunks.documentId).orderBy((0,r.i6)`MAX(${s.documentChunks.metadata}->>'document')`);return Response.json({stats:{documents:e.documents,chunks:e.chunks,avgChunkLength:e.avgChunkLength,totalContent:Number(e.totalContent)},documents:t})}catch(e){return console.error("Knowledge base stats error:",e),new Response("Internal server error",{status:500})}}a=(i.then?(await i)():i)[0],o()}catch(e){o(e)}})},8420:(e,t,n)=>{n.a(e,async(e,o)=>{try{n.d(t,{db:()=>m});var a=n(2163),s=n(8678),r=n(7382),i=e([s,a]);[s,a]=i.then?(await i)():i;let c="postgresql://postgres:postgres@pgvector:5432/vector_db";if(console.log("Database configuration:",{DATABASE_URL:c?"set":"not set",DATABASE_URL_value:c,NODE_ENV:"production"}),!c)throw Error("DATABASE_URL environment variable is required");let d=new URL(c),u={host:d.hostname,port:parseInt(d.port)||5432,database:d.pathname.slice(1),user:d.username,password:d.password,ssl:!1,max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:2e3};console.log("Raw URL parts:",{href:d.href,hostname:d.hostname,port:d.port,pathname:d.pathname,username:d.username}),console.log("Parsed connection config:",{host:u.host,port:u.port,database:u.database,user:u.user});let l=new s.Pool(u);l.on("error",e=>{console.error("PostgreSQL pool error:",e)});let m=(0,a.tS)(l,{schema:r});o()}catch(e){o(e)}})},7382:(e,t,n)=>{n.r(t),n.d(t,{conversations:()=>g,conversationsRelations:()=>y,documentChunks:()=>f,documentChunksRelations:()=>v,documents:()=>h,documentsRelations:()=>_,messages:()=>L,messagesRelations:()=>k});var o=n(6620),a=n(9894),s=n(9411),r=n(7681),i=n(4717),c=n(4006),d=n(5671),u=n(380),l=n(3204),m=n(4211),p=n(4497);let h=(0,o.af)("documents",{id:(0,a.c0)("id",{mode:"number"}).primaryKey(),fileName:(0,s.fL)("file_name").notNull(),originalPath:(0,s.fL)("original_path"),fileHash:(0,s.fL)("file_hash").notNull().unique(),fileSize:(0,r.Kv)("file_size",{mode:"number"}),mimeType:(0,s.fL)("mime_type"),title:(0,s.fL)("title"),version:(0,s.fL)("version"),docNumber:(0,s.fL)("doc_number"),gaDate:(0,i.hT)("ga_date"),publisher:(0,s.fL)("publisher"),copyrightYear:(0,c._L)("copyright_year"),productFamily:(0,s.fL)("product_family").array(),productName:(0,s.fL)("product_name"),productVersion:(0,s.fL)("product_version"),documentType:(0,s.fL)("document_type"),documentCategory:(0,s.fL)("document_category"),serviceLines:(0,s.fL)("service_lines").array(),audiences:(0,s.fL)("audiences").array(),privacyLevel:(0,s.fL)("privacy_level").default("public"),securityClassification:(0,s.fL)("security_classification"),classificationConfidence:(0,d.kw)("classification_confidence"),classificationMethod:(0,s.fL)("classification_method"),processingStatus:(0,s.fL)("processing_status").default("pending"),processedAt:(0,u.AB)("processed_at",{withTimezone:!0}),metadata:(0,l.JB)("metadata").default("{}"),createdAt:(0,u.AB)("created_at",{withTimezone:!0}).defaultNow(),updatedAt:(0,u.AB)("updated_at",{withTimezone:!0}).defaultNow()}),f=(0,o.af)("document_chunks",{id:(0,a.c0)("id",{mode:"number"}).primaryKey(),documentId:(0,r.Kv)("document_id",{mode:"number"}).references(()=>h.id,{onDelete:"cascade"}).notNull(),chunkIndex:(0,c._L)("chunk_index").notNull(),pageNumber:(0,c._L)("page_number"),sectionTitle:(0,s.fL)("section_title"),chunkType:(0,s.fL)("chunk_type").default("text"),content:(0,s.fL)("content").notNull(),contentHash:(0,s.fL)("content_hash").notNull(),contentLength:(0,c._L)("content_length"),embedding:(0,m.xr)("embedding",{dimensions:768}),language:(0,s.fL)("language").default("en"),tokens:(0,c._L)("tokens"),metadata:(0,l.JB)("metadata").default("{}"),contentTsvector:(0,s.fL)("content_tsvector"),createdAt:(0,u.AB)("created_at",{withTimezone:!0}).defaultNow()}),g=(0,o.af)("conversations",{id:(0,a.c0)("id",{mode:"number"}).primaryKey(),title:(0,s.fL)("title").notNull(),createdAt:(0,u.AB)("created_at",{withTimezone:!0}).defaultNow()}),L=(0,o.af)("messages",{id:(0,a.c0)("id",{mode:"number"}).primaryKey(),conversationId:(0,r.Kv)("conversation_id",{mode:"number"}).references(()=>g.id,{onDelete:"cascade"}).notNull(),role:(0,s.fL)("role",{enum:["user","assistant","system"]}).notNull(),content:(0,s.fL)("content").notNull(),citations:(0,l.JB)("citations"),createdAt:(0,u.AB)("created_at",{withTimezone:!0}).defaultNow()}),_=(0,p.lE)(h,({many:e})=>({chunks:e(f)})),v=(0,p.lE)(f,({one:e})=>({document:e(h,{fields:[f.documentId],references:[h.id]})})),y=(0,p.lE)(g,({many:e})=>({messages:e(L)})),k=(0,p.lE)(L,({one:e})=>({conversation:e(g,{fields:[L.conversationId],references:[g.id]})}))},3278:(e,t,n)=>{e.exports=n(517)}};var t=require("../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),o=t.X(0,[379,163],()=>n(1281));module.exports=o})();