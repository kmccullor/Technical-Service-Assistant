"use strict";(()=>{var e={};e.id=4235,e.ids=[4235],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8678:e=>{e.exports=import("pg")},1281:(e,t,n)=>{n.a(e,async(e,o)=>{try{n.r(t),n.d(t,{originalPathname:()=>h,patchFetch:()=>c,requestAsyncStorage:()=>l,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p});var a=n(9303),r=n(8716),i=n(670),d=n(5230),s=e([d]);d=(s.then?(await s)():s)[0];let u=new a.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/knowledge-base/route",pathname:"/api/knowledge-base",filename:"route",bundlePath:"app/api/knowledge-base/route"},resolvedPagePath:"/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/api/knowledge-base/route.ts",nextConfigOutput:"standalone",userland:d}),{requestAsyncStorage:l,staticGenerationAsyncStorage:p,serverHooks:m}=u,h="/api/knowledge-base/route";function c(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:p})}o()}catch(e){o(e)}})},5230:(e,t,n)=>{n.a(e,async(e,o)=>{try{n.r(t),n.d(t,{GET:()=>s});var a=n(7395),r=n(306),i=n(2315),d=e([a]);async function s(e){try{let[e]=await a.db.select({documents:(0,i.i6)`COUNT(DISTINCT ${r.yD.documentId})::int`,chunks:(0,i.i6)`COUNT(*)::int`,avgChunkLength:(0,i.i6)`AVG(${r.yD.contentLength})::int`,totalContent:(0,i.i6)`SUM(${r.yD.contentLength})::bigint`}).from(r.yD),t=await a.db.select({documentId:r.yD.documentId,title:(0,i.i6)`MAX(${r.yD.metadata}->>'document')`,chunkCount:(0,i.i6)`COUNT(*)::int`}).from(r.yD).groupBy(r.yD.documentId).orderBy((0,i.i6)`MAX(${r.yD.metadata}->>'document')`);return Response.json({stats:{documents:e.documents,chunks:e.chunks,avgChunkLength:e.avgChunkLength,totalContent:Number(e.totalContent)},documents:t})}catch(e){return console.error("Knowledge base stats error:",e),new Response("Internal server error",{status:500})}}a=(d.then?(await d)():d)[0],o()}catch(e){o(e)}})},7395:(e,t,n)=>{n.a(e,async(e,o)=>{try{n.d(t,{db:()=>u});var a=n(8029),r=n(8678),i=e([r,a]);[r,a]=i.then?(await i)():i;let d=process.env.DATABASE_URL??process.env.POSTGRES_URL??process.env.POSTGRES_CONNECTION_STRING??"postgresql://postgres:postgres@db:5432/vector_db",s=process.env.DATABASE_SSL?.toLowerCase()==="true"||process.env.DATABASE_SSL?.toLowerCase()==="require",c=globalThis.__tsaDbPool||new r.Pool({connectionString:d,ssl:s?{rejectUnauthorized:!1}:void 0}),u=(0,a.tS)(c);o()}catch(e){o(e)}})},306:(e,t,n)=>{n.d(t,{De:()=>l,p5:()=>c,sY:()=>u,yD:()=>p});var o=n(7561),a=n(5961),r=n(2140),i=n(2941),d=n(1575),s=n(8680);let c=(0,o.af)("conversations",{id:(0,a.eP)("id").primaryKey(),title:(0,r.fL)("title").notNull(),userId:(0,i._L)("user_id"),createdAt:(0,d.AB)("created_at",{withTimezone:!0}).defaultNow().notNull(),updatedAt:(0,d.AB)("updated_at",{withTimezone:!0}).defaultNow(),lastReviewedAt:(0,d.AB)("last_reviewed_at",{withTimezone:!0})}),u=(0,o.af)("messages",{id:(0,a.eP)("id").primaryKey(),conversationId:(0,i._L)("conversation_id").notNull().references(()=>c.id,{onDelete:"cascade"}),role:(0,r.fL)("role").notNull(),content:(0,r.fL)("content").notNull(),citations:(0,s.JB)("citations").$type(),createdAt:(0,d.AB)("created_at",{withTimezone:!0}).defaultNow().notNull()}),l=(0,o.af)("documents",{id:(0,a.eP)("id").primaryKey(),fileName:(0,r.fL)("file_name").notNull(),title:(0,r.fL)("title").notNull(),description:(0,r.fL)("description"),fileHash:(0,r.fL)("file_hash"),fileSize:(0,i._L)("file_size"),mimeType:(0,r.fL)("mime_type"),documentType:(0,r.fL)("document_type"),productName:(0,r.fL)("product_name"),productVersion:(0,r.fL)("product_version"),privacyLevel:(0,r.fL)("privacy_level"),processedAt:(0,d.AB)("processed_at",{withTimezone:!0}),createdAt:(0,d.AB)("created_at",{withTimezone:!0}).defaultNow().notNull(),updatedAt:(0,d.AB)("updated_at",{withTimezone:!0}).defaultNow().notNull()}),p=(0,o.af)("document_chunks",{id:(0,a.eP)("id").primaryKey(),documentId:(0,i._L)("document_id").notNull().references(()=>l.id,{onDelete:"cascade"}),chunkIndex:(0,i._L)("chunk_index"),pageNumber:(0,i._L)("page_number"),chunkType:(0,r.fL)("chunk_type"),content:(0,r.fL)("content").notNull(),contentHash:(0,r.fL)("content_hash"),contentLength:(0,i._L)("content_length").default(0).notNull(),metadata:(0,s.JB)("metadata").$type().default({}),embedding:(0,s.JB)("embedding").$type(),createdAt:(0,d.AB)("created_at",{withTimezone:!0}).defaultNow().notNull(),updatedAt:(0,d.AB)("updated_at",{withTimezone:!0}).defaultNow()})},9303:(e,t,n)=>{e.exports=n(517)}};var t=require("../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),o=t.X(0,[8948,8029],()=>n(1281));module.exports=o})();