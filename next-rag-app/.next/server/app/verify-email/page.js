(()=>{var e={};e.id=6931,e.ids=[6931],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},6066:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>h,originalPathname:()=>d,pages:()=>u,routeModule:()=>p,tree:()=>c}),r(2133),r(9458),r(996);var n=r(170),a=r(5002),s=r(3876),i=r.n(s),l=r(6299),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);r.d(t,o);let c=["",{children:["verify-email",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,2133)),"/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/verify-email/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,9458)),"/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,996,23)),"next/dist/client/components/not-found-error"]}],u=["/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/verify-email/page.tsx"],d="/verify-email/page",h={require:r,loadChunk:()=>Promise.resolve()},p=new n.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/verify-email/page",pathname:"/verify-email",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},6847:(e,t,r)=>{Promise.resolve().then(r.bind(r,1426))},3649:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,3642,23)),Promise.resolve().then(r.t.bind(r,7586,23)),Promise.resolve().then(r.t.bind(r,7838,23)),Promise.resolve().then(r.t.bind(r,8057,23)),Promise.resolve().then(r.t.bind(r,7741,23)),Promise.resolve().then(r.t.bind(r,3118,23))},7730:(e,t,r)=>{Promise.resolve().then(r.bind(r,9410))},1426:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});var n=r(7247),a=r(8964),s=r(9906);function i(){let[e,t]=(0,a.useState)("idle"),[r,i]=(0,a.useState)(""),[l,o]=(0,a.useState)("");return n.jsx("div",{className:"min-h-screen flex items-center justify-center p-6",children:(0,n.jsxs)("div",{className:"max-w-md w-full border rounded p-6 space-y-4 bg-background",children:[n.jsx("h1",{className:"text-xl font-semibold",children:"Email Verification"}),"verifying"===e&&n.jsx("p",{className:"text-sm text-muted-foreground",children:"Verifying your token..."}),"success"===e&&n.jsx("p",{className:"text-sm text-green-600",children:r}),"error"===e&&n.jsx("p",{className:"text-sm text-red-600",children:r}),(0,n.jsxs)("div",{className:"pt-2 flex gap-3",children:[n.jsx(s.default,{href:"/login",className:"text-sm underline",children:"Go to Login"}),"error"===e&&l&&n.jsx("button",{onClick:()=>{window.location.reload()},className:"text-sm underline",children:"Retry"})]})]})})}},9410:(e,t,r)=>{"use strict";r.d(t,{AuthProvider:()=>o,a:()=>c});var n=r(7247),a=r(8964);let s=(0,a.createContext)(void 0),i="tsa_auth_v1";function l(e){try{localStorage.setItem(i,JSON.stringify(e))}catch(e){}}let o=({children:e})=>{let[t,r]=(0,a.useState)({user:null,accessToken:null,refreshToken:null,expiresAt:null,loading:!0,error:null}),o=e=>r(t=>({...t,...e})),c=e=>e;(0,a.useEffect)(()=>{let e=!1;return(async()=>{let t=function(){try{let e=localStorage.getItem(i);if(!e)return null;return JSON.parse(e)}catch(e){return null}}();if(!t?.accessToken){e||o({loading:!1});return}o({...t,loading:!0});try{let t=await fetch(c("/api/auth/health")).catch(()=>null);if(!t||!t.ok&&404!==t.status){e||o({loading:!1,error:"Auth service unavailable"});return}}catch(t){e||o({loading:!1,error:"Auth service unavailable"});return}try{let r=await fetch(c("/api/auth/me"),{headers:{Authorization:`Bearer ${t.accessToken}`}});if(r.ok){let t=await r.json();e||o({user:t,loading:!1})}else e||(o({loading:!1,accessToken:null,refreshToken:null,user:null}),l({}))}catch(t){e||o({loading:!1})}})(),()=>{e=!0}},[]);let u=(0,a.useCallback)(async(e,t)=>{o({loading:!0,error:null});try{let r=await fetch(c("/api/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!r.ok){let e="Login failed";try{let t=await r.json();t&&"string"==typeof t.detail&&(e=t.detail)}catch(e){}return o({loading:!1,error:e}),!1}let n=null;try{n=await r.json()}catch(e){return o({loading:!1,error:"Malformed server response"}),!1}if(!n||"object"!=typeof n||!n.access_token||!n.refresh_token||"number"!=typeof n.expires_in||!n.user)return o({loading:!1,error:"Unexpected auth response"}),!1;let a=Number.isFinite(n.expires_in)?n.expires_in:0,s=Date.now()+Math.max(0,1e3*a-5e3),i={accessToken:n.access_token,refreshToken:n.refresh_token,expiresAt:s,user:n.user};return o({...i,loading:!1}),l(i),!0}catch(e){return o({loading:!1,error:"Network error"}),!1}},[]),d=(0,a.useCallback)(async e=>{o({loading:!0,error:null});try{let t=await fetch(c("/api/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,role_id:e.role_id||2})});if(!t.ok){let e=(await t.json().catch(()=>({}))).detail||"Registration failed";return o({loading:!1,error:e}),!1}return o({loading:!1}),!0}catch(e){return o({loading:!1,error:"Network error"}),!1}},[]),h=(0,a.useCallback)(()=>{o({user:null,accessToken:null,refreshToken:null,expiresAt:null}),l({})},[]);(0,a.useEffect)(()=>{if(globalThis._tsaFetchWrapped)return;let e=fetch;globalThis._tsaFetchWrapped=!0,globalThis.fetch=async(...t)=>{let r=await e(...t);if(401===r.status){let e="string"==typeof t[0]?t[0]:t[0].url;e.includes("/api/auth/login")||e.includes("/api/auth/register")||h()}return r}},[h]);let p=(0,a.useCallback)(async()=>{if(t.refreshToken&&!p._inFlight){p._inFlight=!0;try{let e=await fetch(c("/api/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:t.refreshToken})});if(!e.ok)return h();let r=await e.json(),n=1e3*r.expires_in,a=Date.now()+n-Math.min(5e3,Math.max(1e3,.08*n)),s={accessToken:r.access_token,expiresAt:a,user:r.user};o(s),l({...s,refreshToken:t.refreshToken})}catch(e){h()}finally{p._inFlight=!1}}},[t.refreshToken,h]);(0,a.useEffect)(()=>{if(!t.expiresAt)return;let e=t.expiresAt-Date.now();if(e<=0){p();return}let r=e-.12*e;r<1500&&(r=Math.min(Math.max(e-500,0),1500));let n=setTimeout(()=>p(),r);return()=>clearTimeout(n)},[t.expiresAt,p]);let m={...t,login:u,register:d,logout:h,refresh:p};return n.jsx(s.Provider,{value:m,children:e})};function c(){let e=(0,a.useContext)(s);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},9458:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c,metadata:()=>o});var n=r(2051),a=r(1312),s=r.n(a);r(7272);var i=r(5347);let l=(0,i.createProxy)(String.raw`/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/src/context/AuthContext.tsx#AuthProvider`);(0,i.createProxy)(String.raw`/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/src/context/AuthContext.tsx#useAuth`);let o={title:"Technical Services Assistant",description:"Intelligent document search and chat with RAG capabilities"};function c({children:e}){return n.jsx("html",{lang:"en",children:n.jsx("body",{className:s().className,children:n.jsx(l,{children:n.jsx("div",{className:"min-h-screen bg-background",children:e})})})})}},2133:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});let n=(0,r(5347).createProxy)(String.raw`/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/verify-email/page.tsx#default`)},7272:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[9379,2704,9906],()=>r(6066));module.exports=n})();