(()=>{var e={};e.id=6931,e.ids=[6931],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},6066:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>o.a,__next_app__:()=>h,originalPathname:()=>d,pages:()=>u,routeModule:()=>g,tree:()=>c}),r(6343),r(356),r(5866);var s=r(3191),n=r(8716),a=r(7922),o=r.n(a),i=r(5231),l={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>i[e]);r.d(t,l);let c=["",{children:["verify-email",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,6343)),"/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/verify-email/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,356)),"/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],u=["/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/verify-email/page.tsx"],d="/verify-email/page",h={require:r,loadChunk:()=>Promise.resolve()},g=new s.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/verify-email/page",pathname:"/verify-email",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},6847:(e,t,r)=>{Promise.resolve().then(r.bind(r,5034))},3649:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2994,23)),Promise.resolve().then(r.t.bind(r,6114,23)),Promise.resolve().then(r.t.bind(r,9727,23)),Promise.resolve().then(r.t.bind(r,9671,23)),Promise.resolve().then(r.t.bind(r,1868,23)),Promise.resolve().then(r.t.bind(r,4759,23))},7730:(e,t,r)=>{Promise.resolve().then(r.bind(r,4690))},5034:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var s=r(326),n=r(7577),a=r(434);function o(){let[e,t]=(0,n.useState)("idle"),[r,o]=(0,n.useState)(""),[i,l]=(0,n.useState)("");return s.jsx("div",{className:"min-h-screen flex items-center justify-center p-6",children:(0,s.jsxs)("div",{className:"max-w-md w-full border rounded p-6 space-y-4 bg-background",children:[s.jsx("h1",{className:"text-xl font-semibold",children:"Email Verification"}),"verifying"===e&&s.jsx("p",{className:"text-sm text-muted-foreground",children:"Verifying your token..."}),"success"===e&&s.jsx("p",{className:"text-sm text-green-600",children:r}),"error"===e&&s.jsx("p",{className:"text-sm text-red-600",children:r}),(0,s.jsxs)("div",{className:"pt-2 flex gap-3",children:[s.jsx(a.default,{href:"/login",className:"text-sm underline",children:"Go to Login"}),"error"===e&&i&&s.jsx("button",{onClick:()=>{window.location.reload()},className:"text-sm underline",children:"Retry"})]})]})})}},4690:(e,t,r)=>{"use strict";r.d(t,{AuthProvider:()=>l,a:()=>c});var s=r(326),n=r(7577);let a=(0,n.createContext)(void 0),o="tsa_auth_v1";function i(e){try{localStorage.setItem(o,JSON.stringify(e))}catch(e){}}let l=({children:e})=>{let[t,r]=(0,n.useState)({user:null,accessToken:null,refreshToken:null,expiresAt:null,loading:!0,error:null}),l=e=>r(t=>({...t,...e})),c=e=>e;(0,n.useEffect)(()=>{let e=!1;return(async()=>{console.log("[AUTH] Initializing auth context");let t=function(){try{let e=localStorage.getItem(o);if(!e)return null;return JSON.parse(e)}catch(e){return null}}();if(console.log("[AUTH] Persisted state:",t?"Found tokens":"No tokens"),!t?.accessToken){console.log("[AUTH] No access token found, setting loading false"),e||l({loading:!1});return}console.log("[AUTH] Found access token, loading user profile"),l({...t,loading:!0});try{let t=await fetch(c("/api/auth/health")).catch(()=>null);if(!t||!t.ok&&404!==t.status){e||l({loading:!1,error:"Auth service unavailable"});return}}catch(t){e||l({loading:!1,error:"Auth service unavailable"});return}try{console.log("[AUTH] Fetching user profile from /api/auth/me");let r=await fetch(c("/api/auth/me"),{headers:{Authorization:`Bearer ${t.accessToken}`}});if(console.log("[AUTH] Profile fetch response status:",r.status),r.ok){let t=await r.json();console.log("[AUTH] Profile loaded:",{id:t.id,email:t.email,password_change_required:t.password_change_required}),e||l({user:t,loading:!1})}else e||(l({loading:!1,accessToken:null,refreshToken:null,user:null}),i({}))}catch(t){e||l({loading:!1})}})(),()=>{e=!0}},[]);let u=(0,n.useCallback)(async(e,t)=>{console.log("[AUTH] Login attempt for:",e),l({loading:!0,error:null});try{console.log("[AUTH] Sending login request to:",c("/api/auth/login"));let r=await fetch(c("/api/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(console.log("[AUTH] Login response status:",r.status),!r.ok){let e="Login failed";try{let t=await r.json();t&&"string"==typeof t.detail&&(e=t.detail)}catch(e){}return l({loading:!1,error:e}),!1}let s=null;try{s=await r.json()}catch(e){return l({loading:!1,error:"Malformed server response"}),!1}if(console.log("[AUTH] Login response data:",{hasAccessToken:!!s.access_token,hasRefreshToken:!!s.refresh_token,hasUser:!!s.user,userPasswordChangeRequired:s.user?.password_change_required}),!s||"object"!=typeof s||!s.access_token||!s.refresh_token||"number"!=typeof s.expires_in||!s.user)return console.log("[AUTH] Invalid login response data"),l({loading:!1,error:"Unexpected auth response"}),!1;let n=Number.isFinite(s.expires_in)?s.expires_in:0,a=Date.now()+Math.max(0,1e3*n-5e3),o={accessToken:s.access_token,refreshToken:s.refresh_token,expiresAt:a,user:s.user};return console.log("[AUTH] Login successful, setting user state:",{email:s.user.email,password_change_required:s.user.password_change_required}),l({...o,loading:!1}),i(o),!0}catch(e){return l({loading:!1,error:"Network error"}),!1}},[]),d=(0,n.useCallback)(async e=>{l({loading:!0,error:null});try{let t=await fetch(c("/api/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,role_id:e.role_id||2})});if(!t.ok){let e=(await t.json().catch(()=>({}))).detail||"Registration failed";return l({loading:!1,error:e}),!1}return l({loading:!1}),!0}catch(e){return l({loading:!1,error:"Network error"}),!1}},[]),h=(0,n.useCallback)(()=>{l({user:null,accessToken:null,refreshToken:null,expiresAt:null}),i({})},[]);(0,n.useEffect)(()=>{if(globalThis._tsaFetchWrapped)return;let e=fetch;globalThis._tsaFetchWrapped=!0,globalThis.fetch=async(...t)=>{let r=await e(...t);if(401===r.status){let e="string"==typeof t[0]?t[0]:t[0].url;e.includes("/api/auth/login")||e.includes("/api/auth/register")||h()}return r}},[h]);let g=(0,n.useCallback)(async()=>{if(console.log("[AUTH] Refresh called"),!t.refreshToken){console.log("[AUTH] No refresh token available");return}if(g._inFlight){console.log("[AUTH] Refresh already in flight");return}console.log("[AUTH] Starting token refresh"),g._inFlight=!0;try{let e=await fetch(c("/api/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:t.refreshToken})});if(console.log("[AUTH] Refresh response status:",e.status),!e.ok)return console.log("[AUTH] Refresh failed, logging out"),h();let r=await e.json();console.log("[AUTH] Refresh successful, updated user:",{email:r.user?.email,password_change_required:r.user?.password_change_required});let s=1e3*r.expires_in,n=Date.now()+s-Math.min(5e3,Math.max(1e3,.08*s)),a={accessToken:r.access_token,expiresAt:n,user:r.user};l(a),i({...a,refreshToken:t.refreshToken})}catch(e){h()}finally{g._inFlight=!1}},[t.refreshToken,h]);(0,n.useEffect)(()=>{if(!t.expiresAt)return;let e=t.expiresAt-Date.now();if(e<=0){g();return}let r=e-.12*e;r<1500&&(r=Math.min(Math.max(e-500,0),1500));let s=setTimeout(()=>g(),r);return()=>clearTimeout(s)},[t.expiresAt,g]);let p={...t,login:u,register:d,logout:h,refresh:g};return s.jsx(a.Provider,{value:p,children:e})};function c(){let e=(0,n.useContext)(a);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},356:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c,metadata:()=>l});var s=r(9510),n=r(5384),a=r.n(n);r(7272);var o=r(8570);let i=(0,o.createProxy)(String.raw`/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/src/context/AuthContext.tsx#AuthProvider`);(0,o.createProxy)(String.raw`/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/src/context/AuthContext.tsx#useAuth`);let l={title:"Technical Services Assistant",description:"Intelligent document search and chat with RAG capabilities"};function c({children:e}){return s.jsx("html",{lang:"en",children:s.jsx("body",{className:a().className,children:s.jsx(i,{children:s.jsx("div",{className:"min-h-screen bg-background",children:e})})})})}},6343:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(8570).createProxy)(String.raw`/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/verify-email/page.tsx#default`)},7272:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,2892,434],()=>r(6066));module.exports=s})();