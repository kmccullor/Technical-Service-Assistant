(()=>{var e={};e.id=3,e.ids=[3],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},462:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>o,routeModule:()=>h,tree:()=>c}),s(3389),s(9458),s(996);var a=s(170),r=s(5002),n=s(3876),l=s.n(n),i=s(6299),d={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>i[e]);s.d(t,d);let c=["",{children:["admin",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,3389)),"/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/admin/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,9458)),"/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,996,23)),"next/dist/client/components/not-found-error"]}],o=["/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/admin/page.tsx"],u="/admin/page",m={require:s,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/admin/page",pathname:"/admin",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},8108:(e,t,s)=>{Promise.resolve().then(s.bind(s,2279))},3649:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,3642,23)),Promise.resolve().then(s.t.bind(s,7586,23)),Promise.resolve().then(s.t.bind(s,7838,23)),Promise.resolve().then(s.t.bind(s,8057,23)),Promise.resolve().then(s.t.bind(s,7741,23)),Promise.resolve().then(s.t.bind(s,3118,23))},7730:(e,t,s)=>{Promise.resolve().then(s.bind(s,9410))},2279:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>f});var a=s(7247),r=s(8964),n=s(9410);async function l(e,t,s={}){let a=await fetch(e,{...s,headers:{"Content-Type":"application/json",...s.headers||{},...t?{Authorization:`Bearer ${t}`}:{}}});if(!a.ok)throw Error((await a.json().catch(()=>({}))).detail||`Request failed: ${a.status}`);return a.json()}async function i(e){let t=new URLSearchParams;return e.search&&t.set("search",e.search),e.page&&t.set("page",String(e.page)),e.page_size&&t.set("page_size",String(e.page_size)),l(`/api/admin/users?${t.toString()}`,e.accessToken)}async function d(e,t,s){return l(`/api/admin/users/${t}`,e,{method:"PATCH",body:JSON.stringify(s)})}async function c(e){return l("/api/admin/roles",e)}async function o(e,t,s){return l(`/api/admin/roles/${t}`,e,{method:"PATCH",body:JSON.stringify(s)})}async function u(e,t){return l("/api/admin/users",e,{method:"POST",body:JSON.stringify(t)})}async function m(e,t){let s=await fetch(`/api/admin/users/${t}`,{method:"DELETE",headers:{...e?{Authorization:`Bearer ${e}`}:{}}});if(!s.ok&&204!==s.status)throw Error((await s.json().catch(()=>({}))).detail||`Delete failed: ${s.status}`)}var h=s(9906),x=s(7792);let p=(0,s(6323).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);function f(){let{user:e,accessToken:t,loading:s}=(0,n.a)(),[l,f]=(0,r.useState)([]),[g,j]=(0,r.useState)([]),[b,y]=(0,r.useState)(!0),[v,N]=(0,r.useState)(null),[w,k]=(0,r.useState)(""),[_,S]=(0,r.useState)(null),[P,T]=(0,r.useState)(null),[A,C]=(0,r.useState)(!1),[D,E]=(0,r.useState)({email:"",password:"",first_name:"",last_name:"",role_id:2}),[M,O]=(0,r.useState)(!1),[R,$]=(0,r.useState)(null),q=async()=>{try{y(!0);let[e,s]=await Promise.all([i({accessToken:t,search:w}),c(t)]);f(e.users),j(s),N(null)}catch(e){N(e.message||"Failed to load admin data")}finally{y(!1)}},L=async(e,s)=>{try{S(e);let a=await d(t,e,{role_id:s});f(t=>t.map(t=>t.id===e?a:t))}catch(e){alert(e.message)}finally{S(null)}},F=async(e,s)=>{try{S(e);let a=await d(t,e,{status:s});f(t=>t.map(t=>t.id===e?a:t))}catch(e){alert(e.message)}finally{S(null)}},z=async(e,s)=>{try{T(e);let a=await o(t,e,{description:s});j(t=>t.map(t=>t.id===e?a:t))}catch(e){alert(e.message)}finally{T(null)}},J=async e=>{let s=l.find(t=>t.id===e);if(s&&confirm(`Delete user ${s.email}? This action cannot be undone.`))try{$(e),await m(t,e),f(t=>t.filter(t=>t.id!==e))}catch(e){alert(e.message||"Failed to delete user")}finally{$(null)}},U=async e=>{if(e.preventDefault(),!D.email||!D.password){alert("Email and password are required");return}try{O(!0);let e=await u(t,D);f(t=>[e,...t]),E({email:"",password:"",first_name:"",last_name:"",role_id:2}),C(!1),alert("User created successfully!")}catch(e){alert(e.message||"Failed to create user")}finally{O(!1)}};return s||b?a.jsx("div",{className:"flex items-center justify-center h-screen text-muted-foreground",children:"Loading..."}):e?"admin"!==e.role_name?(0,a.jsxs)("div",{className:"p-8 text-center space-y-4",children:[a.jsx("h1",{className:"text-2xl font-semibold",children:"Access Denied"}),a.jsx("p",{className:"text-muted-foreground",children:"You do not have permission to view administrative controls."}),a.jsx(h.default,{href:"/",className:"underline",children:"Return Home"})]}):(0,a.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,a.jsxs)("div",{className:"border-b p-4 flex items-center justify-between bg-muted/30",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx(h.default,{href:"/",className:"text-muted-foreground hover:text-foreground mr-2",children:"← Back"}),a.jsx(x.Z,{className:"h-5 w-5"}),a.jsx("h1",{className:"text-xl font-semibold",children:"Admin Dashboard"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx("input",{className:"border rounded px-2 py-1 text-sm",placeholder:"Search users",value:w,onChange:e=>k(e.target.value)}),(0,a.jsxs)("button",{onClick:q,className:"inline-flex items-center gap-1 border rounded px-3 py-1 text-sm hover:bg-muted",children:[a.jsx(p,{className:"h-4 w-4"})," Refresh"]})]})]}),v&&a.jsx("div",{className:"p-4 text-sm text-red-600",children:v}),b?a.jsx("div",{className:"flex-1 flex items-center justify-center text-muted-foreground",children:"Loading..."}):(0,a.jsxs)("div",{className:"flex-1 overflow-auto p-6 space-y-10",children:[(0,a.jsxs)("section",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[a.jsx("h2",{className:"text-lg font-medium",children:"Users"}),a.jsx("button",{onClick:()=>C(!A),className:"px-3 py-1 bg-primary text-primary-foreground rounded text-sm hover:bg-primary/90",children:A?"Cancel":"Add User"})]}),A&&(0,a.jsxs)("div",{className:"mb-4 p-4 border rounded bg-muted/20",children:[a.jsx("h3",{className:"text-md font-medium mb-3",children:"Create New User"}),(0,a.jsxs)("form",{onSubmit:U,className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Email *"}),a.jsx("input",{type:"email",required:!0,value:D.email,onChange:e=>E(t=>({...t,email:e.target.value})),className:"w-full border rounded px-2 py-1 text-sm"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Password *"}),a.jsx("input",{type:"password",required:!0,value:D.password,onChange:e=>E(t=>({...t,password:e.target.value})),className:"w-full border rounded px-2 py-1 text-sm"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"First Name"}),a.jsx("input",{type:"text",value:D.first_name,onChange:e=>E(t=>({...t,first_name:e.target.value})),className:"w-full border rounded px-2 py-1 text-sm"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Last Name"}),a.jsx("input",{type:"text",value:D.last_name,onChange:e=>E(t=>({...t,last_name:e.target.value})),className:"w-full border rounded px-2 py-1 text-sm"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Role"}),a.jsx("select",{value:D.role_id,onChange:e=>E(t=>({...t,role_id:Number(e.target.value)})),className:"w-full border rounded px-2 py-1 text-sm",children:g.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))})]}),a.jsx("div",{className:"flex items-end",children:a.jsx("button",{type:"submit",disabled:M,className:"px-4 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700 disabled:opacity-50",children:M?"Creating...":"Create User"})})]})]}),a.jsx("div",{className:"overflow-x-auto border rounded",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[a.jsx("thead",{className:"bg-muted/50",children:(0,a.jsxs)("tr",{className:"text-left",children:[a.jsx("th",{className:"p-2",children:"ID"}),a.jsx("th",{className:"p-2",children:"Email"}),a.jsx("th",{className:"p-2",children:"Name"}),a.jsx("th",{className:"p-2",children:"Role"}),a.jsx("th",{className:"p-2",children:"Status"}),a.jsx("th",{className:"p-2",children:"Verified"}),a.jsx("th",{className:"p-2",children:"Updated"}),a.jsx("th",{className:"p-2",children:"Actions"})]})}),(0,a.jsxs)("tbody",{children:[l.map(t=>(0,a.jsxs)("tr",{className:"border-t",children:[a.jsx("td",{className:"p-2 font-mono text-xs",children:t.id}),a.jsx("td",{className:"p-2",children:t.email}),a.jsx("td",{className:"p-2",children:t.full_name}),a.jsx("td",{className:"p-2",children:a.jsx("select",{className:"border rounded px-1 py-0.5 text-xs",value:t.role_id,disabled:_===t.id,onChange:e=>L(t.id,Number(e.target.value)),children:g.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))})}),a.jsx("td",{className:"p-2",children:(0,a.jsxs)("select",{className:"border rounded px-1 py-0.5 text-xs",value:t.status,disabled:_===t.id,onChange:e=>F(t.id,e.target.value),children:[a.jsx("option",{value:"active",children:"active"}),a.jsx("option",{value:"disabled",children:"disabled"}),a.jsx("option",{value:"pending",children:"pending"})]})}),a.jsx("td",{className:"p-2 text-center",children:t.verified?"✅":"❌"}),a.jsx("td",{className:"p-2 text-xs text-muted-foreground",children:t.updated_at?.replace("T"," ").substring(0,16)}),a.jsx("td",{className:"p-2",children:a.jsx("button",{onClick:()=>J(t.id),disabled:R===t.id||t.id===e.id,className:"text-xs px-2 py-0.5 rounded border border-red-600 text-red-600 hover:bg-red-600 hover:text-white disabled:opacity-40",title:t.id===e.id?"Cannot delete current logged in user":"Delete user",children:R===t.id?"Deleting...":"Delete"})})]},t.id)),0===l.length&&a.jsx("tr",{children:a.jsx("td",{colSpan:8,className:"p-4 text-center text-muted-foreground",children:"No users found."})})]})]})})]}),(0,a.jsxs)("section",{children:[a.jsx("h2",{className:"text-lg font-medium mb-3",children:"Roles"}),a.jsx("div",{className:"overflow-x-auto border rounded",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[a.jsx("thead",{className:"bg-muted/50",children:(0,a.jsxs)("tr",{className:"text-left",children:[a.jsx("th",{className:"p-2",children:"ID"}),a.jsx("th",{className:"p-2",children:"Name"}),a.jsx("th",{className:"p-2",children:"Description"}),a.jsx("th",{className:"p-2",children:"System"}),a.jsx("th",{className:"p-2",children:"Permissions"})]})}),a.jsx("tbody",{children:g.map(e=>(0,a.jsxs)("tr",{className:"border-t",children:[a.jsx("td",{className:"p-2 font-mono text-xs",children:e.id}),a.jsx("td",{className:"p-2 font-medium",children:e.name}),a.jsx("td",{className:"p-2",children:e.system?a.jsx("span",{className:"text-muted-foreground text-xs",children:e.description||"—"}):a.jsx("input",{className:"border rounded px-1 py-0.5 text-xs w-56",defaultValue:e.description||"",disabled:P===e.id,onBlur:t=>{t.target.value!==e.description&&z(e.id,t.target.value)}})}),a.jsx("td",{className:"p-2 text-center",children:e.system?"\uD83D\uDD12":""}),a.jsx("td",{className:"p-2 text-xs",children:(0,a.jsxs)("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(e.permissions||[]).map(e=>a.jsx("span",{className:"px-1.5 py-0.5 rounded bg-secondary text-[10px] tracking-wide uppercase",children:e},e)),(!e.permissions||0===e.permissions.length)&&a.jsx("span",{className:"text-muted-foreground",children:"—"})]})})]},e.id))})]})})]})]})]}):(0,a.jsxs)("div",{className:"p-8 text-center space-y-4",children:[a.jsx("h1",{className:"text-2xl font-semibold",children:"Authentication Required"}),a.jsx("p",{className:"text-muted-foreground",children:"You must be logged in to view this page."}),a.jsx(h.default,{href:"/login",className:"underline",children:"Go to Login"})]})}},6323:(e,t,s)=>{"use strict";s.d(t,{Z:()=>d});var a=s(8964);let r=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=(...e)=>e.filter((e,t,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim();var l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,a.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:s=2,absoluteStrokeWidth:r,className:i="",children:d,iconNode:c,...o},u)=>(0,a.createElement)("svg",{ref:u,...l,width:t,height:t,stroke:e,strokeWidth:r?24*Number(s)/Number(t):s,className:n("lucide",i),...o},[...c.map(([e,t])=>(0,a.createElement)(e,t)),...Array.isArray(d)?d:[d]])),d=(e,t)=>{let s=(0,a.forwardRef)(({className:s,...l},d)=>(0,a.createElement)(i,{ref:d,iconNode:t,className:n(`lucide-${r(e)}`,s),...l}));return s.displayName=`${e}`,s}},7792:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(6323).Z)("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]])},9410:(e,t,s)=>{"use strict";s.d(t,{AuthProvider:()=>d,a:()=>c});var a=s(7247),r=s(8964);let n=(0,r.createContext)(void 0),l="tsa_auth_v1";function i(e){try{localStorage.setItem(l,JSON.stringify(e))}catch(e){}}let d=({children:e})=>{let[t,s]=(0,r.useState)({user:null,accessToken:null,refreshToken:null,expiresAt:null,loading:!0,error:null}),d=e=>s(t=>({...t,...e})),c=e=>e;(0,r.useEffect)(()=>{let e=!1;return(async()=>{let t=function(){try{let e=localStorage.getItem(l);if(!e)return null;return JSON.parse(e)}catch(e){return null}}();if(!t?.accessToken){e||d({loading:!1});return}d({...t,loading:!0});try{let t=await fetch(c("/api/auth/health")).catch(()=>null);if(!t||!t.ok&&404!==t.status){e||d({loading:!1,error:"Auth service unavailable"});return}}catch(t){e||d({loading:!1,error:"Auth service unavailable"});return}try{let s=await fetch(c("/api/auth/me"),{headers:{Authorization:`Bearer ${t.accessToken}`}});if(s.ok){let t=await s.json();e||d({user:t,loading:!1})}else e||(d({loading:!1,accessToken:null,refreshToken:null,user:null}),i({}))}catch(t){e||d({loading:!1})}})(),()=>{e=!0}},[]);let o=(0,r.useCallback)(async(e,t)=>{d({loading:!0,error:null});try{let s=await fetch(c("/api/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!s.ok){let e="Login failed";try{let t=await s.json();t&&"string"==typeof t.detail&&(e=t.detail)}catch(e){}return d({loading:!1,error:e}),!1}let a=null;try{a=await s.json()}catch(e){return d({loading:!1,error:"Malformed server response"}),!1}if(!a||"object"!=typeof a||!a.access_token||!a.refresh_token||"number"!=typeof a.expires_in||!a.user)return d({loading:!1,error:"Unexpected auth response"}),!1;let r=Number.isFinite(a.expires_in)?a.expires_in:0,n=Date.now()+Math.max(0,1e3*r-5e3),l={accessToken:a.access_token,refreshToken:a.refresh_token,expiresAt:n,user:a.user};return d({...l,loading:!1}),i(l),!0}catch(e){return d({loading:!1,error:"Network error"}),!1}},[]),u=(0,r.useCallback)(async e=>{d({loading:!0,error:null});try{let t=await fetch(c("/api/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,role_id:e.role_id||2})});if(!t.ok){let e=(await t.json().catch(()=>({}))).detail||"Registration failed";return d({loading:!1,error:e}),!1}return d({loading:!1}),!0}catch(e){return d({loading:!1,error:"Network error"}),!1}},[]),m=(0,r.useCallback)(()=>{d({user:null,accessToken:null,refreshToken:null,expiresAt:null}),i({})},[]);(0,r.useEffect)(()=>{if(globalThis._tsaFetchWrapped)return;let e=fetch;globalThis._tsaFetchWrapped=!0,globalThis.fetch=async(...t)=>{let s=await e(...t);if(401===s.status){let e="string"==typeof t[0]?t[0]:t[0].url;e.includes("/api/auth/login")||e.includes("/api/auth/register")||m()}return s}},[m]);let h=(0,r.useCallback)(async()=>{if(t.refreshToken&&!h._inFlight){h._inFlight=!0;try{let e=await fetch(c("/api/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:t.refreshToken})});if(!e.ok)return m();let s=await e.json(),a=1e3*s.expires_in,r=Date.now()+a-Math.min(5e3,Math.max(1e3,.08*a)),n={accessToken:s.access_token,expiresAt:r,user:s.user};d(n),i({...n,refreshToken:t.refreshToken})}catch(e){m()}finally{h._inFlight=!1}}},[t.refreshToken,m]);(0,r.useEffect)(()=>{if(!t.expiresAt)return;let e=t.expiresAt-Date.now();if(e<=0){h();return}let s=e-.12*e;s<1500&&(s=Math.min(Math.max(e-500,0),1500));let a=setTimeout(()=>h(),s);return()=>clearTimeout(a)},[t.expiresAt,h]);let x={...t,login:o,register:u,logout:m,refresh:h};return a.jsx(n.Provider,{value:x,children:e})};function c(){let e=(0,r.useContext)(n);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},3389:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(5347).createProxy)(String.raw`/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/admin/page.tsx#default`)},9458:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c,metadata:()=>d});var a=s(2051),r=s(1312),n=s.n(r);s(7272);var l=s(5347);let i=(0,l.createProxy)(String.raw`/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/src/context/AuthContext.tsx#AuthProvider`);(0,l.createProxy)(String.raw`/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/src/context/AuthContext.tsx#useAuth`);let d={title:"Technical Services Assistant",description:"Intelligent document search and chat with RAG capabilities"};function c({children:e}){return a.jsx("html",{lang:"en",children:a.jsx("body",{className:n().className,children:a.jsx(i,{children:a.jsx("div",{className:"min-h-screen bg-background",children:e})})})})}},7272:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[9379,2704,9906],()=>s(462));module.exports=a})();