(()=>{var e={};e.id=3,e.ids=[3],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},462:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>h,tree:()=>d}),s(8748),s(356),s(5866);var r=s(3191),a=s(8716),n=s(7922),i=s.n(n),l=s(5231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let d=["",{children:["admin",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,8748)),"/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/admin/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,356)),"/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/admin/page.tsx"],u="/admin/page",m={require:s,loadChunk:()=>Promise.resolve()},h=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/page",pathname:"/admin",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},8108:(e,t,s)=>{Promise.resolve().then(s.bind(s,3506))},2303:(e,t,s)=>{Promise.resolve().then(s.bind(s,4690))},3649:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},3506:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>_});var r=s(326),a=s(7577),n=s(4690),i=s(7863);let l={active:"active",inactive:"disabled",suspended:"disabled",pending_verification:"pending"},o={active:"active",disabled:"inactive",pending:"pending_verification"};function d(e){if(!e)return null;let t=e.trim();return t.length?t:null}function c(e){let t="first_name"in e?e.first_name:null,s="last_name"in e?e.last_name:null,r=t?.trim()??"",a=s?.trim()??"",n=("full_name"in e?e.full_name?.trim()??"":"")||`${r} ${a}`.trim()||e.email,i=("string"==typeof e.status?e.status:void 0)??"active";return{id:e.id,email:e.email,first_name:d(t),last_name:d(s),role_id:function(e){if("number"==typeof e)return e;if("string"==typeof e){let t=Number.parseInt(e,10);if(Number.isFinite(t))return t}return 0}(e.role_id),role_name:e.role_name??"",status:l[i]??"active",full_name:n,verified:!!(!("verified"in e)||e.verified),created_at:e.created_at,updated_at:e.updated_at}}function u(e){return{id:e.id,name:e.name,description:e.description??null,permissions:Array.isArray(e.permissions)?e.permissions:[],system:!!("boolean"==typeof e.is_system?e.is_system:"boolean"==typeof e.system?e.system:e.is_system_role),user_count:"number"==typeof e.user_count?e.user_count:0}}async function m(e){try{let t=await e.clone().json();if("string"==typeof t?.detail)return Error(t.detail);if("string"==typeof t?.message)return Error(t.message)}catch{}return Error(e.statusText||"Request failed")}async function h(e,t,s){let r=new Headers(s?.headers);r.set("Authorization",`Bearer ${t}`),s?.body&&!r.has("Content-Type")&&r.set("Content-Type","application/json");let a=await fetch((0,i.G)(e),{...s,headers:r,cache:"no-store"});if(!a.ok)throw await m(a);if(204!==a.status)return await a.json()}async function p(e){let t=new URLSearchParams;e.limit&&t.set("limit",String(e.limit)),e.offset&&t.set("offset",String(e.offset)),e.search&&t.set("search",e.search.trim());let s=t.toString(),r=await h(`/api/admin/users${s?`?${s}`:""}`,e.accessToken,{method:"GET"}),a=Array.isArray(r?.items)?r.items:Array.isArray(r?.users)?r.users:[],n="number"==typeof r?.limit?r.limit:"number"==typeof r?.page_size?r.page_size:a.length,i="number"==typeof r?.offset?r.offset:"number"==typeof r?.page&&n?Math.max(r.page-1,0)*n:0,l="number"==typeof r?.total?r.total:"number"==typeof r?.count?r.count:a.length;return{users:a.map(c),total:l,limit:n,offset:i}}async function x(e){let t=await h("/api/admin/roles",e,{method:"GET"});return(Array.isArray(t)?t:Array.isArray(t?.items)?t.items:[]).map(u)}async function f(e,t,s){let r={};return"number"==typeof s.role_id&&(r.role_id=s.role_id),s.status&&(r.status=o[s.status]??s.status),c(await h(`/api/admin/users/${t}`,e,{method:"PATCH",body:JSON.stringify(r)}))}async function g(e,t){await h(`/api/admin/users/${t}`,e,{method:"DELETE"})}async function y(e,t,s){return u(await h(`/api/admin/roles/${t}`,e,{method:"PATCH",body:JSON.stringify(s)}))}async function b(e,t){let s=await fetch((0,i.G)("/api/auth/register"),{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(t),cache:"no-store"});if(!s.ok)throw await m(s);let r=await s.json(),a=c({...r,role_name:r.role_name??"",status:r.status??"pending_verification"});return r.full_name&&(a.full_name=r.full_name),a}var j=s(434),v=s(165);let N=(0,s(2881).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);function _(){let{user:e,accessToken:t,loading:s}=(0,n.a)(),[i,l]=(0,a.useState)([]),[o,d]=(0,a.useState)([]),[c,u]=(0,a.useState)(!0),[m,h]=(0,a.useState)(null),[_,w]=(0,a.useState)(""),[A,k]=(0,a.useState)(null),[T,P]=(0,a.useState)(null),[S,C]=(0,a.useState)(!1),[U,H]=(0,a.useState)({email:"",password:"",first_name:"",last_name:"",role_id:2}),[q,E]=(0,a.useState)(!1),[R,D]=(0,a.useState)(null),L=async()=>{try{u(!0);let[e,s]=await Promise.all([p({accessToken:t,search:_}),x(t)]);l(Array.isArray(e?.users)?e.users:[]),d(Array.isArray(s)?s:[]),h(null)}catch(e){h(e.message||"Failed to load admin data")}finally{u(!1)}},M=async(e,s)=>{try{k(e);let r=await f(t,e,{role_id:s});l(t=>t.map(t=>t.id===e?r:t))}catch(e){alert(e.message)}finally{k(null)}},$=async(e,s)=>{try{k(e);let r=await f(t,e,{status:s});l(t=>t.map(t=>t.id===e?r:t))}catch(e){alert(e.message)}finally{k(null)}},F=async(e,s)=>{try{P(e);let r=await y(t,e,{description:s});d(t=>t.map(t=>t.id===e?r:t))}catch(e){alert(e.message)}finally{P(null)}},O=async e=>{let s=i.find(t=>t.id===e);if(s&&confirm(`Delete user ${s.email}? This action cannot be undone.`))try{D(e),await g(t,e),l(t=>t.filter(t=>t.id!==e))}catch(e){alert(e.message||"Failed to delete user")}finally{D(null)}},G=async e=>{if(e.preventDefault(),!U.email||!U.password){alert("Email and password are required");return}try{E(!0);let e=await b(t,U);l(t=>[e,...t]),H({email:"",password:"",first_name:"",last_name:"",role_id:2}),C(!1),alert("User created successfully!")}catch(e){alert(e.message||"Failed to create user")}finally{E(!1)}};if(s||c)return r.jsx("div",{className:"flex items-center justify-center h-screen text-muted-foreground",children:"Loading..."});if(!e)return(0,r.jsxs)("div",{className:"p-8 text-center space-y-4",children:[r.jsx("h1",{className:"text-2xl font-semibold",children:"Authentication Required"}),r.jsx("p",{className:"text-muted-foreground",children:"You must be logged in to view this page."}),r.jsx(j.default,{href:"/login",className:"underline",children:"Go to Login"})]});if("admin"!==e.role_name)return(0,r.jsxs)("div",{className:"p-8 text-center space-y-4",children:[r.jsx("h1",{className:"text-2xl font-semibold",children:"Access Denied"}),r.jsx("p",{className:"text-muted-foreground",children:"You do not have permission to view administrative controls."}),r.jsx(j.default,{href:"/",className:"underline",children:"Return Home"})]});let z=Array.isArray(o)?o:[],I=Array.isArray(i)?i:[];return(0,r.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,r.jsxs)("div",{className:"border-b p-4 flex items-center justify-between bg-muted/30",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(j.default,{href:"/",className:"text-muted-foreground hover:text-foreground mr-2",children:"← Back"}),r.jsx(v.Z,{className:"h-5 w-5"}),r.jsx("h1",{className:"text-xl font-semibold",children:"Admin Dashboard"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[r.jsx("input",{className:"border rounded px-2 py-1 text-sm",placeholder:"Search users",value:_,onChange:e=>w(e.target.value)}),(0,r.jsxs)("button",{onClick:L,className:"inline-flex items-center gap-1 border rounded px-3 py-1 text-sm hover:bg-muted",children:[r.jsx(N,{className:"h-4 w-4"})," Refresh"]})]})]}),m&&r.jsx("div",{className:"p-4 text-sm text-red-600",children:m}),c?r.jsx("div",{className:"flex-1 flex items-center justify-center text-muted-foreground",children:"Loading..."}):(0,r.jsxs)("div",{className:"flex-1 overflow-auto p-6 space-y-10",children:[(0,r.jsxs)("section",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[r.jsx("h2",{className:"text-lg font-medium",children:"Users"}),r.jsx("button",{onClick:()=>C(!S),className:"px-3 py-1 bg-primary text-primary-foreground rounded text-sm hover:bg-primary/90",children:S?"Cancel":"Add User"})]}),S&&(0,r.jsxs)("div",{className:"mb-4 p-4 border rounded bg-muted/20",children:[r.jsx("h3",{className:"text-md font-medium mb-3",children:"Create New User"}),(0,r.jsxs)("form",{onSubmit:G,className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Email *"}),r.jsx("input",{type:"email",required:!0,value:U.email,onChange:e=>H(t=>({...t,email:e.target.value})),className:"w-full border rounded px-2 py-1 text-sm"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Password *"}),r.jsx("input",{type:"password",required:!0,value:U.password,onChange:e=>H(t=>({...t,password:e.target.value})),className:"w-full border rounded px-2 py-1 text-sm"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"First Name"}),r.jsx("input",{type:"text",value:U.first_name,onChange:e=>H(t=>({...t,first_name:e.target.value})),className:"w-full border rounded px-2 py-1 text-sm"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Last Name"}),r.jsx("input",{type:"text",value:U.last_name,onChange:e=>H(t=>({...t,last_name:e.target.value})),className:"w-full border rounded px-2 py-1 text-sm"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Role"}),r.jsx("select",{value:U.role_id,onChange:e=>H(t=>({...t,role_id:Number(e.target.value)})),className:"w-full border rounded px-2 py-1 text-sm",children:z.map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))})]}),r.jsx("div",{className:"flex items-end",children:r.jsx("button",{type:"submit",disabled:q,className:"px-4 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700 disabled:opacity-50",children:q?"Creating...":"Create User"})})]})]}),r.jsx("div",{className:"overflow-x-auto border rounded",children:(0,r.jsxs)("table",{className:"min-w-full text-sm",children:[r.jsx("thead",{className:"bg-muted/50",children:(0,r.jsxs)("tr",{className:"text-left",children:[r.jsx("th",{className:"p-2",children:"ID"}),r.jsx("th",{className:"p-2",children:"Email"}),r.jsx("th",{className:"p-2",children:"Name"}),r.jsx("th",{className:"p-2",children:"Role"}),r.jsx("th",{className:"p-2",children:"Status"}),r.jsx("th",{className:"p-2",children:"Verified"}),r.jsx("th",{className:"p-2",children:"Updated"}),r.jsx("th",{className:"p-2",children:"Actions"})]})}),(0,r.jsxs)("tbody",{children:[I.map(t=>(0,r.jsxs)("tr",{className:"border-t",children:[r.jsx("td",{className:"p-2 font-mono text-xs",children:t.id}),r.jsx("td",{className:"p-2",children:t.email}),r.jsx("td",{className:"p-2",children:t.full_name}),r.jsx("td",{className:"p-2",children:r.jsx("select",{className:"border rounded px-1 py-0.5 text-xs",value:t.role_id,disabled:A===t.id,onChange:e=>M(t.id,Number(e.target.value)),children:z.map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))})}),r.jsx("td",{className:"p-2",children:(0,r.jsxs)("select",{className:"border rounded px-1 py-0.5 text-xs",value:t.status,disabled:A===t.id,onChange:e=>$(t.id,e.target.value),children:[r.jsx("option",{value:"active",children:"active"}),r.jsx("option",{value:"disabled",children:"disabled"}),r.jsx("option",{value:"pending",children:"pending"})]})}),r.jsx("td",{className:"p-2 text-center",children:t.verified?"✅":"❌"}),r.jsx("td",{className:"p-2 text-xs text-muted-foreground",children:t.updated_at?.replace("T"," ").substring(0,16)}),r.jsx("td",{className:"p-2",children:r.jsx("button",{onClick:()=>O(t.id),disabled:R===t.id||t.id===e.id,className:"text-xs px-2 py-0.5 rounded border border-red-600 text-red-600 hover:bg-red-600 hover:text-white disabled:opacity-40",title:t.id===e.id?"Cannot delete current logged in user":"Delete user",children:R===t.id?"Deleting...":"Delete"})})]},t.id)),0===i.length&&r.jsx("tr",{children:r.jsx("td",{colSpan:8,className:"p-4 text-center text-muted-foreground",children:"No users found."})})]})]})})]}),(0,r.jsxs)("section",{children:[r.jsx("h2",{className:"text-lg font-medium mb-3",children:"Roles"}),r.jsx("div",{className:"overflow-x-auto border rounded",children:(0,r.jsxs)("table",{className:"min-w-full text-sm",children:[r.jsx("thead",{className:"bg-muted/50",children:(0,r.jsxs)("tr",{className:"text-left",children:[r.jsx("th",{className:"p-2",children:"ID"}),r.jsx("th",{className:"p-2",children:"Name"}),r.jsx("th",{className:"p-2",children:"Description"}),r.jsx("th",{className:"p-2",children:"System"}),r.jsx("th",{className:"p-2",children:"Permissions"})]})}),r.jsx("tbody",{children:z.map(e=>(0,r.jsxs)("tr",{className:"border-t",children:[r.jsx("td",{className:"p-2 font-mono text-xs",children:e.id}),r.jsx("td",{className:"p-2 font-medium",children:e.name}),r.jsx("td",{className:"p-2",children:e.system?r.jsx("span",{className:"text-muted-foreground text-xs",children:e.description||"—"}):r.jsx("input",{className:"border rounded px-1 py-0.5 text-xs w-56",defaultValue:e.description||"",disabled:T===e.id,onBlur:t=>{t.target.value!==e.description&&F(e.id,t.target.value)}})}),r.jsx("td",{className:"p-2 text-center",children:e.system?"\uD83D\uDD12":""}),r.jsx("td",{className:"p-2 text-xs",children:(0,r.jsxs)("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(e.permissions||[]).map(e=>r.jsx("span",{className:"px-1.5 py-0.5 rounded bg-secondary text-[10px] tracking-wide uppercase",children:e},e)),(!e.permissions||0===e.permissions.length)&&r.jsx("span",{className:"text-muted-foreground",children:"—"})]})})]},e.id))})]})})]})]})]})}},7863:(e,t,s)=>{"use strict";s.d(t,{G:()=>i,cn:()=>n});var r=s(1135),a=s(1009);function n(...e){return(0,a.m6)((0,r.W)(e))}function i(e){return e}},2881:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o});var r=s(7577);let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=(...e)=>e.filter((e,t,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim();var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,r.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:s=2,absoluteStrokeWidth:a,className:l="",children:o,iconNode:d,...c},u)=>(0,r.createElement)("svg",{ref:u,...i,width:t,height:t,stroke:e,strokeWidth:a?24*Number(s)/Number(t):s,className:n("lucide",l),...c},[...d.map(([e,t])=>(0,r.createElement)(e,t)),...Array.isArray(o)?o:[o]])),o=(e,t)=>{let s=(0,r.forwardRef)(({className:s,...i},o)=>(0,r.createElement)(l,{ref:o,iconNode:t,className:n(`lucide-${a(e)}`,s),...i}));return s.displayName=`${e}`,s}},165:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(2881).Z)("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]])},4690:(e,t,s)=>{"use strict";s.d(t,{AuthProvider:()=>o,a:()=>d});var r=s(326),a=s(7577);let n=(0,a.createContext)(void 0),i="tsa_auth_v1";function l(e){try{localStorage.setItem(i,JSON.stringify(e))}catch(e){}}let o=({children:e})=>{let[t,s]=(0,a.useState)({user:null,accessToken:null,refreshToken:null,expiresAt:null,loading:!0,error:null}),o=e=>s(t=>({...t,...e})),d=e=>e;(0,a.useEffect)(()=>{let e=!1;return(async()=>{console.log("[AUTH] Initializing auth context");let t=function(){try{let e=localStorage.getItem(i);if(!e)return null;return JSON.parse(e)}catch(e){return null}}();if(console.log("[AUTH] Persisted state:",t?"Found tokens":"No tokens"),!t?.accessToken){console.log("[AUTH] No access token found, setting loading false"),e||o({loading:!1});return}console.log("[AUTH] Found access token, loading user profile"),o({...t,loading:!0});try{let t=await fetch(d("/api/auth/health")).catch(()=>null);if(!t||!t.ok&&404!==t.status){e||o({loading:!1,error:"Auth service unavailable"});return}}catch(t){e||o({loading:!1,error:"Auth service unavailable"});return}try{console.log("[AUTH] Fetching user profile from /api/auth/me");let s=await fetch(d("/api/auth/me"),{headers:{Authorization:`Bearer ${t.accessToken}`}});if(console.log("[AUTH] Profile fetch response status:",s.status),s.ok){let t=await s.json();console.log("[AUTH] Profile loaded:",{id:t.id,email:t.email,password_change_required:t.password_change_required}),e||o({user:t,loading:!1})}else e||(o({loading:!1,accessToken:null,refreshToken:null,user:null}),l({}))}catch(t){e||o({loading:!1})}})(),()=>{e=!0}},[]);let c=(0,a.useCallback)(async(e,t)=>{console.log("[AUTH] Login attempt for:",e),o({loading:!0,error:null});try{console.log("[AUTH] Sending login request to:",d("/api/auth/login"));let s=await fetch(d("/api/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(console.log("[AUTH] Login response status:",s.status),!s.ok){let e="Login failed";try{let t=await s.json();t&&"string"==typeof t.detail&&(e=t.detail)}catch(e){}return o({loading:!1,error:e}),!1}let r=null;try{r=await s.json()}catch(e){return o({loading:!1,error:"Malformed server response"}),!1}if(console.log("[AUTH] Login response data:",{hasAccessToken:!!r.access_token,hasRefreshToken:!!r.refresh_token,hasUser:!!r.user,userPasswordChangeRequired:r.user?.password_change_required}),!r||"object"!=typeof r||!r.access_token||!r.refresh_token||"number"!=typeof r.expires_in||!r.user)return console.log("[AUTH] Invalid login response data"),o({loading:!1,error:"Unexpected auth response"}),!1;let a=Number.isFinite(r.expires_in)?r.expires_in:0,n=Date.now()+Math.max(0,1e3*a-5e3),i={accessToken:r.access_token,refreshToken:r.refresh_token,expiresAt:n,user:r.user};return console.log("[AUTH] Login successful, setting user state:",{email:r.user.email,password_change_required:r.user.password_change_required}),o({...i,loading:!1}),l(i),!0}catch(e){return o({loading:!1,error:"Network error"}),!1}},[]),u=(0,a.useCallback)(async e=>{o({loading:!0,error:null});try{let t=await fetch(d("/api/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,role_id:e.role_id||2})});if(!t.ok){let e=(await t.json().catch(()=>({}))).detail||"Registration failed";return o({loading:!1,error:e}),!1}return o({loading:!1}),!0}catch(e){return o({loading:!1,error:"Network error"}),!1}},[]),m=(0,a.useCallback)(()=>{o({user:null,accessToken:null,refreshToken:null,expiresAt:null}),l({})},[]);(0,a.useEffect)(()=>{if(globalThis._tsaFetchWrapped)return;let e=fetch;globalThis._tsaFetchWrapped=!0,globalThis.fetch=async(...t)=>{let s=await e(...t);if(401===s.status){let e="string"==typeof t[0]?t[0]:t[0].url;e.includes("/api/auth/login")||e.includes("/api/auth/register")||m()}return s}},[m]);let h=(0,a.useCallback)(async()=>{if(console.log("[AUTH] Refresh called"),!t.refreshToken){console.log("[AUTH] No refresh token available");return}if(h._inFlight){console.log("[AUTH] Refresh already in flight");return}console.log("[AUTH] Starting token refresh"),h._inFlight=!0;try{let e=await fetch(d("/api/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:t.refreshToken})});if(console.log("[AUTH] Refresh response status:",e.status),!e.ok)return console.log("[AUTH] Refresh failed, logging out"),m();let s=await e.json();console.log("[AUTH] Refresh successful, updated user:",{email:s.user?.email,password_change_required:s.user?.password_change_required});let r=1e3*s.expires_in,a=Date.now()+r-Math.min(5e3,Math.max(1e3,.08*r)),n={accessToken:s.access_token,expiresAt:a,user:s.user};o(n),l({...n,refreshToken:t.refreshToken})}catch(e){m()}finally{h._inFlight=!1}},[t.refreshToken,m]);(0,a.useEffect)(()=>{if(!t.expiresAt)return;let e=t.expiresAt-Date.now();if(e<=0){h();return}let s=e-.12*e;s<1500&&(s=Math.min(Math.max(e-500,0),1500));let r=setTimeout(()=>h(),s);return()=>clearTimeout(r)},[t.expiresAt,h]);let p={...t,login:c,register:u,logout:m,refresh:h};return r.jsx(n.Provider,{value:p,children:e})};function d(){let e=(0,a.useContext)(n);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},8748:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(8570).createProxy)(String.raw`/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/app/admin/page.tsx#default`)},356:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l,metadata:()=>i});var r=s(9510);s(7272);var a=s(8570);let n=(0,a.createProxy)(String.raw`/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/src/context/AuthContext.tsx#AuthProvider`);(0,a.createProxy)(String.raw`/home/kmccullor/Projects/Technical-Service-Assistant/next-rag-app/src/context/AuthContext.tsx#useAuth`);let i={title:"Technical Services Assistant",description:"Intelligent document search and chat with RAG capabilities"};function l({children:e}){return r.jsx("html",{lang:"en",children:r.jsx("body",{className:"font-sans antialiased",children:r.jsx(n,{children:r.jsx("div",{className:"min-h-screen bg-background",children:e})})})})}},7272:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[8948,4471,325,434],()=>s(462));module.exports=r})();