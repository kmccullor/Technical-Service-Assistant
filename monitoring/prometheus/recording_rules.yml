groups:
  - name: performance_monitor_recording
    interval: 60s
    rules:
      - record: ingestion:last_success_age_seconds
        expr: time() - tsa_last_ingestion_timestamp
      - record: ingestion:avg_processing_time_seconds
        expr: tsa_avg_processing_time_seconds
      - record: ingestion:last_refresh_age_seconds
        expr: time() - tsa_last_refresh_timestamp
      - record: performance_monitor:refresh_duration_seconds:p95_15m
        expr: histogram_quantile(0.95, sum by (le) (rate(tsa_refresh_duration_seconds_bucket[15m])))
      - record: performance_monitor:refresh_duration_seconds:avg_5m
        expr: rate(tsa_refresh_duration_seconds_sum[5m]) / rate(tsa_refresh_duration_seconds_count[5m])
      - record: performance_monitor:refresh_errors_rate:5m
        expr: rate(tsa_refresh_errors_total[5m])
